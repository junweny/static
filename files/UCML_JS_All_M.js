UCML={version:"2.3.8.5",updated:"2013-12-27"};if(window["UCML_Services"]){if(UCML_Services.version>UCML.version){alert("您的前端框架与后台DLL不匹配，请更新")}}UCML.apply=function(o,c,defaults){if(defaults){UCML.apply(o,defaults)}if(o&&c&&typeof c=="object"){for(var p in c){o[p]=c[p]}}return o};(function(){var idSeed=0,toString=Object.prototype.toString,ua=navigator.userAgent.toLowerCase(),check=function(r){return r.test(ua)},DOC=document,isStrict=DOC.compatMode=="CSS1Compat",isOpera=check(/opera/),isChrome=check(/chrome/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&check(/msie 7/),isIE8=isIE&&check(/msie 8/),isIE6=isIE&&!isIE7&&!isIE8,isGecko=!isWebKit&&check(/gecko/),isGecko2=isGecko&&check(/rv:1\.8/),isGecko3=isGecko&&check(/rv:1\.9/),isBorderBox=isIE&&!isStrict,isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),isSecure=/^https/i.test(window.location.protocol);if(isIE6){try{DOC.execCommand("BackgroundImageCache",false,true)}catch(e){}}UCML.apply(UCML,{SSL_SECURE_URL:isSecure&&isIE?'javascript:""':"about:blank",isStrict:isStrict,isSecure:isSecure,isReady:false,enableGarbageCollector:true,enableListenerCollection:false,enableNestedListenerRemoval:false,USE_NATIVE_JSON:false,applyIf:function(o,c){if(o){for(var p in c){if(!UCML.isDefined(o[p])){o[p]=c[p]}}}return o},id:function(el,prefix){return(el=UCML.getDom(el)||{}).id=el.id||(prefix||"UCML-gen")+ ++idSeed},extend:function(){var io=function(o){for(var m in o){this[m]=o[m]}};var oc=Object.prototype.constructor;return function(sb,sp,overrides){if(UCML.isObject(sp)){overrides=sp;sp=sb;sb=overrides.constructor!=oc?overrides.constructor:function(){sp.apply(this,arguments)}}var F=function(){},sbp,spp=sp.prototype;F.prototype=spp;sbp=sb.prototype=new F;sbp.constructor=sb;sb.superclass=spp;if(spp.constructor==oc){spp.constructor=sp}sb.override=function(o){UCML.override(sb,o)};sbp.superclass=sbp.supr=function(){return spp};sbp.override=io;UCML.override(sb,overrides);sb.extend=function(o){return UCML.extend(sb,o)};return sb}}(),override:function(origclass,overrides){if(overrides){var p=origclass.prototype;UCML.apply(p,overrides);if(UCML.isIE&&overrides.hasOwnProperty("toString")){p.toString=overrides.toString}}},namespace:function(){var o,d;UCML.each(arguments,function(v){d=v.split(".");o=window[d[0]]=window[d[0]]||{};UCML.each(d.slice(1),function(v2){o=o[v2]=o[v2]||{}})});return o},emptyFn:function(){},urlEncode:function(o,pre){var empty,buf=[],e=encodeURIComponent;UCML.iterate(o,function(key,item){empty=UCML.isEmpty(item);UCML.each(empty?key:item,function(val){buf.push("&",e(key),"=",!UCML.isEmpty(val)&&(val!=key||!empty)?UCML.isDate(val)?UCML.encode(val).replace(/"/g,""):e(val):"")})});if(!pre){buf.shift();pre=""}return pre+buf.join("")},urlDecode:function(string,overwrite){if(UCML.isEmpty(string)){return{}}var obj={},pairs=string.split("&"),d=decodeURIComponent,name,value;UCML.each(pairs,function(pair){pair=pair.split("=");name=d(pair[0]);value=d(pair[1]);obj[name]=overwrite||!obj[name]?value:[].concat(obj[name]).concat(value)});return obj},urlAppend:function(url,s){if(!UCML.isEmpty(s)){return url+(url.indexOf("?")===-1?"?":"&")+s}return url},toArray:function(){return isIE?function(a,i,j,res){res=[];for(var x=0,len=a.length;x<len;x++){res.push(a[x])}return res.slice(i||0,j||res.length)}:function(a,i,j){return Array.prototype.slice.call(a,i||0,j||a.length)}}(),isIterable:function(v){if(UCML.isArray(v)||v.callee){return true}if(/NodeList|HTMLCollection/.test(toString.call(v))){return true}return(v.nextNode||v.item)&&UCML.isNumber(v.length)},each:function(array,fn,scope){if(UCML.isEmpty(array,true)){return}if(!UCML.isIterable(array)||UCML.isPrimitive(array)){array=[array]}for(var i=0,len=array.length;i<len;i++){if(fn.call(scope||array[i],array[i],i,array)===false){return i}}},getDom:function(el){if(!el||!DOC){return null}return el.dom?el.dom:UCML.isString(el)?DOC.getElementById(el):el},getBody:function(){return UCML.get(DOC.body||DOC.documentElement)},isEmpty:function(v,allowBlank){return v===null||v===undefined||UCML.isArray(v)&&!v.length||(!allowBlank?v==="":false)},isArray:function(v){return toString.apply(v)==="[object Array]"},isDate:function(v){return toString.apply(v)==="[object Date]"},isObject:function(v){return!!v&&Object.prototype.toString.call(v)==="[object Object]"},isPrimitive:function(v){return UCML.isString(v)||UCML.isNumber(v)||UCML.isBoolean(v)},isFunction:function(v){return toString.apply(v)==="[object Function]"},isNumber:function(v){return typeof v==="number"&&isFinite(v)},isString:function(v){return typeof v==="string"},isBoolean:function(v){return typeof v==="boolean"},isElement:function(v){return!!v&&v.tagName},isDefined:function(v){return typeof v!=="undefined"},transXMLToText:function(result){var text=result.text;if(UCML.isIE){text=result.documentElement.text}else{text=result.documentElement.textContent}return text},isOpera:isOpera,isWebKit:isWebKit,isChrome:isChrome,isSafari:isSafari,isSafari3:isSafari3,isSafari4:isSafari4,isSafari2:isSafari2,isIE:isIE,isIE6:isIE6,isIE7:isIE7,isIE8:isIE8,isGecko:isGecko,isGecko2:isGecko2,isGecko3:isGecko3,isBorderBox:isBorderBox,isLinux:isLinux,isWindows:isWindows,isMac:isMac,isAir:isAir});UCML.ns=UCML.namespace})();UCML.apply(Function.prototype,{createInterceptor:function(fcn,scope){var method=this;return!UCML.isFunction(fcn)?this:function(){var me=this,args=arguments;fcn.target=me;fcn.method=method;return fcn.apply(scope||me||window,args)!==false?method.apply(me||window,args):null}},createCallback:function(){var args=arguments,method=this;return function(){return method.apply(window,args)}},createDelegate:function(obj,args,appendArgs){var method=this;return function(){var callArgs=args||arguments;if(appendArgs===true){callArgs=Array.prototype.slice.call(arguments,0);callArgs=callArgs.concat(args)}else if(UCML.isNumber(appendArgs)){callArgs=Array.prototype.slice.call(arguments,0);var applyArgs=[appendArgs,0].concat(args);Array.prototype.splice.apply(callArgs,applyArgs)}return method.apply(obj||window,callArgs)}},defer:function(millis,obj,args,appendArgs){var fn=this.createDelegate(obj,args,appendArgs);if(millis>0){return setTimeout(fn,millis)}fn();return 0}});UCML.applyIf(String,{format:function(format){var args=UCML.toArray(arguments,1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i]})},formatToArray:function(format,array){return format.replace(/\{(\d+)\}/g,function(m,i){return array[i]})}});UCML.applyIf(Array.prototype,{indexOf:function(o,from){var len=this.length;from=from||0;from+=from<0?len:0;for(;from<len;++from){if(this[from]===o){return from}}return-1},add:function(o){this[this.length]=o;return o},remove:function(o){var index=this.indexOf(o);if(index!=-1){this.splice(index,1)}return this}});UCML.apply(Function.prototype,{createSequence:function(fcn,scope){var method=this;return!UCML.isFunction(fcn)?this:function(){var retval=method.apply(this||window,arguments);fcn.apply(scope||this||window,arguments);return retval}}});UCML.applyIf(String,{escape:function(string){return string.replace(/('|\\)/g,"\\$1")},leftPad:function(val,size,ch){var result=String(val);if(!ch){ch=" "}while(result.length<size){result=ch+result}return result}});String.prototype.toggle=function(value,other){return this==value?other:value};String.prototype.trim=function(){var re=/^\s+|\s+$/g;return function(){return this.replace(re,"")}}();Date.prototype.getElapsed=function(date){return Math.abs((date||new Date).getTime()-this.getTime())};Date.prototype.add=function(milliseconds){var m=this.getTime()+milliseconds;return new Date(m)};Date.prototype.addSeconds=function(second){return this.add(second*1e3)};Date.prototype.addMinutes=function(minute){return this.addSeconds(minute*60)};Date.prototype.addHours=function(hour){return this.addMinutes(60*hour)};Date.prototype.addDays=function(day){return this.addHours(day*24)};Date.isLeepYear=function(year){return year%4==0&&year%100!=0||year%400==0};Date.daysInMonth=function(year,month){if(month==2){if(year%4==0&&year%100!=0||year%400==0)return 29;else return 28}else if(month<=7&&month%2==1||month>7&&month%2==0)return 31;else return 30};Date.prototype.addMonth=function(){var m=this.getMonth();if(m==11)return new Date(this.getFullYear()+1,0,this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds());var daysInNextMonth=Date.daysInMonth(this.getFullYear(),this.getMonth()+1);var day=this.getDate();if(day>daysInNextMonth){day=daysInNextMonth}return new Date(this.getFullYear(),this.getMonth()+1,day,this.getHours(),this.getMinutes(),this.getSeconds())};Date.prototype.subMonth=function(){var m=this.getMonth();if(m==0)return new Date(this.getFullYear()-1,11,this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds());var day=this.getDate();var daysInPreviousMonth=Date.daysInMonth(this.getFullYear(),this.getMonth());if(day>daysInPreviousMonth){day=daysInPreviousMonth}return new Date(this.getFullYear(),this.getMonth()-1,day,this.getHours(),this.getMinutes(),this.getSeconds())};Date.prototype.addMonths=function(addMonth){var result=this;if(addMonth>0){while(addMonth>0){result=result.addMonth();addMonth--}}else if(addMonth<0){while(addMonth<0){result=result.subMonth();addMonth++}}else{result=this}return result};Date.prototype.addYears=function(year){return new Date(parseInt(this.getFullYear())+parseInt(year),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds())};UCML.applyIf(Number.prototype,{constrain:function(min,max){return Math.min(Math.max(this,min),max)}});UCML.ns("UCML.util");(function(){var UCMLUTIL=UCML.util,TOARRAY=UCML.toArray,EACH=UCML.each,ISOBJECT=UCML.isObject,TRUE=true,FALSE=false;UCMLUTIL.Observable=function(){var me=this,e=me.events;if(me.listeners){me.on(me.listeners);delete me.listeners}me.events=e||{}};UCMLUTIL.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var a=TOARRAY(arguments),ename=a[0].toLowerCase(),me=this,ret=TRUE,ce=me.events[ename],q,c;if(me.eventsSuspended===TRUE){if(q=me.eventQueue){q.push(a)}}else if(ISOBJECT(ce)&&ce.bubble){if(ce.fire.apply(ce,a.slice(1))===FALSE){return FALSE}c=me.getBubbleTarget&&me.getBubbleTarget();if(c&&c.enableBubble){if(!c.events[ename]||!UCML.isObject(c.events[ename])||!c.events[ename].bubble){c.enableBubble(ename)}return c.fireEvent.apply(c,a)}}else{if(ISOBJECT(ce)){a.shift();ret=ce.fire.apply(ce,a)}}return ret},addListener:function(eventName,fn,scope,o){var me=this,e,oe,isF,ce;if(ISOBJECT(eventName)){o=eventName;for(e in o){oe=o[e];if(!me.filterOptRe.test(e)){me.addListener(e,oe.fn||oe,oe.scope||o.scope,oe.fn?oe:o)}}}else{eventName=eventName.toLowerCase();ce=me.events[eventName]||TRUE;if(UCML.isBoolean(ce)){me.events[eventName]=ce=new UCMLUTIL.Event(me,eventName)}ce.addListener(fn,scope,ISOBJECT(o)?o:{})}},removeListener:function(eventName,fn,scope){var ce=this.events[eventName.toLowerCase()];if(ISOBJECT(ce)){ce.removeListener(fn,scope)}},purgeListeners:function(){var events=this.events,evt,key;for(key in events){evt=events[key];if(ISOBJECT(evt)){evt.clearListeners()}}},addEvents:function(o){var me=this;me.events=me.events||{};if(UCML.isString(o)){var a=arguments,i=a.length;while(i--){me.events[a[i]]=me.events[a[i]]||TRUE}}else{UCML.applyIf(me.events,o)}},hasListener:function(eventName){var e=this.events[eventName];return ISOBJECT(e)&&e.listeners.length>0},suspendEvents:function(queueSuspended){this.eventsSuspended=TRUE;if(queueSuspended&&!this.eventQueue){this.eventQueue=[]}},resumeEvents:function(){var me=this,queued=me.eventQueue||[];me.eventsSuspended=FALSE;delete me.eventQueue;EACH(queued,function(e){me.fireEvent.apply(me,e)})}};var OBSERVABLE=UCMLUTIL.Observable.prototype;OBSERVABLE.on=OBSERVABLE.addListener;OBSERVABLE.un=OBSERVABLE.removeListener;UCMLUTIL.Observable.releaseCapture=function(o){o.fireEvent=OBSERVABLE.fireEvent};function createTargeted(h,o,scope){return function(){if(o.target==arguments[0]){h.apply(scope,TOARRAY(arguments))}}}function createBuffered(h,o,fn,scope){fn.task=new UCMLUTIL.DelayedTask;return function(){fn.task.delay(o.buffer,h,scope,TOARRAY(arguments))}}function createSingle(h,e,fn,scope){return function(){e.removeListener(fn,scope);return h.apply(scope,arguments)}}function createDelayed(h,o,fn,scope){return function(){var task=new UCMLUTIL.DelayedTask;if(!fn.tasks){fn.tasks=[]}fn.tasks.push(task);task.delay(o.delay||10,h,scope,TOARRAY(arguments))}}UCMLUTIL.Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[]};UCMLUTIL.Event.prototype={addListener:function(fn,scope,options){var me=this,l;scope=scope||me.obj;if(!me.isListening(fn,scope)){l=me.createListener(fn,scope,options);if(me.firing){me.listeners=me.listeners.slice(0)}me.listeners.push(l)}},createListener:function(fn,scope,o){o=o||{},scope=scope||this.obj;var l={fn:fn,scope:scope,options:o},h=fn;if(o.target){h=createTargeted(h,o,scope)}if(o.delay){h=createDelayed(h,o,fn,scope)}if(o.single){h=createSingle(h,this,fn,scope)}if(o.buffer){h=createBuffered(h,o,fn,scope)}l.fireFn=h;return l},findListener:function(fn,scope){var list=this.listeners,i=list.length,l,s;while(i--){l=list[i];if(l){s=l.scope;if(l.fn==fn&&(s==scope||s==this.obj)){return i}}}return-1},isListening:function(fn,scope){return this.findListener(fn,scope)!=-1},removeListener:function(fn,scope){var index,l,k,me=this,ret=FALSE;if((index=me.findListener(fn,scope))!=-1){if(me.firing){me.listeners=me.listeners.slice(0)}l=me.listeners[index].fn;if(l.task){l.task.cancel();delete l.task}k=l.tasks&&l.tasks.length;if(k){while(k--){l.tasks[k].cancel()}delete l.tasks}me.listeners.splice(index,1);ret=TRUE}return ret},clearListeners:function(){var me=this,l=me.listeners,i=l.length;while(i--){me.removeListener(l[i].fn,l[i].scope)}},fire:function(){var me=this,args=TOARRAY(arguments),listeners=me.listeners,len=listeners.length,i=0,l;if(len>0){me.firing=TRUE;for(;i<len;i++){l=listeners[i];if(l&&l.fireFn.apply(l.scope||me.obj||window,args)===FALSE){return me.firing=FALSE}}}me.firing=FALSE;return TRUE}}})();UCML.apply(UCML.util.Observable.prototype,function(){function getMethodEvent(method){var e=(this.methodEvents=this.methodEvents||{})[method],returnValue,v,cancel,obj=this;if(!e){this.methodEvents[method]=e={};e.originalFn=this[method];e.methodName=method;e.before=[];e.after=[];var makeCall=function(fn,scope,args){if(!UCML.isEmpty(v=fn.apply(scope||obj,args))){if(UCML.isObject(v)){returnValue=!UCML.isEmpty(v.returnValue)?v.returnValue:v;cancel=!!v.cancel}else if(v===false){cancel=true}else{returnValue=v}}};this[method]=function(){var args=UCML.toArray(arguments);returnValue=v=undefined;cancel=false;UCML.each(e.before,function(b){makeCall(b.fn,b.scope,args);if(cancel){return returnValue}});if(!UCML.isEmpty(v=e.originalFn.apply(obj,args))){returnValue=v}UCML.each(e.after,function(a){makeCall(a.fn,a.scope,args);if(cancel){return returnValue}});return returnValue}}return e}return{beforeMethod:function(method,fn,scope){getMethodEvent.call(this,method).before.push({fn:fn,scope:scope})},afterMethod:function(method,fn,scope){getMethodEvent.call(this,method).after.push({fn:fn,scope:scope})},removeMethodListener:function(method,fn,scope){var e=getMethodEvent.call(this,method),found=false;UCML.each(e.before,function(b,i,arr){if(b.fn==fn&&b.scope==scope){arr.splice(i,1);found=true;return false}});if(!found){UCML.each(e.after,function(a,i,arr){if(a.fn==fn&&a.scope==scope){arr.splice(i,1);return false}})}},relayEvents:function(o,events){var me=this;function createHandler(ename){return function(){return me.fireEvent.apply(me,[ename].concat(UCML.toArray(arguments)))}}UCML.each(events,function(ename){me.events[ename]=me.events[ename]||true;o.on(ename,createHandler(ename),me)})},enableBubble:function(events){var me=this;if(!UCML.isEmpty(events)){events=UCML.isArray(events)?events:UCML.toArray(arguments);UCML.each(events,function(ename){ename=ename.toLowerCase();var ce=me.events[ename]||true;if(UCML.isBoolean(ce)){ce=new UCML.util.Event(me,ename);me.events[ename]=ce}ce.bubble=true})}}}}());UCML.util.Observable.capture=function(o,fn,scope){o.fireEvent=o.fireEvent.createInterceptor(fn,scope)};UCML.util.Observable.observeClass=function(c,listeners){if(c){if(!c.fireEvent){UCML.apply(c,new UCML.util.Observable);UCML.util.Observable.capture(c.prototype,c.fireEvent,c)}if(UCML.isObject(listeners)){c.on(listeners)}return c}};UCML.EventManager=function(){function listen(el,eventName,fn,scope,data){function fnToScope(e){e.data=data;fn.call(scope||el,el,e)}return fnToScope}var pub={addListener:function(el,eventName,fn,scope,data){data=data||scope;if(!el.jquery){el=UCML.getDom(el)}$(el).bind(eventName,data,listen(el,eventName,fn,scope,data))},removeListener:function(el,eventName,fn){if(!el.jquery){el=UCML.getDom(el)}if(!UCML.isEmpty(eventName)&&!UCML.isEmpty(fn)){$(el).unbind(eventName,listen(el,eventName,fn))}else if(!UCML.isEmpty(eventName)){$(el).unbind(eventName)}else{$(el).unbind()}}};pub.on=pub.addListener;pub.un=pub.removeListener;return pub}();UCML.on=UCML.EventManager.on;UCML.un=UCML.EventManager.un;UCML.util.ClickRepeater=UCML.extend(UCML.util.Observable,{constructor:function(el,config){this.el=el;UCML.apply(this,config);this.addEvents("mousedown","click","mouseup");if(!this.disabled){this.disabled=true;this.enable()}if(this.handler){this.on("click",this.handler,this.scope||this)}UCML.util.ClickRepeater.superclass.constructor.call(this)},interval:20,delay:250,preventDefault:true,stopDefault:false,timer:0,enable:function(){if(this.disabled){UCML.on(this.el,"mousedown",this.handleMouseDown,this);if(UCML.isIE){UCML.on(this.el,"dblclick",this.handleDblClick,this)}if(this.preventDefault||this.stopDefault){this.on("click",this.eventOptions,this)}}this.disabled=false},disable:function(force){if(force||!this.disabled){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass)}UCMl.un(document,"mouseup",this.handleMouseUp)}this.disabled=true},setDisabled:function(disabled){this[disabled?"disable":"enable"]()},eventOptions:function(el,e){if(this.preventDefault){}if(this.stopDefault){e.stopPropagation()}},destroy:function(){this.disable(true);this.purgeListeners()},handleDblClick:function(el,e){clearTimeout(this.timer);this.el.blur();this.fireEvent("mousedown",el,e);this.fireEvent("click",el,e)},handleMouseDown:function(el,e){clearTimeout(this.timer);this.el.blur();this.mousedownTime=new Date;UCML.on(document,"mouseup",this.handleMouseUp,this);UCML.on(this.el,"mouseout",this.handleMouseOut,this);this.fireEvent("mousedown",el,e);this.fireEvent("click",el,e);if(this.accelerate){this.delay=400}this.timer=this.click.defer(this.delay||this.interval,this,[e])},click:function(e){this.fireEvent("click",this,e);this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12e3):this.interval,this,[e])},easeOutExpo:function(t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},handleMouseOut:function(){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass)}UCML.on(this.el,"mouseover",this.handleMouseReturn,this)},handleMouseReturn:function(){UCML.un(this.el,"mouseover",this.handleMouseReturn);this.el.addClass(this.pressClass)},handleMouseUp:function(e){clearTimeout(this.timer);UCML.un(this.el,"mouseover",this.handleMouseReturn);UCML.un(this.el,"mouseout",this.handleMouseOut);UCML.un(document,"mouseup",this.handleMouseUp);this.fireEvent("mouseup",this,e)}});UCML.Template=function(html){var me=this,a=arguments,buf=[],v;if(UCML.isArray(html)){html=html.join("")}else if(a.length>1){for(var i=0,len=a.length;i<len;i++){v=a[i];if(typeof v=="object"){UCML.apply(me,v)}else{buf.push(v)}}html=buf.join("")}me.html=html;if(me.compiled){me.compile()}};UCML.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(values){var me=this;return me.compiled?me.compiled(values):me.html.replace(me.re,function(m,name){return values[name]!==undefined?values[name]:""})},set:function(html,compile){var me=this;me.html=html;me.compiled=null;return compile?me.compile():me},compile:function(){var me=this,sep=UCML.isGecko?"+":",";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}eval("this.compiled = function(values){ return "+(UCML.isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(UCML.isGecko?"';};":"'].join('');};"));return me},insertFirst:function(el,values,returnElement){return this.doInsert("afterBegin",el,values,returnElement)},insertBefore:function(el,values,returnElement){return this.doInsert("beforeBegin",el,values,returnElement)},insertAfter:function(el,values,returnElement){return this.doInsert("afterEnd",el,values,returnElement)},append:function(el,values,returnElement){return this.doInsert("beforeEnd",el,values,returnElement)},doInsert:function(where,el,values,returnEl){el=UCML.getDom(el);var newNode=UCML.DomHelper.insertHtml(where,el,this.applyTemplate(values));return returnEl?UCML.get(newNode,true):newNode},overwrite:function(el,values,returnElement){el=UCML.getDom(el);el.innerHTML=this.applyTemplate(values);return returnElement?UCML.get(el.firstChild,true):el.firstChild}};UCML.Template.prototype.apply=UCML.Template.prototype.applyTemplate;UCML.Template.from=function(el,config){el=UCML.getDom(el);return new UCML.Template(el.value||el.innerHTML,config||"")};UCML.apply(UCML.Template.prototype,{disableFormats:false,re:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,argsRe:/^\s*['"](.*)["']\s*$/,compileARe:/\\/g,compileBRe:/(\r\n|\n)/g,compileCRe:/'/g,applyTemplate:function(values){var me=this,useF=me.disableFormats!==true,fm=UCML.util.Format,tpl=me;if(me.compiled){return me.compiled(values)}function fn(m,name,format,args){if(format&&useF){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=me.argsRe;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}}return me.html.replace(me.re,fn)},compile:function(){var me=this,fm=UCML.util.Format,useF=me.disableFormats!==true,sep=UCML.isGecko?"+":",",body;function fn(m,name,format,args){if(format&&useF){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"}if(UCML.isGecko){body="this.compiled = function(values){ return '"+me.html.replace(me.compileARe,"\\\\").replace(me.compileBRe,"\\n").replace(me.compileCRe,"\\'").replace(me.re,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(me.html.replace(me.compileARe,"\\\\").replace(me.compileBRe,"\\n").replace(me.compileCRe,"\\'").replace(me.re,fn));body.push("'].join('');};");body=body.join("")}eval(body);return me},call:function(fnName,value,allValues){return this[fnName](value,allValues)}});UCML.Template.prototype.apply=UCML.Template.prototype.applyTemplate;UCML.util.Format=function(){var trimRe=/^\s+|\s+$/g,stripTagsRE=/<\/?[^>]+>/gi,stripScriptsRe=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,nl2brRe=/\r?\n/g;return{ellipsis:function(value,len,word){if(value&&value.length>len){if(word){var vs=value.substr(0,len-2),index=Math.max(vs.lastIndexOf(" "),vs.lastIndexOf("."),vs.lastIndexOf("!"),vs.lastIndexOf("?"));if(index==-1||index<len-15){return value.substr(0,len-3)+"..."}else{return vs.substr(0,index)+"..."}}else{return value.substr(0,len-3)+"..."}}return value},undef:function(value){return value!==undefined?value:""},defaultValue:function(value,defaultValue){return value!==undefined&&value!==""?value:defaultValue},htmlEncode:function(value){return!value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(value){return!value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},trim:function(value){return String(value).replace(trimRe,"")},substr:function(value,start,length){return String(value).substr(start,length)},lowercase:function(value){return String(value).toLowerCase()},uppercase:function(value){return String(value).toUpperCase()},capitalize:function(value){return!value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase()},call:function(value,fn){if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);args.unshift(value);return eval(fn).apply(window,args)}else{return eval(fn).call(window,value)}},usMoney:function(v){v=Math.round((v-0)*100)/100;v=v==Math.floor(v)?v+".00":v*10==Math.floor(v*10)?v+"0":v;v=String(v);var ps=v.split("."),whole=ps[0],sub=ps[1]?"."+ps[1]:".00",r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,"$1"+","+"$2")}v=whole+sub;if(v.charAt(0)=="-"){return"-$"+v.substr(1)}return"$"+v},date:function(v,format){if(!v){return""}if(!UCML.isDate(v)){v=new Date(Date.parse(v))}return v.dateFormat(format||"m/d/Y")},dateRenderer:function(format){return function(v){return UCML.util.Format.date(v,format)}},stripTags:function(v){return!v?v:String(v).replace(stripTagsRE,"")},stripScripts:function(v){return!v?v:String(v).replace(stripScriptsRe,"")},fileSize:function(size){if(size<1024){return size+" bytes"}else if(size<1048576){return Math.round(size*10/1024)/10+" KB"}else{return Math.round(size*10/1048576)/10+" MB"}},math:function(){var fns={};return function(v,a){if(!fns[a]){fns[a]=new Function("v","return v "+a+";")}return fns[a](v)}}(),round:function(value,precision){var result=Number(value);if(typeof precision=="number"){precision=Math.pow(10,precision);result=Math.round(value*precision)/precision}return result},number:function(v,format){if(!format){return v}v=UCML.num(v,NaN);if(isNaN(v)){return""}var comma=",",dec=".",i18n=false,neg=v<0;v=Math.abs(v);if(format.substr(format.length-2)=="/i"){format=format.substr(0,format.length-2);i18n=true;comma=".";dec=","}var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,""):format.replace(/[^\d\.]/g,"")).split(dec);if(1<psplit.length){v=v.toFixed(psplit[1].length)}else if(2<psplit.length){throw"NumberFormatException: invalid format, formats should have no more than 1 period: "+format}else{v=v.toFixed(0)}var fnum=v.toString();psplit=fnum.split(".");if(hasComma){var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3,i;for(i=0;i<j;i+=n){if(i!=0){n=3}parr[parr.length]=cnum.substr(i,n);m-=1}fnum=parr.join(comma);if(psplit[1]){fnum+=dec+psplit[1]}}else{if(psplit[1]){fnum=psplit[0]+dec+psplit[1]}}return(neg?"-":"")+format.replace(/[\d,?\.?]+/,fnum)},numberRenderer:function(format){return function(v){return UCML.util.Format.number(v,format)}},plural:function(v,s,p){return v+" "+(v==1?s:p?p:s+"s")},nl2br:function(v){return UCML.isEmpty(v)?"":v.replace(nl2brRe,"<br/>")}}}();function isTouchDevice(){try{document.createEvent("TouchEvent");return true}catch(e){return false}}function touchScroll(id){if(isTouchDevice()){alert("dd");var el=document.getElementById(id);var scrollStartPos=0;document.getElementById(id).addEventListener("touchstart",function(event){scrollStartPos=this.scrollTop+event.touches[0].pageY;alert(scrollStartPos);event.preventDefault()},false);document.getElementById(id).addEventListener("touchmove",function(event){this.scrollTop=scrollStartPos-event.touches[0].pageY;event.preventDefault()},false)}}UCML.Languge=UCML.Languge||{};UCML.Languge.BCnotMasterTable="主表没有记录,不能添加子表";UCML.Languge.BCnotRightEdit="您现在无权修改这条记录";UCML.Languge.BCfieldLanguge="字段";UCML.Languge.BCnotForNull="不能为空";UCML.Languge.BCincludeLegality="需包含合法值";UCML.Languge.BCneedNumber="内必须填写数字";UCML.Languge.BCneedNumberDecimal="内必须填写数字和小数点";UCML.Languge.BCfromSeivicesChild="正在从服务端请求子表数据，请等待......";UCML.Languge.BClawlessFieldLanguge="非法字段名称";UCML.Languge.BCLoadFirstPageLanguge="正在装入首页数据,请等待......";UCML.Languge.BCLoadPrevPageLanguge="正在装入上页数据,请等待......";UCML.Languge.BCLoadMoreDataLanguge="正在装入下页数据，请等待......";UCML.Languge.BCLoadLastPageLanguge="正在装入末页数据,请等待......";UCML.Languge.BCRefreshLanguge="正在装入数据,请等待......";UCML.Languge.BCinexistenceLanguge="不存在";UCML.Languge.BCerrorLanguge="错误";UCML.Languge.BCOutOfLength="长度不能超过";UCML.Languge.DBLoadPrevPage="上一页";UCML.Languge.DBLoadMore="下一页";UCML.Languge.DBLoadFirstPage="首页";UCML.Languge.DBLoadLastPage="末页";UCML.Languge.DBInsertRecord="添加记录";UCML.Languge.DBInsertSubRecord="添加子级记录";UCML.Languge.DBDeleteRecord="删除记录";UCML.Languge.DBSubmit="数据提交";UCML.Languge.DBCancel="取消修改";UCML.Languge.DBOutExcel="导出数据";UCML.Languge.DBAllOutExcel="导出全部";UCML.Languge.DBRefresh="刷新数据";UCML.Languge.DBConfigColumns="列配置";UCML.Languge.DBNOTSET="未设置";UCML.Languge.DBGreaterEQU="大于等于(>=)";UCML.Languge.DBGreater="大于(>)";UCML.Languge.DBEQU="等于(=)";UCML.Languge.DBLessEQU="小于等于(<=)";UCML.Languge.DBLess="小于(<)";UCML.Languge.DBNOTEQU="不等于(<>)";UCML.Languge.DBIS="IS NULL";UCML.Languge.DBISNOT="IS NOT NULL";UCML.Languge.DBLIKE="包含(LIKE)";UCML.Languge.DBBETWEEN="之间(BETWEEN)";UCML.Languge.DBEQUEmpty="等于空";UCML.Languge.DBNOTEQUEmpty="不等于空";UCML.Languge.DBRunQuery="执行查询";UCML.Languge.DBClearThisQuery="清除当前条件";UCML.Languge.DBClearQuery="清除所有条件";UCML.Languge.DBPleaseInput="请输入";UCML.Languge.DBFormatCondition="格式条件";UCML.Languge.DBTotal="合计";UCML.Languge.DBNotDeleteChild="还有子级数据，不能删除当前行";UCML.Languge.DBnotRightEdit="您现在无权修改这条记录";UCML.Languge.DBPool="共有";UCML.Languge.DBNote="条记录";UCML.Languge.DBFrom="从";UCML.Languge.DBBeginReadCount="开始已读入 ";UCML.Languge.DBTogether1="共 ";UCML.Languge.DBTogether2="转到第";UCML.Languge.DBTogether3="页";UCML.Languge.DBGoto="转到";UCML.Languge.DBLessTotalCount="请输入一个小于总页数的数字";UCML.Languge.DBInputNumber="请输入数字";UCML.Languge.DBSelectCode="代码选择";UCML.Languge.DBOutExcelText="要打印该表，您必须安装Excel电子表格软件，同时浏览器须使用【ActiveX 控件】，您的浏览器须允许执行控件。 请点击【帮助】了解浏览器设置方法！";UCML.Languge.EDInsertRecord="添加记录";UCML.Languge.EDDeleteRecord="删除记录";UCML.Languge.EDSubmit="数据提交";UCML.Languge.EDCancel="取消修改";UCML.Languge.EDRefresh="刷新数据";UCML.Languge.EDUploadImage="上载图片";UCML.Languge.EDOpenImage="打开图片";UCML.Languge.EDMustbeSubmit="请先提交修改过的数据";UCML.Languge.EDNotSettint="未设";UCML.Languge.EDCodeChoice="代码选择";UCML.Languge.EDPointChoice="请点击选择";UCML.Languge.EDVCBusiness1="业务视图组件名称";UCML.Languge.EDVCBusiness2="和HTML内的不一致!,请手工在业务视图组件HTML源码内修改或重新生成";UCML.Languge.BPO_Session_Lose="会话失效或用户未登录,提交无效!";UCML.Languge.BPO_Submit_OK="提交完成!";UCML.Languge.BPO_Submit_NOCHANGE="没有修改的数据可提交!";UCML.Languge.BPO_NotLogin="用户未登录!";UCML.Languge.BPO_NoneRESP="未给该用户分配职责表!";UCML.Languge.BPO_NoneRight="用户没有访问此业务权限!";UCML.Languge.SCR_TODAY=" 您好 今天";UCML.Languge.SCR_YEAR="年";UCML.Languge.SCR_MONTH="月";UCML.Languge.SCR_DAY="日";UCML.Languge.DLLitemFirstText="请选择";UCML.Languge.DBRowNumberText="序号";UCML.Languge.BCLinkText="请选择";UCML.Languge.Pagination_DisplayMsg="  共{total}条  第{pageIndex}/{pageCount}页";UCML.Languge.PaginationMin_DisplayMsg="  共{total}条  第{pageIndex}/{pageCount}页";UCML.Languge.Tree_RootText="默认根";UCML.Languge.Tree_DeleteCheckNode="请选择要删除的节点";UCML.Languge.Tree_QueryNodeError="查询树节点数据错误";UCML.Languge.Tree_CheckRootNode="请选择一个根节点,在添加";UCML.Languge.Tree_HaveNodeChild="该节点没有子表";UCML.Languge.Calendar_Week1="一";UCML.Languge.Calendar_Week2="二";UCML.Languge.Calendar_Week3="三";UCML.Languge.Calendar_Week4="四";UCML.Languge.Calendar_Week5="五";UCML.Languge.Calendar_Week6="六";UCML.Languge.Calendar_Week7="日";UCML.Languge.Calendar_Month1="一月";UCML.Languge.Calendar_Month2="二月";UCML.Languge.Calendar_Month3="三月";UCML.Languge.Calendar_Month4="四月";UCML.Languge.Calendar_Month5="五月";UCML.Languge.Calendar_Month6="六月";UCML.Languge.Calendar_Month7="七月";UCML.Languge.Calendar_Month8="八月";UCML.Languge.Calendar_Month9="九月";UCML.Languge.Calendar_Month10="十月";UCML.Languge.Calendar_Month11="十一月";
UCML.Languge.Calendar_Month12="十二月";UCML.Languge.BU_ExportToText="正在执行导出，请等待......";UCML.Languge.BU_ExportToError="导出失败:";UCML.Languge.BU_ReportExportToText="正在连接服务器,请稍候...";UCML.Languge.BU_ReportExportToError="导出失败:";UCML.Languge.BU_SelectMan_Title="通用选人";UCML.ComponentMgr=function(){var types={};return{registerType:function(ctype,cls){types[ctype]=cls;cls.ctype=ctype},create:function(config,defaultType){if(types[config.ctype||defaultType]){return new types[config.ctype||defaultType](config)}else{return null}},getCtype:function(ctype){return types[ctype]}}}();UCML.reg=UCML.ComponentMgr.registerType;UCML.create=UCML.ComponentMgr.create;UCML.getCtype=UCML.ComponentMgr.getCtype;UCML.get=function(id){return window[id]};UCML.Commponent=function(config){this.config=config;this.isInit=this.isInit==undefined?true:this.isInit;UCML.Commponent.superclass.constructor.call(this);this.addEvents("init","beforerender","render","afterrender");if(this.isInit){if(UCML.isObject(this.config)){UCML.apply(this,config)}this.init()}};UCML.extend(UCML.Commponent,UCML.util.Observable,{autoEl:"div",ctype:"UCML.Commponent",rendeTo:null,rendered:false,initState:false,disabled:false,cls:"",left:null,top:null,width:"auto",height:"auto",style:{},isSetProperties:true,onBeforeDestroy:UCML.emptyFn,onDestroy:UCML.emptyFn});UCML.Commponent.prototype.init=function(config){config=config||this.config||{};if(UCML.isString(config)){config=config.replace("ToolBar","Toolbar");this.id=config;this.el=$("#"+this.id);this.dom=this.el[0]}else if(UCML.isElement(config)){this.dom=config;this.id=this.id||this.dom.id||UCML.id();this.el=$(this.dom)}else if(!UCML.isEmpty(config[0])){this.id=config[0].id||UCML.id();this.dom=config[0];this.el=config}else{this.window=this.window||window;if(!UCML.isEmpty(this.el)){this.dom=this.el[0]}else if(UCML.isElement(this.dom)){this.el=$(this.dom)}else if(this.autoEl){if(UCML.isString(this.autoEl)){this.dom=this.window.document.createElement(this.autoEl);this.el=$(this.dom)}else{var div=document.createElement("div");$(this.autoEl).appendTo(div);this.dom=div.firstChild;this.el=$(this.dom)}}if(!this.dom.id){this.id=config.id||UCML.id()}else{this.id=this.id||this.dom.id}if(this.rendeTo){this.el.appendTo(this.rendeTo);delete this.rendeTo}}if(!this.dom){alert("页面中缺少"+this.id+"元素，或者页面中HTML标记有错")}this.tagName=this.dom.tagName.toLowerCase();window[this.id]=this;this.initState=true;this.fireEvent("onInit");if(this.isSetProperties){this.setProperties()}this.render();this.bindEvents()};UCML.Commponent.prototype.onRender=UCML.emptyFn;UCML.Commponent.prototype.render=function(){if(!this.rendered&&this.fireEvent("beforerender")!==false){this.rendered=true;this.beforeRender();this.onRender();this.fireEvent("render");this.afterRender();this.fireEvent("afterrender")}return this};UCML.Commponent.prototype.destroy=function(){this.el.remove();delete UCML.get(this.id)};UCML.Commponent.prototype.beforeRender=UCML.emptyFn;UCML.Commponent.prototype.afterRender=UCML.emptyFn;UCML.Commponent.prototype.bindEvents=UCML.emptyFn;UCML.Commponent.prototype.setProperties=UCML.emptyFn;UCML.Commponent.prototype.addListener=function(eventName,fn,scope,data){if(this.events&&this.events[eventName]){UCML.Commponent.superclass.addListener.call(this,eventName,fn,scope,data)}else{UCML.EventManager.addListener(this.dom,eventName,fn,scope,data)}};UCML.Commponent.prototype.on=UCML.Commponent.prototype.addListener;UCML.Commponent.prototype.removeListener=function(eventName,fn,scope,data){if(this.events&&this.events[eventName]){UCML.Commponent.superclass.removeListener.call(this,eventName,fn,scope)}else{UCML.EventManager.removeListener(this.dom,eventName,data||scope)}};UCML.Commponent.prototype.un=UCML.Commponent.prototype.removeListener;UCML.Commponent.prototype.getParentEl=function(){return this.el.parent()};UCML.Commponent.prototype.getCssValue=function(cssname){return this.el.css(cssname)};UCML.Commponent.prototype.setCssValue=function(v1,v2){if(arguments.length==2){this.el.css(v1,v2)}else{this.el.css(v1)}};UCML.Commponent.prototype.getOffset=function(){return this.el.offset()};UCML.Commponent.prototype.setOffset=function(_top,_left){this.el.offset({top:_top,left:_left})};UCML.Commponent.prototype.getPosition=function(){return this.el.position()};UCML.Commponent.prototype.getScrollTop=function(){return this.el.scrollTop()};UCML.Commponent.prototype.setScrollTop=function(val){this.el.scrollTop(val)};UCML.Commponent.prototype.getScrollLeft=function(){return this.el.scrollLeft()};UCML.Commponent.prototype.setScrollLeft=function(val){this.el.scrollLeft(val)};UCML.Commponent.prototype.getHeight=function(){return this.el.height()};UCML.Commponent.prototype.setHeight=function(val){this.el.height(val)};UCML.Commponent.prototype.getWidth=function(){return this.el.width()};UCML.Commponent.prototype.setWidth=function(val){this.el.width(val)};UCML.Commponent.prototype.getInnerHeight=function(){return this.el.innerHeight()};UCML.Commponent.prototype.getInnerWidth=function(){return this.el.innerWidth()};UCML.Commponent.prototype.getOuterHeight=function(options){return this.el.outerHeight(options)};UCML.Commponent.prototype.getOuterWidth=function(options){return this.el.outerWidth(options)};UCML.Commponent.prototype.setVisible=function(options){options?this.show():this.hide()};UCML.Commponent.prototype.show=function(){this.el.show()};UCML.Commponent.prototype.hide=function(){this.el.hide()};UCML.Commponent.prototype.isVisible=function(){if(this.el.css("display")!=""&&this.el.css("display")!="none"){return true}else{return false}};UCML.Commponent.prototype.toggle=function(){this.el.toggle()};UCML.Commponent.prototype.addClass=function(cn){this.el.addClass(cn)};UCML.Commponent.prototype.removeClass=function(cn){if(arguments.length>0)this.el.removeClass(cn);else this.el.removeClass()};UCML.Commponent.prototype.toggleClass=function(cn){this.el.toggleClass(cn)};UCML.Commponent.prototype.getAttribute=function(name){return this.el.attr(name)};UCML.Commponent.prototype.setAttribute=function(v1,v2){if(arguments.length==2){this.el.attr(v1,v2)}else{this.el.attr(v1)}};UCML.Commponent.prototype.removeAttribute=function(name){this.el.removeAttr(name)};UCML.Commponent.prototype.getHtml=function(){return this.el.html()};UCML.Commponent.prototype.setHtml=function(val){this.el.html(val)};UCML.Commponent.prototype.getText=function(){return this.el.text()};UCML.Commponent.prototype.setText=function(val){this.el.text(val)};UCML.Commponent.prototype.getValue=function(){return this.el.val()};UCML.Commponent.prototype.setValue=function(val){this.el.val(val)};UCML.Commponent.prototype.setState=function(v,ch){this.disabled=v?false:true;if(!this.disabled){this.el.removeAttr("disabled")}else{this.el.attr("disabled","disabled")}};UCML.Commponent.prototype.enable=function(ch){this.setState(true,ch)};UCML.Commponent.prototype.disable=function(ch){this.setState(false,ch)};UCML.Commponent.prototype.isEnable=function(){return this.el.attr("disabled")==""};UCML.Commponent.prototype.destroy=function(forceDestroy){if(forceDestroy!=true&&this.onBeforeDestroy){if(this.onBeforeDestroy.call(this)==false)return}this.removeNode();if(this.onDestroy){this.onDestroy.call(this)}};UCML.Commponent.prototype.removeNode=function(node){var tnode=node||this.el;tnode.each(function(){$(this).remove();try{if($.browser.msie){this.outerHTML=""}}catch(e){}})};UCML.reg("UCML.Commponent",UCML.Commponent);UCML.namespace("UCML.Common");UCML.Common.Collection=function(){this.items=[];this.keys=[];this.addEvents("clear","add","replace","remove","sort");UCML.Common.Collection.superclass.constructor.call(this)};UCML.extend(UCML.Common.Collection,UCML.util.Observable,{add:function(obj){this.items.push(obj);return obj},replace:function(key,obj){if(typeof key!="undefined"&&key!==null){var index=this.indexOfKey(key);if(index!=-1){this.items[index]=obj}return obj}},remove:function(o){return this.removeAt(this.indexOf(o))},removeAt:function(index){if(index<this.getLength()&&index>=0){var obj=this.items[index];this.items.splice(index,1);return obj}return false},removeKey:function(key){return this.removeAt(this.indexOfKey(key))},indexOf:function(obj){return this.items.indexOf(obj)},indexOfKey:function(key){var index=-1;for(var i=0;i<this.getItems().length;i++){if(this.getItems()[i][0]==key){return i}}return index},getItems:function(){return this.items},item:function(key){var index=this.indexOfKey(key);if(index==-1){return null}return this.itemAt(index)},itemAt:function(index){return this.getItems()[index]},contains:function(o){return this.indexOf(o)!=-1},containsKey:function(key){return this.indexOfKey(o)!=-1},clear:function(){this.items=[]},first:function(){return this.getItems()[0]},last:function(){return this.getItems()[this.getLength()-1]},findIndex:function(property,value,start,anyMatch,caseSensitive){if(UCML.isEmpty(value,false)){return-1}value=this.createValueMatcher(value,anyMatch,caseSensitive);return this.findIndexBy(function(o){return o&&value.test(o[property])},null,start)},findIndexBy:function(fn,scope,start){var it=this.getItems();for(var i=start||0,len=it.length;i<len;i++){if(fn.call(scope||this,it[i],it[i][0])){return i}}return-1},createValueMatcher:function(value,anyMatch,caseSensitive){if(!value.exec){value=String(value);value=new RegExp((anyMatch===true?"":"^")+UCML.escapeRe(value),caseSensitive?"":"i")}return value},cloneByIndex:function(index,newkey){var obj=this.itemAt(index);var newobj=[obj.length];for(var i=1;i<obj.length;i++){newobj[i]=obj[i]}newobj[0]=newkey;return this.add(newobj)},setKey:function(rowIndex,fieldIndex,oid){if(rowIndex>=0&&rowIndex<this.getLength()){if(fieldIndex==0){this.items[rowIndex][fieldIndex]=oid}else{this.items[rowIndex][fieldIndex]=oid}}},getKey:function(rowIndex,fieldIndex){if(rowIndex>=0&&rowIndex<this.getLength()){return this.items[rowIndex][fieldIndex]}},getLength:function(){return this.getItems().length},getCount:function(){return this.getItems().length},_sort:function(property,dir,fn){var i,len,dsc=String(dir).toUpperCase()=="DESC"?-1:1,c=[],k=this.keys,items=this.items;fn=fn||function(a,b){return a-b};for(i=0,len=items.length;i<len;i++){c[c.length]={key:k[i],value:items[i],index:i}}c.sort(function(a,b){var v=fn(a[property],b[property])*dsc;if(v===0){v=a.index<b.index?-1:1}return v});for(i=0,len=c.length;i<len;i++){items[i]=c[i].value;k[i]=c[i].key}}});UCML.Common.Collection.prototype.get=UCML.Common.Collection.prototype.item;UCML.Common.HasTable=function(){UCML.Common.HasTable.superclass.constructor.call(this)};UCML.extend(UCML.Common.HasTable,UCML.Common.Collection,{add:function(key,obj){if(typeof key!="undefined"&&key!==null){var index=this.indexOfKey(key);if(index>=0){return this.replace(key,obj)}}this.items.push(obj);this.keys.push(key);return obj},replace:function(key,obj){if(typeof key!="undefined"&&key!==null){var index=this.indexOfKey(key);if(index==-1){return this.add(key,obj)}this.items[index]=obj;return obj}},removeAt:function(index){if(index<this.getLength()&&index>=0){var obj=this.items[index];this.items.splice(index,1);this.keys.splice(index,1);return obj}return false},indexOfKey:function(key){return this.keys.indexOf(key)},itemAt:function(index){return this.items[index]},clear:function(){this.items=[];this.keys=[]},findIndexBy:function(fn,scope,start){var k=this.keys,it=this.items;for(var i=start||0,len=it.length;i<len;i++){if(fn.call(scope||this,it[i],k[i])){return i}}return-1},cloneByIndex:function(index,newkey){var obj=this.itemAt(index);var newobj=[obj.length];for(var i=1;i<obj.length;i++){newobj[i]=obj[i]}newobj[0]=newkey;return this.add(newkey,newobj)},setKey:function(rowIndex,fieldIndex,oid){if(rowIndex>=0&&rowIndex<this.getLength()){if(fieldIndex==0){this.keys[rowIndex]=oid;this.items[rowIndex][fieldIndex]=oid}else{this.items[rowIndex][fieldIndex]=oid}}},getKey:function(rowIndex,fieldIndex){if(rowIndex>=0&&rowIndex<this.getLength()){if(fieldIndex==0)return this.keys[rowIndex];else return this.items[rowIndex][fieldIndex]}}});UCML.Common.ChangeDataCollection=function(){this.items=[];UCML.Common.ChangeDataCollection.superclass.constructor.call(this)};UCML.extend(UCML.Common.ChangeDataCollection,UCML.util.Observable,{add:function(obj){this.items.push(obj)},insert:function(index,obj){if(index>=this.length){return this.add(obj)}for(var i=this.items.length;i>index;i--){this.items[i]=this.items[i-1]}this.items[index]=obj},removeAt:function(index){this.items.splice(index,1)},getCount:function(){return this.items.length},getItems:function(){return this.items},getItemAt:function(index){return this.items[index]},clear:function(){this.items=[]}});UCML.namespace("UCML.Data");UCML.Data.Table=function(){this.OLD="_old";this.records=[];this.record=null;this.bcData=new UCML.Common.Collection;this.changeData=new UCML.Common.ChangeDataCollection;this.addEvents("load");this.theRecordIndex=-1;this.startPos=0;this.tableName="";this.BCName="bc";UCML.Data.Table.superclass.constructor.call(this)};UCML.extend(UCML.Data.Table,UCML.util.Observable,{load:function(data,records){var beginTime=new Date;this.record=records;this.records=[];for(var i=0;i<records.length;i++){this.records.add(records[i].fieldName)}this.clearData();if(data==null||data.length==0){return}this.bcData.items=data;if(this.bcData.getLength()>0)this.theRecordIndex=0;var endTime=new Date},loadNoClear:function(data,records){var beginTime=new Date;this.record=records;this.records=[];for(var i=0;i<records.length;i++){this.records.add(records[i].fieldName)}if(data==null||data.length==0){return}var opts=this;data.forEach(function(item){if(opts.bcData.indexOf(item)){opts.bcData.add(item)}});if(this.bcData.getLength()>0)this.theRecordIndex=0;var endTime=new Date},addRecord:function(recData){this.bcData.add(recData)},sort:function(index,dir){sortFns=[];sortFns.push(this.createSortFunction(index,dir));var directionModifier=dir.toUpperCase()=="DESC"?-1:1;var fn=function(r1,r2){var result=sortFns[0].call(this,r1,r2);if(sortFns.length>1){for(var i=1,j=sortFns.length;i<j;i++){result=result||sortFns[i].call(this,r1,r2)}}return directionModifier*result};this.bcData._sort("value",dir,fn)},createSortFunction:function(index,direction){direction=direction||"ASC";var directionModifier=direction.toUpperCase()=="DESC"?-1:1;return function(r1,r2){var v1=r1[index],v2=r2[index];return directionModifier*(v1>v2?1:v1<v2?-1:0)}},cloneByIndex:function(index,newkey){this.bcData.cloneByIndex(index,newkey)},clearData:function(){this.bcData.clear()},DataConversion:function(obj,state){var tempobj=[obj.length+1];for(var i=0;i<obj.length;i++){if(obj[i]!=null&&obj[i]!="")tempobj[i]=obj[i];else tempobj[i]="null"}tempobj[obj.length]=state;return tempobj},Insert:function(key){if(!key)return;var c=this.createBlankRec(key);this.bcData.add(c);return c},Delete:function(key){var row=this.bcData.item(key);if(row!=null){this.DeltaDelete(row);this.bcData.removeKey(key)}},columnIndex:function(fieldName){var index=this.records.indexOf(fieldName);if(index>=0){return index}else{return null}},getKey:function(index){if(!index){index=this.theRecordIndex}var row=this.bcData.getItems()[index];if(row){row[0]}else{return null}},getFieldValue:function(fieldName){var fieldIndex=this.columnIndex(fieldName);if(this.theRecordIndex<0||fieldIndex<0){return null}return this.getFieldValueByID(fieldIndex)},getFieldValueByID:function(fieldIndex){if(this.theRecordIndex<0||fieldIndex<0)return null;var row=this.bcData.itemAt(this.theRecordIndex);return row[fieldIndex]},getFieldValueByIndexID:function(rowIndex,fieldIndex){this.theRecordIndex=rowIndex;if(this.theRecordIndex<0||fieldIndex<0)return null;var row=this.bcData.itemAt(this.theRecordIndex);return row[fieldIndex]},setFieldValue:function(fieldName,value){var fieldIndex=this.columnIndex(fieldName);if(this.theRecordIndex<0||fieldIndex<0)return null;return this.setFieldValueByID(this.theRecordIndex,fieldIndex,value)},setFieldValueByID:function(fieldIndex,value){if(this.theRecordIndex<0||fieldIndex<0)return null;var row=this.bcData.itemAt(this.theRecordIndex);if(!row||row[fieldIndex]+""==value)return;this.bcData.getItems()[this.theRecordIndex]=row;this.DeltaUpdate(row,fieldIndex,value);row[fieldIndex]=value},setFieldValueByIndexID:function(rowIndex,fieldIndex,value){this.theRecordIndex=rowIndex;if(this.theRecordIndex<0||fieldIndex<0)return null;var row=this.bcData.itemAt(this.theRecordIndex);if(!row||row[fieldIndex]+""==value)return;this.bcData.getItems()[this.theRecordIndex]=row;this.DeltaUpdate(row,fieldIndex,value);row[fieldIndex]=value},setRecordIndex:function(rowIndex){this.theRecordIndex=rowIndex},getLength:function(){return this.bcData.getLength()},getRecordData:function(index){this.theRecordIndex=index;return this.bcData.itemAt(index)},DeltaUpdate:function(recordData,fieldIndex,value){var srcNode=null;var changeNode=null;var index=-1;if(recordData==null)return;if(value==undefined||value==null)value="null";for(var i=0;i<this.changeData.getCount();i++){var indexNode=this.changeData.getItemAt(i);if(indexNode[this.record.length+1]!=null&&indexNode[0]==recordData[0]){srcNode=indexNode;index=i;if(srcNode[this.record.length+1]=="ukModify"){changeNode=this.changeData.getItemAt(i+1);index++}else{changeNode=srcNode}break}}if(srcNode==null){srcNode=this.DataConversion(recordData,"ukModify");changeNode=[srcNode.length];for(var i=0;i<srcNode.length;i++){if(i!=fieldIndex)changeNode[i]="null"}changeNode[fieldIndex]=value;this.changeData.add(srcNode);this.changeData.add(changeNode);index=this.changeData.getCount()-1}else{if(srcNode[fieldIndex]+""==value){changeNode[fieldIndex]="null"}else{changeNode[fieldIndex]=value}var nullCount=0;for(var i=0;i<changeNode.length;i++){if(changeNode[i]=="null"){nullCount++}}if(nullCount==changeNode.length){this.changeData.removeAt(index);this.changeData.removeAt(index-1)}}},DeltaInsert:function(recordData){if(recordData==null)return;recordData[recordData.length]="0";var newNode=this.DataConversion(recordData,"ukInsert");this.changeData.add(newNode)},DeltaDelete:function(recordData){var srcNode=null;var changeNode=null;var index=-1;if(recordData==null)return;for(var i=0;i<this.changeData.getCount();i++){var indexNode=this.changeData.getItemAt(i);if(indexNode[0]==recordData[0]&&indexNode[this.record.length+1]!=null){if(indexNode[this.record.length+1]=="ukInsert"){this.changeData.removeAt(i);return}else if(indexNode[this.record.length+1]=="ukModify"){this.changeData.removeAt(i+1);this.changeData.removeAt(i)}}}srcNode=this.DataConversion(recordData,"ukDelete");this.changeData.add(srcNode)},IsInsert:function(id){for(var i=0;i<this.changeData.getCount();i++){var indexNode=this.changeData.getItemAt(i);if(indexNode[0]==id){var upKind=indexNode[this.record.length+1];if(upKind=="ukInsert"){return true}break}}return false},clearChangData:function(id){if(this.changeData!=null){this.changeData.clear()}},findByName:function(fieldName,value){var fieldIndex=this.columnIndex(fieldName);if(fieldIndex<0||this.bcData.getLength()<=0){return-1}return this.findByIndex(fieldIndex,value)},findByIndex:function(fieldIndex,value){if(fieldIndex<0||this.bcData.getLength()<=0)return-1;for(var i=0;i<this.bcData.getLength();i++){var row=this.bcData.itemAt(i);if(row[fieldIndex]+""==value)return i}return-1},findLocateOID:function(primaryKey,oid){var fieldIndex=0;if(primaryKey==null||primaryKey==""||primaryKey==this.tableName+"OID")return this.bcData.indexOfKey(oid);else{fieldIndex=this.columnIndex(primaryKey)}return this.findByIndex(fieldIndex,oid)},LookupByIndex:function(primaryKey,oid,fieldIndex){var rowIndex=this.findLocateOID(primaryKey,oid);if(rowIndex>-1){var row=this.bcData.itemAt(rowIndex);return row[fieldIndex]}else return null},LookupByName:function(primaryKey,oid,fieldName){var fieldIndex=this.columnIndex(fieldName);if(fieldIndex<0||this.bcData.getLength()<=0)return null;return this.LookupByIndex(primaryKey,oid,fieldIndex)},getOID:function(rowIndex,primaryKey){var keyIndex=this.getKeyIndex(primaryKey);return this.bcData.getKey(rowIndex,keyIndex)},setOID:function(rowIndex,primaryKey,oid){var keyIndex=this.getKeyIndex(primaryKey);return this.bcData.setKey(rowIndex,keyIndex,oid)},getKeyIndex:function(primaryKey){var keyIndex=0;if(primaryKey==null||primaryKey==""||primaryKey==this.tableName+"OID")keyIndex==0;else keyIndex=this.columnIndex(primaryKey);return keyIndex},getChangeXML:function(){var strXML="<root>";for(var i=0;i<this.changeData.items.length;i++){strXML+="<"+this.BCName+' UpdateKind="';if(this.changeData.items[i][this.record.length+1]!=""&&this.changeData.items[i][this.record.length+1]!="null"){strXML+=this.changeData.items[i][this.record.length+1]}strXML+='">';for(var j=0;j<this.record.length;j++){strXML+="<"+this.record[j].fieldName+">"+UCML.util.Format.htmlEncode(this.changeData.items[i][j])+"</"+this.record[j].fieldName+">"}strXML+="</"+this.BCName+">"}strXML+="</root>";return strXML},getChangeCount:function(){return this.changeData.getCount()},createBlankRec:function(key){var row=[this.record.length+1];row[0]=key;return row}});function createXMLObject(){try{var l_objActiveXObject=new ActiveXObject("Msxml2.DOMDocument");return l_objActiveXObject}catch(e){try{l_objActiveXObject=new ActiveXObject("Msxml.DOMDocument");return l_objActiveXObject}catch(e){try{l_objActiveXObject=new ActiveXObject("Microsoft.XMLDOM");return l_objActiveXObject}catch(e){}}}}var prefixes=["MSXML2.DomDocument","Microsoft.XMLDOM","MSXML.DomDocument","MSXML3.DomDocument"];var isIE=navigator.userAgent.indexOf("MSIE")>0;var XMLJS=function(){};XMLJS.apply=function(o,c,defaults){if(defaults){XMLJS.apply(o,defaults)}if(o&&c&&typeof c=="object"){for(var p in c){o[p]=c[p]}}return o};XMLJS.apply(XMLJS,{docObjs:new Array,initDocs:function(count){if(count==null)count=5;for(var i=0;i<count;i++){XMLJS.docObjs[i]=new Object;if(isIE){XMLJS.docObjs[i].doc=new ActiveXObject("Microsoft.XMLDOM");XMLJS.docObjs[i].doc.async=false;XMLJS.docObjs[i].free=true}else{XMLJS.docObjs[i].doc=new DOMParser;XMLJS.docObjs[i].doc.async=false;XMLJS.docObjs[i].free=true}}},getFreeDocObj:function(){var docObj=null;for(var i=0;i<XMLJS.docObjs.length;i++){if(XMLJS.docObjs[i].free){XMLJS.docObjs[i].free=false;docObj=XMLJS.docObjs[i];break}}return docObj},parseXML:function(xmlContent){var docObj=XMLJS.getFreeDocObj();if(isIE){docObj.doc.loadXML(xmlContent);var doc=docObj.doc;docObj.free=true;return doc}else{var XmlDom=docObj.doc.parseFromString(xmlContent,"text/xml");docObj.free=true;return XmlDom}},parseXML2:function(xmlContent){var xmlDoc;if(isIE){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(xmlContent);return xmlDoc}else{xmlDoc=new DOMParser;var XmlDom=xmlDoc.parseFromString(xmlContent,"text/xml");return XmlDom}},getXMLSubNodes:function(domNode,subNodeName){var subNodes=[];var currentNode=domNode;var childNodes=null;var paths=subNodeName.split("/");for(var i=0;paths!=null&&i<paths.length-1;i++){if(paths[i]=="")continue;childNodes=currentNode.childNodes;for(var j=0;childNodes!=null&&j<childNodes.length;j++){if(childNodes[j].nodeName.toLowerCase()==paths[i].toLowerCase()){currentNode=childNodes[j];break}}}childNodes=currentNode.childNodes;for(var i=0;i<childNodes.length;i++){if(childNodes[i].nodeName.toLowerCase()==paths[paths.length-1].toLowerCase())subNodes.push(childNodes[i])}return subNodes},getXMLRootNode:function(doc){if(doc==null)return null;return doc.documentElement},getXMLChildNodes:function(root){var itemNodes=[];var nodes=root.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType==1){itemNodes.push(nodes[i])}}return itemNodes},getXMLChildNode:function(doc_el,nodeName){var element=doc_el.getElementsByTagName(nodeName);return element.documentElement},getXMLNodeValue:function(doc,nodeName){if(doc==null){return null}return XMLJS.getXMLSingleNodeValue(doc.documentElement,nodeName)},getXMLSingleNodeValue:function(doc_el,nodeName){var element=doc_el.getElementsByTagName(nodeName);var nodevalue="";if(element[0].firstChild!=null){nodevalue=element[0].firstChild.nodeValue}return nodevalue},getAttributeNodeValues:function(doc_el,nodeName,attributeName){if(doc_el==null){return null}var values=[];var len=doc_el.length;var value="";for(var i=0;i<len;i++){if(doc_el[i].nodeName==nodeName){value=doc_el[i].getAttribute(attributeName);values.push(value)}}return values},getAttributeNodeValue:function(doc_el,nodeName,attributeName){var element=doc_el.getElementsByTagName(nodeName);var nodevalue="";if(element[0]!=null){nodevalue=element[0].getAttribute(attributeName)}return nodevalue}});XMLJS.initDocs();UCML.Container=function(id){UCML.Container.superclass.constructor.call(this,id);this.addEvents("setsize")};UCML.extend(UCML.Container,UCML.Commponent,{ctype:"UCML.Container",doSize:true,href:null,cache:true,sizeCount:0,alignWidth:false,alignHeight:false,onResize:function(width,height){},ratioWidth:null,ratioHeight:null,resizeTo:true,beforeRender:function(){UCML.Container.superclass.beforeRender.call(this);if(this.alignWidth==true||this.alignWidth=="true"){this.alignWidth=true;this.width="100%"}else{this.alignWidth=false}if(this.alignHeight==true||this.alignHeight=="true"){this.alignHeight=true;this.height="100%"}else{this.alignHeight=false}this.el.attr("layout",this.ctype)},onRender:function(){UCML.Container.superclass.onRender.call(this);this.el.css(this.style);this.el.addClass(this.cls)},afterRender:function(){UCML.Container.superclass.afterRender.call(this);if(this.doSize==true){this.el.css("display","block");this.setSize(null,"afterRender")}},getHasLayout:function(){return this.el.parent().attr("layout")?true:false},resize:function(param){this.setSize(param,"resize")},setProperties:function(){UCML.Container.superclass.setProperties.call(this);var width=this.dom.style.width;var height=this.dom.style.height;this.alignWidth=this.el.attr("alignwidth")?this.el.attr("alignwidth")=="true":this.alignWidth;this.alignHeight=this.el.attr("alignheight")?this.el.attr("alignheight")=="true":this.alignHeight;var elWidth=width;if(isNaN(elWidth)&&elWidth.indexOf("%")!=-1){this.ratioWidth=parseInt(elWidth)}else if(!isNaN(parseInt(elWidth))){this.width=parseInt(elWidth)}var elHeight=height;if(isNaN(elHeight)&&elHeight.indexOf("%")!=-1){this.ratioHeight=parseInt(elHeight)}else if(!isNaN(parseInt(elHeight))){this.height=parseInt(elHeight)}},bindEvents:function(){UCML.Container.superclass.bindEvents.call(this);var opt=this;opt.el.parent().bind("_resize",function(){opt.resize(null,opt.el.attr("id")+":opt.el.parent().bind(_resize")});if(opt.alignHeight==true||opt.alignWidth==true||UCML.isEmpty(opt.ratioHeight)==false||UCML.isEmpty(opt.ratioWidth)==false){$(window).bind("resize",function(){opt.setSize(null,"$(window).bind('resize'")})}},resize:function(param){this.setSize(param);this.onResize.apply(this,[this.width,this.height]);this.el.triggerHandler("_resize")},setSize:function(param,a){this.sizeCount=this.sizeCount+1;var oldWidth=this.width;var oldHeight=this.height;if(param){if(param.width){this.width=param.width}if(param.height){this.height=param.height}if(param.left!=null){this.left=param.left}if(param.top!=null){this.top=param.top}}else{var p=this.getParentEl();if(this.alignWidth==true||this.alignWidth=="true"){this.alignWidth=true;this.width=p.width()}else if(this.ratioWidth){this.width=parseInt(p.width()*this.ratioWidth/100)}if(this.alignHeight){if(p.attr("id")=="MainPanel"&&(this.el.prevAll().length>0||this.el.nextAll().length>0)){var prevHeight=0;this.el.prevAll().each(function(index,el){prevHeight+=$(this).outerHeight(true)});this.el.nextAll().each(function(index,el){prevHeight+=$(this).outerHeight(true)});this.height=p.height()-prevHeight}else{this.height=p.height()}}else if(this.ratioHeight){this.height=parseInt(p.height()*this.ratioHeight/100)}}this.el.css({left:this.left,top:this.top});if(!isNaN(this.width)){if($.boxModel==true){this.el.width(this.width-(this.el.outerWidth(true)-this.el.width()))}else{this.el.width(this.width-(this.el.outerWidth(true)-this.el.width()))}}else{this.el.width(this.width)}if(!isNaN(this.height)){if($.boxModel==true){this.el.height(this.height-(this.el.outerHeight(true)-this.el.height()))}else{this.el.height(this.height-(this.el.outerHeight(true)-this.el.height()))}}else{this.el.height(this.height)}this.fireEvent("setsize")}});UCML.Container.prototype.init=function(){UCML.Container.superclass.init.call(this)};UCML.Panel=function(id){this.addEvents("load","beforeOpen","open","beforeClose","close","move","maximize","restore","minimize","beforeCollapse","beforeExpand","collapse","expand");UCML.Panel.superclass.constructor.call(this,id)};UCML.extend(UCML.Panel,UCML.Container,{ctype:"UCML.Panel",title:null,iconCls:null,headerCls:"",bodyCls:"",href:null,cache:true,border:true,noheader:false,content:null,collapsible:false,minimizable:false,maximizable:false,closable:false,collapsed:false,minimized:false,maximized:false,closed:false,tools:[],isLoaded:false,href:null,animate:true,loadingMessage:"数据加载中....",onLoad:UCML.emptyFn,onBeforeOpen:UCML.emptyFn,onOpen:UCML.emptyFn,onBeforeClose:UCML.emptyFn,onClose:UCML.emptyFn,onMove:UCML.emptyFn,onMaximize:UCML.emptyFn,onRestore:UCML.emptyFn,onMinimize:UCML.emptyFn,onBeforeCollapse:UCML.emptyFn,onBeforeExpand:UCML.emptyFn,onCollapse:UCML.emptyFn,onExpand:UCML.emptyFn,afterRender:function(){UCML.Panel.superclass.afterRender.call(this);if(this.closed==true){this.el.hide()}else{this.open()}},loadData:function(){var opts=this;if(this.href&&(!this.isLoaded||!this.cache)){this.isLoaded=false;var pbody=this.el.find(">div.panel-body");pbody.html($('<div class="panel-loading"></div>').html(this.loadingMessage));pbody.load(this.href,null,function(){opts.fireEvent("load");opts.onLoad.apply(this,arguments);opts.isLoaded=true})}},bindEvents:function(){UCML.Panel.superclass.bindEvents.call(this)},onRender:function(){this.cls="panel "+this.cls;UCML.Panel.superclass.onRender.call(this);var opts=this;if(!this.body){$('<div class="panel-body"></div>',this.window.document).appendTo(this.el);this.body=this.el.children("div.panel-body");var elCildren=this.el.children();for(var i=elCildren.length-1;i>=0;i--){if(elCildren[i]!=opts.body[0]){$(elCildren[i]).prependTo(opts.body)}}}else{$(this.body).addClass("panel-body").appendTo(this.el)}this.body.attr("layout",this.ctype);if(!this.header){this.createHeader();this.header=this.el.children("div.panel-header")}else{$(this.header).addClass("panel-header").appendTo(this.el)}this.header.addClass(this.headerCls);this.body.addClass(this.bodyCls);this.setBorder()},setProperties:function(){UCML.Panel.superclass.setProperties.call(this);this.title=this.el.attr("title")||this.title;this.el.attr("title","");this.iconCls=this.el.attr("icon")||this.iconCls;this.headerCls=this.el.attr("headerCls")||this.headerCls;this.bodyCls=this.el.attr("bodyCls")||this.bodyCls;this.href=this.el.attr("href")||this.href;this.cache=this.el.attr("cache")?this.el.attr("cache")=="true":undefined;this.border=this.el.attr("border")?this.el.attr("border")=="true":this.border;this.noheader=this.el.attr("noheader")?this.el.attr("noheader")=="true":this.noheader;this.collapsible=this.el.attr("collapsible")?this.el.attr("collapsible")=="true":this.collapsible;this.minimizable=this.el.attr("minimizable")?this.el.attr("minimizable")=="true":this.minimizable;this.maximizable=this.el.attr("maximizable")?this.el.attr("maximizable")=="true":this.maximizable;this.closable=this.el.attr("closable")?this.el.attr("closable")=="true":this.closable;this.collapsed=this.el.attr("collapsed")?this.el.attr("collapsed")=="true":this.collapsed;this.minimized=this.el.attr("minimized")?this.el.attr("minimized")=="true":this.minimized;this.maximized=this.el.attr("maximized")?this.el.attr("maximized")=="true":this.maximized;this.closed=this.el.attr("closed")?this.el.attr("closed")=="true":this.closed},createHeader:function(){var opt=this;if(this.title&&!this.noheader){var header=$('<div class="panel-header widget-header widget-header-small"><div class="panel-title widget-title">'+this.title+"</div></div>",this.window.document).prependTo(this.el);
if(this.iconCls){header.find(".panel-title").addClass("panel-with-icon");$('<div class="panel-icon"></div>',this.window.document).addClass(this.iconCls).appendTo(header)}var tool=$('<div class="panel-tool"></div>',this.window.document).appendTo(header);this.tool=tool;if(this.closable){$('<div class="panel-tool-close"><span class="ace-icon ep ep-close"></span></div>',this.window.document).appendTo(tool).bind("click",function(){opt.close()})}if(this.maximizable){$('<div class="panel-tool-max"><span class="ace-icon ep ep-expand"></span><span class="ace-icon ep ep-compress"></span></div>',this.window.document).appendTo(tool).bind("click",function(){opt.onMax.call(opt,this)})}if(this.minimizable){$('<div class="panel-tool-min"></div>',this.window.document).appendTo(tool).bind("click",function(){opt.onMin.call(opt,this)})}if(this.collapsible){$('<div class="panel-tool-collapse"><span class="ace-icon ep ep-chevron-up"></span><span class="ace-icon ep ep-chevron-down"></span></div>',this.window.document).appendTo(tool).bind("click",function(){opt.onToggle.call(opt,this)})}if(this.tools){for(var i=this.tools.length-1;i>=0;i--){var t=$('<div title="'+this.tools[i].tip+'"></div>').addClass(this.tools[i].iconCls).html(this.tools[i].content).appendTo(tool);if(this.tools[i].handler){t.bind("click",eval(this.tools[i].handler))}}}tool.find("div").hover(function(){$(this).addClass("panel-tool-over")},function(){$(this).removeClass("panel-tool-over")});this.el.find(">div.panel-body").removeClass("panel-body-noheader")}else{this.el.find(">div.panel-body").addClass("panel-body-noheader")}},close:function(forceClose){if(forceClose!=true){if(this.onBeforeClose.call(this)==false||this.fireEvent("beforeClose")==false)return}this.el.hide();this.closed=true;this.fireEvent("close");this.onClose.call(this)},open:function(forceOpen){if(forceOpen!=true){if(this.onBeforeOpen.call(this)==false||this.fireEvent("beforeOpen")==false)return}this.el.show();this.closed=false;this.fireEvent("open");this.onOpen.call(this);if(this.maximized==true){this.maximize()}if(this.minimized==true){this.minimize()}if(this.collapsed==true){this.collapse()}if(!this.collapsed){this.loadData()}},move:function(param){if(param){if(param.left!=null)this.left=param.left;if(param.top!=null)this.top=param.top}this.el.css({left:this.left,top:this.top});this.fireEvent("move",[this.left,this.top]);this.onMove.apply(this,[this.left,this.top])},maximize:function(){var tool=this.el.find(">div.panel-header .panel-tool-max");if(tool.hasClass("panel-tool-restore"))return;tool.addClass("panel-tool-restore");this.original={width:this.width,height:this.height,left:this.left,top:this.top,alignHeight:this.alignHeight,alignWidth:this.alignWidth,ratioWidth:this.ratioWidth,ratioHeight:this.ratioHeight};this.left=0;this.top=0;this.alignHeight=true;this.alignWidth=true;this.setSize();this.minimized=false;this.maximized=true;this.fireEvent("maximize");this.onMaximize.call(this)},restore:function(){var tool=this.el.find(">div.panel-header .panel-tool-max");if(!tool.hasClass("panel-tool-restore"))return;this.el.show();tool.removeClass("panel-tool-restore");var original=this.original;this.width=original.width;this.height=original.height;this.left=original.left;this.top=original.top;this.alignWidth=original.alignWidth;this.alignHeight=original.alignHeight;this.ratioWidth=original.ratioWidth;this.ratioHeight=original.ratioHeight;this.setSize();this.minimized=false;this.maximized=false;this.fireEvent("restore");this.onRestore.call(this)},minimize:function(){this.el.hide();this.minimized=true;this.maximized=false;this.fireEvent("minimize");this.onMinimize.call(this)},collapse:function(param){var opt=this;var body=this.el.find(">div.panel-body");var tool=this.el.find(">div.panel-header .panel-tool-collapse");if(tool.hasClass("panel-tool-expand"))return;body.stop(true,true);if(this.onBeforeCollapse.call(this)==false||this.fireEvent("beforeCollapse")==false)return;tool.addClass("panel-tool-expand");if(this.animate==true){body.slideUp("normal",function(){opt.collapsed=true;opt.fireEvent("collapse");opt.onCollapse.call(opt)})}else{body.hide();this.collapsed=true;this.fireEvent("collapse");this.onCollapse.call(this)}},expand:function(param){var opt=this;var body=this.el.find(">div.panel-body");var tool=this.el.find(">div.panel-header .panel-tool-collapse");if(!tool.hasClass("panel-tool-expand"))return;body.stop(true,true);if(this.onBeforeExpand.call(this)==false||this.fireEvent("beforeExpand")==false)return;tool.removeClass("panel-tool-expand");if(this.animate==true){body.slideDown("normal",function(){opt.collapsed=false;opt.fireEvent("expand");opt.onExpand.call(this);opt.loadData()})}else{body.show();this.collapsed=false;this.fireEvent("expand");this.onExpand.call(this);this.loadData()}this.setSize()},refresh:function(){this.isLoaded=false;this.loadData()},setBorder:function(){if(this.border==true){this.el.find(">div.panel-header").removeClass("panel-header-noborder");this.el.find(">div.panel-body").removeClass("panel-body-noborder")}else{this.el.find(">div.panel-header").addClass("panel-header-noborder");this.el.find(">div.panel-body").addClass("panel-body-noborder")}},setTitle:function(title){this.title=title;this.header.find("div.panel-title").html(title)},getTitle:function(){return this.title},resize:function(param){this.setSize(param);this.onResize.apply(this,[this.width,this.height])},setSize:function(param){UCML.Panel.superclass.setSize.call(this,param);if(!isNaN(this.width)){var width=this.el.width();if($.boxModel==true){this.header.width(width-(this.header.outerWidth(true)-this.header.width()));this.body.width(width-(this.body.outerWidth(true)-this.body.width()))}else{this.header.width(width-(this.header.outerWidth(true)-this.header.width()));this.body.width(width-(this.body.outerWidth(true)-this.body.width()))}}else{this.body.width("auto")}if(!isNaN(this.height)){var height=this.el.height();if($.boxModel==true){this.body.height(height-this.header.outerHeight(true)-(this.body.outerHeight(true)-this.body.height()))}else{this.body.height(height-this.header.outerHeight(true)-(this.body.outerHeight(true)-this.body.height()))}}else{this.body.height("auto")}this.el.css("height","auto");this.body.triggerHandler("_resize")},onToggle:function(el){if($(el).hasClass("panel-tool-expand")){this.expand(true)}else{this.collapse(true)}return false},onMin:function(){this.minimize();return false},onMax:function(){var tool=this.el.find(">div.panel-header .panel-tool-max");if(tool.hasClass("panel-tool-restore")){this.restore()}else{this.maximize()}return false}});UCML.Panel.prototype.init=function(){UCML.Panel.superclass.init.call(this)};UCML.Input=function(id){this.value="";this.addEvents("valuechange","setValue");UCML.Input.superclass.constructor.call(this,id)};UCML.extend(UCML.Input,UCML.Commponent,{ctype:"UCML.Input",setProperties:function(){UCML.Input.superclass.setProperties.call(this);this.disabled=this.el.attr("disabled")?true:this.disabled},select:function(){if(this.dom.select){this.dom.select()}}});UCML.Input.prototype.init=function(){UCML.Input.superclass.init.call(this);if(this.disabled){this.disable()}};UCML.Input.prototype.setValue=function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}if(this.tagName=="input"||this.tagName=="textarea"){this.el.val(val)}else{this.el.html(val)}};UCML.Input.prototype.setValueBack=function(val){this.setValue(val,false)};UCML.Input.prototype.setLabel=function(){var p=this.el.parent();var value=this.getValue();if(this.getText){value=this.getText()}this.destroy();p.append('<div class="">'+value+"</div>")};UCML.Input.prototype.resize=function(width,height){this.setSize(width,height)};UCML.Input.prototype.setSize=function(width,height){if($.boxModel==true){this.setWidth(width-(this.getOuterWidth(true)-this.getWidth()));this.setHeight(height-(this.getOuterHeight(true)-this.getHeight()))}else{this.setWidth(width-(this.getOuterWidth(true)-this.getInnerWidth()));this.setHeight(height-(this.dom.offsetHeight-this.dom.clientHeight))}};UCML.Input.prototype.getValue=function(){return this.value};UCML.Input.prototype.focus=function(){this.dom.focus()};UCML.Input.prototype.blur=function(){this.dom.blur()};UCML.reg("UCML.Input",UCML.Input);UCML.TextBox=function(id){UCML.TextBox.superclass.constructor.call(this,id);return this};UCML.extend(UCML.TextBox,UCML.Input,{ctype:"UCML.TextBox",autoEl:"input"});UCML.TextBox.prototype.init=function(){UCML.TextBox.superclass.init.call(this);this.on("blur",function(){this.setValue(this.dom.value)},this)};UCML.TextBox.prototype.setMaxLength=function(val){this.el.attr("maxLength",val)};UCML.TextBox.prototype.select=function(){if(this.dom.select){this.dom.select()}};UCML.reg("UCML.TextBox",UCML.TextBox);UCML.Password=function(id){UCML.Password.superclass.constructor.call(this,id)};UCML.extend(UCML.Password,UCML.TextBox,{ctype:"UCML.Password"});UCML.Password.prototype.renderedValue=function(val){var tempStr="";var len=val.length;for(var i=0;i<len;i++){tempStr+="*"}return tempStr};UCML.reg("UCML.Password",UCML.Password);UCML.TextArea=function(id){UCML.TextArea.superclass.constructor.call(this,id)};UCML.extend(UCML.TextArea,UCML.TextBox,{ctype:"UCML.TextArea",autoEl:"textarea"});UCML.reg("UCML.TextArea",UCML.TextArea);UCML.CheckBox=function(id){UCML.CheckBox.superclass.constructor.call(this,id)};UCML.extend(UCML.CheckBox,UCML.Input,{ctype:"UCML.CheckBox"});UCML.CheckBox.prototype.init=function(){UCML.CheckBox.superclass.init.call(this);this.on("change",function(){this.setValue(this.dom.checked?"true":"false")},this)};UCML.CheckBox.prototype.setState=function(v,ch){UCML.CheckBox.superclass.setState.call(this);this.disabled=v?false:true;if(!this.disabled){this.el.parent("span.chk").removeClass("no")}else{this.el.parent("span.chk").addClass("no")}};UCML.CheckBox.prototype.onRender=function(){if(this.el[0].type.toLowerCase()=="checkbox"){this.el.wrap("<span class='chk'></span>")}};UCML.CheckBox.prototype.setValue=function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}if(val=="true"||val==true){this.dom.checked=true;this.el.parent("span.chk").addClass("on")}else{this.dom.checked=false;this.el.parent("span.chk").removeClass("on")}};UCML.reg("UCML.Checkbox",UCML.CheckBox);UCML.reg("UCML.CheckBox",UCML.CheckBox);UCML.Radio=function(id){UCML.Radio.superclass.constructor.call(this,id)};UCML.extend(UCML.Radio,UCML.CheckBox,{ctype:"UCML.Radio"});UCML.reg("UCML.Radio",UCML.Radio);UCML.Hidden=function(id){UCML.Hidden.superclass.constructor.call(this,id)};UCML.extend(UCML.Hidden,UCML.TextBox,{ctype:"UCML.Hidden"});UCML.reg("UCML.Hidden",UCML.Hidden);UCML.Image=function(id){UCML.Image.superclass.constructor.call(this,id)};UCML.extend(UCML.Image,UCML.Input,{ctype:"UCML.Image"});UCML.Image.prototype.setValue=function(val,trigger){if(trigger!==false){this.fireEvent("setValue",val)}this.value=val;this.dom.src=UCMLLocalResourcePath+"File/Images/"+this.dataTable.TableName+"_"+this.fieldName+"/"+this.dataTable.getUserOID()+"/"+this.dataTable.getOID()+val;if(this.getCustomSrc)this.dom.src=this.getCustomSrc()};UCML.reg("UCML.Image",UCML.Image);UCML.UploadImage=function(id){UCML.UploadImage.superclass.constructor.call(this,id)};UCML.extend(UCML.UploadImage,UCML.Input,{ctype:"UCML.UploadImage"});UCML.UploadImage.prototype.setValue=function(val,trigger){if(trigger!==false){this.fireEvent("setValue",val)}this.value=val;this.dom.src="upload/"+val};UCML.reg("UCML.UploadImage",UCML.UploadImage);UCML.Article=function(id){UCML.Article.superclass.constructor.call(this,id)};UCML.extend(UCML.Article,UCML.Input,{ctype:"UCML.Article",onRender:function(){UCML.Article.superclass.onRender.call(this);var p=$("<p></p>");this.el.append(p);this.el.css("text-indent","2em")},setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.el.find("p").text(val)}});UCML.reg("UCML.Article",UCML.Article);UCML.Label=function(id){UCML.Label.superclass.constructor.call(this,id)};UCML.extend(UCML.Label,UCML.Input,{ctype:"UCML.Label"});UCML.Label.prototype.setValue=function(val,trigger){var valData=val;if(this.isCodeTable){val=this.BusinessObject.GetCodeCaption(this.codeTable,val)||""}this.value=val;this.el.html(val);var urlkind=this.el.attr("urlkind");if(urlkind=="phone"){if(this.el.attr("href")!=undefined)this.el.attr("href","tel:"+val)}else if(urlkind=="sms"){if(this.el.attr("href")!=undefined)this.el.attr("href","sms:"+val)}var iconSrc=this.getAttribute("icon")||"";if(!UCML.isEmpty(iconSrc)){var icon='<img class="ui-li-icon" src="'+iconSrc+'">';this.el.html(icon+"<span>"+val+"</span>");this.el.parents("ul[data-role='listview']").eq(0).listview("refresh")}var align=this.getAttribute("align")||"left";if(align!="left"){this.el.find("span").addClass("ui-text-"+align)}if(trigger!==false){this.fireEvent("setValue",valData)}};UCML.reg("UCML.Label",UCML.Label);UCML.EditLabel=function(id){UCML.EditLabel.superclass.constructor.call(this,id)};UCML.extend(UCML.EditLabel,UCML.Input,{ctype:"UCML.EditLabel",onRender:function(){UCML.EditLabel.superclass.onRender.call(this);this.label=$("<div class='editlabel'></div>");this.label.css("padding","5px 3px");this.el.after(this.label).hide()}});UCML.EditLabel.prototype.setValue=function(val,trigger){var valData=val;if(this.isCodeTable){val=this.BusinessObject.GetCodeCaption(this.codeTable,val)||""}this.value=val;this.el.html(val);if(val=="")val="&nbsp;";this.label.html(val);if(trigger!==false){this.fireEvent("setValue",valData)}};UCML.reg("UCML.EditLabel",UCML.EditLabel);UCML.Link=function(id){UCML.Link.superclass.constructor.call(this,id)};UCML.extend(UCML.Link,UCML.Input,{ctype:"UCML.Link",autoEl:"a"});UCML.reg("UCML.Link",UCML.Link);UCML.BCLink=function(id){UCML.BCLink.superclass.constructor.call(this,id)};UCML.extend(UCML.BCLink,UCML.Link,{ctype:"UCML.BCLink",linkState:0,bindEvents:function(){UCML.BCLink.superclass.bindEvents.call(this);this.on("click",this.click,this)},click:function(){startBCLink(this.dom)},setAppletObject:function(val){this.AppletObject=val}});UCML.reg("UCML.BCLink",UCML.BCLink);UCML.BCLink.prototype.setValue=function(val,trigger){if(val==""){val="请选择"}this.value=val;this.dom.innerHTML=val;UCML.BCLink.superclass.setValue.call(this,val,trigger)};UCML.HTMLEdit=function(id){UCML.HTMLEdit.superclass.constructor.call(this,id)};UCML.extend(UCML.HTMLEdit,UCML.Input,{ctype:"UCML.HTMLEdit",autoEl:"div",init:function(){UCML.HTMLEdit.superclass.init.call(this)},onRender:function(){if(this.tagName=="textarea"){this.editor=$(this.dom).xheditor({skin:"o2007silver"})}else{this.el.append("<textarea></textarea>");this.editor=this.el.find("textarea").xheditor({skin:"vista"})}},bindEvents:function(){UCML.HTMLEdit.superclass.bindEvents.call(this);var opts=this;this.editor.settings.blur=function(){opts.setValue(opts.editor.getSource(),true)}},setValue:function(val,trigger){if(trigger){this.fireEvent("setValue",val)}else{this.editor.setSource(val)}}});UCML.reg("UCML.HTMLEdit",UCML.HTMLEdit);UCML.UEditorHTML=function(id){UCML.UEditorHTML.superclass.constructor.call(this,id)};UCML.extend(UCML.UEditorHTML,UCML.Input,{ctype:"UCML.UEditorHTML",autoEl:"div",init:function(){UCML.UEditorHTML.superclass.init.call(this)},onRender:function(){this.options={imageUrlPrefix:UCMLLocalResourcePath+"upload/",scrawlUrlPrefix:UCMLLocalResourcePath+"upload/",snapscreenUrlPrefix:UCMLLocalResourcePath+"upload/",catcherUrlPrefix:UCMLLocalResourcePath+"upload/",videoUrlPrefix:UCMLLocalResourcePath+"upload/",fileUrlPrefix:UCMLLocalResourcePath+"upload/",imageManagerUrlPrefix:UCMLLocalResourcePath+"upload/",fileManagerUrlPrefix:UCMLLocalResourcePath+"upload/"};if(this.tagName=="textarea"){this.editor=UE.getEditor(this.dom,this.options)}else{this.el.append("<textarea></textarea>");this.editor=UE.getEditor(this.el.find("textarea").get(0),this.options)}},bindEvents:function(){UCML.UEditorHTML.superclass.bindEvents.call(this);var opts=this;this.editor.addListener("blur",function(){opts.setValue(opts.editor.getContent(),true)})},setValue:function(val,trigger){var opts=this;if(trigger){this.fireEvent("setValue",val)}else{this.editor.ready(function(){opts.editor.setContent(val)})}}});UCML.reg("UCML.UEditorHTML",UCML.UEditorHTML);UCML.reg("UCML.Html",UCML.HTMLEdit);UCML.InputList=function(id){this.dataValueField;this.dataTextField;this.srcDataTable;this.codeTable;this.isCodeTable=false;this.Captions;this.Values;this.text;this.addEvents("setData","setreadonly","onitem","databind");UCML.InputList.superclass.constructor.call(this,id)};UCML.extend(UCML.InputList,UCML.Input,{ctype:"UCML.InputList",setProperties:function(){UCML.InputList.superclass.setProperties.call(this);this.codeTable=this.getAttribute("codeTable")||this.codeTable;this.isCodeTable=(this.el.attr("isCodeTable")?this.getAttribute("isCodeTable")=="true":false)||this.isCodeTable;this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName"))||undefined;this.dataValueField=this.getAttribute("dataValueField")||this.dataValueField;this.dataTextField=this.getAttribute("dataTextField")||this.dataTextField;this.Captions=this.getAttribute("Captions")||this.Captions;this.Values=this.getAttribute("Values")||this.Values},getText:function(){return this.text}});UCML.InputList.prototype.init=function(){UCML.InputList.superclass.init.call(this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.srcDataTable.on("onLoad",this.dataBind,this)}else if(this.isCodeTable==true&&!UCML.isEmpty(this.codeTable)){if(window.BusinessObject.dataLoading){this.bindCodeTable()}else{window.BusinessObject.on("onLoad",this.bindCodeTable,this)}}else if(!UCML.isEmpty(this.Captions)&&!UCML.isEmpty(this.Values)){this.bindCustomData(this.Captions,this.Values)}};UCML.InputList.prototype.bindCustomData=function(texts,values){};UCML.InputList.prototype.getSrcDataTable=function(){return this.srcDataTable};UCML.InputList.prototype.setSrcDataTable=function(dataTable){this.srcDataTable=dataTable};UCML.InputList.prototype.dataBind=function(){this.fireEvent("databind",this,this.input)};UCML.InputList.prototype.bindCodeTable=function(){};UCML.DropDownList=function(id){this.addEvents("change");UCML.DropDownList.superclass.constructor.call(this,id)};UCML.extend(UCML.DropDownList,UCML.InputList,{ctype:"UCML.DropDownList",autoEl:"select",isSetItemFirstText:true,itemFirstText:null,itemFirstValue:"",bindEvents:function(){var opts=this;this.el.bind("change",function(){var value=this.options[this.selectedIndex].value;var text=this.options[this.selectedIndex].text;opts.setValue(value);opts.fireEvent("change",text,value);opts.onClick(text,value)});if(this.ParentControl&&this.dataTable&&this.applet&&this.applet.view&&this.applet.view.length>0){this.applet.on("beforebeginedit",this.beforeEdit,this)}},getText:function(){if(this.dom.options[this.dom.selectedIndex]){return this.dom.options[this.dom.selectedIndex].text}return""},getValue:function(){if(this.dom.selectedIndex>-1){return this.dom.options[this.dom.selectedIndex].value}return""},getOptions:function(){return this.dom.options}});UCML.DropDownList.prototype.init=function(){UCML.DropDownList.superclass.init.call(this)};UCML.DropDownList.prototype.beforeEdit=function(obj){if(obj.fieldName==this.el.attr("dataFld")){var pCtl=this.ParentControl;var rCtl=this;while(rCtl.ParentControl){rCtl=rCtl.ParentControl}var rValue=this.dataTable.getFieldValue(rCtl.el.attr("dataFld"));if(rValue==""||rValue=="00000000-0000-0000-0000-000000000000"){rCtl.srcDataTable.getData();alert("请先选择父级!");return false}else{rCtl.srcDataTable.Locate(rCtl.dataValueField,rValue);if(!(rCtl===pCtl)){var pValue=this.dataTable.getFieldValue(pCtl.el.attr("dataFld"));if(pValue!=""&&pValue!="00000000-0000-0000-0000-000000000000"){pCtl.srcDataTable.Locate(pCtl.dataValueField,pValue)}else{alert("请先选择父级!");return false}}}}};UCML.DropDownList.prototype.setProperties=function(){UCML.DropDownList.superclass.setProperties.call(this);var t=this.el;this.JIONDataField=t.attr("JIONDataField")||this.JIONDataField;this.isSetItemFirstText=this.el.attr("isSetItemFirstText")?this.el.attr("isSetItemFirstText")=="false"?false:true:true;this.ParentControlID=t.attr("ParentControlID")||this.ParentControlID;if(typeof this.ParentControlID!="undefined"&&this.ParentControlID!=""){this.ParentControl=eval(this.ParentControlID)}};UCML.DropDownList.prototype.onClick=UCML.emptyFn;UCML.DropDownList.prototype.renderedValue=function(val){if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.dataBind()}this.setValue(val);return this.getText()};UCML.DropDownList.prototype.change=function(val,text){this.value=val;this.text=text;this.setData(this.value);if(this.JIONDataField){this.dataTable.setFieldValue(this.JIONDataField,this.text)}if(this.srcDataTable){var index=this.dom.selectedIndex;if(this.isSetItemFirstText){index=index-1}this.srcDataTable.setRecordIndex(index)}};UCML.DropDownList.prototype.setValue=function(value,trigger){this.value=value;this.text="";for(var i=0;i<this.dom.options.length;i++){if(this.value==this.dom.options[i].value){this.text=this.dom.options[i].text;var opt=this.dom.options[i];try{this.dom.options[i].selected=true}catch(ex){}}else{this.dom.options[i].selected=false}}if(this.JIONDataField){this.dataTable.setFieldValue(this.JIONDataField,this.text)}if(this.srcDataTable&&value!=""){this.srcDataTable.Locate(this.dataValueField,value)}if(trigger!==false){this.fireEvent("setValue",value)}};UCML.DropDownList.prototype.selectByIndex=function(index){this.dom.selectIndex=index;return this.dom.options[index].selected=true};UCML.DropDownList.prototype.add=function(text,value,selected){selected=selected==undefined?false:selected;var optionElement=document.createElement("OPTION");this.dom.appendChild(optionElement);optionElement.value=value;optionElement.text=text;optionElement.selected=selected;if(this.dom.options.length==1){this.value=value;this.text=text;optionElement.selected=true}};UCML.DropDownList.prototype.insert=function(index,text,value,selected){var optionElement=document.createElement("OPTION");this.dom.options.add(optionElement,index);optionElement.value=value;optionElement.text=text;optionElement.selected=selected||false;if(this.dom.options.length==1){this.value=value;this.text=text;optionElement.selected=true}};UCML.DropDownList.prototype.removeAt=function(index){for(var i=0;i<this.dom.options.length;i++){if(i==index)this.dom.options.remove(i)}};UCML.DropDownList.prototype.clear=function(){this.el.find("option").remove()};UCML.DropDownList.prototype.dataBind=function(){UCML.DropDownList.superclass.dataBind.call(this);this.dom.innerHTML="";var recordCount=this.srcDataTable.getRecordCount();if(recordCount>0){var flag=false;for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(i==0){this.srcDataTable.childDatas[this.srcDataTable.getOID()]=false}var optionElement=document.createElement("OPTION");this.dom.appendChild(optionElement);optionElement.value=this.srcDataTable.getFieldValue(this.dataValueField);optionElement.text=this.srcDataTable.getFieldValue(this.dataTextField);if(this.value==optionElement.value){try{optionElement.selected=true}catch(ex){}this.dom.selectIndex=i;flag=true}else{try{optionElement.selected=false}catch(ex){}}}if(flag){this.srcDataTable.setRecordIndex(this.dom.selectIndex)}else{this.srcDataTable.SetIndexNoEvent(0)}}else{this.dom.selectIndex=-1}if(this.isSetItemFirstText){if(this.applet&&this.applet.itemFirstText&&this.itemFirstText==null){this.itemFirstText=this.applet.itemFirstText}var col=this.srcDataTable.getColumn(this.dataValueField);if(col.fieldType=="UCMLKey"&&this.itemFirstValue==""){this.itemFirstValue="00000000-0000-0000-0000-000000000000"}this.insert(0,this.itemFirstText||"",this.itemFirstValue,flag?false:true);this.dom.selectIndex=0}this.fireEvent("databind",this,this.input)};UCML.DropDownList.prototype.bindCodeTable=function(){UCML.DropDownList.superclass.bindCodeTable.call(this);this.dom.innerHTML="";var codeList=BusinessObject.GetCodeValue(this.codeTable);var flag=false;if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){var optionElement=document.createElement("OPTION");this.dom.appendChild(optionElement);optionElement.value=codeList[i].value;optionElement.text=codeList[i].caption;if(this.value==optionElement.value){optionElement.selected=true;this.dom.selectIndex=i;flag=true}else{optionElement.selected=false}}}if(this.isSetItemFirstText){if(this.applet&&this.applet.itemFirstText&&this.itemFirstText==null){this.itemFirstText=this.applet.itemFirstText}this.insert(0,this.itemFirstText||"","",flag?false:true);this.dom.selectIndex=0}};UCML.DropDownList.prototype.bindCustomData=function(texts,values){UCML.DropDownList.superclass.bindCustomData.call(this);this.dom.innerHTML="";var flag=false;var textList=texts.split(";");var valueList=values.split(";");if(textList&&valueList&&valueList.length>0){for(var i=0;i<valueList.length;i++){var optionElement=document.createElement("OPTION");this.dom.appendChild(optionElement);optionElement.value=valueList[i];optionElement.text=textList[i];if(this.value==optionElement.value){optionElement.selected=true;this.dom.selectIndex=i;flag=true}else{optionElement.selected=false}}}if(this.isSetItemFirstText){if(this.applet&&this.applet.itemFirstText&&this.itemFirstText==null){this.itemFirstText=this.applet.itemFirstText}this.insert(0,this.itemFirstText||"","",flag?false:true);this.dom.selectIndex=0}};UCML.reg("UCML.DropDownList",UCML.DropDownList);UCML.CheckBoxGroup=function(id){this.columns=1;this.addEvents("itemchange","blur");UCML.CheckBoxGroup.superclass.constructor.call(this,id)};UCML.extend(UCML.CheckBoxGroup,UCML.InputList,{ctype:"UCML.CheckBoxGroup",onRender:function(){$('<table border="0" cellspacing="0" cellpadding="0"><tbody></tbody></table>').appendTo(this.el)},setProperties:function(){UCML.CheckBoxGroup.superclass.setProperties.call(this);this.columns=this.getAttribute("repeatColumns")||this.columns}});UCML.CheckBoxGroup.prototype.init=function(){UCML.CheckBoxGroup.superclass.init.call(this)};UCML.CheckBoxGroup.prototype.renderedValue=function(val){if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.dataBind()}this.setValue(val);return this.getText()};UCML.CheckBoxGroup.prototype.setValue=function(value,trigger){value=value||"";if(trigger!==false){this.fireEvent("setValue",value)}var opt=this;var spv=value.split(";");this.el.find(":checkbox").each(function(){this.checked=false;$(this).attr("checked",false)});for(var i=0;i<spv.length;i++){this.el.find(":checkbox").each(function(){if(spv[i]==this.value){this.checked=true}$(this).attr("checked",this.checked);if(this.checked==true)$(this).parent("span.chk").addClass("on");else $(this).parent("span.chk").removeClass("on")})}this.value=value;this.text=this.getText()};UCML.CheckBoxGroup.prototype.change=function(val,text){this.value=this.getValue();this.text=this.getText();this.setValue(this.value)};UCML.CheckBoxGroup.prototype.setColumns=function(columns){this.columns=columns};UCML.CheckBoxGroup.prototype.enable=function(ch){this.setEnabledEdit(true)};UCML.CheckBoxGroup.prototype.disable=function(ch){this.setEnabledEdit(false)};UCML.CheckBoxGroup.prototype.setEnabledEdit=function(value){this.disabled=value?false:true;if(this.disabled){this.el.find("input").attr("disabled","true")}else{this.el.find("input").removeAttr("disabled")}};UCML.CheckBoxGroup.prototype.add=function(text,value,checked){text=text||"";if(value){var table=this.el.children("table");var length=table.find("td").length;var cid=this.id+"CheckList_"+length;if(length%this.columns==0){$("<tr></tr>").appendTo($("tbody",table))}var td=$("<td></td>");var input=$('<input id="'+cid+'" name="'+this.id+'" type="checkbox" value="'+value+'"   text="'+text+'" '+(this.disabled?"disabled":"")+"  "+(checked?"checked=true":"")+">");var chkSpan=$('<span class="chk '+(checked?"on":"")+(this.disabled?"no":"")+'"></span>');var label=$('<label for="'+cid+'">'+text+"</label>");chkSpan.append(input).appendTo(td);label.appendTo(td);td.appendTo($(table[0].rows[table[0].rows.length-1]));var opt=this;input.bind("change",function(e){var el=$(this);var text=el.attr("text");el.attr("checked",this.checked);if(this.checked===true)el.parent("span.chk").addClass("on");else el.parent("span.chk").removeClass("on");opt.change(this.value,text);opt.fireEvent("valuechange",opt.value,opt.text);opt.fireEvent("itemchange",this.value,text,this.checked)})}};UCML.CheckBoxGroup.prototype.dataBind=function(){UCML.CheckBoxGroup.superclass.dataBind.call(this);this.el.children("table").children("tbody").empty();var recordCount=this.srcDataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);this.add(this.srcDataTable.getFieldValue(this.dataTextField),this.srcDataTable.getFieldValue(this.dataValueField))}this.srcDataTable.SetIndexNoEvent(0);this.fireEvent("databind",this,this.input)};UCML.CheckBoxGroup.prototype.getValue=function(){this.value="";var opt=this;this.el.find("input:checked").each(function(){opt.value=opt.value+this.value+";"});if(this.value.lastIndexOf(";")==this.value.length-1){this.value=this.value.substring(0,this.value.length-1)}return this.value};UCML.CheckBoxGroup.prototype.getText=function(){this.text="";var opt=this;this.el.find("input:checked").each(function(){opt.text=opt.text+$(this).attr("text")+";"});if(this.text.lastIndexOf(";")==this.text.length-1){this.text=this.text.substring(0,this.text.length-1)}return this.text};UCML.CheckBoxGroup.prototype.bindCodeTable=function(){UCML.CheckBoxGroup.superclass.bindCodeTable.call(this);this.el.children("table").children("tbody").empty();var codeList=BusinessObject.GetCodeValue(this.codeTable);if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){this.add(codeList[i].caption,codeList[i].value)}}};UCML.CheckBoxGroup.prototype.bindCustomData=function(texts,values){UCML.CheckBoxGroup.superclass.bindCustomData.call(this);this.el.children("table").children("tbody").empty();var valueList=values.split(";");var textList=texts.split(";");if(valueList&&textList&&valueList.length>0){for(var i=0;i<valueList.length;i++){this.add(textList[i],valueList[i])}}};UCML.reg("UCML.CheckBoxGroup",UCML.CheckBoxGroup);UCML.RadioGroup=function(id){this.columns=1;this.addEvents("blur");UCML.RadioGroup.superclass.constructor.call(this,id)};UCML.extend(UCML.RadioGroup,UCML.InputList,{ctype:"UCML.RadioGroup",onRender:function(){$('<table border="0" cellspacing="0" cellpadding="0"><tbody></tbody></table>').appendTo(this.el)},setProperties:function(){UCML.RadioGroup.superclass.setProperties.call(this);this.columns=this.getAttribute("columns")||this.columns}});UCML.RadioGroup.prototype.init=function(){UCML.RadioGroup.superclass.init.call(this)};UCML.RadioGroup.prototype.renderedValue=function(val){if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.dataBind()}this.setValue(val);return this.text};UCML.RadioGroup.prototype.setValue=function(value,trigger){if(value==undefined){value=""}if(trigger!==false){this.fireEvent("setValue",value)}this.value=value;this.text="";var opt=this;this.el.find(":radio").each(function(){this.checked=false;$(this).attr("checked",false);$(this).parent("span.rdo").removeClass("on")});this.el.find(":radio[value='"+value+"']").each(function(){this.checked=true;var el=$(this);opt.text=el.attr("text");el.attr("checked",this.checked);if(this.checked==true)$(this).parent("span.rdo").addClass("on");else $(this).parent("span.rdo").removeClass("on")})};UCML.RadioGroup.prototype.change=function(val,text){this.value=val;this.text=text;this.setValue(this.value)};UCML.RadioGroup.prototype.setColumns=function(columns){this.columns=columns};UCML.RadioGroup.prototype.add=function(text,value,checked){text=text||"";if(value){var table=this.el.children("table");var length=table.find("td").length;
var cid=this.id+"RadioList_"+length;if(length%this.columns==0){$("<tr></tr>").appendTo($("tbody",table))}var td=$("<td></td>");var input=$('<input id="'+cid+'" name="'+this.id+'" type="radio" value="'+value+'"   text="'+text+'" '+(this.disabled?"disabled":"")+"  "+(checked?"checked=true":"")+">");var radioSpan=$("<span class='rdo "+(checked?"on ":"")+(this.disabled?"no":"")+"'></span>");var label=$('<label for="'+cid+'">'+text+"</label>");radioSpan.append(input).appendTo(td);label.appendTo(td);td.appendTo($(table[0].rows[table[0].rows.length-1]));var opt=this;input.bind("change",function(e){var el=$(this);var text=el.attr("text");el.attr("checked",this.checked);if(this.checked===true){opt.el.find("span.rdo").removeClass("on");el.parent("span.rdo").addClass("on")}opt.change(this.value,text);opt.fireEvent("valuechange",this.value,text);opt.fireEvent("blur")})}};UCML.RadioGroup.prototype.dataBind=function(){UCML.RadioGroup.superclass.dataBind.call(this);this.el.children("table").children("tbody").empty();var recordCount=this.srcDataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);this.add(this.srcDataTable.getFieldValue(this.dataTextField),this.srcDataTable.getFieldValue(this.dataValueField))}this.srcDataTable.SetIndexNoEvent(0)};UCML.RadioGroup.prototype.getValue=function(){return this.value};UCML.RadioGroup.prototype.getText=function(){this.text="";var opt=this;this.el.find(":radio:checked").each(function(){opt.text=opt.text+$(this).attr("text")});return this.text};UCML.RadioGroup.prototype.bindCodeTable=function(){UCML.RadioGroup.superclass.bindCodeTable.call(this);this.el.children("table").children("tbody").empty();var codeList=BusinessObject.GetCodeValue(this.codeTable);if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){this.add(codeList[i].caption,codeList[i].value)}}};UCML.RadioGroup.prototype.bindCustomData=function(texts,values){UCML.RadioGroup.superclass.bindCustomData.call(this);this.el.children("table").children("tbody").empty();var textList=texts.split(";");var valueList=values.split(";");if(textList&&valueList&&valueList.length>0){for(var i=0;i<valueList.length;i++){this.add(textList[i],valueList[i])}}};UCML.RadioGroup.prototype.enable=function(ch){this.setEnabledEdit(true)};UCML.RadioGroup.prototype.disable=function(ch){this.setEnabledEdit(false)};UCML.RadioGroup.prototype.setEnabledEdit=function(value){this.disabled=value?false:true;if(this.disabled){this.el.find("input").attr("disabled","true")}else{this.el.find("input").removeAttr("disabled")}};UCML.reg("UCML.RadioGroup",UCML.RadioGroup);UCML.Combo=function(id){this.addEvents("blur","focus");UCML.Combo.superclass.constructor.call(this,id)};UCML.extend(UCML.Combo,UCML.Input,{width:"auto",panelWidth:"auto",panelHeight:200,multiple:true,separator:",",editable:true,disabled:false,required:false,missingMessage:"This field is required.",selectPrev:function(){},selectNext:function(){},selectCurr:function(){},filter:function(query){},onChange:function(newValue,oldValue){},hide:function(){UCML.Combo.superclass.hide.call(this);this.combo.hide();this.hidePanel()},show:function(){UCML.Combo.superclass.show.call(this);this.combo.show();this.showPanel()}});UCML.Combo.prototype.init=function(){UCML.Combo.superclass.init.call(this)};UCML.Combo.prototype.onRender=function(){var span=$('<span class="combo"></span>').insertAfter(this.el);var table=$('<table width="100%" style="width:100%; table-layout:fixed" border=0 cellSpacing=0 cellPadding=0><tr><td ></td><td  width="20"><span class="combo-arrow"></span></td></tr></table>').appendTo(span);var input=this.el.appendTo(table.find("td")[0]);input.addClass("combo-text");$('<input type="hidden" class="combo-value">').appendTo(span);var name=this.el.attr("name");if(name){span.find("input.combo-value").attr("name",name);this.el.removeAttr("name").attr("comboName",name)}input.attr("autocomplete","off");if(!this.editable){input.attr("readonly",this.editable)}if(!this.panel){var panel=new UCML.Panel({el:$("<div ></div>").appendTo("body"),doSize:true,closed:true,style:{position:"absolute"},width:this.panelWidth,height:this.panelHeight,isSetProperties:false,bodyCls:"combo-panel"});this.panel=panel;this.panel.el.bind("mousedown.combo",function(e){return false})}this.combo=span;UCML.on(this.el,"blur",function(){this.setValue(this.dom.value,false)},this)};UCML.Combo.prototype.setProperties=function(){UCML.Combo.superclass.setProperties.call(this);this.panelWidth=this.el.attr("panelWidth")=="auto"?"auto":parseInt(this.el.attr("panelWidth"))||this.panelWidth;this.panelHeight=this.el.attr("panelHeight")=="auto"?"auto":parseInt(this.el.attr("panelHeight"))||this.panelHeight;this.separator=this.el.attr("separator")||this.separator;this.multiple=this.el.attr("multiple")?this.el.attr("multiple")=="true"||this.el.attr("multiple")==true:this.multiple;this.editable=this.el.attr("editable")?this.el.attr("editable")=="true":true;this.disabled=this.el.attr("disabled")?true:this.disabled;this.required=this.el.attr("required")?this.el.attr("required")=="true"||this.el.attr("required")==true:this.required;this.missingMessage=this.el.attr("missingMessage")||this.missingMessage};UCML.Combo.prototype.focus=function(){this.combo.find("input.combo-text")[0].focus()};UCML.Combo.prototype.blur=function(){this.combo.find("input.combo-text")[0].blur();this.close()};UCML.Combo.prototype.destroy=function(){this.panel.destroy();this.combo.remove();UCML.Combo.superclass.destroy.call(this)};UCML.Combo.prototype.showPanel=function(){this.panel.el.css("z-index",UCML.Window.zIndex++);this.panel.open();var panelWidth=this.panel.getOuterWidth(true);var opt=this;(function(){if(opt.panel.el.is(":visible")){var top=opt.combo.offset().top+opt.combo.outerHeight();var height=null;if(top+opt.panel.el.outerHeight()>$(window).height()+$(document).scrollTop()){top=opt.combo.offset().top-opt.panel.el.outerHeight();height=$(window).height()-(opt.combo.offset().top+opt.combo.outerHeight())}if(top<$(document).scrollTop()){top=opt.combo.offset().top+opt.combo.outerHeight()}var left=opt.combo.offset().left;if(left+panelWidth>$(window).width()+$(document).scrollLeft()){left=left+opt.combo.outerWidth()-panelWidth}opt.panel.el.css({left:left,top:top});if(height&&height>0){opt.panel.el.css({height:height,"overflow-y":"auto","overflow-x":"hidden"})}setTimeout(arguments.callee,200)}})()};UCML.Combo.prototype.hidePanel=function(){this.panel.close()};UCML.Combo.prototype.setDisabled=function(disabled){if(disabled){this.disabled=true;this.el.attr("disabled",true);this.combo.find(".combo-value").attr("disabled",true);this.combo.find(".combo-text").attr("disabled",true)}else{this.disabled=false;this.el.removeAttr("disabled");this.combo.find(".combo-value").removeAttr("disabled");this.combo.find(".combo-text").removeAttr("disabled")}};UCML.Combo.prototype.clear=function(){this.combo.find("input.combo-value:gt(0)").remove();this.combo.find("input.combo-value").val("");this.combo.find("input.combo-text").val("")};UCML.Combo.prototype.getText=function(){return this.combo.find("input.combo-text").val()};UCML.Combo.prototype.setText=function(text){this.combo.find("input.combo-text").val(text);this.validate(true)};UCML.Combo.prototype.validate=function(doit){var input=this.combo.find("input.combo-text")};UCML.Combo.prototype.getValues=function(){var values=[];this.combo.find("input.combo-value").each(function(){values.push($(this).val())});return values};UCML.Combo.prototype.setValues=function(values){var oldValues=this.getValues();this.combo.find("input.combo-value").remove();var name=this.el.attr("comboName");for(var i=0;i<values.length;i++){var input=$('<input type="hidden" class="combo-value">').appendTo(this.combo);if(name)input.attr("name",name);input.val(values[i])}var tmp=[];for(var i=0;i<oldValues.length;i++){tmp[i]=oldValues[i]}var aa=[];for(var i=0;i<values.length;i++){for(var j=0;j<tmp.length;j++){if(values[i]==tmp[j]){aa.push(values[i]);tmp.splice(j,1);break}}}if(aa.length!=values.length||values.length!=oldValues.length){if(this.multiple){this.onChange.call(this,values,oldValues)}else{this.onChange.call(this,values[0],oldValues[0])}}};UCML.Combo.prototype.getValue=function(){var values=this.getValues();return values[0]};UCML.Combo.prototype.setValue=function(value,trigger){this.value=value;this.setText(value);this.setValues([value]);if(trigger!==false){this.fireEvent("setValue",value)}};UCML.Combo.prototype.setSize=function(width){if(width){this.width=width}if(!isNaN(this.width)){if($.boxModel==true){this.combo.width(this.width-(this.combo.outerWidth()-this.combo.width()))}else{this.combo.width(this.width)}}};UCML.Combo.prototype.setOffset=function(top,left){this.combo.offset({top:top,left:left})};UCML.Combo.prototype.close=function(){this.fireEvent("blur");if(this.panel){this.panel.close()}};UCML.Combo.prototype.bindEvents=function(){UCML.Combo.superclass.bindEvents.call(this);var input=this.combo.find(".combo-text");var arrow=this.combo.find(".combo-arrow");this.combo.unbind(".combo");input.unbind(".combo");arrow.unbind(".combo");var opt=this;if(!this.disabled){UCML.on(document,"mousedown.combo",this.close,this);this.combo.bind("mousedown.combo",function(e){return false});input.bind("focus.combo",function(){if(opt.fireEvent("focus")===true){opt.showPanel()}}).bind("mousedown.combo",function(e){input.focus()}).bind("keyup.combo",function(e){switch(e.keyCode){case 37:case 38:opt.selectPrev.call(opt);break;case 39:case 40:opt.selectNext.call(opt);break;case 13:opt.hidePanel(opt);break;case 27:opt.hidePanel(opt);break;default:if(opt.editable){opt.filter.call(opt,$(this).val())}}return false});arrow.bind("click.combo",function(){input.focus()}).bind("mouseenter.combo",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.combo",function(){$(this).removeClass("combo-arrow-hover")})}};UCML.Combo.prototype.disable=function(jq){this.setDisabled(true);this.bindEvents()};UCML.Combo.prototype.enable=function(jq){this.setDisabled(false);this.bindEvents()};UCML.Combo.prototype.textbox=function(){return this.combo.find("input.combo-text")};UCML.reg("UCML.Combo",UCML.Combo);UCML.ComboBox=function(id){this.selected=[];UCML.ComboBox.superclass.constructor.call(this,id)};UCML.extend(UCML.ComboBox,UCML.Combo,{ctype:"UCML.ComboBox",autoEl:"input",panelWidth:180,panelHeight:"auto",setProperties:function(){UCML.ComboBox.superclass.setProperties.call(this);this.codeTable=this.getAttribute("codeTable")||this.codeTable;this.isCodeTable=(this.el.attr("isCodeTable")?this.getAttribute("isCodeTable")=="true":false)||this.isCodeTable;this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName"))||undefined;this.dataValueField=this.getAttribute("dataValueField")||this.dataValueField;this.dataTextField=this.getAttribute("dataTextField")||this.dataTextField}});UCML.ComboBox.prototype.init=function(){UCML.ComboBox.superclass.init.call(this);UCML.on(this.dom,"change",function(){this.setValue(this.dom.value)},this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.srcDataTable.on("onLoad",this.dataBind,this)}else if(this.isCodeTable==true&&!UCML.isEmpty(this.codeTable)){this.bindCodeTable()}};UCML.ComboBox.prototype.selectPrev=function(){var panel=this.panel.body;var values=this.getValues();var item=panel.find("div.combobox-item[value='"+values.pop()+"']");if(item.length){var prev=item.prev(":visible");if(prev.length){item=prev}}else{item=panel.find("div.combobox-item:visible:last")}var value=item.attr("value");this.setValues([value]);if(item.position().top<=0){var h=panel.scrollTop()+item.position().top;panel.scrollTop(h)}else if(item.position().top+item.outerHeight()>panel.height()){var h=panel.scrollTop()+item.position().top+item.outerHeight()-panel.height();panel.scrollTop(h)}};UCML.ComboBox.prototype.selectNext=function(){var panel=this.panel.body;var values=this.getValues();var item=panel.find("div.combobox-item[value='"+values.pop()+"']");if(item.length){var next=item.next(":visible");if(next.length){item=next}}else{item=panel.find("div.combobox-item:visible:first")}var value=item.attr("value");this.setValues([value]);if(item.position().top<=0){var h=panel.scrollTop()+item.position().top;panel.scrollTop(h)}else if(item.position().top+item.outerHeight()>panel.height()){var h=panel.scrollTop()+item.position().top+item.outerHeight()-panel.height();panel.scrollTop(h)}};UCML.ComboBox.prototype.selectCurr=function(){var panel=this.panel.body;var item=panel.find("div.combobox-item-selected");this.setValues([item.attr("value")]);this.hidePanel()};UCML.ComboBox.prototype.filter=function(query){this.showPanel();var panel=this.panel.body;panel.find("div.combobox-item").each(function(){var item=$(this);if(item.text().indexOf(query)==0){item.show();if(item.text()==query){item.addClass("combobox-item-selected")}}else{item.hide()}})};UCML.ComboBox.prototype.select=function(value){var opts=this;if(opts.multiple){var values=this.getValues();for(var i=0;i<values.length;i++){if(values[i]==value)return}values.push(value);var val=values.join(this.separator);this.setValue(val)}else{this.setValue(value);this.hidePanel()}};UCML.ComboBox.prototype.unselect=function(value){var opts=this;var values=this.getValues();for(var i=0;i<values.length;i++){if(values[i]==value){values.splice(i,1);var val=values.join(this.separator);this.setValue(val);break}}};UCML.ComboBox.prototype.setValues=function(values,remainText){var opts=this;var panel=this.panel.body;UCML.ComboBox.superclass.setValues.call(this,values);panel.find("div.combobox-item-selected").removeClass("combobox-item-selected");var vv=[],ss=[];for(var i=0;i<values.length;i++){var v=values[i];var itemSelect=panel.find("div.combobox-item[value='"+v+"']");vv.push(v);ss.push(itemSelect.html());itemSelect.addClass("combobox-item-selected")}if(!remainText){var text=ss.join(opts.separator);this.setText(text)}};UCML.ComboBox.prototype.setValue=function(value,trigger){var opts=this;var v=value;if(opts.multiple){if(v){this.setValues(value.split(opts.separator))}else{this.setValues([])}}else{this.setValues([v])}if(trigger!==false){this.fireEvent("setValue",v)}};UCML.ComboBox.prototype.add=function(caption,value,selected){var opts=this;var panel=this.panel.body;var item=$('<div class="combobox-item"></div>').appendTo(panel);item.attr("value",value);item.html(caption);if(selected){this.selected.push(value);if(opts.multiple){this.setValues(this.selected)}else{if(this.selected.length){this.setValues([this.selected[0]])}else{this.setValues([])}}}item.hover(function(){$(this).addClass("combobox-item-hover")},function(){$(this).removeClass("combobox-item-hover")}).click(function(){var item=$(this);if(opts.multiple){if(item.hasClass("combobox-item-selected")){opts.unselect(item.attr("value"))}else{opts.select(item.attr("value"))}}else{opts.select(item.attr("value"));opts.fireEvent("blur")}})};UCML.ComboBox.prototype.dataBind=function(){UCML.RadioGroup.superclass.dataBind.call(this);this.el.empty();var recordCount=this.srcDataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);this.add(this.srcDataTable.getFieldValue(this.dataTextField),this.srcDataTable.getFieldValue(this.dataValueField))}this.srcDataTable.SetIndexNoEvent(0)};UCML.ComboBox.prototype.bindCodeTable=function(){var panel=this.panel.body;panel.empty();var codeList=BusinessObject.GetCodeValue(this.codeTable);if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){this.add(codeList[i].caption,codeList[i].value)}}};UCML.reg("UCML.ComboBox",UCML.ComboBox);UCML.Spinner=function(id){this.addEvents("blur","focus");UCML.Spinner.superclass.constructor.call(this,id)};UCML.extend(UCML.Spinner,UCML.Input,{ctype:"UCML.Spinner",autoEl:"input",width:"auto",value:"",min:null,max:null,increment:1,editable:true,disabled:false,spin:function(down){},onSpinUp:function(){},onSpinDown:function(){},accelerate:false});UCML.Spinner.prototype.init=function(){UCML.Spinner.superclass.init.call(this);this.setDisabled(this.disabled);this.setSize();this.validatebox=new UCML.Validatebox(this.el);return this.spinner};UCML.Spinner.prototype.onRender=function(){this.spinner=$('<span class="spinner"></span>').insertAfter(this.el);var table=$('<table width="100%" style="width:100%; table-layout:fixed" border=0 cellSpacing=0 '+'cellPadding=0><tr><td vAlgign="top"></td><td  width="18">'+'<span class="spinner-arrow">'+'<span class="spinner-arrow-up"></span>'+'<span class="spinner-arrow-down"></span>'+"</span>"+"</td></tr></table>").appendTo(this.spinner);this.el.removeClass().addClass("spinner-text").prependTo(table.find("td")[0]);this.el.removeAttr("disabled");this.el.val(this.value);this.el.attr("readonly",!this.editable)};UCML.Spinner.prototype.setSize=function(width,height){if(width){this.width=width}if(height){this.height=height}if(!isNaN(this.width)){if($.boxModel==true){this.spinner.width(this.width-(this.spinner.outerWidth()-this.spinner.width()))}else{this.spinner.width(this.width)}}};UCML.Spinner.prototype.setOffset=function(top,left){this.spinner.offset({top:top,left:left})};UCML.Spinner.prototype.handleMouseWheel=function(el,e){return;var delta=e.getWheelDelta();if(delta>0){opts.spin.call(opts,false);opts.onSpinUp.call(opts);opts.validatebox.validate();e.stopEvent()}else{if(delta<0){opts.spin.call(opts,false);opts.onSpinDown.call(opts);opts.validatebox.validate();e.stopEvent()}}};UCML.Spinner.prototype.focus=function(){this.spinner.find("input.spinner-text")[0].focus()};UCML.Spinner.prototype.bindEvents=function(){var opts=this;var spinner=this.spinner;spinner.find(".spinner-arrow-up,.spinner-arrow-down").unbind(".spinner");if(!opts.disabled){UCML.on(document,"mousedown.spinner",function(){this.fireEvent("blur")},this);var input=this.spinner.find(".spinner-text");input.bind("mousedown.spinner",function(e){e.stopPropagation()});input.bind("focus.spinner",function(){if(opts.fireEvent("focus")===true){}});spinner.bind("mousedown.spinner",function(e){return false});spinner.find(".spinner-arrow-up").bind("mouseenter.spinner",function(){$(this).addClass("spinner-arrow-hover")}).bind("mouseleave.spinner",function(){$(this).removeClass("spinner-arrow-hover")});var up=new UCML.util.ClickRepeater(spinner.find(".spinner-arrow-up"),{accelerate:this.accelerate,stopDefault:false});up.on("click",function(){opts.spin.call(opts,false);opts.onSpinUp.call(opts)});spinner.find(".spinner-arrow-down").bind("mouseenter.spinner",function(){$(this).addClass("spinner-arrow-hover")}).bind("mouseleave.spinner",function(){$(this).removeClass("spinner-arrow-hover")});var down=new UCML.util.ClickRepeater(spinner.find(".spinner-arrow-down"),{accelerate:this.accelerate,stopDefault:false});down.on("click",function(){opts.spin.call(opts,true);opts.onSpinDown.call(opts)})}};UCML.Spinner.prototype.setDisabled=function(disabled){var opts=this;if(disabled){opts.disabled=true;this.el.attr("disabled",true)}else{opts.disabled=false;this.el.removeAttr("disabled")}};UCML.Spinner.prototype.parseOptions=function(){this.width=parseInt(this.dom.style.width)||undefined;this.value=this.el.val()||undefined;this.min=this.el.attr("min");this.max=this.el.attr("max");this.increment=parseFloat(t.attr("increment"))||undefined;this.editable=t.attr("editable")?t.attr("editable")=="true":undefined;this.disabled=t.attr("disabled")?true:undefined};UCML.Spinner.prototype.destroy=function(){var spinner=this.spinner;this.validatebox.destroy();spinner.remove()};UCML.Spinner.prototype.enable=function(){this.setDisabled(false);this.bindEvents()};UCML.Spinner.prototype.disable=function(){this.setDisabled(true);this.bindEvents()};UCML.Spinner.prototype.getValue=function(){return this.el.val()};UCML.Spinner.prototype.setValue=function(value){this.value=value;this.el.val(value)};UCML.Spinner.prototype.clear=function(){this.value="";this.el.val("")};UCML.Validatebox=function(id){this.required=false;this.validType=null;this.missingMessage="输入不能为空";this.invalidMessage=null;UCML.Spinner.superclass.constructor.call(this,id)};UCML.extend(UCML.Validatebox,UCML.Commponent,{ctype:"UCML.Validatebox"});UCML.Validatebox.prototype.init=function(){UCML.Validatebox.superclass.init.call(this);this.el.addClass("validatebox-text");this.required=this.el.attr("required")?this.el.attr("required")=="true"||this.el.attr("required")==true:this.required;this.validType=this.el.attr("validType")||this.validType;this.missingMessage=this.el.attr("missingMessage")||this.missingMessage;this.invalidMessage=this.el.attr("invalidMessage")||this.invalidMessage};UCML.Validatebox.prototype.destroyBox=function(){var tip=this.tip;if(tip){tip.remove()}};UCML.Validatebox.prototype.bindEvents=function(){var box=this.el;var tip=this.tip;var opts=this;var time=null;box.unbind(".validatebox").bind("focus.validatebox",function(){if(time){clearInterval(time)}time=setInterval(function(){opts.validate()},200)}).bind("blur.validatebox",function(){clearInterval(time);time=null}).bind("mouseover.validatebox",function(){if(box.hasClass("validatebox-invalid")){opts.showTip()}}).bind("mouseout.validatebox",function(){opts.hideTip()})};UCML.Validatebox.prototype.showTip=function(){var box=this.el;var msg=this.message;var tip=this.tip;if(!tip){tip=$('<div class="validatebox-tip">'+'<span class="validatebox-tip-content">'+"</span>"+'<span class="validatebox-tip-pointer">'+"</span>"+"</div>").appendTo("body");this.tip=tip}tip.find(".validatebox-tip-content").html(msg);tip.width(box.outerWidth());var boxWidthl=box.offset().left+box.outerWidth();if(boxWidthl>0){tip.css({display:"block",left:boxWidthl,top:box.offset().top});var width=tip.find(".validatebox-tip-content").outerWidth(true)+tip.find(".validatebox-tip-pointer").outerWidth(true);if(boxWidthl+width>=$(window.document.body).outerWidth(true)){tip.addClass("validatebox-tip-left");tip.css({display:"block",left:box.offset().left,top:box.offset().top+box.outerHeight(true)})}}};UCML.Validatebox.prototype.hideTip=function(){var tip=this.tip;if(tip){tip.remove();this.tip=null}};UCML.Validatebox.prototype.setTipMessage=function(msg){this.message=msg};UCML.Validatebox.prototype.validate=function(){var opts=this;var tip=this.tip;var box=this.el;var value=box.val();var disabled=box.attr("disabled");if(disabled==true||disabled=="true"){return true}if(opts.required){if(value==""){box.addClass("validatebox-invalid");this.setTipMessage(opts.missingMessage);this.showTip();return false}}if(opts.validType){var result=/([a-zA-Z_]+)(.*)/.exec(opts.validType);var rule=opts.rules[result[1]];if(value&&rule){var param=eval(result[2]);if(!rule["validator"](value,param)){box.addClass("validatebox-invalid");var message=rule["message"];if(param){for(var i=0;i<param.length;i++){message=message.replace(new RegExp("\\{"+i+"\\}","g"),param[i])}}this.setTipMessage(opts.invalidMessage||message);this.showTip();return false}}}box.removeClass("validatebox-invalid");this.hideTip();return true};UCML.Validatebox.prototype.destroy=function(){this.destroyBox()};UCML.Validatebox.prototype.isValid=function(){return this.validate()};UCML.Linkbutton=function(id){this.id=null;this.disabled=false;this.plain=false;this.text="";this.iconCls=null;UCML.Linkbutton.superclass.constructor.call(this,id)};UCML.extend(UCML.Linkbutton,UCML.Commponent,{autoEl:"a",ctype:"UCML.Linkbutton"});UCML.Linkbutton.prototype.init=function(){UCML.Linkbutton.superclass.init.call(this);this.el.removeAttr("disabled")};UCML.Linkbutton.prototype.setProperties=function(){UCML.Linkbutton.superclass.setProperties.call(this);this.plain=this.el.attr("plain")?this.el.attr("plain")=="true":this.plain;this.text=this.text||$.trim(this.el.html());this.iconCls=this.el.attr("icon")||this.iconCls};UCML.Linkbutton.prototype.bindEvents=function(){UCML.Linkbutton.superclass.bindEvents.call(this);this.on("click",this.click,this)};UCML.Linkbutton.prototype.click=function(el,e){if(this.onClick){if(!this.disabled){this.onClick.call(this,el,e)}}};UCML.Linkbutton.prototype.IsCssOrRes=function(iconCls){iconCls=iconCls.toLowerCase();if(iconCls.indexOf(".jpg")!=-1||iconCls.indexOf(".png")!=-1||iconCls.indexOf(".gif")!=-1||iconCls.indexOf(".bmp")!=-1){return false}return true};UCML.Linkbutton.prototype.onRender=function(){if(this.isMobile){this.el.addClass("ui-btn");this.el.attr("data-mini","true");this.el.attr("data-inline","true");if(this.iconCls){this.el.addClass(this.iconCls);if(this.iconPos){this.el.addClass("ui-btn-icon-"+this.iconPos)}else{this.el.addClass("ui-btn-icon-left")}}if(this.btnCls){this.el.addClass(this.btnCls)}if(this.toolbar&&this.toolbar.ctype=="UCML.PaginationMobile"){this.el.attr("data-mini","false");if(this.toolbar.el.length>0&&typeof BPOIsJQMPage!=undefined){var theme=BPOIsJQMPage?BPOPageTheme:this.toolbar.applet.IsJQMPage?this.toolbar.applet.JQMPageTheme:"a";if(theme=="a"){this.el.css({background:"#e6e6e6",border:"none","padding-right":"0px"})}else if(theme=="b"){this.el.css({background:"#1d1d1d",border:"none","padding-right":"0px"})}}}else{if(this.text){this.el.html(this.text)}else{this.el.attr("data-mini","false");this.el.addClass("ui-btn-icon-notext");this.el.css({"border-radius":" .3125em","padding-left":"0px"})}}this.el.textinput();return}this.el.empty();this.el.addClass("l-btn");if(this.id){this.el.attr("id",this.id)}else{this.el.removeAttr("id")}if(this.plain){this.el.addClass("l-btn-plain")}else{this.el.removeClass("l-btn-plain")}if(this.text){this.el.html(this.text).wrapInner('<span class="l-btn-left">'+'<span class="l-btn-text btn c">'+"</span>"+"</span>");if(this.iconCls){if(this.IsCssOrRes(this.iconCls)){this.el.find(".l-btn-text").addClass(this.iconCls)}else this.el.find(".l-btn-text").css({"padding-left":"20px",background:"url("+this.iconCls+") no-repeat"})}if(this.btnCls){this.el.find(".l-btn-text").addClass(this.btnCls)}}else{this.el.html("&nbsp;").wrapInner('<span class="l-btn-left">'+'<span class="l-btn-text btn c">'+'<span class="l-btn-empty"></span>'+"</span>"+"</span>");if(this.iconCls){if(this.IsCssOrRes(this.iconCls))this.el.find(".l-btn-text").addClass(this.iconCls);else this.el.find(".l-btn-empty").css({background:"url("+this.iconCls+") no-repeat"})}if(this.btnCls){this.el.find(".l-btn-text").addClass(this.btnCls)}}this.setDisabled(this.disabled)};UCML.Linkbutton.prototype.setDisabled=function(disabled){if(disabled){this.disabled=true;var href=this.el.attr("href");if(href){this.href=href;this.attr("href","javascript:void(0)")}var onclick=this.el.attr("onclick");if(onclick){this.onclick=onclick;this.el.attr("onclick",null)}this.el.addClass("l-btn-disabled")}else{this.disabled=false;if(this.href){this.el.attr("href",this.href)}if(this.onclick){this.dom.onclick=this.onclick}this.el.removeClass("l-btn-disabled")}};UCML.Linkbutton.prototype.enable=function(){this.setDisabled(false)};UCML.Linkbutton.prototype.disable=function(){this.setDisabled(true)};UCML.Linkbutton.prototype.setText=function(val){if(this.isMobile){this.el.html(val).removeClass("ui-btn-icon-notext").addClass("ui-mini").css({"padding-left":"1em"})}else{this.el.find(".l-btn-left .l-btn-text").html(val)}};UCML.reg("UCML.Linkbutton",UCML.Linkbutton);UCML.CheckButton=function(id){this.checked=false;UCML.CheckButton.superclass.constructor.call(this,id)};UCML.extend(UCML.CheckButton,UCML.Linkbutton,{ctype:"UCML.CheckButton"});UCML.CheckButton.prototype.init=function(){UCML.CheckButton.superclass.init.call(this)};UCML.CheckButton.prototype.click=function(){if(!this.checked){this.el.addClass("check-btn");this.checked=true}else{this.checked=false;this.el.removeClass("check-btn")}UCML.CheckButton.superclass.click.call(this)};UCML.reg("UCML.CheckButton",UCML.CheckButton);UCML.Menu=function(id){this.zIndex=11e4;this.left=0;this.top=0;this.onShow=function(){};this.onHide=function(){};this.items=[];this.menus=[];this.addEvents("menuItemClick");UCML.Menu.superclass.constructor.call(this,id)};UCML.extend(UCML.Menu,UCML.Commponent,{});UCML.Menu.prototype.init=function(){UCML.Menu.superclass.init.call(this);this.el.appendTo("body");this.el.addClass("menu");var menuList=window["menuList"]||[];menuList.add(this);window["menuList"]=menuList;this.el.css({left:this.left,top:this.top});this.el.hide();return;this.adjust(this.el);var opts=this;for(var i=0;i<this.menus.length;i++){var menu=this.menus[i];this.wrapMenu(menu);menu.find(">div.menu-item").each(function(){opts.bindMenuItemEvent($(this))});menu.find("div.menu-item").click(function(){if(!this.submenu){opts.hideAll()}return false})}};UCML.Menu.prototype.adjust=function(menu){this.menus.push(menu);var opts=this;menu.find(">div").each(function(){var item=$(this);var submenu=item.find(">div");if(submenu.length){submenu.insertAfter(opts.el);item[0].submenu=submenu;opts.adjust(submenu)}})};UCML.Menu.prototype.bindMenuItemEvent=function(item){var opts=this;item.bind("click",function(e){var menuId=item.attr("menuId");var menuItem=opts.getMenuItemById(menuId);opts.fireEvent("menuItemClick",$(this).attr("menuId"),menuItem);if(menuItem&&menuItem.hander){menuItem.hander.call(opts,menuItem,e)}});item.hover(function(){item.siblings().each(function(){if(this.submenu){opts.hideMenu(this.submenu)}$(this).removeClass("menu-active")});item.addClass("menu-active");var submenu=item[0].submenu;if(submenu){var left=item.offset().left+item.outerWidth()-2;if(left+submenu.outerWidth()>$(window).width()){left=item.offset().left-submenu.outerWidth()+2}opts.showMenu(submenu,{left:left,top:item.offset().top-3})}},function(e){item.removeClass("menu-active");var submenu=item[0].submenu;if(submenu){if(e.pageX>=parseInt(submenu.css("left"))){item.addClass("menu-active")}else{opts.hideMenu(submenu)}}else{item.removeClass("menu-active")}})};UCML.Menu.prototype.wrapMenu=function(menu){menu.addClass("menu").find(">div").each(function(){var item=$(this);if(item.hasClass("menu-sep")){item.html("&nbsp;")}else{var text=item.addClass("menu-item").html();item.empty().append($('<div class="menu-text"></div>').html(text));var icon=item.attr("icon");if(icon){$('<div class="menu-icon"></div>').addClass(icon).appendTo(item)}if(item[0].submenu){$('<div class="menu-rightarrow"></div>').appendTo(item)}if($.boxModel==true){var height=item.height();item.height(height-(item.outerHeight()-item.height()))}}});menu.hide()};UCML.Menu.prototype.onDocClick=function(e){this.hideAll();return false};UCML.Menu.prototype.hideAll=function(){this.hideMenu(this.el);UCML.un(document,".menu",this);this.onHide.call(this);return false};UCML.Menu.prototype.showTopMenu=function(pos){var opts=this;if(pos){opts.left=pos.left;opts.top=pos.top}this.showMenu(this.el,{left:opts.left,top:opts.top},function(){UCML.on(document,"click.menu",opts.onDocClick,opts);UCML.on(document,"contextmenu.menu",opts.onDocClick,opts);opts.onShow.call(opts)})};UCML.Menu.prototype.addSeparator=function(id){var item=$("<div menuId="+(id||UCML.id())+" class=menu-sep  >&nbsp;</div>");this.el.append(item)};UCML.Menu.prototype.getMenuItem=function(index){return this.items[index]};UCML.Menu.prototype.getMenuItemById=function(menuId){var i=this.getMenuItemIndex(menuId);return this.items[i]};UCML.Menu.prototype.getMenuItemIndex=function(menuId){for(var i=0;i<this.items.length;i++){if(menuId==this.items[i].menuId){return i}}return-1};UCML.Menu.prototype.addMenuItem=function(menuId,text,iconcls,hander){var menuItem={menuId:menuId||UCML.id(),text:text||"",iconcls:iconcls||"",hander:hander};this.items.add(menuItem);var item=$("<div menuId="+menuItem.menuId+' class=menu-item  ><div class="menu-text">'+menuItem.text+"</div></div>");$('<div class="menu-icon"></div>').addClass(iconcls).appendTo(item);if(item.submenu){$('<div class="menu-rightarrow"></div>').appendTo(item)}menuItem.el=item;this.el.append(item);this.bindMenuItemEvent(item)};UCML.Menu.prototype.setCheckedMenuItem=function(menuId,iconcls){iconcls=iconcls||"icon-ok";for(var i=0;i<this.items.length;i++){this.items[i].el.find(".menu-icon").removeClass(this.items[i].iconcls);if(this.items[i].menuId==menuId){this.items[i].el.find(".menu-icon").addClass(iconcls);
this.items[i].iconcls=iconcls}}};UCML.Menu.prototype.showMenu=function(menu,pos,callback){if(!menu)return;var opts=this;if(pos){menu.css(pos)}menu.show(1,function(){if(!menu[0].shadow){menu[0].shadow=$('<div class="menu-shadow"></div>').insertAfter(menu)}menu[0].shadow.css({display:"block",zIndex:opts.zIndex++,left:menu.css("left"),top:menu.css("top"),width:menu.outerWidth(),height:menu.outerHeight()});menu.css("z-index",opts.zIndex++);if(callback){callback()}})};UCML.Menu.prototype.hideMenu=function(menu){if(!menu)return;var opts=this;hideit(menu);menu.find("div.menu-item").each(function(){if(this.submenu){opts.hideMenu(this.submenu)}$(this).removeClass("menu-active")});function hideit(m){if(m[0].shadow){m[0].shadow.hide()}m.hide()}};UCML.Menu.prototype.show=function(param){this.showTopMenu(param)};UCML.Menu.prototype.hide=function(){this.hideAll()};UCML.Menu.hideMenuAll=function(){var menuList=window["menuList"]||[];for(var i=0;i<menuList.length;i++){menuList[i].hide()}};UCML.reg("UCML.Menu",UCML.Menu);UCML.Splitbutton=function(id){this.menuId=null;this.duration=100;this.split=true;UCML.Splitbutton.superclass.constructor.call(this,id)};UCML.extend(UCML.Splitbutton,UCML.Linkbutton,{});UCML.Splitbutton.prototype.init=function(){UCML.Splitbutton.superclass.init.call(this);this.menuId=this.el.attr("menuId");this.duration=parseInt(this.el.attr("duration"))||this.duration;var opts=this;var menubtn;var ice="s";this.el.removeClass("s-btn-active s-btn-plain-active");if(this.split){this.el.find(".l-btn-text").append('<span class="'+ice+'-btn-downarrow">&nbsp;</span>');menubtn=this.el.find(".s-btn-downarrow")}else{ice="m";this.el.find(".l-btn-text").append('<span class="'+ice+'-btn-downarrow">&nbsp;</span>');menubtn=this.el}this.menu=new UCML.Menu;this.menu.onShow=function(){this.el.addClass(this.plain==true?""+ice+"-btn-plain-active":""+ice+"-btn-active")};this.menu.onHide=function(){this.el.removeClass(this.plain==true?""+ice+"-btn-plain-active":""+ice+"-btn-active")};menubtn.unbind(".Splitbutton");this.el.unbind(".Splitbutton");if(opts.disabled==false&&opts.menu){menubtn.bind("click.Splitbutton",function(){UCML.Menu.hideMenuAll();opts.showMenu();return false});var timeout=null;this.el.bind("mouseenter.Splitbutton",function(){UCML.Menu.hideMenuAll();timeout=setTimeout(function(){opts.showMenu()},opts.duration);return false}).bind("mouseleave.Splitbutton",function(){if(timeout){clearTimeout(timeout)}})}};UCML.Splitbutton.prototype.showMenu=function(){if(this.disabled){for(var i=0;i<this.menu.items.length;i++){var item=this.menu.items[i];item.el[0].disabled=true;item.el.unbind("click")}}var left=this.el.offset().left;if(left+this.menu.el.outerWidth()+5>$(window).width()){left=$(window).width()-this.menu.el.outerWidth()-5}this.menu.show({left:left,top:this.el.offset().top+this.el.outerHeight()});this.el.blur()};UCML.reg("UCML.Splitbutton",UCML.Splitbutton);UCML.Menubutton=function(id){UCML.Menubutton.superclass.constructor.call(this,id);this.split=false};UCML.extend(UCML.Menubutton,UCML.Splitbutton,{});UCML.reg("UCML.Menubutton",UCML.Menubutton);UCML.BCLinkBox=function(id){this.queryFieldName="";this.quickQuery=false;this.dropDownMode=true;this.dropDownWidth;this.dropDownHeight;this.BCName;this.caption="请选择";this.BCRunMode=1;this.srcFieldName="";this.destFieldName="";this.condiFieldName="";this.constValue="";this.targetTable;this.urlFuncName="";this.canAdd=false;UCML.BCLinkBox.superclass.constructor.call(this,id)};UCML.extend(UCML.BCLinkBox,UCML.Combo,{ctype:"UCML.BCLinkBox",showPanel:function(){startBCLink(this.dom)},setProperties:function(){UCML.BCLinkBox.superclass.setProperties.call(this);this.dropDownHeight=this.getAttribute("DropDownHeight")||this.dropDownHeight;this.dropDownWidth=this.getAttribute("DropDownWidth")||this.dropDownWidth;this.BCName=this.getAttribute("DropDownAppletName")||this.BCName;this.targetTable=BusinessObject.getDataTableByBCName(this.getAttribute("targetTable"))||this.targetTable;this.srcFieldName=this.getAttribute("SrcFieldList")||this.srcFieldName;this.destFieldName=this.getAttribute("DestFieldList")||this.destFieldName;this.dataValueField=this.getAttribute("DataValueField")||this.dataValueField;this.canAdd=this.getAttribute("canAdd")||this.canAdd},onRender:function(){UCML.BCLinkBox.superclass.onRender.call(this)},onQuickQuery:function(el,e){},arrowClick:function(el){this.showPanel()},onFocus:function(){},onBlur:function(){},onKeyDown:function(el,e){this.onQuickQuery(el,e);return false},onKeyUp:function(){return false},close:function(){var bcLinKBPOName=this.BCName+"BPO";var linkWindow=UCML.get(bcLinKBPOName);if(linkWindow){linkWindow.close()}},setAppletObject:function(val){this.AppletObject=val},bindEvents:function(){var opts=this;var input=this.combo.find(".combo-text");var arrow=this.combo.find(".combo-arrow");if(!this.disabled){this.combo.unbind(".BCLink");arrow.unbind(".BCLink");this.un("keydown",this.onQuickQuery);UCML.un(input,"click",this.onFocus);UCML.un(input,"focus",this.onFocus);this.on("keydown",this.onKeyDown,this);this.on("keyup",this.onKeyUp,this);arrow.bind("click.BCLink",function(){opts.arrowClick(this)}).bind("mouseenter.BCLink",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.BCLink",function(){$(this).removeClass("combo-arrow-hover")});UCML.on(input,"click",this.onFocus,this);UCML.on(input,"focus",this.onFocus,this);UCML.on(input,"blur",this.onBlur,this)}else{this.combo.unbind(".BCLink");arrow.unbind(".BCLink");this.un("keydown",this.onQuickQuery);UCML.un(input,"click",this.onFocus);UCML.un(input,"focus",this.onFocus)}}});UCML.reg("UCML.BCLinkBox",UCML.BCLinkBox);UCML.BCLinkBoxForGrid=function(id){this.queryFieldName="";this.quickQuery=false;this.dropDownMode=true;this.dropDownWidth;this.dropDownHeight;this.BCName;this.caption="请选择";this.BCRunMode=1;this.srcFieldName="";this.destFieldName="";this.condiFieldName="";this.constValue="";this.targetTable;this.urlFuncName="";this.objBCLoadCondiColl=[];UCML.BCLinkBoxForGrid.superclass.constructor.call(this,id)};UCML.extend(UCML.BCLinkBoxForGrid,UCML.BCLinkBox,{ctype:"UCML.BCLinkBoxForGrid",setAppletObject:function(val){UCML.BCLinkBoxForGrid.superclass.setAppletObject.call(this,val);if(this.AppletObject){this.AppletObject.on("loaddata",function(){this.selectUpRow()})}},showPanel:function(){startBCLink(this);var opts=this;if(this.showWindow){this.showWindow.on("close",function(){})}},onQuickQuery:function(){this.queryValue=this.dom.value;this.queryValue=this.queryValue.replace("'","");if(this.queryOldValue!=this.queryValue){this.queryOldValue=this.queryValue;var s=this.dataValueField.split(";");var sqlcondi="";var TableName=this.AppletObject.getRootTable().TableName;for(var i=0;i<s.length;i++){if(sqlcondi!="")sqlcondi+=" OR ";var bcColumn=this.AppletObject.getRootTable().getColumn(s[i]);var fieldKind=bcColumn.fieldKind;if(fieldKind=="2"){var sortFieldName="al"+bcColumn.foreignKeyField+"."+bcColumn.lookupResultField+"";sqlcondi+=sortFieldName+" LIKE '%"+this.queryValue+"%' "}else{sqlcondi+=TableName+"."+s[i]+" LIKE '%"+this.queryValue+"%' "}}var rootBC=this.AppletObject.getRootTable();this.AppletObject.condiQuery(rootBC.theFieldList,rootBC.theValueList,rootBC.theCondiIndentList,sqlcondi,0)}},setRelaValue:function(){var s=this.dataValueField.split(";");this.dataTable.setActorData(this.AppletObject.getRootTable(),this.srcFieldName,this.destFieldName);this.dom.value=this.dataTable.getFieldValue(this.fieldName)},onFocus:function(){if(this.showWindow){if(this.showWindow.closed){this.showWindow.open()}}else{this.showPanel()}},onBlur:function(){this.queryValue=this.dom.value;var fieldValue=this.dataTable.getFieldValue(this.fieldName);if(fieldValue!=this.queryValue){if(this.canAdd){this.dataTable.setFieldValue(this.fieldName,this.queryValue)}else{this.dataTable.setFieldValue(this.fieldName,"")}}},onKeyDown:function(el,e){if(this.showWindow&&this.showWindow.closed){this.showWindow.open();return}var vcObj=UCML.get(this.AppletObject.BPOName);if(e.keyCode==38){vcObj.selectUpRow()}else if(e.keyCode==40){vcObj.selectNextRow()}else if(e.keyCode==13&&vcObj.activeRow){this.setRelaValue();this.showWindow.close()}else if(e.keyCode==27||e.keyCode==9){this.showWindow.close()}return false},onKeyUp:function(el,e){if(e.keyCode==40||e.keyCode==38||e.keyCode==37||e.keyCode==39||e.keyCode==34||e.keyCode==33|e.keyCode==27||e.keyCode==16||e.keyCode==35||e.keyCode==36||e.keyCode==36||e.keyCode==20||e.keyCode==18||e.keyCode==145||e.keyCode==19||e.keyCode==144||e.keyCode==13||e.keyCode==9)return;if(e.keyCode==13){}else{this.onQuickQuery()}return false}});UCML.reg("UCML.BCLinkBoxForGrid",UCML.BCLinkBoxForGrid);UCML.SelectManBox=function(id){UCML.SelectManBox.superclass.constructor.call(this,id)};UCML.extend(UCML.SelectManBox,UCML.Combo,{ctype:"UCML.SelectManBox",readOnly:true,otype:"1",destFieldName:"",dataValueField:"",BCName:"",showPanel:function(){if(this.selectWindow){this.selectWindow.open()}else{this.selectWindow=openSelectMan(this.otype,1,this.BCName,this.dataValueField,this.dataFld,{close:function(){UCML.OpenShowWindow.superclass.close.call(this)}})}},setProperties:function(){UCML.SelectManBox.superclass.setProperties.call(this);this.otype=this.getAttribute("otype")||this.otype;this.dataFld=this.getAttribute("dataFld")||this.dataFld;this.dataValueField=this.getAttribute("DataValueField")||this.dataValueField;if(!this.dataValueField){this.dataValueField=this.dataFld}this.BCName=this.getAttribute("BCName")||this.BCName},onRender:function(){UCML.SelectManBox.superclass.onRender.call(this);if(this.readOnly){this.setAttribute("readOnly",true)}},arrowClick:function(el){this.showPanel()},onFocus:function(){this.showPanel()},close:function(){if(this.selectWindow){this.selectWindow.close()}},bindEvents:function(){var opts=this;var input=this.combo.find(".combo-text");var arrow=this.combo.find(".combo-arrow");if(!this.disabled){arrow.bind("click.BCLink",function(){opts.arrowClick(this)}).bind("mouseenter.BCLink",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.BCLink",function(){$(this).removeClass("combo-arrow-hover")});UCML.on(input,"click",this.onFocus,this);UCML.on(input,"focus",this.onFocus,this)}else{this.combo.unbind(".BCLink");arrow.unbind(".BCLink");UCML.un(input,"click",this.onFocus);UCML.un(input,"focus",this.onFocus)}}});UCML.reg("UCML.SelectManBox",UCML.SelectManBox);UCML.WebCodeInput=function(id){this.queryFieldName="";this.quickQuery=false;this.dropDownMode=true;this.dropDownWidth;this.dropDownHeight;this.BCName;this.caption="请选择";this.BCRunMode=1;this.srcFieldName="";this.destFieldName="";this.condiFieldName="";this.constValue="";this.targetTable;this.urlFuncName="";this.objBCLoadCondiColl=[];this.DataTextField="";this.JOINDataField="";UCML.WebCodeInput.superclass.constructor.call(this,id)};UCML.extend(UCML.WebCodeInput,UCML.BCLinkBox,{ctype:"UCML.WebCodeInput",setAppletObject:function(val){UCML.WebCodeInput.superclass.setAppletObject.call(this,val);if(this.AppletObject){this.AppletObject.on("loaddata",function(){this.selectUpRow()})}},showPanel:function(){startBCLink(this);var opts=this;if(this.showWindow){this.showWindow.on("close",function(){opts.fireEvent("blur")})}},onRender:function(){var span=$('<span class="combo"></span>').insertAfter(this.el);var table=$('<table width="100%" style="width:100%; table-layout:fixed" border=0 cellSpacing=0 cellPadding=0><tr><td ></td><td  width="20"><span class="combo-arrow"></span></td><td class="BCLinkBox-text" width="30%"></td></tr></table>').appendTo(span);var input=this.el.appendTo(table.find("td")[0]);input.addClass("combo-text");var input2=$('<input id="'+this.id+'textvalue" ctype = "UCML.TextBox"  style="width:99%;height:100%;border-width:0px;border-style:none;" dataFld="'+this.JOINDataField+'" />').appendTo(table.find("td")[2]);input2.addClass("combo-textvalue");$('<input type="hidden" class="combo-value">').appendTo(span);var name=this.el.attr("name");if(name){span.find("input.combo-value").attr("name",name);this.el.removeAttr("name").attr("comboName",name)}input.attr("autocomplete","off");if(!this.editable){input.attr("readonly",this.editable)}if(!this.panel){var panel=new UCML.Panel({el:$("<div ></div>").appendTo("body"),doSize:true,closed:true,style:{position:"absolute"},width:this.panelWidth,height:this.panelHeight,isSetProperties:false,bodyCls:"combo-panel"});this.panel=panel;this.panel.el.bind("mousedown.combo",function(e){return false})}this.combo=span;UCML.on(this.el,"blur",function(){this.setValue(this.dom.value,false)},this)},setValue:function(value,trigger){if(trigger!==false){this.fireEvent("setValue",value)}this.value=value;this.setText(value);this.setValues([value]);this.setTextValue(value)},setValues:function(values){var oldValues=this.getValues();this.combo.find("input.combo-value").remove();var name=this.el.attr("comboName");for(var i=0;i<values.length;i++){var input=$('<input type="hidden" class="combo-value">').appendTo(this.combo);if(name)input.attr("name",name);input.val(values[i])}var tmp=[];for(var i=0;i<oldValues.length;i++){tmp[i]=oldValues[i]}var aa=[];for(var i=0;i<values.length;i++){for(var j=0;j<tmp.length;j++){if(values[i]==tmp[j]){aa.push(values[i]);tmp.splice(j,1);break}}}if(aa.length!=values.length||values.length!=oldValues.length){if(this.multiple){this.onChange.call(this,values,oldValues)}else{this.onChange.call(this,values[0],oldValues[0])}}},setTextValue:function(value){var txtvalue="";if(!this.AppletObject){txtvalue=this.dataTable.getFieldValue(this.getAttribute("JOINDataField"))}else{if(value==this.AppletObject.getRootTable().getFieldValue(this.getAttribute("DataValueField"))){txtvalue=this.AppletObject.getRootTable().getFieldValue(this.getAttribute("DataTextField"))}else{txtvalue=this.dataTable.getFieldValue(this.getAttribute("JOINDataField"));$("#"+this.id)[0].value=this.dataTable.getFieldValue(this.getAttribute("dataFld"))}}$("#"+this.id+"textvalue")[0].value=txtvalue},onQuickQuery:function(){this.queryValue=this.dom.value;this.queryValue=this.queryValue.replace("'","");if(this.queryOldValue!=this.queryValue){this.queryOldValue=this.queryValue;var s=this.dataValueField.split(";");var sqlcondi="";var TableName=this.AppletObject.getRootTable().TableName;for(var i=0;i<s.length;i++){if(sqlcondi!="")sqlcondi+=" OR ";sqlcondi+=TableName+"."+s[i]+" LIKE '%"+this.queryValue+"%' "}this.AppletObject.condiQuery("","","",sqlcondi,0)}},setRelaValue:function(){var s=this.dataValueField.split(";");this.dataTable.setActorData(this.AppletObject.getRootTable(),this.srcFieldName,this.destFieldName)},onFocus:function(){if(this.showWindow){if(this.showWindow.closed){this.showWindow.open()}}else{this.showPanel()}},onKeyDown:function(el,e){if(this.showWindow&&this.showWindow.closed){this.showWindow.open();return}var vcObj=UCML.get(this.AppletObject.BPOName);if(e.keyCode==38){vcObj.selectUpRow()}else if(e.keyCode==40){vcObj.selectNextRow()}else if(e.keyCode==13&&vcObj.activeRow){this.setRelaValue();this.showWindow.close()}else if(e.keyCode==27){this.showWindow.close()}return false},onKeyUp:function(el,e){if(e.keyCode==40||e.keyCode==38||e.keyCode==37||e.keyCode==39||e.keyCode==34||e.keyCode==33|e.keyCode==27||e.keyCode==16||e.keyCode==35||e.keyCode==36||e.keyCode==36||e.keyCode==20||e.keyCode==18||e.keyCode==145||e.keyCode==19||e.keyCode==144||e.keyCode==13||e.keyCode==9)return;if(e.keyCode==13){}else{this.onQuickQuery()}return false}});UCML.reg("UCML.WebCodeInput",UCML.WebCodeInput);UCML.BCLinkInputBox=function(id){this.queryFieldName="";this.quickQuery=false;this.dropDownMode=true;this.dropDownWidth;this.dropDownHeight;this.BCName;this.caption="请选择";this.BCRunMode=1;this.srcFieldName="";this.destFieldName="";this.condiFieldName="";this.constValue="";this.targetTable;this.urlFuncName="";UCML.BCLinkInputBox.superclass.constructor.call(this,id)};UCML.extend(UCML.BCLinkInputBox,UCML.BCLinkBox,{ctype:"UCML.BCLinkInputBox",onRender:function(){UCML.BCLinkInputBox.superclass.onRender.call(this)},setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}var input=this.combo.find(".combo-text");input.val(val)},init:function(){UCML.BCLinkInputBox.superclass.init.call(this)},onBlur:function(e){this.setValue(e.val())},bindEvents:function(){var opts=this;var input=this.combo.find(".combo-text");var arrow=this.combo.find(".combo-arrow");if(!this.disabled){arrow.bind("click.BCLink",function(){opts.arrowClick(this)}).bind("mouseenter.BCLink",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.BCLink",function(){$(this).removeClass("combo-arrow-hover")});UCML.on(input,"blur",this.onBlur,this)}else{this.combo.unbind(".BCLink");arrow.unbind(".BCLink")}}});UCML.reg("UCML.BCLinkInputBox",UCML.BCLinkInputBox);UCML.CheckBoxGroupBox=function(id){this.dataValueField;this.dataTextField;this.srcDataTable;this.codeTable;this.isCodeTable=false;this.Captions;this.Values;this.columns=1;UCML.CheckBoxGroupBox.superclass.constructor.call(this,id)};UCML.extend(UCML.CheckBoxGroupBox,UCML.Combo,{ctype:"UCML.CheckBoxGroupBox",autoEl:"input",panelWidth:180,panelHeight:"auto",setProperties:function(){UCML.CheckBoxGroupBox.superclass.setProperties.call(this);this.codeTable=this.getAttribute("codeTable")||this.codeTable;this.isCodeTable=(this.el.attr("isCodeTable")?this.getAttribute("isCodeTable")=="true":false)||this.isCodeTable;this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName"))||undefined;this.dataValueField=this.getAttribute("dataValueField")||this.dataValueField;this.dataTextField=this.getAttribute("dataTextField")||this.dataTextField;this.columns=this.getAttribute("repeatColumns")||this.columns;this.Values=this.getAttribute("Values")||this.Values;this.Captions=this.getAttribute("Captions")||this.Captions},onRender:function(){this.el.attr("readonly","true");UCML.CheckBoxGroupBox.superclass.onRender.call(this);UCML.un(this.el,"blur");if(!this.CheckBoxGroup){this.CheckBoxGroup=new UCML.CheckBoxGroup({columns:this.columns,isSetProperties:false,codeTable:this.codeTable,isCodeTable:this.isCodeTable,dataTable:this.dataTable,srcDataTable:this.srcDataTable,dataValueField:this.dataValueField,dataTextField:this.dataTextField,fieldName:this.fieldName,rendeTo:this.panel.body,Values:this.Values,Captions:this.Captions,BusinessObject:this.BusinessObject});this.CheckBoxGroup.on("valuechange",this.change,this)}UCML.on(this.el,"blur",function(){this.setValue(this.value,false)},this)},showPanel:function(){UCML.CheckBoxGroupBox.superclass.showPanel.call(this)},hidePanel:function(){UCML.CheckBoxGroupBox.superclass.hidePanel.call(this)},bindEvents:function(){UCML.CheckBoxGroupBox.superclass.bindEvents.call(this);this.CheckBoxGroup.on("databind",function(){},this)},change:function(val,text){this.value=val;this.text=text;this.setText(this.text);this.setValue(val)},setValue:function(value,trigger){if(trigger!==false){this.fireEvent("setValue",value)}this.value=value;if(this.CheckBoxGroup){this.CheckBoxGroup.setValue(this.value);this.setText(this.CheckBoxGroup.getText())}this.setValues([value])}});UCML.CheckBoxGroupBox.prototype.renderedValue=function(val){if(this.CheckBoxGroup&&!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.CheckBoxGroup.dataBind()}this.setValue(val);return this.getText()};UCML.CheckBoxGroupBox.prototype.bindCodeTable=function(){};UCML.reg("UCML.CheckBoxGroupBox",UCML.CheckBoxGroupBox);UCML.RadioGroupBox=function(id){this.dataValueField;this.dataTextField;this.srcDataTable;this.codeTable;this.isCodeTable=false;this.Values;this.Captions;this.columns=1;UCML.RadioGroupBox.superclass.constructor.call(this,id)};UCML.extend(UCML.RadioGroupBox,UCML.Combo,{ctype:"UCML.RadioGroupBox",autoEl:"input",panelWidth:180,panelHeight:"auto",setProperties:function(){UCML.Combo.superclass.setProperties.call(this);this.codeTable=this.getAttribute("codeTable")||this.codeTable;this.isCodeTable=(this.el.attr("isCodeTable")?this.getAttribute("isCodeTable")=="true":false)||this.isCodeTable;this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName"))||undefined;this.dataValueField=this.getAttribute("dataValueField")||this.dataValueField;this.dataTextField=this.getAttribute("dataTextField")||this.dataTextField;this.columns=this.getAttribute("columns")||this.columns;this.Values=this.getAttribute("Values")||this.Values;this.Captions=this.getAttribute("Captions")||this.Captions},onRender:function(){this.el.attr("readonly","true");UCML.RadioGroupBox.superclass.onRender.call(this);UCML.un(this.el,"blur");if(!this.RadioGroup){this.RadioGroup=new UCML.RadioGroup({columns:this.columns,isSetProperties:false,codeTable:this.codeTable,isCodeTable:this.isCodeTable,dataTable:this.dataTable,srcDataTable:this.srcDataTable,dataValueField:this.dataValueField,dataTextField:this.dataTextField,fieldName:this.fieldName,rendeTo:this.panel.body,Captions:this.Captions,Values:this.Values,BusinessObject:this.BusinessObject});this.RadioGroup.on("valuechange",this.change,this)}UCML.on(this.el,"blur",function(){this.setValue(this.value,false)},this)},bindEvents:function(){UCML.RadioGroupBox.superclass.bindEvents.call(this);this.RadioGroup.on("dataBind",function(){},this)},hidePanel:function(){UCML.RadioGroupBox.superclass.hidePanel.call(this)},change:function(val,text){this.value=val;this.text=text;this.setValue(this.value);this.setText(this.text)},setValue:function(value,trigger){if(trigger!==false){this.fireEvent("setValue",value)}this.value=value;if(this.RadioGroup){this.RadioGroup.setValue(this.value);this.setText(this.RadioGroup.getText())}this.setValues([value])}});UCML.RadioGroupBox.prototype.renderedValue=function(val){if(this.RadioGroup&&!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.dataValueField)&&!UCML.isEmpty(this.dataTextField)){this.RadioGroup.dataBind()}this.setValue(val);return this.getText()};UCML.RadioGroupBox.prototype.bindCodeTable=function(){};UCML.reg("UCML.RadioGroupBox",UCML.RadioGroupBox);UCML.MButton=function(id){UCML.MButton.superclass.constructor.call(this,id)};UCML.extend(UCML.MButton,UCML.Input,{ctype:"UCML.MButton"});UCML.reg("UCML.MButton",UCML.MButton);UCML.MSlider=function(id){UCML.MSlider.superclass.constructor.call(this,id)};UCML.extend(UCML.MSlider,UCML.Input,{ctype:"UCML.MSlider"});UCML.MSlider.prototype.init=function(){UCML.MSlider.superclass.init.call(this);this.on("blur",function(){this.setValue(this.dom.value)},this);this.on("slidestop",function(){this.setValue(this.dom.value)},this)};UCML.MSlider.prototype.setValue=function(val,trigger,isDy){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}if(this.tagName=="input"||this.tagName=="textarea"){this.el.val(val)}else{this.el.html(val)}if(isDy||this.isDy){var pSlider=this.el.parent(".ui-slider");this.isDy=true;var maxV=this.el.attr("max");var minV=this.el.attr("min");var per=val*100/(parseInt(maxV)-parseInt(minV));pSlider.find("div.ui-slider-bg").css("width",per+"%");pSlider.find("a.ui-slider-handle").attr("aria-valuenow",per).attr("aria-valuetext",per).attr("title",per).css("left",per+"%")}else{this.el.slider("refresh")}};UCML.reg("UCML.MSlider",UCML.MSlider);UCML.MToggle=function(id){this.ValueChecked="1";this.ValueUnchecked="0";UCML.MToggle.superclass.constructor.call(this,id)};UCML.extend(UCML.MToggle,UCML.InputList,{ctype:"UCML.MToggle",autoEl:"select",setProperties:function(){UCML.MToggle.superclass.setProperties.call(this);this.ValueChecked=this.el.attr("ValueChecked")||this.ValueChecked;this.ValueUnchecked=this.el.attr("ValueUnchecked")||this.ValueUnchecked},bindEvents:function(){UCML.MToggle.superclass.bindEvents.call(this);var opts=this;this.el.bind("change",function(){var value=opts.el.val();opts.setValue(value)})}});UCML.MToggle.prototype.setValue=function(val,trigger){var value=val||"";if(trigger!==false){this.fireEvent("setValue",value)}if(value==this.ValueChecked){this.el[0].selectedIndex=0}else if(value==this.ValueUnchecked){this.el[0].selectedIndex=1}else{this.el[0].selectedIndex=-1}this.value=value;this.el.slider("refresh")};UCML.reg("UCML.MToggle",UCML.MToggle);UCML.MCheckBoxGroup=function(id){this.dataRole="none";UCML.MCheckBoxGroup.superclass.constructor.call(this,id)};UCML.extend(UCML.MCheckBoxGroup,UCML.CheckBoxGroup,{ctype:"UCML.MCheckBoxGroup",setProperties:function(){UCML.MCheckBoxGroup.superclass.setProperties.call(this);this.columns=this.getAttribute("repeatColumns")||this.columns;this.dataRole=this.getAttribute("data-role")||this.dataRole}});UCML.MCheckBoxGroup.prototype.setValue=function(value,trigger){value=value||"";if(trigger!==false){this.fireEvent("setValue",value)}var opt=this;var spv=value.split(";");this.el.find(":checkbox").each(function(){this.checked=false;$(this).attr("checked",false);if(this.dataRole!="none")$(this).checkboxradio("refresh")});for(var i=0;i<spv.length;i++){this.el.find(":checkbox").each(function(){if(spv[i]==this.value){this.checked=true}$(this).attr("checked",this.checked);if(this.dataRole!="none")$(this).checkboxradio("refresh")})}this.value=value;this.text=this.getText()};UCML.MCheckBoxGroup.prototype.dataBind=function(){this.el.children("table").children("tbody").empty();var recordCount=this.srcDataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);this.add(this.srcDataTable.getFieldValue(this.dataTextField),this.srcDataTable.getFieldValue(this.dataValueField))}this.srcDataTable.SetIndexNoEvent(0);this.fireEvent("databind",this,this.input);if(this.dataRole!="none")this.el.trigger("create")};UCML.MCheckBoxGroup.prototype.bindCodeTable=function(){this.el.children("table").children("tbody").empty();var codeList=BusinessObject.GetCodeValue(this.codeTable);if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){this.add(codeList[i].caption,codeList[i].value)}}if(this.dataRole!="none")this.el.trigger("create")};UCML.MCheckBoxGroup.prototype.bindCustomData=function(texts,values){this.el.children("table").children("tbody").empty();var valueList=values.split(";");var textList=texts.split(";");if(valueList&&textList&&valueList.length>0){for(var i=0;i<valueList.length;i++){this.add(textList[i],valueList[i])}}if(this.dataRole!="none")this.el.trigger("create")};UCML.reg("UCML.MCheckBoxGroup",UCML.MCheckBoxGroup);UCML.MRadioGroup=function(id){this.dataRole="none";UCML.MRadioGroup.superclass.constructor.call(this,id)};UCML.extend(UCML.MRadioGroup,UCML.RadioGroup,{ctype:"UCML.MRadioGroup",setProperties:function(){UCML.MRadioGroup.superclass.setProperties.call(this);this.columns=this.getAttribute("columns")||this.columns;this.dataRole=this.getAttribute("data-role")||this.dataRole}});UCML.MRadioGroup.prototype.setValue=function(value,trigger){if(value==undefined){value=""}if(trigger!==false){this.fireEvent("setValue",value)}this.value=value;this.text="";var opt=this;this.el.find(":radio").each(function(){this.checked=false;$(this).attr("checked",false);if(this.dataRole!="none")$(this).checkboxradio("refresh")});this.el.find(":radio[value='"+value+"']").each(function(){this.checked=true;var el=$(this);opt.text=el.attr("text");el.attr("checked",this.checked);if(this.dataRole!="none")$(this).checkboxradio("refresh")})};UCML.MRadioGroup.prototype.dataBind=function(){this.el.children("table").children("tbody").empty();var recordCount=this.srcDataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);this.add(this.srcDataTable.getFieldValue(this.dataTextField),this.srcDataTable.getFieldValue(this.dataValueField))}this.srcDataTable.SetIndexNoEvent(0);if(this.dataRole!="none")this.el.trigger("create")};UCML.MRadioGroup.prototype.bindCodeTable=function(){this.el.children("table").children("tbody").empty();var codeList=BusinessObject.GetCodeValue(this.codeTable);if(codeList&&codeList.length>0){for(var i=0;i<codeList.length;i++){this.add(codeList[i].caption,codeList[i].value)}}if(this.dataRole!="none")this.el.trigger("create")};UCML.MRadioGroup.prototype.bindCustomData=function(texts,values){this.el.children("table").children("tbody").empty();var textList=texts.split(";");var valueList=values.split(";");if(textList&&valueList&&valueList.length>0){for(var i=0;i<valueList.length;i++){this.add(textList[i],valueList[i])}}if(this.dataRole!="none")this.el.trigger("create")};UCML.reg("UCML.MRadioGroup",UCML.MRadioGroup);UCML.MComboBox=function(id){this.dataRole="mSelect";UCML.MComboBox.superclass.constructor.call(this,id)};UCML.extend(UCML.MComboBox,UCML.DropDownList,{ctype:"UCML.MComboBox",setProperties:function(){UCML.MComboBox.superclass.setProperties.call(this);this.dataRole=this.el.attr("data-role")||this.dataRole}});UCML.MComboBox.prototype.setValue=function(value,trigger,isDy){this.value=value;this.text="";for(var i=0;i<this.dom.options.length;i++){if(this.value==this.dom.options[i].value){this.text=this.dom.options[i].text;var opt=this.dom.options[i];try{this.dom.options[i].selected=true}catch(ex){}}else{this.dom.options[i].selected=false}}if(this.JIONDataField){this.dataTable.setFieldValue(this.JIONDataField,this.text)}if(this.srcDataTable&&value!=""){this.srcDataTable.Locate(this.dataValueField,value)}if(trigger!==false){this.fireEvent("setValue",value)}if(this.dataRole!="none"){if(isDy||this.isDy){this.isDy=true;var pSelect=this.el.parent().parent(".ui-select");pSelect.find("span").text(this.text)}else{this.el.selectmenu("refresh")}}};UCML.reg("UCML.MComboBox",UCML.MComboBox);UCML.MDate=function(id){this.options={};UCML.MDate.superclass.constructor.call(this,id)};UCML.extend(UCML.MDate,UCML.Input,{ctype:"UCML.MDate",setProperties:function(){UCML.MDate.superclass.setProperties.call(this);this.options={preset:"date",theme:"jqm",display:"modal",mode:"mixed",dateFormat:"yy-mm-dd",setText:"确定",cancelText:"取消",dateOrder:"yymmdd",dayText:"日",monthText:"月",yearText:"年",hourText:"时",minuteText:"分",endYear:parseInt(this.el.attr("endYear"))||2020,startYear:parseInt(this.el.attr("startYear"))||2e3,onSelect:this.confirm}},setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.el.val(val)}});UCML.MDate.prototype.init=function(){UCML.MDate.superclass.init.call(this);this.el.mobiscroll().date(this.options)};UCML.MDate.prototype.confirm=function(value,inst){var opts=eval(this.id);opts.setValue(value)};UCML.reg("UCML.MDate",UCML.MDate);UCML.MDateTime=function(id){UCML.MDateTime.superclass.constructor.call(this,id)};UCML.extend(UCML.MDateTime,UCML.MDate,{ctype:"UCML.MDateTime",setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.el.val(val)}});UCML.MDateTime.prototype.init=function(){UCML.MDateTime.superclass.init.call(this);this.el.mobiscroll().datetime(this.options)};UCML.MDateTime.prototype.confirm=function(value,inst){var opts=eval(this.id);var apm=value.substr(value.length-2);var currSec=(new Date).getSeconds()+"";value=value.substr(0,value.length-3)+":"+currSec;if(apm=="PM"){var dt=value.split(" ");var time=dt[1].split(":");time[0]=parseInt(time[0])+12;dt[1]=time.join(":");value=dt.join(" ")}else{}opts.setValue(value)};UCML.reg("UCML.MDateTime",UCML.MDateTime);UCML.MTime=function(id){UCML.MTime.superclass.constructor.call(this,id)};UCML.extend(UCML.MTime,UCML.MDate,{ctype:"UCML.MTime",setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.el.val(val)}});UCML.MTime.prototype.init=function(){UCML.MTime.superclass.init.call(this);this.el.mobiscroll().time(this.options)};UCML.MTime.prototype.confirm=function(value,inst){var opts=eval(this.id);var apm=value.substr(value.length-2);var currSec=(new Date).getSeconds()+"";value=value.substr(0,value.length-3)+":"+currSec;if(apm=="PM"){var time=value.split(":");time[0]=parseInt(time[0])+12;value=time.join(":")}else{}opts.setValue(value)};UCML.reg("UCML.MTime",UCML.MTime);UCML.JQMDate=function(id){UCML.JQMDate.superclass.constructor.call(this,id)};UCML.extend(UCML.JQMDate,UCML.Input,{ctype:"UCML.JQMDate",hasDay:true,setProperties:function(){
UCML.JQMDate.superclass.setProperties.call(this);this.hasDay=this.el.attr("hasDay")?this.el.attr("hasDay")=="false":this.hasDay},setValue:function(val,trigger){this.value=val;if(!this.hasDay){val=val.substr(0,7)}if(trigger!==false){this.fireEvent("setValue",this.value)}this.el.val(val)},bindEvents:function(){UCML.JQMDate.superclass.bindEvents.call(this);var opts=this;this.el.bind("blur",function(e){var value=$(this).val();if(!opts.hasDay){value+="-01"}opts.setValue(value)})}});UCML.reg("UCML.JQMDate",UCML.JQMDate);UCML.JQMMonth=function(id){UCML.JQMMonth.superclass.constructor.call(this,id)};UCML.extend(UCML.JQMMonth,UCML.JQMDate,{ctype:"UCML.JQMMonth",hasDay:false,setValue:function(val,trigger){UCML.JQMMonth.superclass.setValue.call(this,val,trigger)},bindEvents:function(){UCML.JQMMonth.superclass.bindEvents.call(this)}});UCML.reg("UCML.JQMMonth",UCML.JQMMonth);UCML.JQMDateTime=function(id){UCML.JQMDateTime.superclass.constructor.call(this,id)};UCML.extend(UCML.JQMDateTime,UCML.Input,{ctype:"UCML.JQMDateTime",setValue:function(val,trigger){var jqmFormatDt=val.substr(0,val.lastIndexOf(":")).replace(" ","T");this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.el.val(jqmFormatDt)},bindEvents:function(){var opts=this;this.el.bind("blur",function(e){var value=$(this).val();value=value.replace("T"," ");if(value.length==16){var curr=new Date;value=value+":"+curr.getSeconds()}else if(value.length>=19){value=value.substr(0,19)}opts.setValue(value)})}});UCML.reg("UCML.JQMDateTime",UCML.JQMDateTime);UCML.JQMTime=function(id){UCML.JQMTime.superclass.constructor.call(this,id)};UCML.extend(UCML.JQMTime,UCML.Input,{ctype:"UCML.JQMTime",setValue:function(val,trigger){this.value=val;val=val.substr(0,5);if(trigger!==false){this.fireEvent("setValue",this.value)}this.el.val(val)},bindEvents:function(){var opts=this;this.el.bind("blur",function(e){var value=$(this).val();value+=":00";opts.setValue(value)})}});UCML.reg("UCML.JQMTime",UCML.JQMTime);UCML.JQMWeek=function(id){UCML.JQMWeek.superclass.constructor.call(this,id)};UCML.extend(UCML.JQMWeek,UCML.Input,{ctype:"UCML.JQMWeek",setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",this.value)}this.el.val(val)},bindEvents:function(){var opts=this;this.el.bind("blur",function(e){var value=$(this).val();opts.setValue(value)})}});UCML.reg("UCML.JQMWeek",UCML.JQMWeek);UCML.MSelectManBox=function(id){this.addEvents("manSelected");this.queryData=[];UCML.MSelectManBox.superclass.constructor.call(this,id)};UCML.extend(UCML.MSelectManBox,UCML.Input,{ctype:"UCML.MSelectManBox",autoEl:"div",readOnly:true,otype:"1",destFieldName:"",dataValueField:"",BCName:"",manType:"",setProperties:function(){UCML.MSelectManBox.superclass.setProperties.call(this);this.otype=this.getAttribute("otype")||this.otype;this.dataFld=this.getAttribute("dataFld")||this.dataFld;this.dataValueField=this.getAttribute("DataValueField")||this.dataValueField;if(!this.dataValueField){this.dataValueField=this.dataFld}this.BCName=this.getAttribute("BCName")||this.BCName;this.bc=BusinessObject.getDataTableByBCName(this.BCName);this.manType=this.getAttribute("manType")||"";this.arrowEl="<a class='arrowItem'><span class='mui-icon mui-icon-arrowthinright'></span></a>";this.addEl=$("<a class='addItem'><span class='mui-icon mui-icon-plusempty'></span></a>");this.manEl=this.el;if(this.tagName.toLowerCase()!="div"){this.manEl=$("<div></div>");this.el.after(this.manEl);this.el.hide()}},onRender:function(){UCML.MSelectManBox.superclass.onRender.call(this);if(this.applet){col=this.applet.getColumn(this.dataValueField);if(col&&!col.allowModify){this.disabled=true}}if(this.disabled){this.manEl.addClass("man-list")}else{this.manEl.append(this.addEl).addClass("man-list")}if(this.otype!="1"&&this.otype!="2"){this.manEl.addClass("fman-list")}},bindEvents:function(){UCML.MSelectManBox.superclass.bindEvents.call(this);var opts=this;this.manEl.on("click",".addItem",function(){var w=openSelectManForMobile(opts.otype,opts.BCName,opts.dataValueField,opts.dataFld)});this.manEl.on("click",".man-item",function(){if(opts.disabled){return}var oid=$(this).attr("data-id");var oids=opts.bc.getFieldValue(opts.dataValueField);var names=opts.bc.getFieldValue(opts.dataFld);var oidarr=oids.split(",");var namearr=names.split(",");var index=oidarr.indexOf(oid);oidarr.remove(oid);namearr.remove(namearr[index]);opts.bc.setFieldValue(opts.dataValueField,oidarr.join(","));opts.bc.setFieldValue(opts.dataFld,namearr.join(","));if(namearr.length==0)opts.setValue(namearr.join(","))})}});UCML.MSelectManBox.prototype.setValue=function(val){if(this.disabled){if(val!=""){var oids=this.bc.getFieldValue(this.dataValueField);var arr=val.split(",");var oidarr=oids.split(",");for(var i=0;i<arr.length;i++){this.manEl.append("<a data-id='"+oidarr[i]+"' class='man-item man-item-bg"+i+"'><span>"+arr[i]+"</span></a>");if(i<arr.length-1)this.manEl.append(this.arrowEl)}}}else{this.addEl.siblings().remove();if(val!=""){var oids=this.bc.getFieldValue(this.dataValueField);var arr=val.split(",");var oidarr=oids.split(",");for(var i=0;i<arr.length;i++){this.addEl.before("<a data-id='"+oidarr[i]+"' class='man-item man-item-bg"+i+"'><span>"+arr[i]+"</span></a>");this.addEl.before(this.arrowEl)}}}};UCML.MSelectManBox.prototype.setItems=function(val,text){this.addEl.siblings().remove();if(val!=""){var arr=text.split(",");var oidarr=val.split(",");for(var i=0;i<arr.length;i++){this.addEl.before("<a data-id='"+oidarr[i]+"' class='man-item man-item-bg"+i+"'><span>"+arr[i]+"</span></a>");this.addEl.before(this.arrowEl)}}};UCML.reg("UCML.MSelectManBox",UCML.MSelectManBox);UCML.MCount=function(id){this.minValue=1;this.maxValue=-1;this.increment=1;UCML.MCount.superclass.constructor.call(this,id)};UCML.extend(UCML.MCount,UCML.Input,{ctype:"UCML.MCount",setProperties:function(){UCML.MCount.superclass.setProperties.call(this);this.minValue=parseInt(this.getAttribute("minValue"))||this.minValue;this.maxValue=parseInt(this.getAttribute("maxValue"))||this.maxValue;this.increment=parseInt(this.getAttribute("increment"))||this.increment},onRender:function(){var outerEl=$('<div class="sn-count" style="display:inline-block"></div>');var minEl=$('<a href="javascript:void(0)" class="min" id="minCount"></a>');var input=$('<input class="input-count" value="1">');var addEl=$('<a href="javascript:void(0)" class="add" id="addCount"></a>');outerEl.append(minEl);outerEl.append(input);outerEl.append(addEl);this.el.append(outerEl);this.minEl=minEl;this.input=input;this.addEl=addEl},setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}this.input.val(val);if(val<=this.minValue){this.minEl.addClass("cover")}else{this.minEl.removeClass("cover")}if(this.maxValue!=-1&&val>=this.maxValue){this.addEl.addClass("cover")}else{this.addEl.removeClass("cover")}},bindEvents:function(){UCML.MCount.superclass.bindEvents.call(this);var opts=this;this.input.on("blur",function(){var el=$(this);opts.setValue(el.val())});this.minEl.on("click",function(ctx){var el=$(this);if(el.hasClass("cover")){return}var value=parseInt(opts.input.val());opts.setValue(value-opts.increment)});this.addEl.on("click",function(){var el=$(this);if(el.hasClass("cover")){return}var value=parseInt(opts.input.val());opts.setValue(value+opts.increment)})}});UCML.reg("UCML.MCount",UCML.MCount);UCML.MDatePick=function(id){this.calendarCls=["hdp__day available","selected","in","out"];this.calendarT1=["今天","明天","后天"];this.calendarT2=["开始","结束"];this.calendarT3=["点击选择开始时间","点击选择结束时间"];UCML.MDatePick.superclass.constructor.call(this,id)};UCML.extend(UCML.MDatePick,UCML.Input,{ctype:"UCML.MDatePick",onRender:function(){UCML.MDatePick.superclass.onRender.call(this);this.el.attr("readonly","readonly")},bindEvents:function(){UCML.MDatePick.superclass.bindEvents.call(this);var opts=this;this.el.on("click",function(){opts.showDatePicker()})},setProperties:function(){UCML.MDatePick.superclass.setProperties.call(this);this.startDateField=this.el.attr("startDateField");this.endDateField=this.el.attr("endDateField")},setValue:function(val,trigger){this.value=val;if(trigger!==false){this.fireEvent("setValue",val)}var dateArr=[];if(val!=""){dateArr=val.split(";")}if(dateArr.length==2){var startDate=new Date(Number(dateArr[0]));var endDate=new Date(Number(dateArr[1]));this.el.val(startDate.getMonth()+1+"月"+startDate.getDate()+"日"+"--"+(endDate.getMonth()+1)+"月"+endDate.getDate()+"日");this.dataTable.setFieldValue(this.startDateField,startDate.getFullYear()+"-"+(startDate.getMonth()+1)+"-"+startDate.getDate());this.dataTable.setFieldValue(this.endDateField,endDate.getFullYear()+"-"+(endDate.getMonth()+1)+"-"+endDate.getDate())}else{var startDate=this.dataTable.getFieldValue(this.startDateField);var endDate=this.dataTable.getFieldValue(this.endDateField);this.el.val((startDate!=""?startDate.substr(5,2)+"月"+startDate.substr(8)+"日":"-月-日")+"--"+(endDate!=""?endDate.substr(5,2)+"月"+endDate.substr(8)+"日":"-月-日"))}}});UCML.MDatePick.prototype.showDatePicker=function(){if($("#hotel-date-picker").length==0){var outer=$('<div id="hotel-date-picker" style="-webkit-transform-origin:0px 0px;opacity:1;-webkit-transform:scale(1,1);display:block"></div>');var backdrop=$('<div class="backdrop"></div>');var hdp=$('<div class="hdp" style="overflow:hidden"></div>');var hdp_header=$('<div class="hdp__header"><a class="hdp__cancel" href="javascript:">取消</a><span class="hdp__tip">'+this.calendarT3[0]+'</span><a class="hdp__ok" href="javascript:">完成</a></div>');var hdp_week=$('<ul class="hdp__week"><li class="hdp__weekend">日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li class="hdp__weekend">六</li></ul>');var hdp_calendar=$('<ul class="hdp__calendar" style="overflow:auto;"></ul>');hdp_calendar.html(this.getCalendar());hdp.append(hdp_header);hdp.append(hdp_week);hdp.append(hdp_calendar);outer.append(backdrop);outer.append(hdp);$("body").append(outer).addClass("show-hotel-date-picker");$("html").css({"font-size":"312.5%",overflow:"hidden"});var opts=this;hdp_header.find("a.hdp__cancel").click(function(e){$("#hotel-date-picker").hide();$("body").removeClass("show-hotel-date-picker");$("html").css({"font-size":"100%",overflow:"visible"})});hdp_header.find("a.hdp__ok").click(function(e){if(hdp_header.find("span.hdp__tip").text()!=opts.calendarT3[0]&&hdp_header.find("span.hdp__tip").text()!=opts.calendarT3[1]){var value=hdp_calendar.find("li.in").attr("dateTs")+";"+hdp_calendar.find("li.out").attr("dateTs");opts.setValue(value)}$("#hotel-date-picker").hide();$("body").removeClass("show-hotel-date-picker");$("html").css({"font-size":"100%",overflow:"visible"})});var lis=hdp_calendar.find("li.hdp__day");lis.on("click",function(e){var that=$(this);if(hdp_header.find("span.hdp__tip").text()!=opts.calendarT3[1]){hdp_calendar.find("li").attr("class",opts.calendarCls[0]);that.addClass(opts.calendarCls[1]);that.addClass(opts.calendarCls[2]);hdp_header.find("span.hdp__tip").text(opts.calendarT3[1])}else if(hdp_header.find("span.hdp__tip").text()==opts.calendarT3[1]){if(that.hasClass("in")){return}that.addClass(opts.calendarCls[1]);that.addClass(opts.calendarCls[3]);hdp_header.find("span.hdp__tip").text(opts.calendarT3[0]);var startIndex=lis.index(hdp_calendar.find("li.in"));var endIndex=lis.index(hdp_calendar.find("li.out"));if(startIndex<endIndex){for(var i=startIndex;i<endIndex;i++){lis.eq(i).addClass(opts.calendarCls[1])}}else{lis.eq(startIndex).removeClass(opts.calendarCls[2]);lis.eq(startIndex).addClass(opts.calendarCls[3]);lis.eq(endIndex).removeClass(opts.calendarCls[3]);lis.eq(endIndex).addClass(opts.calendarCls[2]);for(var i=endIndex;i<startIndex;i++){lis.eq(i).addClass(opts.calendarCls[1])}}var startDate=new Date(Number(hdp_calendar.find("li.in").attr("dateTs")));var endDate=new Date(Number(hdp_calendar.find("li.out").attr("dateTs")));hdp_header.find("span.hdp__tip").text(startDate.getMonth()+1+"月"+startDate.getDate()+"日--"+(endDate.getMonth()+1)+"月"+endDate.getDate()+"日")}})}else{$("#hotel-date-picker").show();$("body").addClass("show-hotel-date-picker");$("html").css({"font-size":"312.5%",overflow:"hidden"})}};UCML.MDatePick.prototype.getMaxDayCurMonth=function(year,month){if(month==12){return(new Date(year+1,1,1).getTime()-new Date(year,month,1).getTime())/864e5}else{return(new Date(year,month+1,1).getTime()-new Date(year,month,1).getTime())/864e5}};UCML.MDatePick.prototype.getCalendar=function(){var mydate=new Date;var curDay=mydate.getDay();var curDate=mydate.getDate();var curMonth=mydate.getMonth()+1;var curYear=mydate.getFullYear();var maxday=this.getMaxDayCurMonth(curYear,curMonth-1);var calendarStr="";if(curDay>0){calendarStr+='<li class="hdp__day--padding" style="width:'+curDay/7*100+'%"></li>'}for(var i=0;i<=maxday-curDate;i++){var dateTs=new Date(curYear,curMonth-1,curDate+i).getTime();calendarStr+='<li class="'+this.calendarCls[0]+'" dateTs="'+dateTs+'"><div>';calendarStr+="<span>"+(curDate==1&&i==0?curMonth+"月":curDate+i)+"</span>";calendarStr+='<span class="textTip label">'+(i<3?this.calendarT1[i]:"")+"</span>";calendarStr+='<span class="textTip in">'+this.calendarT2[0]+"</span>";calendarStr+='<span class="textTip out">'+this.calendarT2[1]+"</span>";calendarStr+="</div></li>"}var nextMonth=curMonth==12?1:curMonth+1;var maxday_next=curMonth==12?this.getMaxDayCurMonth(curYear+1,0):this.getMaxDayCurMonth(curYear,nextMonth-1);for(var i=1;i<=maxday_next;i++){var dateTs=new Date(curMonth==12?curYear+1:curYear,nextMonth-1,i).getTime();calendarStr+='<li class="'+this.calendarCls[0]+'" dateTs="'+dateTs+'"><div>';calendarStr+="<span>"+(i==1?nextMonth+"月":i)+"</span>";calendarStr+='<span class="textTip label"></span>';calendarStr+='<span class="textTip in">'+this.calendarT2[0]+"</span>";calendarStr+='<span class="textTip out">'+this.calendarT2[1]+"</span>";calendarStr+="</div></li>"}if(maxday_next+maxday-curDate<60){var nextnextMonth=nextMonth==12?1:nextMonth+1;for(var i=1;i<60-maxday_next-maxday+curDate;i++){var dateTs=new Date(nextnextMonth==12?curYear+1:curYear,nextnextMonth-1,i).getTime();calendarStr+='<li class="'+this.calendarCls[0]+'" dateTs="'+dateTs+'"><div>';calendarStr+="<span>"+(i==1?nextnextMonth+"月":i)+"</span>";calendarStr+='<span class="textTip label"></span>';calendarStr+='<span class="textTip in">'+this.calendarT2[0]+"</span>";calendarStr+='<span class="textTip out">'+this.calendarT2[1]+"</span>";calendarStr+="</div></li>"}}return calendarStr};UCML.reg("UCML.MDatePick",UCML.MDatePick);UCML.MInputBtn=function(id){UCML.MInputBtn.superclass.constructor.call(this,id)};UCML.BusinessComponent=function(){this.BusinessObject=null;this.TableName="";this.BCName="";this.TableType="M";this.LinkKeyName="";this.PK_COLUMN_NAME="";this.dateFormat="";this.recordIndex=-1;this.dataStore=null;this.ChangeOnlyOwnerBy=false;this.CodeTableXMLData=null;this.OIDSeed=1e4;this.SeedOffset=0;this.columns=null;this.MasterTable=null;this.theDetailTables=new Array;this.theBPOName=null;this.theDeltaData=null;this.theRecordOwnerType=0;this.theFieldList="";this.theValueList="";this.theCondiIndentList="";this.theDefaultFieldList="";this.theDefaultValueList="";this.theDefaultCondiIndentList="";this.theDefaultSQLCondi="";this.theDefaultSQLCondiType=0;this.nTotalRecordCount=0;this.StartPos=0;this.ReadCount=0;this.DefaultPageCount=10;this.EnabledEdit=true;this.EnabledAppend=true;this.EnabledDelete=true;this.PositionObject=new Array;this.sortSQL="";this.theinsertOtherDefaultValue=null;this.sender="";this.theLoadChildData=true;this.allChildIndex=null;this.theSQLCondi="";this.theSQLCondiType=0;this.enabledSort=true;this.PrimaryKey=null;this.ForeignKey=null;this.fCustomRela=false;this.thefCustomPrimaryKey=false;this.subBC_SQLCondi="";this.theUCMLlanguge=null;this.InnerRuleList=new Array;this.isLoadHistoryData=false;this.childDatas={};UCML.BusinessComponent.superclass.constructor.call(this);this.addEvents("onInit","onLoad","OnGetCodeValue","OnAfterInsert","OnRecordChange","BeforeFieldChange","OnFieldChange","OnCalculate","onAfterFieldChange","OnAfterDelete","OnBeforeDelete","OnValiate","beforeGetData","afterGetData","loadChildData")};UCML.extend(UCML.BusinessComponent,UCML.util.Observable,{setinsertOtherDefaultValue:function(value){this.theinsertOtherDefaultValue=value},getinsertOtherDefaultValue:function(){return this.theinsertOtherDefaultValue},loaded:undefined,isChangeData:true,open:function(){if(this.BusinessObject){window[this.BCName+"base"]=this;this.BusinessObject.AddUseTable(this);if(this.PrimaryKey==null){this.PrimaryKey=this.TableName+"OID"}if(this.MasterTable!=null){this.MasterTable.AddDetailTable(this)}this.fireEvent("onInit");this.on("OnAfterInsert",function(){this.claerChildData()},this)}},loadData:function(data){this.SetDataPacket(data);if(this.loaded==undefined){this.loaded=false}this.fireEvent("onLoad",data)},setChildData:function(BCName,val){var data=[];if(val){data=val.slice(0)}if(BCName){this.childDatas=this.childDatas||{};var MOID=this.OID_GUID();this.childDatas[MOID]=this.childDatas[MOID]||{};this.childDatas[MOID][BCName]=data}},removeChildData:function(BCName,OID){var data=this.getChildData(BCName);if(data){for(var i=0;i<data.length;i++){if(data[i][0]==OID){data.remove(data[i])}}}},getChildData:function(BCName){return this.getChildDataByOID(BCName)},getChildDataByOID:function(BCName,OID){if(BCName){this.childDatas=this.childDatas||{};var MOID=OID||this.OID_GUID();this.childDatas[MOID]=this.childDatas[MOID]||{};this.childDatas[MOID][BCName]=this.childDatas[MOID][BCName]||[];return this.childDatas[MOID][BCName]}return[]},isChildData:function(BCName){return this.isChildDataByOID(BCName)},isChildDataByOID:function(BCName,OID){if(!this.childDatas){return false}var MOID=OID||this.OID_GUID();if(!this.childDatas[MOID]){return false}if(BCName){return this.childDatas[MOID][BCName]?true:false}return true},getSequenceNo:function(){return GetSequenceNo(this.TableName)-9999},getOIDSeed:function(){var ar=BusinessData["OIDData"];for(var i=0;i<ar.length;i++){if(ar[i][0]==this.BCName){return ar[i][1]}}return 0},getSeedOffset:function(){var ar=BusinessData["OIDData"];for(var i=0;i<ar.length;i++){if(ar[i][0]==this.BCName){return ar[i][2]}}return-1},SetDataPacket:function(data){var seed=this.getOIDSeed();var offset=this.getSeedOffset();if(seed!=-1){this.OIDSeed=seed;this.SeedOffset=offset}this.nTotalRecordCount=RecordCountInfo[this.BCName].RecordCount;this.StartPos=RecordCountInfo[this.BCName].StartPos;this.ReadCount=RecordCountInfo[this.BCName].ReadCount;this.DefaultPageCount=RecordCountInfo[this.BCName].PageCount;var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}else{obj.key="0";obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}if(this.dataStore==null){this.dataStore=new UCML.Data.Table}this.dataStore.startPos=this.StartPos;this.dataStore.BCName=this.BCName;this.dataStore.tableName=this.TableName;if(this.isLoadHistoryData){this.dataStore.loadNoClear(data,this.getColumns())}else{this.dataStore.load(data,this.getColumns())}this.recordIndex=0;if(this.theDetailTables.length>0){if(this.isChildData()==false){for(var i=0;i<this.theDetailTables.length;i++){if(this.theDetailTables[i].loaded!==true){this.setChildData(this.theDetailTables[i].BCName,BusinessData[this.theDetailTables[i].BCName])}}}}},SetDataPacketAndChild:function(data,sender){this.loaded=false;sender||this;this.SetDataPacket(data);for(var i=0;i<this.theDetailTables.length;i++){this.theDetailTables[i].SetDataPacketAndChild(BusinessData[this.theDetailTables[i].BCName])}this.fireEvent("onLoad",data)},claerChildData:function(){if(this.theDetailTables.length>0){for(var i=0;i<this.theDetailTables.length;i++){this.setChildData(this.theDetailTables[i].BCName,[]);this.theDetailTables[i].SetDataPacketAndChild([]);this.theDetailTables[i].claerChildData()}}},loadChildData:function(){if(this.theLoadChildData==false||this.loaded==true){return}if(this.theDetailTables.length>0){var cur=this.getCurrentRecord();if(cur==null){this.claerChildData()}else{var flag=this.isChildData();if(!flag&&!this.IsInsert()){this.ShowMessage(UCML.Languge.BCfromSeivicesChild);this.BusinessObject.loadChildDataEx(this.BCName,this.getOID(),this.turnArrayDataToXml(cur),this.subBC_SQLCondi,this.LoadChildResults,this.OnFailureCall,this)}else{for(var i=0;i<this.theDetailTables.length;i++){var data=this.getChildData(this.theDetailTables[i].BCName);RecordCountInfo[this.theDetailTables[i].BCName].RecordCount=this.theDetailTables[i].getTotalRecordCount();RecordCountInfo[this.theDetailTables[i].BCName].StartPos=this.theDetailTables[i].getStartPos();RecordCountInfo[this.theDetailTables[i].BCName].ReadCount=this.theDetailTables[i].getReadCount();BusinessData[this.theDetailTables[i].BCName]=data;this.setChildData(this.theDetailTables[i].BCName,BusinessData[this.theDetailTables[i].BCName]);this.theDetailTables[i].SetDataPacketAndChild(data);this.theDetailTables[i].loadChildData()}}}}},getTotalRecordCount:function(){if(this.MasterTable==null){return this.nTotalRecordCount}else{for(var i=0;this.PositionObject.length;i++){var obj=this.PositionObject[i];if(obj==undefined||obj==null){var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=0;obj.nTotalRecordCount=1;obj.ReadCount=0;this.AddPosition(obj);this.nTotalRecordCount=0;this.StartPos=0;this.ReadCount=0}return this.nTotalRecordCount}if(obj.key=="0"){return this.nTotalRecordCount}if(obj.key==this.MasterTable.getOID()){return obj.nTotalRecordCount}}}return this.nTotalRecordCount},getStartPos:function(){if(this.MasterTable==null){return this.StartPos}else{for(var i=0;this.PositionObject.length;i++){var obj=this.PositionObject[i];if(obj==undefined||obj==null){var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=0;obj.nTotalRecordCount=1;obj.ReadCount=0;this.AddPosition(obj);this.nTotalRecordCount=0;this.StartPos=0;this.ReadCount=0}return this.StartPos}if(obj.key=="0")return this.StartPos;if(obj.key==this.MasterTable.getOID()){return obj.StartPos}}}return this.StartPos},getReadCount:function(){if(this.MasterTable==null){return this.ReadCount}else{for(var i=0;this.PositionObject.length;i++){var obj=this.PositionObject[i];if(obj==undefined||obj==null){var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=0;obj.nTotalRecordCount=1;obj.ReadCount=0;this.AddPosition(obj);this.nTotalRecordCount=0;this.StartPos=0;this.ReadCount=0}return this.ReadCount}if(obj.key=="0")return this.ReadCount;if(obj.key==this.MasterTable.getOID()){return obj.ReadCount}}}return this.ReadCount},getAppletList:function(){return this.theConnectControls},getDefaultPageCount:function(){return this.DefaultPageCount},setDefaultPageCount:function(value){this.DefaultPageCount=value},getMasterTable:function(){return this.MasterTable},setMasterTable:function(value){this.MasterTable=value},setDeltaData:function(value){this.theDeltaData=value},setColumns:function(value){this.columns=value},getColumns:function(){return this.columns},getColumn:function(name){return this.getColumnByName(name)},getColumnByName:function(name){if(this.columns&&name){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==name){return this.columns[i]}}}return false},getLocalDataPacket:function(){return this.dataStore.xmldoc},getCurrentData:function(){var aryT=[];for(var i=0;i<this.columns.length;i++){var columnName=this.columns[i].fieldName;var strF=this.getFieldValue(columnName);aryT[columnName]=strF}return aryT},getCurrentRecord:function(){try{if(this.dataStore!=null){if(this.recordIndex>=this.dataStore.getLength()){return null}if(this.dataStore.getLength()==0){return null}if(this.recordIndex<0){return null}return this.dataStore.getRecordData(this.recordIndex)}return null}catch(e){alert("getCurrentRecord:"+e.description)}return null},getRecordCount:function(){return this.dataStore.getLength()},addRecord:function(recData){recData=recData||[];recData[0]=recData[0]||this.TimeToGuid();for(var i=0;i<this.columns.length;i++){if(typeof recData[i]=="number"){recData[i]=recData[i]+""}else{recData[i]=recData[i]||""}}this.dataStore.addRecord(recData);var evObj=this.createEventObject();this.nTotalRecordCount=this.getRecordCount()},find:function(fieldName,value){if(this.dataStore==null){return false}var index=this.dataStore.findByName(fieldName,value);if(index==-1){return false}else{return true}},Locate:function(fieldName,value,sender){if(this.dataStore==null){return false}var index=this.dataStore.findByName(fieldName,value);if(index==-1){return false}else{this.setRecordIndex(index,sender);return true}},GetOIDIndex:function(OID){if(this.dataStore==null){return-1}if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return this.dataStore.findLocateOID("",OID)}else{return this.dataStore.findLocateOID(this.PrimaryKey,OID)}},GetIsOIDKey:function(){if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return true}else{return false}},GetGuidBy_Index:function(OID){if(this.GetIsOIDKey()){return this.GetOIDIndex(OID)}else{return this.dataStore.findLocateOID("",OID)}},GetOIDBy_GUID:function(OID){var rowIndex=-1;if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return OID}else{rowIndex=this.dataStore.findLocateOID("",OID)}if(rowIndex==-1){return this.getEmptyGuid()}else{return this.dataStore.getOID(rowIndex,this.PrimaryKey)}},GetGUIDBy_OID:function(OID){var rowIndex=-1;if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return OID}else{rowIndex=this.dataStore.findLocateOID(this.PrimaryKey,OID)}if(rowIndex==-1){return this.getEmptyGuid()}else{return this.dataStore.getRecordData(rowIndex)[0]}},LocateOID_GUID:function(OID){if(this.dataStore==null){return null}var rowIndex=this.dataStore.findLocateOID("",OID);if(rowIndex==-1){this.setRecordIndex(-1);return null}else{this.setRecordIndex(rowIndex);return this.dataStore.getRecordData(rowIndex)}},LocateOID:function(OID,sender){if(this.dataStore==null){return null}var rowIndex=-1;if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){rowIndex=this.dataStore.findLocateOID("",OID)}else{rowIndex=this.dataStore.findLocateOID(this.PrimaryKey,OID)}if(rowIndex==-1){this.setRecordIndex(-1);return null}else{this.setRecordIndex(rowIndex,sender);return this.dataStore.getRecordData(rowIndex)}}});UCML.BusinessComponent.prototype.LookupOID=function(OID){try{var rowIndex=-1;if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){rowIndex=this.dataStore.findLocateOID("",OID)}else{rowIndex=this.dataStore.findLocateOID(this.PrimaryKey,OID)}if(rowIndex==-1){return false}else{return true}}catch(e){alert("LookupOID:"+e.description)}};UCML.BusinessComponent.prototype.Lookup=function(OID,fieldName){try{if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return this.dataStore.LookupByName("",OID,fieldName)}else{return this.dataStore.LookupByName(this.PrimaryKey,OID,fieldName)}}catch(e){alert("Lookup:"+e.description)}};UCML.BusinessComponent.prototype.addActorData=function(actorTable){if(this.EnabledAppend==false){return}if(this.EnabledEdit==false){return}var xmldoc=this.dataStore.xmldoc;if(xmldoc==null){return}this.Insert();this.setFieldValue(actorTable.TableName+"OID",actorTable.getOID());for(var i=0;i<this.columns.length;i++){if(this.columns[i].lookupDataSet!=""){this.setFieldValue(this.columns[i].fieldName,actorTable.getFieldValue(this.columns[i].fieldName))}}};UCML.BusinessComponent.prototype.getEmptyGuid=function(){return"00000000-0000-0000-0000-000000000000"};UCML.BusinessComponent.prototype.setActorData=function(actorTable,srcFieldName,destFieldName){if(this.EnabledEdit==false){return}var srcArray=srcFieldName.split(";");var destArray=destFieldName.split(";");if(srcArray.length==0){return}for(var i=0;i<srcArray.length;i++){var index=this.recordIndex;this.setFieldValue(destArray[i],actorTable.getFieldValue(srcArray[i]));this.recordIndex=index}for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldKind==2&&this.columns[i].lookupDataSet==actorTable.TableName&&this.columns[i].foreignKeyField==destArray[0]){var index=this.recordIndex;this.setFieldValue(this.columns[i].fieldName,actorTable.getFieldValue(this.columns[i].lookupResultField));this.recordIndex=index}}var evObj=this.createEventObject();evObj.destFieldName=destFieldName;evObj.srcFieldName=srcFieldName;this.fireEvent("OnActorFieldChange",evObj)};UCML.BusinessComponent.prototype.createEventObject=function(){return new Object};UCML.BusinessComponent.prototype.setBPOName=function(value){this.theBPOName=value};UCML.BusinessComponent.prototype.getBPOName=function(){return this.theBPOName};UCML.BusinessComponent.prototype.LoadResults=function(data){if(data){if(this.MasterTable){this.MasterTable.setChildData(this.BCName,data)}this.SetDataPacketAndChild(data)}};UCML.BusinessComponent.prototype.onAfterGetData=function(result,text){this.HideMessage();if(text!=undefined){if(text!=null){eval(text)}}this.LoadResults(BusinessData[this.BCName]);this.fireEvent("afterGetData");return};UCML.BusinessComponent.prototype.AddPosition=function(PObject){for(var i=0;i<this.PositionObject.length;i++){var obj=this.PositionObject[i];if(obj.key==PObject.key){this.PositionObject[i]=PObject;return}}this.PositionObject[this.PositionObject.length]=PObject};UCML.BusinessComponent.prototype.ClearData=function(){if(this.dataStore!=null){BusinessData[this.BCName]=null;this.dataStore.clearData()}};UCML.BusinessComponent.prototype.getUserOID=function(){return UCML.UserInfo.getUserOID()};UCML.BusinessComponent.prototype.getPostnName=function(){return UCML.UserInfo.getPostnName()};UCML.BusinessComponent.prototype.getUserName=function(){return UCML.UserInfo.getUserId()};UCML.BusinessComponent.prototype.getDivisionOID=function(){return UCML.UserInfo.getDivisionOID()};UCML.BusinessComponent.prototype.getOrgOID=function(){return UCML.UserInfo.getOrgOID()};UCML.BusinessComponent.prototype.getPostPrimaryOID=function(){return UCML.UserInfo.getPostPrimaryOID()};UCML.BusinessComponent.prototype.getMasterPostOID=function(){return UCML.UserInfo.getMasterPostOID()};UCML.BusinessComponent.prototype.getPersonName=function(){return UCML.UserInfo.getPersonName()};UCML.BusinessComponent.prototype.getDepartName=function(){return UCML.UserInfo.getDivisionName()};UCML.BusinessComponent.prototype.getDivisionName=function(){return UCML.UserInfo.getDivisionName()};UCML.BusinessComponent.prototype.getOrgName=function(){return UCML.UserInfo.getOrgName()};UCML.BusinessComponent.prototype.getLoginTime=function(){return UCML.UserInfo.getLoginTime()};UCML.BusinessComponent.prototype.getLoginState=function(){return UCML.UserInfo.getLoginState()};UCML.BusinessComponent.prototype.getUserID=function(){return UCML.UserInfo.getUserId()};UCML.BusinessComponent.prototype.getSSID=function(){return UCML.UserInfo.getSSID()};UCML.BusinessComponent.prototype.getfMutiLangugeSupport=function(){var thefMutiLanguge="false";if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){if(BusinessData.UCMLUserSystemInfo.length==0)return null;thefMutiLanguge=BusinessData.UCMLUserSystemInfo[0][20]}return thefMutiLanguge};UCML.BusinessComponent.prototype.getPersonOID=function(){return UCML.UserInfo.getPersonOID()};UCML.BusinessComponent.prototype.getRESPOID=function(){return UCML.UserInfo.getRESPOID()};UCML.BusinessComponent.prototype.TimeToGuid=function(){var val0;var val1;var i;hexascii="0123456789ABCDEF";var cArr=new Array("","","","","","","-","","-","","-","","-","","","");mystr="";var valArr=new Array(4);var mydate=new Date;value1=mydate.getTime();sec=mydate.getSeconds();min=mydate.getMinutes();hou=mydate.getHours();ran=Math.random()*10;valArr[0]=value1;
valArr[1]=0;valArr[2]=this.SeedOffset;this.SeedOffset++;valArr[3]=this.OIDSeed;for(i=0;i<32;i++){val0=Math.floor(valArr[Math.floor(i/8)]/16);val1=valArr[Math.floor(i/8)]-val0*16;c=hexascii.charAt(val1);if(i%2==0)mystr=cArr[i/2]+mystr;mystr=c+mystr;valArr[Math.floor(i/8)]=val0}return mystr.toLowerCase()};UCML.BusinessComponent.prototype.getColumnIndex=function(fieldName){return this.dataStore.columnIndex(fieldName)};UCML.BusinessComponent.prototype.sort=function(fieldName,sortMode){if(this.enabledSort==false)return;var bcColumn=this.getColumn(fieldName);if(!bcColumn){return}var index=this.columns.indexOf(bcColumn);var fieldKind=bcColumn.fieldKind;var fieldType=bcColumn.fieldType;if(fieldType=="Text"||fieldType=="Blob"||fieldType=="Image"){return}if(this.ChangeCount()){if(!window.confirm("当前业务存在变化数据,是否继续排序?")){return}}if(fieldKind==0){var sortFieldName=this.TableName+"."+fieldName+"";this.RefreshSort(sortFieldName,sortMode)}else if(fieldKind==2){var sortFieldName="al"+bcColumn.foreignKeyField+"."+bcColumn.lookupResultField+"";this.RefreshSort(sortFieldName,sortMode)}else if(fieldKind==10){var sortFieldName="al"+bcColumn.foreignKeyField+"."+fieldName+"";this.RefreshSort(sortFieldName,sortMode)}else if(fieldKind==5&&bcColumn.QueryRefColumn){this.RefreshSort(bcColumn.QueryRefColumn,sortMode)}else if(fieldKind==3){this.dataStore.sort(index,sortMode==1?"desc":"asc");this.fireEvent("onLoad")}else{this.dataStore.sort(index,sortMode==1?"desc":"asc");this.fireEvent("onLoad")}};UCML.BusinessComponent.prototype.CopyRecord=function(){if(this.dataStore==null){return}var newOID=null;var currec=this.getCurrentRecord();var newrec;if(currec==null){this.Insert();return}this.fireEvent("OnBeforeInsert");newOID=this.TimeToGuid();if(newOID!=null){newrec=this.dataStore.Insert(newOID);var cols=this.getColumns();for(var i=1;i<cols.length;i++){newrec[i]=currec[i]}}this.dataStore.DeltaInsert(newrec);this.recordIndex=parseInt(this.getRecordCount())-1;this.dataStore.setRecordIndex(this.recordIndex);this.nTotalRecordCount++;var evObj=this.createEventObject();this.fireEvent("OnAfterInsert",evObj);var evObj=this.createEventObject();this.fireEvent("OnRecordChange",evObj);return newrec};UCML.BusinessComponent.prototype.Insert=function(mode){if(this.dataStore==null){return}if(this.EnabledAppend==false){return null}if(this.EnabledEdit==false){return null}if(this.TableType=="S"){if(this.MasterTable.recordCount==0){alert(UCML.Languge.BCnotMasterTable);return null}}this.fireEvent("OnBeforeInsert");var OID=this.TimeToGuid();var rec=this.dataStore.Insert(OID);for(var i=1;i<this.columns.length;i++){var colIndex=i;var objColumn=this.columns[i];if(this.columns[i].defaultValue!=null){rec[colIndex]=this.columns[i].defaultValue}if(objColumn.isFunctionInitValue==true&&objColumn.initValueFunc!=""){rec[colIndex]=eval(objColumn.initValueFunc+"()")}if(this.MasterTable!=null&&this.TableType=="S"){if(this.columns[i].isForeignKey==true&&this.columns[i].lookupDataSet==this.MasterTable.TableName){rec[colIndex]=this.MasterTable.getOID()}if(this.columns[i].fieldName==this.LinkKeyName){rec[colIndex]=this.MasterTable.getFieldValue(this.PK_COLUMN_NAME)}if(this.getCustomRela()){for(var m=0;m<this.ForeignKey.ChildColumns.length;m++){if(this.columns[i].fieldName==this.ForeignKey.ChildColumns[m]){rec[colIndex]=this.MasterTable.getFieldValue(this.ForeignKey.ParentColumns[m]);break}}}if(this.columns[i].isForeignKey==false&&this.columns[i].lookupDataSet==this.MasterTable.TableName){if(this.columns[i].isCodeTable==false){rec[colIndex]=this.MasterTable.getFieldValue(this.columns[i].lookupResultField)}else{}}}if(this.columns[i].fieldName=="SYS_Created"){rec[colIndex]=this.today("y-m-d h:mi:s")}else if(this.columns[i].fieldName=="SYS_CreatedBy"){rec[colIndex]=UCML.UserInfo.getUserOID()}else if(this.columns[i].fieldName=="SYS_POSTN"){rec[colIndex]=UCML.UserInfo.getMasterPostOID()}else if(this.columns[i].fieldName=="SYS_DIVISION"){rec[colIndex]=UCML.UserInfo.getDivisionOID()}else if(this.columns[i].fieldName=="SYS_ORG"){rec[colIndex]=UCML.UserInfo.getOrgOID()}else if(this.columns[i].fieldName=="SYS_LAST_UPD"){rec[colIndex]=this.today("y-m-dTh:mi:s")}else if(this.columns[i].fieldName=="SYS_LAST_UPD_BY"){rec[colIndex]=UCML.UserInfo.getUserOID()}if(this.theinsertOtherDefaultValue!=null){if(this.theinsertOtherDefaultValue[columns[i].fieldName]!=null){rec[colIndex]=this.theinsertOtherDefaultValue[columns[i].fieldName]}}}this.dataStore.DeltaInsert(rec);this.recordIndex=parseInt(this.getRecordCount())-1;this.dataStore.setRecordIndex(this.recordIndex);this.nTotalRecordCount++;var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}else{obj.key="0";obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}var evObj=this.createEventObject();this.fireEvent("OnAfterInsert",evObj);var evObj=this.createEventObject();this.fireEvent("OnRecordChange",evObj);return rec};UCML.BusinessComponent.prototype.Delete=function(mode){if(this.dataStore==null){return}if(this.EnabledDelete==false)return;var row=this.getCurrentRecord();if(mode){row=this.LocateOID(mode)}if(row==null){return}if(this.IsRecordOwner()==false){alert(UCML.Languge.BCnotRightEdit);return}var DeleteOID=row[0];this.fireEvent("OnBeforeDelete",DeleteOID);this.dataStore.Delete(DeleteOID);this.recordIndex--;this.nTotalRecordCount--;if(this.recordIndex<=0)this.recordIndex=0;if(this.getRecordCount()==0)this.recordIndex=-1;this.dataStore.setRecordIndex(this.recordIndex);var obj=new Object;if(this.MasterTable!=null){obj.key=this.MasterTable.getOID();obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}else{obj.key="0";obj.StartPos=this.StartPos;obj.nTotalRecordCount=this.nTotalRecordCount;obj.ReadCount=this.ReadCount;this.AddPosition(obj)}this.fireEvent("OnAfterDelete",DeleteOID);this.NotifyDetailTable("D");var evObj=this.createEventObject();this.NotifyDetailTable("R");this.fireEvent("OnRecordChange",evObj)};UCML.BusinessComponent.prototype.IsInsert=function(){if(this.dataStore==null){return}var id=this.OID_GUID();return this.dataStore.IsInsert(id)};UCML.BusinessComponent.prototype.ChangeCountBC=function(){return this.ChangeCount()};UCML.BusinessComponent.prototype.MergeChange=function(){if(this.dataStore==null){return}this.dataStore.clearChangData()};UCML.BusinessComponent.prototype.getInnerPacket=function(){return this.dataStore};UCML.BusinessComponent.prototype.ChangeCount=function(){if(this.dataStore.getChangeCount()>0){return true}else{return false}};UCML.BusinessComponent.prototype.RejectChanges=function(){this.RejectChangesInner();this.fireEvent("onLoad")};UCML.BusinessComponent.prototype.RejectChangesInner=function(){var srcNode=null;var changeNode=null;var changeData=this.dataStore.changeData;var bcData=this.dataStore.bcData;if(changeData){for(var i=0;i<changeData.getCount();i++){var item=changeData.getItemAt(i);var state=item[item.length-1];if(state!="null"){srcNode=item;if(state=="ukModify"){bcData.replace(srcNode[0],srcNode)}if(state=="ukInsert"){this.Delete(srcNode[0])}if(state=="ukDelete"){this.addRecord(srcNode)}}}}changeData.clear()};UCML.BusinessComponent.prototype.showValiateMsg=function(msg){alert(msg)};UCML.BusinessComponent.prototype.Valiate=function(){var fieldType=null;var columnInfo=null;var index;var oldIndex=this.getRecordIndex();for(var j=0;j<this.getRecordCount();j++){this.SetIndexNoEvent(j);for(var i=0;i<this.columns.length;i++){columnInfo=this.columns[i];var value=this.getFieldValue(columnInfo.fieldName);if(this.ValiateOneCol(columnInfo,value)==false)return false}}this.SetIndexNoEvent(oldIndex);var changeData=this.dataStore.changeData;if(changeData){for(var j=0;j<changeData.getCount();j++){var item=changeData.getItemAt(j);var state=item[item.length-1];if(state=="ukModify"){j++;item=changeData.getItemAt(j);for(var i=0;i<this.columns.length;i++){columnInfo=this.columns[i];var value=item[i];if(value=="null")continue;if(this.ValiateOneCol(columnInfo,value)==false)return false}}if(state=="ukInsert"){var item=changeData.getItemAt(j);var state=item[item.length-1];item=changeData.getItemAt(j);for(var i=0;i<this.columns.length;i++){columnInfo=this.columns[i];var value=item[i];if(value=="null")value="";if(this.ValiateOneCol(columnInfo,value)==false)return false}}}}return true};UCML.BusinessComponent.prototype.ValiateOneCol=function(columnInfo,value){if(columnInfo.allowNull==false){if(this.isEmpty(value)){error=UCML.Languge.BCfieldLanguge+" "+columnInfo.caption+" "+UCML.Languge.BCnotForNull;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}else if(this.isWhitespace(value)){error=UCML.Languge.BCfieldLanguge+" "+columnInfo.caption+" "+UCML.Languge.BCincludeLegality;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}if(value!=null&&value.length!=0){if(columnInfo.fieldType=="Short"||columnInfo.fieldType=="Int"||columnInfo.fieldType=="Long"||columnInfo.fieldType=="Byte"){if(/^-?\d+$/.test(value)==false){error=columnInfo.caption+UCML.Languge.BCneedNumber;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}if((columnInfo.fieldType=="VarChar"||columnInfo.fieldType=="Char"||columnInfo.fieldType=="NVarChar")&&columnInfo.fieldKind!=3){if((value+"").replace(/[\u0391-\uFFE5]/g,"aa").length>columnInfo.length){error=columnInfo.caption+UCML.Languge.BCOutOfLength+columnInfo.length+"!";if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}if(columnInfo.fieldType=="Float"||columnInfo.fieldType=="Double"||columnInfo.fieldType=="Money"||columnInfo.fieldType=="Numeric")if(isNaN(value)){error=columnInfo.caption+UCML.Languge.BCneedNumberDecimal;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}var objColumn=columnInfo;if(typeof ACColumnInputRule!="undefined"){for(var m=0;m<ACColumnInputRule.length;m++){if(columnInfo.fieldName==ACColumnInputRule[m].FieldName&&this.BCName==ACColumnInputRule[m].BCName){var inputParams=new Array;inputParams[inputParams.length]=value;if(ACColumnInputRule[m].ExParam1!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam2!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam3!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam4!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var result=ExecuteRule(ACColumnInputRule[m].RuleMethod,inputParams);if(result.ReturnCode!="OK"){var error=result.ReturnDescText;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}}}if(columnInfo.allowNull==true&&!UCML.isEmpty(value)&&(objColumn.RuleList!=null&&objColumn.RuleList.length>0)){for(var m=0;m<objColumn.RuleList.length;m++){var inputParams=new Array;inputParams[inputParams.length]=value;if(objColumn.RuleList[m].ExParam1!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[m].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[m].ExParam2!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[m].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[m].ExParam3!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[m].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[m].ExParam4!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[m].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var result=ExecuteRule(objColumn.RuleList[m].RuleMethod,inputParams);if(result.ReturnCode!="OK"){var error=result.ReturnDescText;if(this.fireEvent("OnValiate",{OID:this.OID_GUID(),msg:error,caption:columnInfo.caption,value:value,fieldName:columnInfo.fieldName,columnInfo:columnInfo})!==false){this.showValiateMsg(error)}return false}}}return true};UCML.BusinessComponent.prototype.isEmpty=function(s){var bol=false;if(s==null||s.length==0){bol=true}return bol};UCML.BusinessComponent.prototype.columnIsNumber=function(val){var col;if(UCML.isObject(val)){col=val}else{col=this.getColumn(val)}if(col&&(col.fieldType=="Short"||col.fieldType=="Int"||col.fieldType=="Long"||col.fieldType=="Byte"||col.fieldType=="Float"||col.fieldType=="Double"||col.fieldType=="Money"||col.fieldType=="Numeric")){return true}else{return false}};UCML.BusinessComponent.prototype.isWhitespace=function(s){var i;s=s+"";var whitespace=" \t\n\r";if(this.isEmpty(s)){return true}for(i=0;i<s.length;i++){var c=s.charAt(i);if(whitespace.indexOf(c)==-1){return false}}return true};UCML.BusinessComponent.prototype.UseRule=function(fieldName,RuleID){for(var i=0;this.InnerRuleList.length;i++){var obj=this.InnerRuleList[i];if(obj.RuleID==RuleID){return}}var obj=new Object;obj.fieldName=fieldName;obj.RuleID=RuleID;this.InnerRuleList[this.InnerRuleList.length]=obj};UCML.BusinessComponent.prototype.setFieldValue=function(fieldName,value,sender){if(this.EnabledEdit==false){return}var columnInfo=null;var index;if(this.IsRecordOwner()==false){alert(UCML.Languge.BCnotRightEdit);return}var columnInfo=null;index=this.dataStore.columnIndex(fieldName);columnInfo=this.columns[index];if(index==null){return}var oldvalue=this.getFieldValue(fieldName);var evObj=this.createEventObject();evObj.result=true;evObj.fieldName=fieldName;evObj.value=value;evObj.oldvalue=oldvalue;if(this.fireEvent("BeforeFieldChange",evObj)===false){return}this.sender=sender;var fieldType=columnInfo.fieldType;if(columnInfo.fieldType=="Boolean"){if(value==true){value="true"}if(value==false){value="false"}}else if(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Int"||fieldType=="Byte"||fieldType=="Short"){if(columnInfo.isCodeTable!=true){if(value!="null"){if(value!=null&&value!=""&&(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Short")){value=parseFloat(value);if(columnInfo.decLength!=0){value=this.DotRound(value,columnInfo.decLength)}}}}}else if(columnInfo.fieldType=="DateTime"||columnInfo.fieldType=="Date"){var valueTemp=value;if(columnInfo.dateTimeFormat){value=this.dateFilterValue(value,columnInfo.dateTimeFormat)}valueTemp=this.dateFilterValue(valueTemp,"y-m-d");if(valueTemp=="1900-01-01"||valueTemp=="1900-1-1"||valueTemp=="1899-12-31"){value=""}}var record=this.getCurrentRecord();if(record==null&&this.getRecordCount()==0){this.Insert();record=this.getCurrentRecord()}if(value==null){value=""}if(record!=null){if(record[index]+""==value){return}this.dataStore.setFieldValueByIndexID(this.recordIndex,index,value);var evObj=this.createEventObject();evObj.TableName=this.TableName;evObj.fieldName=fieldName;evObj.value=value;evObj.newvalue=value;evObj.oldvalue=oldvalue;evObj.dataTable=this;evObj.OID=record[0];this.fireEvent("OnFieldChange",evObj,sender);var evObj=this.createEventObject();evObj.fieldName=fieldName;this.fireEvent("OnCalculate",evObj);var evObj=this.createEventObject();evObj.fieldName=fieldName;evObj.value=value;this.fireEvent("onAfterFieldChange",evObj)}};UCML.BusinessComponent.prototype.setAllFieldValue=function(fieldName,value,sender){var sRecordIndex=this.recordIndex;for(var i=0;i<this.getRecordCount();i++){this.SetIndexNoEvent(i);this.setFieldValueEx(fieldName,value,sender)}this.recordIndex=sRecordIndex};UCML.BusinessComponent.prototype.setFieldValueEx=function(fieldName,value,sender){if(this.EnabledEdit==false){return}if(this.IsRecordOwner()==false){alert("您现在无权修改这条记录!");return}var flag=0;var index=null;var columnInfo=null;for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){flag=1;columnInfo=this.columns[i];break}}this.sender=sender;if(flag==0){return}index=this.dataStore.columnIndex(fieldName);columnInfo=this.columns[index];if(index==null){return}var fieldType=columnInfo.fieldType;if(columnInfo.fieldType=="Boolean"){if(value==true){value="true"}if(value==false){value="false"}}else if(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Int"||fieldType=="Byte"||fieldType=="Short"){if(columnInfo.isCodeTable!=true){if(value!="null"){if(value!=null&&value!=""&&(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Short")){value=parseFloat(value);if(columnInfo.decLength!=0){value=this.DotRound(value,columnInfo.decLength)}}}}}var evObj=this.createEventObject();evObj.result=true;evObj.fieldName=fieldName;evObj.Value=value;if(this.fireEvent("BeforeFieldChange",evObj)===false){return}var oldvalue=this.getFieldValue(fieldName);var record=this.getCurrentRecord();if(record!=null){this.dataStore.setFieldValueByIndexID(this.recordIndex,index,value);var evObj=this.createEventObject();evObj.TableName=this.TableName;evObj.fieldName=fieldName;evObj.value=value;evObj.newvalue=value;evObj.oldvalue=oldvalue;evObj.dataTable=this;evObj.OID=record[0];this.fireEvent("OnFieldChange",evObj,sender);var evObj=this.createEventObject();evObj.fieldName=fieldName;evObj.Value=value;this.fireEvent("onAfterFieldChange",evObj)}};UCML.BusinessComponent.prototype.setFieldValueToControl=function(fieldName,value){var objectValue=new Object;objectValue.fieldName=fieldName;objectValue.value=value;this.NotifyControls("QueryValue",objectValue)};UCML.BusinessComponent.prototype.setFieldValueBack=function(fieldName,value,sender){if(this.EnabledEdit==false){return}if(this.IsRecordOwner()==false){alert(UCML.Languge.BCnotRightEdit);return}this.sender=sender;var index=this.dataStore.columnIndex(fieldName);if(index==null){return}var record=this.getCurrentRecord();if(record!=null){this.dataStore.setFieldValueByIndexID(this.recordIndex,index,value)}};UCML.BusinessComponent.prototype.ShowMessage=function(str){var top=window.document.body.scrollTop};UCML.BusinessComponent.prototype.HideMessage=function(){};UCML.BusinessComponent.prototype.getLoadChildData=function(){return this.theLoadChildData};UCML.BusinessComponent.prototype.setLoadChildData=function(value){this.theLoadChildData=value};UCML.BusinessComponent.prototype.turnArrayDataToXml=function(){var xml="<"+this.BCName+">";if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){xml=xml+"<"+this.TableName+"OID"+">";xml=xml+this.getOID();xml=xml+"</"+this.TableName+"OID"+">"}for(var i=0;i<this.columns.length;i++){xml=xml+"<"+this.columns[i].fieldName+">";xml=xml+"<![CDATA["+this.getFieldValue(this.columns[i].fieldName)+"]]>";xml=xml+"</"+this.columns[i].fieldName+">"}xml=xml+"</"+this.BCName+">";return xml};UCML.BusinessComponent.prototype.LoadChildResults=function(result,text,methodName){this.HideMessage();eval(text);for(var i=0;i<this.theDetailTables.length;i++){this.theDetailTables[i].loaded=false;this.setChildData(this.theDetailTables[i].BCName,BusinessData[this.theDetailTables[i].BCName]);this.theDetailTables[i].SetDataPacketAndChild(BusinessData[this.theDetailTables[i].BCName])}this.fireEvent("loadChildData",{})};UCML.BusinessComponent.prototype.NotifyDetailTable=function(msg){if(msg=="R"){this.loadChildData()}else if(msg=="I"){}else if(msg=="D"){for(var i=0;i<this.theDetailTables.length;i++){}}};UCML.BusinessComponent.prototype.DeleteAll=function(){var i=0;while(true){this.recordIndex=0;if(this.getRecordCount()>0){this.Delete()}else{break}}};UCML.BusinessComponent.prototype.DeleteAllChild=function(ParentFieldName,ParentOID){this.allChildIndex=new Array;this.LocateOID(ParentOID);var old=this.recordIndex;this.InernalGetAllChildIndex(ParentFieldName,ParentOID);for(var i=0;i<this.allChildIndex.length;i++){this.recordIndex=this.allChildIndex[i];this.Delete()}this.recordIndex=old;this.Delete();this.recordIndex=-1};UCML.BusinessComponent.prototype.InernalGetAllChildIndex=function(ParentFieldName,ParentOID){var n=this.getRecordCount();for(var i=0;i<n;i++){this.recordIndex=i;if(this.getFieldValue(ParentFieldName)==ParentOID){this.allChildIndex[this.allChildIndex.length]=i;this.InernalGetAllChildIndex(ParentFieldName,this.getOID())}}};UCML.BusinessComponent.prototype.AddDetailTable=function(Table){this.theDetailTables[this.theDetailTables.length]=Table;this.on("OnBeforeDelete",function(OID){if(!this.childDatas){return}if(!this.childDatas[OID]){return}this.childDatas[OID]=null},this);Table.on("OnAfterInsert",function(OID){if(this.getChildData(Table.BCName).indexOf(Table.dataStore.bcData.last())!=-1)return;this.getChildData(Table.BCName).add(Table.dataStore.bcData.last())},this);Table.on("OnBeforeDelete",function(OID){this.removeChildData(Table.BCName,OID)},this)};UCML.BusinessComponent.prototype.getDateTimeFormatType=function(dateTimeFormat){if(dateTimeFormat.split(" ").length==2){return"datetime"}else if(dateTimeFormat.indexOf("y")>-1){return"date"}else{return"time"}};UCML.BusinessComponent.prototype.dateTimeValue=function(dateTimeValue,dateTimeFormat){var localTimeFormat="";var localDateFormat="";var timeValue="";var dateValue="";var dateTimeFormatType=this.getDateTimeFormatType(dateTimeFormat);switch(dateTimeFormatType){case"datetime":localDateFormat=dateTimeFormat.split(" ")[0];localTimeFormat=dateTimeFormat.split(" ")[1];if(dateTimeValue.split("T").length==2){dateValue=dateTimeValue.split("T")[0];timeValue=dateTimeValue.split("T")[1]}else if(dateTimeValue.split(" ").length==2){dateValue=dateTimeValue.split(" ")[0];timeValue=dateTimeValue.split(" ")[1]}else if(dateTimeValue.split(" ").length==0||dateTimeValue.split("T").length==0){dateValue=dateTimeValue.split(" ")[0];timeValue=""}break;case"date":localDateFormat=dateTimeFormat;dateValue=dateTimeValue;break;case"time":localDateFormat=dateTimeFormat.split(" ")[0];localTimeFormat=dateTimeFormat.split(" ")[1];if(dateTimeValue.split("T").length==2){timeValue=dateTimeValue.split("T")[1]}else if(dateTimeValue.split(" ").length==2){timeValue=dateTimeValue.split(" ")[1]}else if(dateTimeValue.split(" ").length==1){timeValue=dateTimeValue.split(" ")[0]}else if(dateTimeValue.split(" ").length==0||dateTimeValue.split("T").length==0){timeValue=""}dateValue="";break}var year=1900;var month=1;var day=1;if(dateValue!=""){dateValue=dateValue.replace(/[^0-9]/g,"/");var dateSequence=localDateFormat.toLowerCase().replace(/[^ymd]/g,"");var dateArray=dateValue.split("/");year=dateArray[dateSequence.indexOf("y")];month=dateArray[dateSequence.indexOf("m")];if(dateSequence.indexOf("d")!=-1){day=dateArray[dateSequence.indexOf("d")]}}var d=new Date(year,parseInt(month,10)-parseInt(1),day);if(timeValue!=""){timeValue=timeValue.replace(/[^0-9]/g,":");timeArray=timeValue.split(":");d=new Date(year,parseInt(month,10)-1,day);d.setHours(parseInt(timeArray[0],10));if(timeArray.length>1){d.setMinutes(parseInt(timeArray[1],10));if(timeArray.length>2)d.setSeconds(parseInt(timeArray[2],10))}}return d};UCML.BusinessComponent.prototype.leadingZero=function(value){if(value<10){return"0"+value.toString()}else{return value.toString()}};UCML.BusinessComponent.prototype.dateFilterValue=function(value,dateTimeFormat){if(dateTimeFormat==""){dateTimeFormat=this.dateFormat}var d=this.dateTimeValue(value,dateTimeFormat);var day=this.leadingZero(d.getDate());var month=this.leadingZero(d.getMonth()+1);var year=d.getFullYear();var hours=this.leadingZero(d.getHours());var minutes=this.leadingZero(d.getMinutes());var seconds=this.leadingZero(d.getSeconds());var dateTimeFormatType=this.getDateTimeFormatType(dateTimeFormat);var DBMSName="Microsoft SQL Server";switch(DBMSName){case"Microsoft SQL Server":case"Adaptive Server Anywhere":switch(dateTimeFormatType){case"datetime":value=dateTimeFormat;break;case"date":value=dateTimeFormat;break;case"time":value="h:mi:s";break}break;case"Oracle":switch(dateTimeFormatType){case"datetime":value="TO_DATE('m/d/y h:mi:s','MM/DD/YYYY HH24:MI:SS')";break;case"date":value="TO_DATE('m/d/y','MM/DD/YYYY')";break;case"time":value="TO_DATE('h:mi:s','HH24:MI:SS')";break}break;case"Sybase SQL Server":switch(dateTimeFormatType){case"datetime":value="'m/d/y h:mi:s'";break;case"date":value="'m/d/y'";break;case"time":value="'h:mi'";break}break;case"DB2/NT":value="'m/d/y'";break;case"InterSystems Cache":value="TO_DATE('m/d/y','MM/DD/YYYY')";break;case"MySQL":value="'y-m-d'";break;default:switch(dateTimeFormatType){case"time":value="'h:mi'";break;default:value="#m/d/y#";break}break}value=value.replace(/mi/,minutes).replace(/h/,hours).replace(/s/,seconds);value=value.replace(/m/,month).replace(/d/,day).replace(/y/,year);return value};UCML.BusinessComponent.prototype.today=function(dateTimeFormat){var d=new Date;var day=this.leadingZero(d.getDate());var month=this.leadingZero(d.getMonth()+1);var year=d.getFullYear();var hours=this.leadingZero(d.getHours());var minutes=this.leadingZero(d.getMinutes());var seconds=this.leadingZero(d.getSeconds());return year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds};UCML.BusinessComponent.prototype.IsRecordOwner=function(){var evObj=this.createEventObject();evObj.result=true;this.fireEvent("OnRecordOwner",evObj);if(evObj.result==false){return false}if(this.haveField("SYS_CreatedBy")==false||this.ChangeOnlyOwnerBy==false){return true}var d=new UCML.BusinessComponent.ModifyPerm(this);if(d!=null){if(d["OnlyAllowsSelf"]=="true"||d["OnlyAllowsSelf"]=="1"){var value=this.getFieldValue("SYS_CreatedBy");if(value==this.getUserOID()||this.getUserOID()=="00000000-0000-0000-0000-000000000001"){return true}else{return false}}if(d["AllowsSelf"]=="true"||d["AllowsSelf"]=="1"){var value=this.getFieldValue("SYS_CreatedBy");if(value==this.getUserOID()||this.getUserOID()=="00000000-0000-0000-0000-000000000001"){return true}}if(d["NotAllowsSelf"]=="true"||d["NotAllowsSelf"]=="1"){var value=this.getFieldValue("SYS_CreatedBy");if(value==this.getUserOID()){return false}}if(d["AllowsDesignee"]=="true"||d["AllowsDesignee"]=="1"){if(UCML.BusinessComponent.ModifyPerm.IsAllowsResp(this,this.getRESPOID())||UCML.BusinessComponent.ModifyPerm.IsAllowsUser(this,this.getUserOID())){return true}else{return false}}}};UCML.BusinessComponent.prototype.haveField=function(fieldName){if(fieldName==this.TableName+"OID"){return true}for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return true}}return false};UCML.BusinessComponent.prototype.DotRound=function(Dight,How){Dight=Math.round(Dight*Math.pow(10,How))/Math.pow(10,How);var ar=Dight.toString().split(".");if(ar.length>1){var str=ar[1];for(var i=0;i<parseInt(How)-parseInt(ar[1].length);i++){str=str+"0"}Dight=ar[0]+"."+str}else{var str="";for(var i=0;i<How;i++){str=str+"0"}Dight=ar[0]+"."+str}return Dight};UCML.BusinessComponent.prototype.getRowFieldValue=function(rowIndex,fieldName){var old=this.recordIndex;this.recordIndex=rowIndex;var value=this.getFieldValue(fieldName);this.recordIndex=old;return value};UCML.BusinessComponent.prototype.setRowFieldValue=function(rowIndex,fieldName,value){var old=this.recordIndex;this.recordIndex=rowIndex;var value=this.setFieldValueEx(fieldName,value);this.recordIndex=old};UCML.BusinessComponent.prototype.getFieldValue=function(fieldName){if(this.dataStore==null){return}if(fieldName==""||fieldName==null){return""}var fieldType=null;var columnInfo=null;var index;if(this.GetIsOIDKey()&&fieldName==this.TableName+"OID"){return this.getOID()}index=this.dataStore.columnIndex(fieldName);if(index==null){return}columnInfo=this.columns[index];fieldType=columnInfo.fieldType;if(columnInfo==null){alert(this.TableName+UCML.Languge.BClawlessFieldLanguge+fieldName);return null}var value=null;var v;var fieldNode=null;var record=this.getCurrentRecord();if(record!=null){value=record[index];if(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Int"||fieldType=="Byte"||fieldType=="Short"){if(columnInfo.isCodeTable!=true){if(value!="null"){if(value!=null&&value!=""&&(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Number"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Short")){value=parseFloat(value);if(columnInfo.decLength!=0){value=this.DotRound(value,columnInfo.decLength)}}}}}if(fieldType=="Date"){var valueTemp=value;if(columnInfo.dateTimeFormat){value=this.dateFilterValue(value,columnInfo.dateTimeFormat)}else{value=this.dateFilterValue(value,"y-m-d")}valueTemp=this.dateFilterValue(valueTemp,"y-m-d");if(valueTemp=="1900-01-01"||valueTemp=="1900-1-1"||valueTemp=="1899-12-31"){value=""}}else if(fieldType=="DateTime"){var valueTemp=value;if(value.length<=10){value+=" 00:00:00"}if(columnInfo.dateTimeFormat){value=this.dateFilterValue(value,columnInfo.dateTimeFormat)}else{value=this.dateFilterValue(value,"y-m-d h:mi:s")}if(value=="1900-01-01 00:00:00"){value=""}valueTemp=this.dateFilterValue(valueTemp,"y-m-d");if(valueTemp=="1900-01-01"||valueTemp=="1900-1-1"||valueTemp=="1899-12-31"){value=""}}else if(fieldType=="Time"){value=this.dateFilterValue(value,"h:mi:s")}}else{}if(value==null){value=""}if(value=="null"){value=""}return value};UCML.BusinessComponent.prototype.turnFieldValue=function(value,columnInfo){var fieldType=columnInfo.fieldType;if(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Numeric"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Int"||fieldType=="Byte"||fieldType=="Short"){if(columnInfo.isCodeTable!=true){if(value!="null"){if(columnInfo.decLength!=0){value=this.DotRound(value,columnInfo.decLength)}}else{value=""}}else{if(value=="null"){value=""}}}if(fieldType=="Date"){if(value==""){value="1900-01-01"}if(value=="null"){value="1900-01-01"}if(columnInfo.dateTimeFormat){value=this.dateFilterValue(value,columnInfo.dateTimeFormat)}else{value=this.dateFilterValue(value,"y-m-d")}if(value=="1900-1-1"){value="";
}if(value=="1900-01-01"){value=""}}else if(fieldType=="DateTime"){if(value==""){value="1900-01-01 00:00:00"}if(value=="null"){value="1900-01-01 00:00:00"}if(columnInfo.dateTimeFormat){value=this.dateFilterValue(value,columnInfo.dateTimeFormat)}else{value=this.dateFilterValue(value,"y-m-d h:mi:s")}if(value=="1900-01-01 00:00:00"){value=""}}else if(fieldType=="Time"){if(value==""){value="1900-01-01 00:00:00"}if(value=="null"){value="1900-01-01 00:00:00"}value=this.dateFilterValue(value,"h:mi:s");if(value=="00:00:00"){value=""}}if(value=="null"){value=""}return value};UCML.BusinessComponent.prototype.OID_GUID=function(){var record=this.getCurrentRecord();if(record!=null){return record[0]}return"00000000-0000-0000-0000-000000000000"};UCML.BusinessComponent.prototype.getOID=function(){var record=this.getCurrentRecord();try{if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){return record[0]}else{if(this.fHaveUCMLKey==true){var key=this.PrimaryKey.split(";")[0];return this.getFieldValue(key)}else{var keys=this.PrimaryKey.split(";");var kv="";for(var i=0;i<keys.length;i++){if(kv!="")kv+=";";kv+=this.getFieldValue(keys[i])}return kv}}}catch(e){}return"00000000-0000-0000-0000-000000000000"};UCML.BusinessComponent.prototype.setOID=function(value){var record=this.getCurrentRecord();try{if(this.PrimaryKey==null||this.PrimaryKey==""||this.PrimaryKey==this.TableName+"OID"){this.dataStore.setOID(this.recordIndex,"",value)}else{this.dataStore.setOID(this.recordIndex,this.PrimaryKey,value)}}catch(e){}};UCML.BusinessComponent.prototype.GetKeyValue=function(value){if(value!=null){if(value.length>0){return value[0]}}return"00000000-0000-0000-0000-000000000000"};UCML.BusinessComponent.prototype.setFieldValueByID=function(index,value){if(this.EnabledEdit==false){return}this.dataStore.setFieldValueByID(index,value)};UCML.BusinessComponent.prototype.getFieldValueByID=function(index){this.dataStore.getFieldValueByID(index)};UCML.BusinessComponent.prototype.Post=function(){this.NotifyControls("Post")};UCML.BusinessComponent.prototype.Prev=function(){var recIndex=this.recordIndex-1;this.setRecordIndex(recIndex)};UCML.BusinessComponent.prototype.Next=function(){var recIndex=this.recordIndex+1;this.setRecordIndex(recIndex)};UCML.BusinessComponent.prototype.First=function(){var recIndex=0;this.setRecordIndex(recIndex)};UCML.BusinessComponent.prototype.Last=function(){var recIndex=this.getRecordCount()-1;this.setRecordIndex(recIndex)};UCML.BusinessComponent.prototype.Eof=function(){if(this.recordIndex<0){return true}if(this.recordIndex==this.getRecordCount()-1){return true}return false};UCML.BusinessComponent.prototype.Bof=function(){if(this.recordIndex<=0){return true}else{return false}};UCML.BusinessComponent.prototype.getRecordIndex=function(){return this.recordIndex};UCML.BusinessComponent.prototype.setRecordIndex=function(value,sender){if(value<0){return}if(value>=this.getRecordCount()){return}if(this.recordIndex!=value){this.recordIndex=value;this.dataStore.setRecordIndex(this.recordIndex);this.NotifyDetailTable("R");this.fireEvent("OnRecordChange",{},sender)}};UCML.BusinessComponent.prototype.SetIndexNoEvent=function(value,sender){if(value<0){return}if(value>=this.getRecordCount()){return}if(this.recordIndex!=value){this.recordIndex=value;this.dataStore.setRecordIndex(this.recordIndex,sender)}};UCML.BusinessComponent.prototype.setIndexNoEvent=function(value,sender){if(value<0){return}if(value>=this.getRecordCount()){return}if(this.recordIndex!=value){this.recordIndex=value;this.dataStore.setRecordIndex(this.recordIndex,sender)}};UCML.BusinessComponent.prototype.getRecordOwnerType=function(){return this.recordOwnerType};UCML.BusinessComponent.prototype.setRecordOwnerType=function(value){this.recordOwnerType=value};UCML.BusinessComponent.prototype.LoadFirstPage=function(){if(this.getStartPos()==0){return}this.ShowMessage(UCML.Languge.BCLoadFirstPageLanguge);var nStartPoseEx=0;this.getDataPage(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.LoadPrevPage=function(){if(this.getStartPos()==0)return;this.ShowMessage(UCML.Languge.BCLoadPrevPageLanguge);var nStartPoseEx=parseInt(this.getStartPos())-parseInt(this.getDefaultPageCount());if(nStartPoseEx<0){nStartPoseEx=0}this.getDataPage(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.LoadMoreData=function(){if(parseInt(this.getStartPos())+parseInt(this.getReadCount())>=this.getTotalRecordCount()){return}this.ShowMessage(UCML.Languge.BCLoadMoreDataLanguge);var nStartPoseEx=parseInt(this.getStartPos())+parseInt(this.getReadCount());this.getDataPage(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.LoadLastPage=function(){this.ShowMessage(UCML.Languge.BCLoadLastPageLanguge);var pageNum=parseInt(parseInt(this.getTotalRecordCount())/parseInt(this.getDefaultPageCount()));if(parseInt(parseInt(this.getTotalRecordCount())%parseInt(this.getDefaultPageCount()))!=0){pageNum++}var nStartPoseEx=(pageNum-1)*parseInt(this.getDefaultPageCount());if(nStartPoseEx<0){nStartPoseEx=0}this.getDataPage(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.GotoPage=function(pageNo){this.ShowMessage(UCML.Languge.BCRefreshLanguge);nStartPoseEx=(parseInt(pageNo)-1)*parseInt(this.getDefaultPageCount());if(nStartPoseEx<0){nStartPoseEx=0}this.getDataPage(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.getCustomRela=function(){if(this.fCustomRela==true&&this.ForeignKey!=undefined&&this.ForeignKey!=null){return true}return false};UCML.BusinessComponent.prototype.getData=function(nStartPoseEx,DefaultPageCount,async){nStartPoseEx=nStartPoseEx==undefined?0:nStartPoseEx;DefaultPageCount=DefaultPageCount==undefined?this.getDefaultPageCount():DefaultPageCount;this.fireEvent("beforeGetData");if(this.TableType=="M"){this.BusinessObject.getCondiActorDataBC(this.BCName,nStartPoseEx,DefaultPageCount,this.theFieldList,this.theValueList,this.theCondiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,this.onAfterGetData,this.onFailureCall,this,async)}else if(this.TableType=="A"){this.BusinessObject.getCondiActorDataBC(this.BCName,nStartPoseEx,DefaultPageCount,this.theFieldList,this.theValueList,this.theCondiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,this.onAfterGetData,this.onFailureCall,this,async)}else if(this.TableType=="S"){var cond=this.getForeignCondition();this.BusinessObject.getCondiActorDataBC(this.BCName,nStartPoseEx,DefaultPageCount,cond.fieldList,cond.valueList,cond.condiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,this.onAfterGetData,this.onFailureCall,this,async)}};UCML.BusinessComponent.prototype.getDataPage=function(nStartPoseEx,DefaultPageCount,async){nStartPoseEx=nStartPoseEx==undefined?0:nStartPoseEx;DefaultPageCount=DefaultPageCount==undefined?this.getDefaultPageCount():DefaultPageCount;var totalRecordCount=this.getTotalRecordCount();this.fireEvent("beforeGetData");if(this.TableType=="M"){this.BusinessObject.getCondiActorDataBCPage(this.BCName,nStartPoseEx,DefaultPageCount,this.theFieldList,this.theValueList,this.theCondiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,totalRecordCount,this.onAfterGetData,this.onFailureCall,this,async)}else if(this.TableType=="A"){this.BusinessObject.getCondiActorDataBCPage(this.BCName,nStartPoseEx,DefaultPageCount,this.theFieldList,this.theValueList,this.theCondiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,totalRecordCount,this.onAfterGetData,this.onFailureCall,this,async)}else if(this.TableType=="S"){var cond=this.getForeignCondition();this.BusinessObject.getCondiActorDataBCPage(this.BCName,nStartPoseEx,DefaultPageCount,cond.fieldList,cond.valueList,cond.condiIndentList,this.theSQLCondi,this.theSQLCondiType,this.sortSQL,totalRecordCount,this.onAfterGetData,this.onFailureCall,this,async)}};UCML.BusinessComponent.prototype.getForeignCondition=function(){var ForeignKey=this.ForeignKey;var theCondiIndentList1="";var theFieldList1="";var theValueList1="";if(this.TableType=="S"){if(this.getCustomRela()){for(var m=0;m<ForeignKey.ChildColumns.length;m++){parentOID=this.MasterTable.getFieldValue(ForeignKey.ParentColumns[m]);pkField=ForeignKey.ChildColumns[m];theFieldList1=theFieldList1+this.theFieldList+this.TableName+"."+pkField+";";theValueList1=theValueList1+this.theValueList+parentOID+";";theCondiIndentList1=theCondiIndentList1+this.theCondiIndentList+" = ;"}}else{theFieldList1=this.theFieldList+this.TableName+"."+this.LinkKeyName+";";if(this.PK_COLUMN_NAME!=""){theValueList1=this.theValueList+this.MasterTable.getFieldValue(this.PK_COLUMN_NAME)+";"}else{theValueList1=this.theValueList+this.MasterTable.getOID()+";"}theCondiIndentList1=this.theCondiIndentList+" = ;"}}return{condiIndentList:theCondiIndentList1,fieldList:theFieldList1,valueList:theValueList1}};UCML.BusinessComponent.prototype.OnSuccessCall=function(result,userContext,methodName){BusinessObject.HideMessage();var xmldoc=XMLJS.parseXML2(result.responseText);var text=xmldoc.text;alert(text)};UCML.BusinessComponent.prototype.onFailureCall=function(result,text,methodName){this.fireEvent("afterGetData");alert(text)};UCML.BusinessComponent.prototype.Refresh=function(){this.ShowMessage(UCML.Languge.BCRefreshLanguge);if(this.MasterTable){this.MasterTable.setChildData(this.BCName,[])}this.claerChildData();this.childDatas={};this.ClearData();this.RejectChangesInner();var nStartPoseEx=this.StartPos;this.getData(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.RefreshSort=function(fieldName,Order){this.RejectChangesInner();this.StartPos=0;var nStartPoseEx=0;if(Order==0){SQLFix=" ORDER BY "+fieldName}else if(Order==1){SQLFix=" ORDER BY "+fieldName+" DESC"}else{SQLFix=""}this.sortSQL=SQLFix;this.getData(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.setSortSQL=function(val){this.RejectChangesInner();this.StartPos=0;var nStartPoseEx=0;this.sortSQL=val;this.getData(nStartPoseEx,this.getDefaultPageCount())};UCML.BusinessComponent.prototype.SetCondiList=function(fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType){this.theFieldList=fieldList;this.theValueList=valueList;this.theCondiIndentList=condiIndentList;if(SQLCondi!=undefined){this.theSQLCondi=SQLCondi}if(SQLCondiType==undefined){this.theSQLCondiType=0}else{this.theSQLCondiType=SQLCondiType}};UCML.BusinessComponent.prototype.getSQLCondi=function(){return this.theSQLCondi};UCML.BusinessComponent.prototype.getFieldList=function(){return this.theFieldList};UCML.BusinessComponent.prototype.getValueList=function(){return this.theValueList};UCML.BusinessComponent.prototype.getCondiIndentList=function(){return this.theCondiIndentList};UCML.BusinessComponent.prototype.setSQLCondi=function(value){this.theSQLCondi=value};UCML.BusinessComponent.prototype.setFieldList=function(value){this.theFieldList=value};UCML.BusinessComponent.prototype.setValueList=function(value){this.theValueList=value};UCML.BusinessComponent.prototype.setCondiIndentList=function(value){this.theCondiIndentList=value};UCML.BusinessComponent.prototype.SetDefaultCondiList=function(fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType){this.theDefaultFieldList=fieldList;this.theDefaultValueList=valueList;this.theDefaultCondiIndentList=condiIndentList;this.theDefaultSQLCondi=SQLCondi;this.theDefaultSQLCondiType=SQLCondiType};UCML.BusinessComponent.prototype.getEnabledEdit=function(){return this.EnabledEdit};UCML.BusinessComponent.prototype.setEnabledEdit=function(value){this.EnabledEdit=value};UCML.BusinessComponent.prototype.getEnabledAppend=function(){return this.EnabledAppend};UCML.BusinessComponent.prototype.setEnabledAppend=function(value){this.EnabledAppend=value};UCML.BusinessComponent.prototype.getEnabledDelete=function(){return this.EnabledDelete};UCML.BusinessComponent.prototype.setEnabledDelete=function(value){this.EnabledDelete=value};UCML.BusinessComponent.prototype.getEnabledSort=function(){return this.enabledSort};UCML.BusinessComponent.prototype.setEnabledSort=function(value){this.enabledSort=value};UCML.BusinessComponent.prototype.getDetailTables=function(){return this.theDetailTables};UCML.BusinessComponent.prototype.getPrimaryKey=function(){return this.PrimaryKey};UCML.BusinessComponent.prototype.setPrimaryKey=function(value){this.PrimaryKey=value};UCML.BusinessComponent.prototype.getForeignKey=function(){return this.ForeignKey};UCML.BusinessComponent.prototype.setForeignKey=function(value){this.ForeignKey=value};UCML.BusinessComponent.prototype.setCustomRela=function(value){this.fCustomRela=value};UCML.BusinessComponent.prototype.getfCustomPrimaryKey=function(){return this.thefCustomPrimaryKey};UCML.BusinessComponent.prototype.setfCustomPrimaryKey=function(value){this.thefCustomPrimaryKey=value};UCML.BusinessComponent.prototype.getCustomKeyValue=function(){};UCML.BusinessComponent.prototype.setNotifyControl=function(value){this.theNotifyControl=value};UCML.BusinessComponent.prototype.setSubBC_SQLCondi=function(){this.subBC_SQLCondi=value};UCML.BusinessComponent.prototype.getFieldType=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return this.columns[i].fieldType}}return 46};UCML.BusinessComponent.prototype.getFieldCaption=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return this.columns[i].caption}}return fieldName};UCML.BusinessComponent.prototype.clearAllBCLink=function(){for(var i=0;i<this.columns.length;i++){this.columns[i].objBCLinkColl=null}};UCML.BusinessComponent.prototype.clearBCLink=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){this.columns[i].objBCLinkColl=null;break}}};UCML.BusinessComponent.prototype.GetBCLink=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return this.columns[i].objBCLinkColl}}return null};UCML.BusinessComponent.prototype.getBCLink=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return this.columns[i].objBCLinkColl}}return null};UCML.BusinessComponent.prototype.getUCMLlanguge=function(LableText){return""};UCML.BusinessComponent.prototype.getChangeXML=function(){return this.dataStore.getChangeXML()};UCML.override(UCML.BusinessComponent,{sum:function(fieldName){var columnInfo=null;var cindex=this.dataStore.columnIndex(fieldName);columnInfo=this.columns[cindex];var oldIndex=this.recordIndex;var recordCount=this.getRecordCount();var value=0;for(var i=0;i<recordCount;i++){this.SetIndexNoEvent(i);var tempValue=this.getFieldValue(fieldName);if(isNaN(parseFloat(tempValue))==false)value=value+parseFloat(tempValue)}this.SetIndexNoEvent(oldIndex);if(columnInfo.decLength!=0){value=this.DotRound(value,columnInfo.decLength)}return value},avg:function(fieldName){var columnInfo=null;var cindex=this.dataStore.columnIndex(fieldName);columnInfo=this.columns[cindex];var oldIndex=this.recordIndex;var recordCount=this.getRecordCount();var value=0;for(var i=0;i<recordCount;i++){this.SetIndexNoEvent(i);var tempValue=this.getFieldValue(fieldName);if(isNaN(parseFloat(tempValue))==false)value=value+parseFloat(tempValue)}this.SetIndexNoEvent(oldIndex);if(recordCount>0){if(columnInfo.decLength!=0){return this.DotRound(value/recordCount,columnInfo.decLength)}else return value/recordCount}else return 0},count:function(fieldName){return this.getRecordCount()},max:function(fieldName){var oldIndex=this.recordIndex;var recordCount=this.getRecordCount();var value;for(var i=0;i<recordCount;i++){this.SetIndexNoEvent(i);var fval=parseFloat(this.getFieldValue(fieldName));if(!value){value=fval}else if(value<fval){value=fval}}this.SetIndexNoEvent(oldIndex);return UCML.isEmpty(value)?"":value},min:function(fieldName){var oldIndex=this.recordIndex;var recordCount=this.getRecordCount();var value;for(var i=0;i<recordCount;i++){this.SetIndexNoEvent(i);var fval=parseFloat(this.getFieldValue(fieldName));if(!value){value=fval}else if(value>fval){value=fval}}this.SetIndexNoEvent(oldIndex);return UCML.isEmpty(value)?"":value}});UCML.BusinessComponent.ModifyPerm=function(BCBase){try{this.data=BusinessData[BCBase.BPOName+"ModifyPerm"];if(this.data){if(this.data.length>0){var obj={};obj["BPOName"]=this.data[0][1];obj["OnlyAllowsSelf"]=this.data[0][5];obj["AllowsSelf"]=this.data[0][6];obj["NotAllowsSelf"]=this.data[0][7];obj["AllowsDesignee"]=this.data[0][8];return obj}}}catch(e){this.data=null}return null};UCML.BusinessComponent.ModifyPerm.IsAllowsResp=function(BCBase,RespStr){this.data=BusinessData[BCBase.BPOName+"AllowModifyResp"];var respList=RespStr.split(";");var userResp,respKey;var isModeify=false;if(this.data){for(var r=0;r<respList.length;r++){userResp=respList[r];if(UCML.isEmpty(userResp)){continue}for(var i=0;i<this.data.length;i++){var respKey=this.data[i][4];if(userResp==respKey){isModeify=true;break}}if(isModeify==true){break}}}return isModeify};UCML.BusinessComponent.ModifyPerm.IsAllowsUser=function(BCBase,userOID){this.data=BusinessData[BCBase.BPOName+"AllowModifyUser"];var userKey;var isModeify=false;if(this.data){for(var i=0;i<this.data.length;i++){var respKey=this.data[i][5];if(userOID==respKey){isModeify=true;break}}}return isModeify};UCML.Applet=function(id){this.dataTable=null;this.columns=null;this.isInit=false;UCML.Applet.superclass.constructor.call(this,id);this.addEvents("onLoadData")};UCML.extend(UCML.Applet,UCML.Container,{ctype:"UCML.Applet",moduleMode:0,showLoadMask:false,haveScroll:false,afterRender:function(){UCML.Applet.superclass.afterRender.call(this);if(typeof BPOIsJQMPage!=="undefined"&&BPOIsJQMPage){var theme=BPOPageTheme||"a";this.toolbar.addClass("toolbar-"+theme);this.el.addClass("applet-jqmtheme-"+theme)}else if(this.IsJQMPage){var theme=this.JQMPageTheme||"a";this.toolbar.addClass("toolbar-"+theme)}},beforeRender:function(){UCML.Applet.superclass.beforeRender.call(this);this.toolbar=$("#"+this.id+"Toolbar_Module");this.toolbar.addClass("toolbar");this.el.addClass("applet-box");this.module=window[this.id+"_Module"];var module=$("#"+this.id+"_Module");if(this.module&&this.module.ctype){this.layout=this.module}else if(module.length>0){module.addClass("applet-module");switch(this.moduleMode){case 0:this.module=new UCML.Container({el:module,alignHeight:this.alignHeight,isSetProperties:false,alignWidth:this.alignWidth,ratioHeight:this.ratioHeight,ratioWidth:this.ratioWidth,width:this.width,height:this.height});break;case 1:this.module=new UCML.Panel({el:module,alignHeight:this.alignHeight,isSetProperties:false,alignWidth:this.alignWidth,ratioHeight:this.ratioHeight,ratioWidth:this.ratioWidth,width:this.width,height:this.height,title:this.el.attr("title")||this.id,collapsible:true});break;case 2:this.module=new UCML.GropBox({el:module,alignHeight:this.alignHeight,isSetProperties:false,alignWidth:this.alignWidth,ratioHeight:this.ratioHeight,ratioWidth:this.ratioWidth,width:this.width,height:this.height});break;case 3:this.module=new UCML.Panel({el:module,alignHeight:this.alignHeight,isSetProperties:false,alignWidth:this.alignWidth,ratioHeight:this.ratioHeight,ratioWidth:this.ratioWidth,width:this.width,height:this.height,title:this.el.attr("title")||this.id});break;default:this.module=new UCML.Container({el:module,alignHeight:this.alignHeight,isSetProperties:false,alignWidth:this.alignWidth,ratioHeight:this.ratioHeight,ratioWidth:this.ratioWidth,width:this.width,height:this.height})}this.layout=this.module}this.el.attr("title","")},setPerm:function(){this.ColumnPerm=new UCML.Applet.ColumnPerm(this);if(this.ColumnPerm){for(var j=0;j<this.ColumnPerm.length;j++){var fieldName=this.ColumnPerm[j]["fieldName"];var allowModify=this.ColumnPerm[j]["allowModify"];var allowVisible=this.ColumnPerm[j]["allowVisible"];var defaultValue=this.ColumnPerm[j]["defaultValue"];var notAllowNull=this.ColumnPerm[j]["notAllowNull"];var objColumn=this.getColumn(fieldName);if(objColumn){if(isNaN(allowVisible)){objColumn.display=allowVisible=="true"?true:false;if(!objColumn.display){if(this.headerTable&&this.headerTable.length>0){this.headerTable.find("td.datagrid-header-cell[fieldname="+fieldName+"]").hide();this.headerTable.find("td.datagrid-header-query-cell[fieldname="+fieldName+"]").hide()}else{if(this.controls&&this.controls.length>0){for(var i=0;i<this.controls.length;i++){var ctl=this.controls[i];if(ctl.fieldName==fieldName){ctl.hide();$("#"+fieldName+"LabelValue").hide();break}}}}}}else{objColumn.display=allowVisible==1?true:false;if(!objColumn.display){if(this.headerTable&&this.headerTable.length>0){this.headerTable.find("td.datagrid-header-cell[fieldname="+fieldName+"]").hide();this.headerTable.find("td.datagrid-header-query-cell[fieldname="+fieldName+"]").hide()}else{if(this.controls&&this.controls.length>0){for(var i=0;i<this.controls.length;i++){var ctl=this.controls[i];if(ctl.fieldName==fieldName){ctl.hide();$("#"+fieldName+"LabelValue").hide();break}}}}}}if(isNaN(allowModify)){objColumn.allowModify=allowModify=="true"?true:false;if(!objColumn.allowModify){if(this.controls&&this.controls.length>0){for(var i=0;i<this.controls.length;i++){var ctl=this.controls[i];if(ctl.fieldName==fieldName){ctl.disable();break}}}}}else{objColumn.allowModify=allowModify==1?true:false;if(!objColumn.allowModify){if(this.controls&&this.controls.length>0){for(var i=0;i<this.controls.length;i++){var ctl=this.controls[i];if(ctl.fieldName==fieldName){ctl.disable();break}}}}}if(defaultValue!=""||notAllowNull=="true"){var bcCol=this.dataTable.getColumn(fieldName);if(defaultValue!="")bcCol.defaultValue=defaultValue;if(notAllowNull=="true")bcCol.allowNull=false}}}}this.ButtonPerm=new UCML.Applet.ButtonPerm(this);this.DropDownButtonPerm=new UCML.Applet.DropDownButtonPerm(this);if(this.ButtonPerm){var toolbar=window["ToolBar"+this.id]||window["WidgetToolBar"+this.id];if(!UCML.isEmpty(toolbar)){for(var i=0;i<this.ButtonPerm.length;i++){var caption=this.ButtonPerm[i]["caption"];var enabled=this.ButtonPerm[i]["enabled"];var visible=this.ButtonPerm[i]["visible"];var resp_appletbuttonoid=this.ButtonPerm[i]["resp_appletbuttonoid"];var buttontype=this.ButtonPerm[i]["buttontype"];var button=toolbar.getItem(i);if(button){if(button.setDisabled&&(enabled=="true"||enabled==1)){button.enable()}else if(button.setDisabled&&enabled=="false"||enabled==0){button.disable()}if(visible=="false"||visible==0){button.hide()}else if(visible=="true"||visible==1){button.show()}if((enabled=="true"||enabled==1)&&(visible=="true"||visible==1)){if(buttontype=="9"||buttontype==9){if(this.DropDownButtonPerm){for(var j=0;j<this.DropDownButtonPerm.length;j++){var caption=this.DropDownButtonPerm[j]["caption"];var enabled=this.DropDownButtonPerm[j]["enabled"];var visible=this.DropDownButtonPerm[j]["visible"];var resp_appletbutton_fk=this.DropDownButtonPerm[j]["resp_appletbutton_fk"];var buttonid=this.DropDownButtonPerm[j]["buttonid"];if(resp_appletbuttonoid==resp_appletbutton_fk){var item=button.menu.getMenuItemById(buttonid);if(item){if(enabled=="true"||enabled==1){item.el[0].disabled=false}else if(enabled=="false"||enabled==0){item.el[0].disabled=true;item.el.unbind("click")}if(visible=="false"||visible==0){item.el.hide()}else if(visible=="true"||visible==1){item.el.show()}}}}}}}}}}}this.AppletPerm=new UCML.Applet.AppletPerm(this);if(this.AppletPerm){for(var i=0;i<this.AppletPerm.length;i++){var caption=this.AppletPerm[i]["caption"];var enabled=this.AppletPerm[i]["enabled"];var visible=this.AppletPerm[i]["visible"];var appletname=this.AppletPerm[i]["appletname"];var button=window[this.id+"Toolbar_Module"];if(appletname){if(appletname==this.id){if(enabled=="false"||enabled==0){this.setEnabledEdit(false);if(button){if(button.setDisabled&&(enabled=="true"||enabled==1)){button.setDisabled(false)}else if(button.setDisabled&&enabled=="false"||enabled==0){button.setDisabled(true)}}}else{this.enabledEdit=true}}if(visible=="false"||visible==0){if(this.moduleMode==0){if(appletname==this.id){this.layout.hide();var tabPanel=this.el.parents(".tabs-container");if(tabPanel&&tabPanel[0]){var tabPanelObj=eval(tabPanel[0].id);for(var i=0;i<tabPanelObj.panels.length;i++){var panel=tabPanelObj.panels[i];if(panel){var tabId="Tab_"+this.id;if(panel.config.body[0].id==tabId){tabPanelObj.closeTab(i)}}}}}}else if(this.moduleMode==1){if(appletname==this.id){this.layout.hide()}}else if(this.moduleMode==2){if(appletname==this.id){this.layout.hide()}}else if(this.moduleMode==3){if(appletname==this.id){this.layout.hide()}}else{if(appletname==this.id){this.layout.hide()}}}}}}this.CustomButtonPerm=new UCML.Applet.CustomButtonPerm(this);if(this.CustomButtonPerm){for(var i=0;i<this.CustomButtonPerm.length;i++){var enabled=this.CustomButtonPerm[i]["enabled"];var visible=this.CustomButtonPerm[i]["visible"];var buttonid=this.CustomButtonPerm[i]["buttonid"];if(buttonid){if(buttonid.indexOf("$")!=-1){continue}var obj=$("#"+buttonid);if(obj){if(enabled=="false"||enabled==0){obj.attr("disabled",true)}else{obj.removeAttr("disabled")}if(visible=="false"||visible==0){obj.hide()}else{obj.show()}}}}}},getHasLayout:function(){return this.layout?true:false},showMenu:function(x,y){var menu=this.menu;if(this.haveMenu&&menu){var dbody=getPageArea(window.document);var dbWidth=dbody.width;var dbHeight=dbody.height;var qmWidth=menu.el.outerWidth();var qmHeight=menu.el.outerHeight();if(x+qmWidth>dbWidth){x=x-(x+qmWidth-dbWidth)}if(y+qmHeight>dbHeight){y=y-(y+qmHeight-dbHeight)}x=x+$(window.document.body).scrollLeft();y=y+$(window.document.body).scrollTop();menu.show({left:x-4,top:y})}},getModuleEl:function(){if(this.module){return this.module.el}else{return this.el}},showMask:function(type){this.maskType=type||this.maskType;var text="";if(this.maskType=="load"){text='<div class="applet_loading"></div>'}var moduleEl=this.getModuleEl();if(!this.mask){text=text||"";this.mask=$('<div class="applet-mask">'+text+"</div>").appendTo(moduleEl)}var elPosition=moduleEl.position();this.mask.css({width:moduleEl.width(),height:moduleEl.height(),left:elPosition.left,top:elPosition.top});if(this.maskType=="load"){var elLoading=this.mask.find(".applet_loading");var elMask=this.mask;elLoading.css("top",(elMask.height()-elLoading.height())/2);elLoading.css("left",(elMask.width()-elLoading.width())/2);this.maskType=""}},hideMask:function(){if(this.mask){this.mask.remove();delete this.mask}},bindEvents:function(){UCML.Applet.superclass.bindEvents.call(this);if(this.BusinessObject){this.BusinessObject.on("onLoad",this.setPerm,this)}var opt=this;if(this.haveCustomMenu){this.el.bind("contextmenu",function(e){return false})}else if(this.haveMenu){this.el.bind("contextmenu",function(e){opt.showMenu(e.clientX,e.clientY);return false});this.onMenuReady();this.menu.on("menuItemClick",this.onMenuItemClick,this)}if(opt.alignHeight==true||opt.alignWidth==true||UCML.isEmpty(opt.ratioHeight)==false||UCML.isEmpty(opt.ratioWidth)==false){this.getModuleEl().parent().trigger("_resize",function(){})}if(this.dataTable&&this.showLoadMask){this.dataTable.on("beforeGetData",function(){opt.showMask("load")});this.dataTable.on("afterGetData",function(){opt.hideMask()})}UCML.Container.superclass.bindEvents.call(this);this.on("setsize",function(){if(this.mask){opt.showMask()}})},onMenuItemClick:function(menuId,menuItem){if(menuId=="cmd_LoadMore"){this.onLoadMoreData()}else if(menuId=="cmd_LoadPrevPage"){this.onLoadPrevPage()}else if(menuId=="cmd_LoadFirstPage"){this.onLoadFirstPage()}else if(menuId=="cmd_LoadLastPage"){this.onLoadLastPage()}else if(menuId=="cmd_ConfigColumns"){window.open(UCMLLocalResourcePath+"UCMLCommon/SYS/BPO_AppletColumn_PersonJS.aspx?VCName="+this.id+"&ParentBPOName="+this.BusinessObject.BPOName,"","location=no,menubar=no,toolbar=no,status=yes,directories=no,scrollbars=no,resizable=no,width=400,height=360")}else if(menuId=="cmd_Refresh"){this.dataTable.Refresh()}else if(menuId=="cmd_InsertRecord"){this.dataTable.Insert()}else if(menuId=="cmd_DeleteRecord"){this.dataTable.Delete()}else if(menuId=="cmd_Submit"){if(this.BusinessObject.el==window){BusinessSubmit()}else{this.BusinessObject.BusinessSubmit()}}else if(menuId=="cmd_Cancel"){this.dataTable.RejectChanges()}else if(menuId=="cmd_Query"){this.ExecuteQuery()}else if(menuId=="cmd_QueryCancel"){this.clearData()}else if(menuId=="cmd_OutExcel"){ExportToExcelById(this.id)}else if(menuId=="cmd_AllOutExcel"){ExportToExcel(this.dataTable.BCName,this,"","","")}},setToolbarEnabled:function(val){var vcToolbar=window["ToolBar"+this.id];if(!vcToolbar){return vcToolbar}if(val){vcToolbar.enable()}else{vcToolbar.disable()}}});UCML.Applet.prototype.open=function(){if(this.BusinessObject){this.BusinessObject.addApplet(this);this.init()}};UCML.Applet.prototype.getHeight=function(){return this.getModuleEl().height()};UCML.Applet.prototype.getWidth=function(){return this.getModuleEl().width()};UCML.Applet.prototype.init=function(){UCML.Applet.superclass.init.call(this);this.dataTable=this.dataTable||this.BusinessObject.getDataTableByBCName(this.getAttribute("BCName"));if(!this.enabledEdit){this.disabled=true}};UCML.Applet.prototype.isVisible=function(){if(this.getModuleEl().css("display")!=""&&this.getModuleEl().css("display")!="none"){return true}else{return false}};UCML.Applet.prototype.show=function(){this.getModuleEl().show()};UCML.Applet.prototype.hide=function(){this.getModuleEl().hide()};UCML.Applet.prototype.loadData=function(data){};UCML.Applet.prototype.afterFieldChange=function(fieldName,value){};UCML.Applet.prototype.setDataTable=function(value){this.dataTable=value};UCML.Applet.prototype.setColumns=function(value){this.columns=value;if(this.dataTable){for(var i=0;i<this.columns.length;i++){var fieldName=this.columns[i].fieldName;var bcCol=this.dataTable.getColumn(fieldName);if(bcCol){UCML.applyIf(this.columns[i],bcCol)}}}};UCML.Applet.prototype.getColumns=function(){return this.columns};UCML.Applet.prototype.setEnabledEdit=function(value){this.enabledEdit=value};UCML.Applet.prototype.setSize=function(param,a){UCML.Applet.superclass.setSize.call(this,param,a);if(!isNaN(this.height)){this.el.height(this.height-this.toolbar.outerHeight(true))}};UCML.Applet.prototype.setSize=function(param,a){UCML.Applet.superclass.setSize.call(this,param,a);if(!isNaN(this.height)){if(this.el.prevAll().length>0||this.el.nextAll().length>0){var prevHeight=0;this.el.prevAll().each(function(index,el){prevHeight+=$(this).outerHeight(true)});var nextHeight=0;this.el.nextAll().each(function(index,el){if($(this).hasClass("toolbar")){nextHeight+=$(this).outerHeight(true)}});this.el.height(this.height-prevHeight-nextHeight)}else{this.el.height(this.height)}}};UCML.Applet.prototype.getColumn=function(fieldName){if(this.columns){for(var i=0;i<this.columns.length;i++){var col=this.columns[i];if(col.fieldName==fieldName){return col}}}return null};UCML.Applet.prototype.SetCustomizeMenuPerm=function(menuObj){this.CustomizeMenuPerm=new UCML.Applet.CustomizeMenuPerm(this);if(this.CustomizeMenuPerm){for(var i=0;i<menuObj.items.length;i++){for(var j=0;j<this.CustomizeMenuPerm.length;j++){var caption=this.CustomizeMenuPerm[j]["caption"];var enabled=this.CustomizeMenuPerm[j]["enabled"];var visible=this.CustomizeMenuPerm[j]["visible"];var menuid=this.CustomizeMenuPerm[j]["menuid"];if(menuObj.items[i].menuId==menuid){var item=menuObj.getMenuItemById(menuid);if(enabled=="true"||enabled==1){item.el[0].disabled=false}else if(enabled=="false"||enabled==0){item.el[0].disabled=true;item.el.unbind("click")}if(visible=="false"||visible==0){item.el.hide()}else if(visible=="true"||visible==1){item.el.show()}}}}}};UCML.Applet.ColumnPerm=function(vc){if(!window["appletColumnPerm"]){return null}var objList=window["appletColumnPerm"][vc.id]||[];try{this.data=BusinessData[vc.id+"CloumnPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var fieldName=this.data[i][3];var allowModify=this.data[i][1];var allowVisible=this.data[i][2];var defaultValue=this.data[i][7];var notAllowNull=this.data[i][8];
var obj={};obj["fieldName"]=fieldName;obj["allowModify"]=allowModify;obj["allowVisible"]=allowVisible;obj["defaultValue"]=defaultValue;obj["notAllowNull"]=notAllowNull;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.ColumnPerm.fields=["RESP_AppletColumnOID","AllowModify","AllowVisible","FieldName","ChineseName","AllowEdit","Visible","AppletColumn_FK","UCML_RESPONSIBILITY_FK","Applet_FK"];UCML.Applet.ColumnPerm.prototype.getFieldIndex=function(name){return UCML.Applet.ColumnPerm.fields.indexOf(name)};UCML.Applet.ColumnPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.Applet.ButtonPerm=function(vc){if(!window["appletButtonPerm"]){return null}var objList=window["appletButtonPerm"][vc.id]||[];try{this.data=BusinessData[vc.id+"ButtonPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"Enabled");var visible=this.getValue(i,"AllowVisible");var resp_appletbuttonoid=this.getValue(i,"RESP_AppletButtonOID");var buttontype=this.getValue(i,"ButtonType");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["resp_appletbuttonoid"]=resp_appletbuttonoid;obj["buttontype"]=buttontype;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.ButtonPerm.fields=["RESP_AppletButtonOID","Caption","Enabled","AllowVisible","ButtonType","Applet_FK","AppletButton_FK","UCML_RESPONSIBILITY_FK"];UCML.Applet.ButtonPerm.prototype.getFieldIndex=function(name){return UCML.Applet.ButtonPerm.fields.indexOf(name)};UCML.Applet.ButtonPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.Applet.DropDownButtonPerm=function(vc){if(!window["appletButtonPerm"]){return null}var objList=[];try{this.data=BusinessData[vc.id+"DropDownButtonPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"AllowModify");var visible=this.getValue(i,"AllowVisible");var resp_appletbutton_fk=this.getValue(i,"RESP_AppletButton_FK");var buttonid=this.getValue(i,"ButtonId");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["buttonid"]=buttonid;obj["resp_appletbutton_fk"]=resp_appletbutton_fk;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.DropDownButtonPerm.fields=["RESP_AppletDropDownButtonOID","AllowModify","AllowVisible","Caption","ButtonId","AppletName","UCMLClass_FK","RESP_AppletButton_FK","Applet_FK","CheckButtonColl_FK","UCML_RESPONSIBILITY_FK"];UCML.Applet.DropDownButtonPerm.prototype.getFieldIndex=function(name){return UCML.Applet.DropDownButtonPerm.fields.indexOf(name)};UCML.Applet.DropDownButtonPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.Applet.CustomizeMenuPerm=function(vc){if(!window["appletButtonPerm"]){return null}var objList=[];try{this.data=BusinessData[vc.id+"CustomizeMenuPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"AllowModify");var visible=this.getValue(i,"AllowVisible");var menuid=this.getValue(i,"MenuId");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["menuid"]=menuid;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.CustomizeMenuPerm.fields=["RESP_AppletCustomizeMenuOID","AllowModify","AllowVisible","Caption","MenuId","AppletName","UCMLClass_FK","Applet_FK","UCML_RESPONSIBILITY_FK","NodeTypeDefine_FK","NodeTypeMenuItemsOID"];UCML.Applet.CustomizeMenuPerm.prototype.getFieldIndex=function(name){return UCML.Applet.CustomizeMenuPerm.fields.indexOf(name)};UCML.Applet.CustomizeMenuPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.Applet.CustomButtonPerm=function(vc){var objList=[];try{this.data=BusinessData[vc.id+"CustomButtonPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"AllowModify");var visible=this.getValue(i,"AllowVisible");var buttonid=this.getValue(i,"ButtonID");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["buttonid"]=buttonid;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.CustomButtonPerm.fields=["RESP_AppletCustomButtonOID","AllowModify","AllowVisible","Caption","ButtonType","AppletName","ButtonID","UCMLClass_FK","Applet_FK","UCML_RESPONSIBILITY_FK","AppletButton_FK"];UCML.Applet.CustomButtonPerm.prototype.getFieldIndex=function(name){return UCML.Applet.CustomButtonPerm.fields.indexOf(name)};UCML.Applet.CustomButtonPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.Applet.AppletPerm=function(vc){var objList=[];try{this.data=BusinessData[vc.dataTable.BPOName+"AppletPerm"];if(!this.data){this.data=window["appletPerm"]||[];return this.data}if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"AllowModify");var visible=this.getValue(i,"AllowVisible");var appletname=this.getValue(i,"AppletName");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["appletname"]=appletname;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.Applet.AppletPerm.fields=["RESP_AppletLinkOID","AppletName","Caption","AllowModify","AllowVisible","ClassName"];UCML.Applet.AppletPerm.prototype.getFieldIndex=function(name){return UCML.Applet.AppletPerm.fields.indexOf(name)};UCML.Applet.AppletPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};(function(){function ruleCheck(val,dataTable,columnName){var value=val;var objColumn=dataTable.getColumnByName(columnName);if(typeof ACColumnInputRule!="undefined"){for(var m=0;m<ACColumnInputRule.length;m++){if(objColumn.fieldName==ACColumnInputRule[m].FieldName&&dataTable.BCName==ACColumnInputRule[m].BCName){var inputParams=new Array;inputParams[inputParams.length]=value;if(ACColumnInputRule[m].ExParam1!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam2!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam3!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam4!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var result=ExecuteRule(ACColumnInputRule[m].RuleMethod,inputParams);result.PromptMode=ACColumnInputRule[m].PromptMode;return result}}}if(objColumn&&!UCML.isEmpty(value)&&(objColumn.RuleList!=null&&objColumn.RuleList.length>0)){for(var i=0;i<objColumn.RuleList.length;i++){var inputParams=new Array;inputParams[inputParams.length]=value;if(objColumn.RuleList[i].ExParam1!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam2!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam3!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam4!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var result=ExecuteRule(objColumn.RuleList[i].RuleMethod,inputParams);result.PromptMode=objColumn.RuleList[i].PromptMode;if(objColumn.RuleList[i].InputTip!=""){result.ReturnDescText=objColumn.RuleList[i].InputTip}if(i<objColumn.RuleList.length-1&&result.ReturnCode=="OK"){continue}else{return result}}}}function doRuleCheck(ctl,val,dataTable,columnName){var result=ruleCheck(val,dataTable,columnName);var tip=$(".validatebox-tip");if(tip){tip.each(function(){$(this).hide()})}if(result){if(result.ReturnCode!="OK"){if(result.PromptMode==0){var vctl=ctl.applet.getValiateControl(ctl);if(vctl){vctl.setTipMessage(result.ReturnDescText);vctl.showTip()}else{vctl=new UCML.Validatebox({dom:ctl.dom,id:UCML.id()});ctl.applet.setValiateControl(ctl.id,vctl);vctl.setTipMessage(result.ReturnDescText);vctl.showTip()}}else if(result.PromptMode==1){alert(result.ReturnDescText)}return false}else{if(result.PromptMode==0){var vctl=ctl.applet.getValiateControl(ctl);if(vctl){vctl.hideTip()}}}}else{var vctl=ctl.applet.getValiateControl(ctl);if(vctl){vctl.hideTip()}}return true}UCML.Edit=function(id){this.controls=new Array;this.fieldNameControls={};this.valiateControls={};this.isToLabel=false;UCML.Edit.superclass.constructor.call(this,id)};UCML.extend(UCML.Edit,UCML.Applet,{ctype:"UCML.Edit",itemFirstText:UCML.Languge.DLLitemFirstText,editTableCols:3,showBCLink:true,onRender:function(){UCML.Edit.superclass.onRender.call(this);if(this.userDefineHTML==false){this.renderEditPanel()}if(this.haveScroll){this.el.css("overflow","auto")}else{this.el.css("overflow","hidden")}},renderEditPanel:function(){this.el.html("");var editPanel=$('<DIV style="WIDTH: 100%; HEIGHT: auto; OVERFLOW: hidden" id='+this.id+"editPanel  class=UCML-Header ></div>");var editTable=this.renderEditTable(this.editTableCols);editPanel.append(editTable);this.el.append(editPanel);editPanel.show();return editPanel},editTableStr:'<table style="width: 100%;" border="0" style="table-layout: fixed !important;display: table;" cellSpacing="0" cellPadding="0">{rows}</tbody>',editRowStr:"<tr>{cells}</tr>",editCellStr:'<td style="width:{width}%; text-align: right;" id="{fieldName}Label" class="UCML-LabelCell" noWrap=""><div id="{fieldName}LabelValue" class="UCML-LabelText">{caption}</div></td>'+'<td style="width:{width}%;" id="{fieldName}Cell" class="UCML-InputCell" noWrap="" >{input}</td>',renderEditTable:function(cols){var editTableTpl=new UCML.Template(this.editTableStr);var rowsStr=[];var rowCount=0;var clength=this.columns.length;var cellWidth=100/(cols*2);if(clength%cols==0){rowCount=parseInt(clength/cols)}else{rowCount=parseInt(clength/cols)+1}for(var i=0;i<rowCount;i++){var cellStr=[];var n=i*cols;var n1=n==0?0:n;var n2=n==0?cols-1:n+cols-1;for(var j=n1;j<=n2;j++){var editCellTpl=new UCML.Template(this.editCellStr);var inputStr="";var labelStr="";var fieldName="";var EditType="";var caption="";if(j>=0&&j<clength){fieldName=this.columns[j].fieldName;caption=this.columns[j].caption;EditType=this.columns[j].EditType;inputStr=this.getInputCell(EditType,fieldName);cellStr.add(editCellTpl.apply({input:inputStr,label:labelStr,fieldName:fieldName,caption:caption,width:cellWidth}))}else{cellStr.add(editCellTpl.apply({input:inputStr,label:labelStr,fieldName:fieldName,caption:caption,width:cellWidth}))}}var editRowTpl=new UCML.Template(this.editRowStr);rowsStr.add(editRowTpl.apply({cells:cellStr.join("")}))}return editTableTpl.apply({rows:rowsStr.join("")})},getInputCell:function(EditType,fieldName){var type=EditType.toLowerCase();switch(type){case"ucml.textbox":return'<input id="'+fieldName+'Edit" type="text" dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-inputframe" />';break;case"ucml.password ":return'<input id="'+fieldName+'Edit" type="password" dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-inputframe" />';break;case"ucml.textarea":return'<textarea id="'+fieldName+'Edit" style="width:400px; height:200px"  dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-textareaframe" />';break;case"ucml.checkbox":return'<input id="'+fieldName+'Edit" type="checkbox" dataFld="'+fieldName+'"  ctype="'+EditType+'"  />';break;case"ucml.radio":return'<input id="'+fieldName+'Edit" type="radio" dataFld="'+fieldName+'"  ctype="'+EditType+'"  />';break;case"ucml.hidden":return'<input id="'+fieldName+'Edit" type="hidden" dataFld="'+fieldName+'"  ctype="'+EditType+'"  />';break;case"ucml.image":return'<img id="'+fieldName+'Edit"  dataFld="'+fieldName+'"  ctype="'+EditType+'"  />';break;case"ucml.label":return'<div id="'+fieldName+'Edit"  dataFld="'+fieldName+'"  ctype="'+EditType+'" ></div>';break;case"ucml.bclink":return'<a id="'+fieldName+'Edit"  dataFld="'+fieldName+'"  ctype="'+EditType+'" ></a>';break;case"ucml.html":return'<textarea id="'+fieldName+'Edit" style="width:400px; height:200px"  dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-textareaframe" />';break;case"ucml.datebox":return'<input id="'+fieldName+'Edit" type="text" dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-inputframe" />';break;case"ucml.timebox":return'<input id="'+fieldName+'Edit" type="text" dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-inputframe" />';break;case"ucml.datetimebox":return'<input id="'+fieldName+'Edit" type="text" dataFld="'+fieldName+'"  ctype="'+EditType+'" class="ucml-inputframe" />';break;default:return'<input id="'+fieldName+'Edit" type="text" dataFld="'+fieldName+'"  ctype="UCML.TextBox" class="ucml-inputframe" />';break}},bindEvents:function(){UCML.Edit.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.dataTable)){if(this.IsJQMPage){var opts=this;var curPage=$("#"+this.id+"_Page");if(curPage.length>0&&curPage.css("display").toLowerCase()=="none"){$(document).on("pageinit","#"+this.id+"_Page",function(){opts.onAfterLoadData();opts.BusinessObject.on("onAfterLoadData",opts.onAfterLoadData,opts);opts.dataTable.on("OnRecordChange",opts.BCLoadData,opts);opts.dataTable.on("onLoad",opts.BCLoadData,opts);opts.dataTable.on("OnFieldChange",opts.onFieldChange,opts);opts.dataTable.on("OnValiate",opts.onValiate,opts)})}else{this.BusinessObject.on("onAfterLoadData",this.onAfterLoadData,this);this.dataTable.on("OnRecordChange",this.BCLoadData,this);this.dataTable.on("onLoad",this.BCLoadData,this);this.dataTable.on("OnFieldChange",this.onFieldChange,this);this.dataTable.on("OnValiate",this.onValiate,this)}}else{this.BusinessObject.on("onAfterLoadData",this.onAfterLoadData,this);this.dataTable.on("OnRecordChange",this.BCLoadData,this);this.dataTable.on("onLoad",this.BCLoadData,this);this.dataTable.on("OnFieldChange",this.onFieldChange,this);this.dataTable.on("OnValiate",this.onValiate,this)}}var $input=this.el.find("[dataFld][ctype!='UCML.Label']");UCML.on(this.el.find("[dataFld][ctype!='UCML.TextArea']"),"keydown",function(el,e){if(e.keyCode==13){e.preventDefault();var index=$input.index($("#"+e.target.id));if(index==-1){}else{if(index==$input.length-1){index=-1}var flag=0;for(var i=index;i<$input.length-1;i++){if($($input[i+1]).attr("disabled")!="disabled"){index=i;flag=1;break}}if(flag==0){for(var i=-1;i<$input.length-1;i++){if($($input[i+1]).attr("disabled")!="disabled"){index=i;break}}}$input[index+1].focus();if($($input[index+1]).attr("ctype")!="UCML.DropDownList"&&$($input[index+1]).attr("ctype")!="UCML.TextArea"){$input[index+1].select()}}}},this)},onMenuReady:function(){var menu=new UCML.Menu;if(this.enabledEdit){menu.addMenuItem("cmd_InsertRecord",UCML.Languge.DBInsertRecord);menu.addMenuItem("cmd_DeleteRecord",UCML.Languge.DBDeleteRecord);menu.addSeparator();menu.addMenuItem("cmd_Submit",UCML.Languge.DBSubmit);menu.addMenuItem("cmd_Cancel",UCML.Languge.DBCancel);menu.addMenuItem("cmd_Refresh",UCML.Languge.DBRefresh)}this.menu=menu},initControl:function(){var beginTime=new Date;var inputs=this.el.find("[ctype]").not("div.customctl>[ctype]");for(var i=0;i<inputs.length;i++){var ctl=this.addControl(inputs[i]);if(ctl){this.setControl(ctl)}}this.el.find(".UCML-Header").show()},setControl:function(ctl){ctl.fieldName=ctl.getAttribute("dataFld")||ctl.fieldName||"";ctl.BusinessObject=this.BusinessObject;if(!ctl.dataTable&&ctl.getAttribute("BCName")){ctl.dataTable=ctl.BusinessObject.getDataTableByBCName(ctl.getAttribute("BCName"))}if(ctl.dataTable&&ctl.fieldName){var bcCom=ctl.dataTable.getColumn(ctl.fieldName);if(bcCom&&bcCom.isCodeTable){if(ctl.isCodeTable==true&&UCML.isEmpty(this.codeTable)){ctl.codeTable=bcCom.codeTable;ctl.bindCodeTable()}else{ctl.isCodeTable=bcCom.isCodeTable;ctl.codeTable=bcCom.codeTable}}if(this.showBCLink&&bcCom.objBCLinkColl&&ctl.ctype=="UCML.Label"){var pBody=ctl.el.parents(".UCML-InputCell");this.controls.remove(ctl);ctl.destroy();var BCLinkConfig=bcCom.objBCLinkColl[0];var caption;if(BCLinkConfig.caption){caption=BCLinkConfig.caption}var BCLinkEL=$("<a ctype='UCML.BCLink' dataFld='"+ctl.fieldName+"'  linkIndex='0' href='javascript:void(0)' title='"+(BCLinkConfig.title||"")+"'  BCName='"+ctl.dataTable.BCName+"'  >"+(caption||"请选择")+"</a>");pBody.append(BCLinkEL);var ctl=this.addControl(BCLinkEL[0]);ctl.fieldName=ctl.getAttribute("dataFld")||ctl.fieldName||"";ctl.dataTable=ctl.BusinessObject.getDataTableByBCName(ctl.getAttribute("BCName"))}ctl.on("setValue",this.setControlValue,ctl);this.controls.add(ctl)}if(ctl.fieldName&&ctl.fieldName!=""){this.fieldNameControls[ctl.fieldName]=this.fieldNameControls[ctl.fieldName]||[];this.fieldNameControls[ctl.fieldName].add(ctl);var col=this.getColumn(ctl.fieldName);if(col&&!col.allowModify){ctl.disable()}if(col&&!col.display){ctl.hide();$("#"+ctl.fieldName+"LabelValue").hide()}if(col&&col.PromptText&&col.PromptText!=""){ctl.el.attr("title",col.PromptText)}}},setControlValue:function(value){var columnInfo=this.dataTable.getColumn(this.fieldName);doRuleCheck(this,value,this.dataTable,this.fieldName);this.dataTable.setFieldValue(this.fieldName,value,this)},setValiateControl:function(id,ctl){this.valiateControls[id]=ctl},getValiateControl:function(ctl){return this.valiateControls[ctl.id]},getValiateControlById:function(id){return this.valiateControls[id]},clearValiateControls:function(){for(var item in this.valiateControls){item.destroy()}this.valiateControls={}},onValiate:function(config){for(var i=0;i<this.controls.length;i++){if(this.controls[i].fieldName==config.fieldName){var vctl=this.getValiateControl(this.controls[i]);if(vctl){vctl.setTipMessage(config.msg);vctl.showTip()}else{vctl=new UCML.Validatebox({dom:this.controls[i].dom,id:UCML.id()});this.setValiateControl(this.controls[i].id,vctl);vctl.setTipMessage(config.msg);vctl.showTip()}return false}}}});UCML.Edit.prototype.init=function(){UCML.Edit.superclass.init.call(this);this.initControl()};UCML.Edit.prototype.onAfterLoadData=function(data){var opts=this;setTimeout(function(){opts.loadData(data)},1)};UCML.Edit.prototype.BCLoadData=function(data){if(this.BusinessObject&&this.BusinessObject.dataLoading==false){if(typeof IsHTMLPage!="undefined"&&IsHTMLPage==true&&typeof FUseMultiLanguage!="undefined"&&FUseMultiLanguage==true){if(this.moduleMode==0){var currTab=$("ul.tabs>li[ownervc='"+this.id+"']");if(currTab.length>0){currTab.find("span").text(getResourceData(this.id))}}else if(this.moduleMode==1||this.moduleMode==3){this.module.el.find(">div.panel-header>div.panel-title").text(getResourceData(this.id))}if($("#"+this.id+"Toolbar_Module").length>0){var vctbl=eval("ToolBar"+this.id);for(var i=0;i<vctbl.items.length;i++){if(typeof vctbl.items[i].text!="undefined"){vctbl.items[i].setText(getResourceData(vctbl.items[i].id))}}}for(var i=0;i<this.controls.length;i++){var label=$("label[for='"+this.controls[i].id+"']");if(label.length>0){label.text(getResourceData(this.id+"_"+this.controls[i].fieldName))}}this.el.find("input[ctype='UCML.MButton']").each(function(index,el){$(this).val(getResourceData(this.id)).button("refresh")});this.el.find("a[ctype='UCML.MToolBar']").each(function(index,el){if(this.id!=""){this.innerText=getResourceData(this.id)}})}return}var opts=this;setTimeout(function(){opts.loadData(data)},100)};UCML.Edit.prototype.loadData=function(data){for(var i=0;i<this.controls.length;i++){if(this.controls[i].setValueBack){if(this.controls[i].dataTable&&this.controls[i].fieldName){var value=this.dataTable.getFieldValue(this.controls[i].fieldName);this.controls[i].setValueBack(value);var vctl=this.getValiateControl(this.controls[i]);if(vctl){this.setValiateControl(this.controls[i].id,null);vctl.destroy()}}}}};UCML.Edit.prototype.clearData=function(){for(var i=0;i<this.controls.length;i++){if(this.controls[i].setValueBack){this.controls[i].setValueBack("");var vctl=this.getValiateControl(this.controls[i]);if(vctl){this.setValiateControl(this.controls[i].id,null);vctl.destroy()}}}};UCML.Edit.prototype.addControl=function(o){var el=$(UCML.getDom(o));var BCName=el.attr("BCName")||(this.dataTable?this.dataTable.BCName:this.el.attr("BCName"));var ctype=el.attr("ctype")||"UCML.Input";if(this.isToLabel==true)ctype="UCML.EditLabel";var ctl;if(ctype&&BCName){el.attr("BCName",BCName);el.attr("VCName",this.id);ctl=UCML.create({el:el,BusinessObject:this.BusinessObject,disabled:this.disabled,isSetProperties:true,applet:this},ctype)}return ctl};UCML.Edit.prototype.setToLabel=function(val){this.isToLabel=val};UCML.Edit.prototype.deleteRecord=function(){this.dataTable.Delete();this.loadData()};UCML.Edit.prototype.insertRecord=function(){this.dataTable.Insert();this.loadData()};UCML.Edit.prototype.updateRecord=function(){this.loadData()};UCML.Edit.prototype.onFieldChange=function(e,sender){var controls=this.fieldNameControls[e.fieldName]||[];for(var i=0;i<controls.length;i++){if(controls[i]!=sender&&controls[i].getValue()!=e.value){controls[i].setValue(e.value,false);doRuleCheck(controls[i],e.value,controls[i].dataTable,controls[i].fieldName)}}};UCML.Edit.prototype.setEnabledEditByFieldName=function(val,fieldName){if(fieldName){var controls=this.fieldNameControls[fieldName]||[];for(var i=0;i<controls.length;i++){if(val==true){controls[i].enable()}else{controls[i].disable()}}}};UCML.Edit.prototype.setEnabledEdit=function(val,fieldName){UCML.Edit.superclass.setEnabledEdit(val);if(fieldName){this.setEnabledEditByFieldName(val,fieldName)}else{for(var i=0;i<this.controls.length;i++){if(val==true){this.controls[i].enable()}else{this.controls[i].disable()}}}}})();UCML.EditList=function(id){this.controls=new Array;this.fieldEvent={};this.fieldNameControls={};this.valiateControls={};this.isToLabel=false;this.editrecordcount=0;UCML.EditList.superclass.constructor.call(this,id)};UCML.extend(UCML.EditList,UCML.Applet,{ctype:"UCML.EditList",showBtn:true,itemFirstText:UCML.Languge.DLLitemFirstText,btnList:null,showCollapse:true,onRender:function(){UCML.EditList.superclass.onRender.call(this);this.editPanel=this.el.find("#"+this.id+"EditPanel");if(this.haveScroll){this.el.css("overflow","auto")}else{this.el.css("overflow","hidden")}this.currentCls=this.editPanel.attr("class")},init:function(){UCML.EditList.superclass.init.call(this);this.setTemplate()},bindEvents:function(){UCML.EditList.superclass.bindEvents.call(this);var opts=this;if(!UCML.isEmpty(this.dataTable)){this.BusinessObject.on("onAfterLoadData",this.loadData,this);this.dataTable.on("OnFieldChange",this.onFieldChange,this);this.dataTable.on("OnAfterInsert",this.addRow,this);this.dataTable.on("OnAfterDelete",this.delRow,this)}this.el.on("click","div.panel-tool-collapse",function(){var curr=$(this);curr.toggleClass("panel-tool-expand");curr.parent().siblings(":not(.panel-title)").toggle()});this.el.on("click",".add",function(e){var panelEl=$(this).parents(".editlist-panel");if(panelEl.length>0){opts.dataTable.LocateOID(panelEl.attr("OID"))}opts.insertAfterCurrent=true;opts.currentPanel=panelEl;opts.dataTable.Insert();opts.insertAfterCurrent=false});this.el.on("click",".delete",function(e){var panelEl=$(this).parents(".editlist-panel");if(panelEl.length>0){opts.dataTable.LocateOID(panelEl.attr("OID"));opts.dataTable.Delete()}})},onMenuReady:function(){var menu=new UCML.Menu;if(this.enabledEdit){menu.addMenuItem("cmd_InsertRecord",UCML.Languge.DBInsertRecord);menu.addMenuItem("cmd_DeleteRecord",UCML.Languge.DBDeleteRecord);menu.addSeparator();menu.addMenuItem("cmd_Submit",UCML.Languge.DBSubmit);menu.addMenuItem("cmd_Cancel",UCML.Languge.DBCancel);menu.addMenuItem("cmd_Refresh",UCML.Languge.DBRefresh)}this.menu=menu},setControlValue:function(value){var panelEl=this.el.parents(".editlist-panel");if(panelEl.length>0&&panelEl.attr("OID")!=this.dataTable.getOID()){this.dataTable.LocateOID(panelEl.attr("OID"))}this.dataTable.setFieldValue(this.fieldName,value,this)}});UCML.EditList.prototype.SetFieldEvent=function(eventName,fn,fieldName){this.fieldEvent[fieldName]={eventName:eventName,fn:fn};for(var i=0;i<this.controls.length;i++){var ctl=this.controls[i];if(ctl.fieldName==fieldName){ctl.on(eventName,fn,ctl)}}};UCML.EditList.prototype.loadData=function(data){var recordCount=this.dataTable.getRecordCount();this.editrecordcount=recordCount;if(recordCount>0){var editliststr="";this.el.html("");for(var i=0;i<recordCount;i++){this.dataTable.SetIndexNoEvent(i);var editTableTpl=new UCML.Template(this.editTableStr);var editTableTplstr=editTableTpl.apply(this.getTemplateObj(i));var editTableTplEl=$('<div id="'+this.id+"EditPanel_el"+i+'"></div>');editTableTplEl.html(editTableTplstr);editTableTplEl.attr("OID",this.dataTable.getOID());editTableTplEl.addClass(this.currentCls);editTableTplEl.addClass("editlist-panel");if(this.showBtn){this.renderBtn(editTableTplEl)}this.el.append(editTableTplEl);if(this.showCollapse)this.renderCollapse(editTableTplEl);if(this.showTitle){if(this.customTitle){this.renderTitle(editTableTplEl,this.customTitle())}else if(this.titleField&&this.titleField!=""){this.renderTitle(editTableTplEl,this.dataTable.getFieldValue(this.titleField))}}this.initControl(editTableTplEl)}this.dataTable.SetIndexNoEvent(0)}else{var editTableTplEl=this.el.find("#"+this.id+"EditPanel");editTableTplEl.addClass(this.currentCls);editTableTplEl.addClass("editlist-panel");if(this.showBtn){this.renderBtn(editTableTplEl)}this.el.append(editTableTplEl);if(this.showCollapse)this.renderCollapse(editTableTplEl);if(this.showTitle){if(this.customTitle){this.renderTitle(editTableTplEl,this.customTitle())}else if(this.titleField&&this.titleField!=""){this.renderTitle(editTableTplEl,this.dataTable.getFieldValue(this.titleField))}}this.initControl(editTableTplEl)}};UCML.EditList.prototype.renderTitle=function(editpanel,title){if(IsHTMLPage&&(BPOIsJQMPage||this.IsJQMPage)){if(editpanel.find("section.editlist-title").length>0){editpanel.find("section.editlist-title").append(title)}else{var str='<section class="editlist-title">'+title+"</section>";editpanel.prepend(str)}}else{var str='<div class="panel-title" style="cursor: auto;position:absolute;top:7px;left:10px;">'+title+"</div>";editpanel.append(str)}};UCML.EditList.prototype.renderCollapse=function(editpanel){var str='<div class="panel-tool"><div class="panel-tool-collapse '+(this.fCollapsed?"panel-tool-expand":"")+'"><span class="ace-icon ep ep-chevron-up"></span><span class="ace-icon ep ep-chevron-down"></span></div></div>';editpanel.append(str);if(this.fCollapsed){editpanel.children(":not(.panel-tool)").toggle()}};UCML.EditList.prototype.renderBtn=function(editpanel){if(IsHTMLPage&&(BPOIsJQMPage||this.IsJQMPage)){if(this.btnList!=null){var str='<section class="editlist-title">';for(var i=0;i<this.btnList.length;i++){str+='<a onclick="'+this.btnList[i].fn+'" class="btn '+this.btnList[i].cls+'">'+this.btnList[i].text+"</a>"}str+="&nbsp;</section>";editpanel.prepend(str)}else{var str='<section class="editlist-title">';if(this.dataTable.EnabledDelete){str+="<a class='delete'>删除</a>"}if(this.dataTable.EnabledAppend){str+="<a class='add'>添加</a>"}str+="&nbsp;</section>";editpanel.prepend(str)}}else{if(this.btnList!=null){var btnstr='<div align="center" class="btn_outer">';for(var i=0;i<this.btnList.length;i++){btnstr+='<input type="button" value="'+this.btnList[i].text+'" onclick="'+this.btnList[i].fn+'" class="btn '+this.btnList[i].cls+'">'}editpanel.append(btnstr)}else{var btnstr='<div align="center" class="btn_outer">';if(this.dataTable.EnabledAppend){btnstr+='<input type="button" value="新增" class="btn add">'}if(this.dataTable.EnabledDelete){btnstr+='<input type="button" value="删除" class="btn delete">'}btnstr+="</div>";editpanel.append(btnstr)}}};UCML.EditList.prototype.initControl=function(editpanel){var beginTime=new Date;var inputs=editpanel.find("[ctype]");for(var i=0;i<inputs.length;i++){var ctl=this.addControl(inputs[i]);if(ctl){this.setControl(ctl);if(ctl.dataTable&&ctl.fieldName){if(this.fieldEvent[ctl.fieldName]){ctl.on(this.fieldEvent[ctl.fieldName].eventName,this.fieldEvent[ctl.fieldName].fn,ctl)}var value=this.dataTable.getFieldValue(ctl.fieldName);ctl.setValue(value,false,true)}}}};UCML.EditList.prototype.setControl=function(ctl){ctl.fieldName=ctl.getAttribute("dataFld")||ctl.fieldName||"";ctl.BusinessObject=this.BusinessObject;if(!ctl.dataTable&&ctl.getAttribute("BCName")){ctl.dataTable=ctl.BusinessObject.getDataTableByBCName(ctl.getAttribute("BCName"))}if(ctl.dataTable&&ctl.fieldName){var bcCom=ctl.dataTable.getColumn(ctl.fieldName);if(bcCom&&bcCom.isCodeTable){if(ctl.isCodeTable==true&&UCML.isEmpty(this.codeTable)){ctl.codeTable=bcCom.codeTable;ctl.bindCodeTable()}else{ctl.isCodeTable=bcCom.isCodeTable;ctl.codeTable=bcCom.codeTable}}if(this.showBCLink&&bcCom.objBCLinkColl&&ctl.ctype=="UCML.Label"){var pBody=ctl.el.parents(".UCML-InputCell");this.controls.remove(ctl);ctl.destroy();var BCLinkConfig=bcCom.objBCLinkColl[0];var caption;if(BCLinkConfig.caption){caption=BCLinkConfig.caption}var BCLinkEL=$("<a ctype='UCML.BCLink' dataFld='"+ctl.fieldName+"'  linkIndex='0' href='javascript:void(0)' title='"+(BCLinkConfig.title||"")+"'  BCName='"+ctl.dataTable.BCName+"'  >"+(caption||"请选择")+"</a>");pBody.append(BCLinkEL);var ctl=this.addControl(BCLinkEL[0]);ctl.fieldName=ctl.getAttribute("dataFld")||ctl.fieldName||"";ctl.dataTable=ctl.BusinessObject.getDataTableByBCName(ctl.getAttribute("BCName"))}ctl.on("setValue",this.setControlValue,ctl);this.controls.add(ctl)}if(ctl.fieldName&&ctl.fieldName!=""){this.fieldNameControls[ctl.fieldName]=this.fieldNameControls[ctl.fieldName]||[];this.fieldNameControls[ctl.fieldName].add(ctl);var col=this.getColumn(ctl.fieldName);if(col&&!col.allowModify){ctl.disable()}if(col&&!col.display){ctl.hide();$("#"+ctl.fieldName+"LabelValue").hide()}if(col&&col.PromptText&&col.PromptText!=""){ctl.el.attr("title",col.PromptText)}}};UCML.EditList.prototype.addControl=function(o){var el=$(UCML.getDom(o));var BCName=el.attr("BCName")||(this.dataTable?this.dataTable.BCName:this.el.attr("BCName"));var ctype=el.attr("ctype")||"UCML.Input";var ctl;if(ctype&&BCName){el.attr("BCName",BCName);el.attr("VCName",this.id);ctl=UCML.create({el:el,BusinessObject:this.BusinessObject,
disabled:this.disabled,isSetProperties:true,applet:this},ctype)}if(typeof IsHTMLPage=="undefined"||typeof IsHTMLPage!="undefined"&&IsHTMLPage==false&&el[0].tagName.toLowerCase()!="div"&&el[0].tagName.toLowerCase()!="select"||el[0].tagName.toLowerCase()=="select"&&el.hasClass("UCML-DropDownList")){el.height(el.outerHeight()>0?el.outerHeight():21)}return ctl};UCML.EditList.prototype.getTemplateObj=function(index){var obj={};for(var i=0;i<this.controlsid.length;i++){obj["_id"+i]=this.controlsid[i].id+"_el"+index}return obj};UCML.EditList.prototype.setTemplate=function(){var templateel=this.el.find(">div");this.editTableStr=templateel.html();this.controlsid=[];var opts=this;templateel.find("[id]").each(function(index,el){opts.controlsid.add(this);opts.editTableStr=opts.editTableStr.replace('id="'+$(this).attr("id")+'"','id="{_id'+index+'}"')})};UCML.EditList.prototype.addRow=function(panelEl){if(this.dataTable.getRecordCount()==1){this.insertAfterCurrent=false}if(this.insertAfterCurrent){panelEl=this.currentPanel}if(this.dataTable.getRecordCount()==1){var orgEditPanel=this.el.find("#"+this.id+"EditPanel");if(orgEditPanel.length>0){orgEditPanel.attr("OID",this.dataTable.getOID());return}}var editTableTpl=new UCML.Template(this.editTableStr);var editTableTplstr=editTableTpl.apply(this.getTemplateObj(this.editrecordcount));var editTableTplEl=$('<div id="'+this.id+"EditPanel_el"+this.editrecordcount+'" ></div>');editTableTplEl.html(editTableTplstr);editTableTplEl.attr("OID",this.dataTable.getOID());editTableTplEl.addClass(this.currentCls);editTableTplEl.addClass("editlist-panel");if(this.showBtn){this.renderBtn(editTableTplEl)}if(this.showTitle){if(this.customTitle){this.renderTitle(editTableTplEl,this.customTitle())}else if(this.titleField&&this.titleField!=""){this.renderTitle(editTableTplEl,this.dataTable.getFieldValue(this.titleField))}}if(panelEl&&panelEl.length>0){panelEl.after(editTableTplEl)}else{this.el.append(editTableTplEl)}this.initControl(editTableTplEl);this.editrecordcount=this.editrecordcount+1};UCML.EditList.prototype.delRow=function(deleteOID){var targetPanelEl=this.el.find("div.editlist-panel[OID='"+deleteOID+"']");if(targetPanelEl.length>0){targetPanelEl.remove()}if(this.el.find("div.editlist-panel").length==0){var editliststr="";this.el.html("");var editTableTpl=new UCML.Template(this.editTableStr);var editTableTplstr=editTableTpl.apply(this.getTemplateObj(0));var editTableTplEl=$('<div id="'+this.id+'EditPanel_el0"></div>');editTableTplEl.html(editTableTplstr);editTableTplEl.addClass(this.currentCls);editTableTplEl.addClass("editlist-panel");if(this.showBtn){this.renderBtn(editTableTplEl)}this.el.append(editTableTplEl);if(this.showCollapse)this.renderCollapse(editTableTplEl);if(this.showTitle){if(this.customTitle){this.renderTitle(editTableTplEl,this.customTitle())}else if(this.titleField&&this.titleField!=""){this.renderTitle(editTableTplEl,this.dataTable.getFieldValue(this.titleField))}}this.initControl(editTableTplEl)}};UCML.EditList.prototype.onFieldChange=function(e,sender){var controls=this.fieldNameControls[e.fieldName]||[];var recIndex=this.dataTable.getRecordIndex();if(recIndex<=controls.length){if(controls[recIndex]!=sender&&controls[recIndex].getValue()!=e.value){controls[recIndex].setValue(e.value,false)}}};UCML.Query=function(id){this.controls=new Array;this.MTVFieldList=[];this.queryControl=[];UCML.Query.superclass.constructor.call(this,id)};UCML.extend(UCML.Query,UCML.Applet,{ctype:"UCML.Query",itemFirstText:"全部",init:function(){UCML.Query.superclass.init.call(this);this.initControl()},bindEvents:function(){UCML.Query.superclass.bindEvents.call(this);UCML.on(this.el.find("[ctype]"),"blur",this.validateSQL,this);this.BusinessObject.on("onAfterLoadData",this.onAfterLoadData,this)},onAfterLoadData:function(){if(this.BusinessObject.dataLoading==true){if(typeof IsHTMLPage!="undefined"&&IsHTMLPage==true&&typeof FUseMultiLanguage!="undefined"&&FUseMultiLanguage==true){if(this.moduleMode==0){var currTab=$("ul.tabs>li[ownervc='"+this.id+"']");if(currTab.length>0){currTab.find("span").text(getResourceData(this.id))}}else if(this.moduleMode==1||this.moduleMode==3){this.module.el.find(">div.panel-header>div.panel-title").text(getResourceData(this.id))}if($("#"+this.id+"Toolbar_Module").length>0){var vctbl=eval("ToolBar"+this.id);for(var i=0;i<vctbl.items.length;i++){if(typeof vctbl.items[i].text!="undefined"){vctbl.items[i].setText(getResourceData(vctbl.items[i].id))}}}for(var i=0;i<this.controls.length;i++){var label=$("label[for='"+this.controls[i].id+"']");if(label.length>0){label.text(getResourceData(this.id+"_"+this.controls[i].fieldName))}}this.el.find("input[ctype='UCML.MButton']").each(function(index,el){$(this).val(getResourceData(this.id)).button("refresh")});this.el.find("a[ctype='UCML.MToolBar']").each(function(index,el){if(this.id!=""){this.innerText=getResourceData(this.id)}})}}},initControl:function(){var inputs=this.el.find("[ctype]");for(var i=0;i<inputs.length;i++){var ctl=this.addControl(inputs[i]);if(ctl){this.setControl(ctl)}}$("#"+this.id+"EditPanel").show()},setControl:function(ctl){ctl.fieldName=ctl.getAttribute("dataFld")||ctl.fieldName||"";ctl.defaultM=ctl.getAttribute("defaultM")||ctl.defaultM||"";ctl.defaultV=ctl.getAttribute("defaultV")||ctl.defaultV||"";if(ctl.defaultM){if(ctl.defaultM=="1"){ctl.setValue(ctl.defaultV)}else if(ctl.defaultM=="2"&&ctl.defaultV&&window[ctl.defaultV]){var val=window[ctl.defaultV].call(window,ctl,this);ctl.setValue(val)}}if(ctl.fieldName&&ctl.fieldName!=""){var bcCom=this.dataTable.getColumn(ctl.fieldName);if(bcCom&&bcCom.isCodeTable){if(ctl.isCodeTable==true&&UCML.isEmpty(this.codeTable)){ctl.codeTable=bcCom.codeTable;ctl.bindCodeTable()}}var col=this.getColumn(ctl.fieldName);if(col&&!col.allowModify){ctl.disable()}}},addControl:function(o){var el=$(UCML.getDom(o));var BCName=el.attr("BCName")||(this.dataTable?this.dataTable.BCName:this.el.attr("BCName"));var ctype=el.attr("ctype")||"UCML.Input";if(ctype&&BCName){el.attr("BCName",BCName);el.attr("VCName",this.id);if(ctype=="UCML.BCLinkBox"||ctype=="UCML.BCLinkBoxForGrid"){el.attr("controlValue","true")}var opt=UCML.create({el:el,BusinessObject:this.BusinessObject,isSetData:false,disabled:this.disabled,isSetProperties:true,applet:this},ctype);this.controls.add(opt);if(typeof IsHTMLPage=="undefined"||typeof IsHTMLPage!="undefined"&&IsHTMLPage==false&&el[0].tagName.toLowerCase()!="div"&&el[0].tagName.toLowerCase()!="select"||el[0].tagName.toLowerCase()=="select"&&(el.hasClass("UCML-DropDownList")||el.hasClass("ucml-inputframe"))||typeof IsHTMLPage!="undefined"&&IsHTMLPage==true&&el[0].tagName.toLowerCase()!="div"&&el[0].tagName.toLowerCase()!="select"){el.height(el.outerHeight()>0?el.outerHeight():21)}return opt}},onMenuReady:function(){var menu=new UCML.Menu;if(this.enabledEdit){menu.addMenuItem("cmd_Query","查询");menu.addSeparator();menu.addMenuItem("cmd_QueryCancel","清空条件")}this.menu=menu},clearQuery:function(nStartPos,nRecords){this.clearData();nStartPos=nStartPos==undefined?0:nStartPos;nRecords=nRecords==undefined?this.dataTable.getDefaultPageCount():nRecords;this.dataTable.theSQLCondi="";this.dataTable.getData(nStartPos,nRecords)},clearQueryForSP:function(nStartPos,nRecords){this.clearData();nStartPos=nStartPos==undefined?0:nStartPos;nRecords=nRecords==undefined?this.dataTable.getDefaultPageCount():nRecords;this.dataTable.theFieldList="";this.dataTable.theValueList="";this.dataTable.theCondiIndentList="";this.dataTable.getData(nStartPos,nRecords)},GetQuerySQL:function(){var SQLWhere="";var j=0;var DataBaseType=this.dataTable.DataBaseType==undefined?"":this.dataTable.DataBaseType;for(var i=0;i<this.columns.length;i++){var objColumn=this.columns[i];var value="";if(objColumn.InnerLinkComp=="true"){value=this.BuildMTVWhere(objColumn);if(j==0){if(value!=""){SQLWhere=SQLWhere+" "+objColumn.leftBracket+value+objColumn.rightBracket+" "}else{SQLWhere=SQLWhere+" "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}else{if(value!=""){SQLWhere=SQLWhere+" "+objColumn.logicConnect+" "+objColumn.leftBracket+value+objColumn.rightBracket+" "}else{SQLWhere=SQLWhere+" "+objColumn.logicConnect+" "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}j++;continue}if(this.columns[i].display==false)continue;var columnInfo=this.columns[i];var bcColumn=this.dataTable.getColumn(columnInfo.fieldName);var value="";if(columnInfo.controlID){value=window[columnInfo.controlID].getValue()}else{value=this.findFieldValue(columnInfo.fieldName)||""}if(bcColumn.fieldType=="UCMLKey"&&value==this.dataTable.getEmptyGuid())value="";var tableName=this.dataTable.TableName;var fieldName=objColumn.fieldName;if(bcColumn.fieldKind==0){tableName=this.dataTable.TableName;j++}else if(bcColumn.fieldKind==2){fieldName=bcColumn.lookupResultField;tableName="al"+bcColumn.foreignKeyField;j++}else if(bcColumn.fieldKind==10){fieldName=bcColumn.lookupResultField;tableName="al"+bcColumn.foreignKeyField;j++}else if(bcColumn.fieldKind==5&&bcColumn.QueryRefColumn){fieldName=bcColumn.QueryRefColumn;var s=fieldName.split(".");if(s.length>1){tableName=s[0];fieldName=s[1];j++}else{continue}}else{continue}if(j==1){if(value!=""){if(objColumn.MutiValueCol||objColumn.mutiValueCol){SQLWhere=SQLWhere+" "+objColumn.leftBracket+getMutiValueCol(tableName+"."+fieldName,objColumn,value)+objColumn.rightBracket+" "}else{value=getFormatValue(value);SQLWhere=SQLWhere+" "+objColumn.leftBracket+tableName+"."+fieldName+" "+objColumn.operationIndent+" "+value+objColumn.rightBracket+" "}}else{SQLWhere=SQLWhere+" "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}else{if(value!=""){if(objColumn.MutiValueCol||objColumn.mutiValueCol){SQLWhere=SQLWhere+" "+objColumn.logicConnect+" "+objColumn.leftBracket+getMutiValueCol(tableName+"."+fieldName,objColumn,value)+objColumn.rightBracket+" "}else{value=getFormatValue(value);SQLWhere=SQLWhere+" "+objColumn.logicConnect+" "+objColumn.leftBracket+tableName+"."+fieldName+" "+objColumn.operationIndent+" "+value+objColumn.rightBracket+" "}}else{SQLWhere=SQLWhere+" "+objColumn.logicConnect+" "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}}for(var i=0;i<this.queryControl.length;i++){var value=window[this.queryControl[i].controlId].getValue();var name=this.queryControl[i].name;var operationIndent=this.queryControl[i].operationIndent||"=";var logicConnect=this.queryControl[i].logicConnect||" and ";if(value!=""){if(operationIndent=="like"){var likeMode=this.queryControl[i].likeMode==undefined?0:this.queryControl[i].likeMode;if(likeMode==1){if(j>0){SQLWhere=SQLWhere+" "+logicConnect+" "+name+" "+operationIndent+"  '%"+value+"'"}else{SQLWhere=SQLWhere+" "+name+" "+operationIndent+"  '%"+value+"'"}}else if(likeMode==2){if(j>0){SQLWhere=SQLWhere+" "+logicConnect+" "+name+" "+operationIndent+"  '"+value+"%'"}else{SQLWhere=SQLWhere+" "+name+" "+operationIndent+"  '"+value+"%'"}}else{if(j>0){SQLWhere=SQLWhere+" "+logicConnect+" "+name+" "+operationIndent+"  '%"+value+"%'"}else{SQLWhere=SQLWhere+" "+name+" "+operationIndent+"  '%"+value+"%'"}}}else{if(j>0){SQLWhere=SQLWhere+" "+logicConnect+" "+name+" "+operationIndent+"  '"+value+"'"}else{SQLWhere=SQLWhere+" "+name+" "+operationIndent+"  '"+value+"'"}}j++}}function getMutiValueCol(fieldName,objColumn,value){value=value.replace(/\'/g,"");var values=value.split(";");var operationIndent=objColumn.operationIndent||"=";var logicConnect=" or ";var sql="";if(values.length>0){sql=" ( ";for(var i=0;i<values.length;i++){if(i>0){sql+=" "+logicConnect+" "}sql+=fieldName+" "+objColumn.operationIndent+" "+getFormatValue(values[i])}sql+=" )"}return sql}function getFormatValue(value){if(bcColumn.fieldType=="Float"||bcColumn.fieldType=="Double"||bcColumn.fieldType=="Money"||bcColumn.fieldType=="Numeric"||bcColumn.fieldType=="Long"||bcColumn.fieldType=="Byte"||bcColumn.fieldType=="Short"||bcColumn.fieldType=="Int"){}else if(DataBaseType=="ORACLE"&&(bcColumn.fieldType=="Date"||bcColumn.fieldType=="DateTime"||bcColumn.fieldType=="Time")){if(value!=""){if(bcColumn.fieldType=="Date"){value="to_date('"+value+"','yyyy-mm-dd')"}else if(bcColumn.fieldType=="DateTime"){value="to_date('"+value+"','yyyy-mm-dd hh24:mi:ss')"}else if(bcColumn.fieldType=="Time"){value="to_date('"+value+"','hh24:mi:ss')"}}}else{if(value!=""){if(objColumn.operationIndent=="Like"){value="'%"+value+"%'"}else{value="'"+value+"'"}}}return value}return SQLWhere},setCondiForSP:function(){var fieldArr=[],valueArr=[],condiIndentArr=[];var SQLWhere="";var j=0;var DataBaseType=this.dataTable.DataBaseType==undefined?"":this.dataTable.DataBaseType;for(var i=0;i<this.columns.length;i++){var objColumn=this.columns[i];if(this.columns[i].display==false)continue;var columnInfo=this.columns[i];var bcColumn=this.dataTable.getColumn(columnInfo.fieldName);var value="";if(columnInfo.controlID){value=window[columnInfo.controlID].getValue()}else{value=this.findFieldValue(columnInfo.fieldName)||""}var tableName=this.dataTable.TableName;var fieldName=objColumn.fieldName;if(bcColumn.fieldKind==0){tableName=this.dataTable.TableName;j++}else if(bcColumn.fieldKind==2){fieldName=bcColumn.lookupResultField;tableName="al"+bcColumn.foreignKeyField;j++}else if(bcColumn.fieldKind==10){fieldName=bcColumn.lookupResultField;tableName="al"+bcColumn.foreignKeyField;j++}else if(bcColumn.fieldKind==5&&bcColumn.QueryRefColumn){fieldName=bcColumn.QueryRefColumn;var s=fieldName.split(".");if(s.length>1){tableName=s[0];fieldName=s[1];j++}else{continue}}else{continue}if(j==1){if(value!=""){if(objColumn.MutiValueCol||objColumn.mutiValueCol){}else{value=getFormatValue(value);fieldArr.push(tableName+"."+fieldName);valueArr.push(value);condiIndentArr.push(objColumn.operationIndent)}}}else{if(value!=""){if(objColumn.MutiValueCol||objColumn.mutiValueCol){}else{value=getFormatValue(value);fieldArr.push(tableName+"."+fieldName);valueArr.push(value);condiIndentArr.push(objColumn.operationIndent)}}}}function getMutiValueCol(fieldName,objColumn,value){value=value.replace(/\'/g,"");var values=value.split(";");var operationIndent=objColumn.operationIndent||"=";var logicConnect=" or ";var sql="";if(values.length>0){sql=" ( ";for(var i=0;i<values.length;i++){if(i>0){sql+=" "+logicConnect+" "}sql+=fieldName+" "+objColumn.operationIndent+" "+getFormatValue(values[i])}sql+=" )"}return sql}function getFormatValue(value){if(bcColumn.fieldType=="Float"||bcColumn.fieldType=="Double"||bcColumn.fieldType=="Money"||bcColumn.fieldType=="Numeric"||bcColumn.fieldType=="Long"||bcColumn.fieldType=="Byte"||bcColumn.fieldType=="Short"||bcColumn.fieldType=="Int"){}else if(DataBaseType=="ORACLE"&&(bcColumn.fieldType=="Date"||bcColumn.fieldType=="DateTime"||bcColumn.fieldType=="Time")){if(value!=""){if(bcColumn.fieldType=="Date"){value="to_date('"+value+"','yyyy-mm-dd')"}else if(bcColumn.fieldType=="DateTime"){value="to_date('"+value+"','yyyy-mm-dd hh24:mi:ss')"}else if(bcColumn.fieldType=="Time"){value="to_date('"+value+"','hh24:mi:ss')"}}}else{if(value!=""){if(objColumn.operationIndent=="Like"){value="%"+value+"%"}else{}}}return value}this.dataTable.theFieldList=fieldArr.join(";");this.dataTable.theValueList=valueArr.join(";");this.dataTable.theCondiIndentList=condiIndentArr.join(";");if(this.dataTable.theFieldList!=""){this.dataTable.theFieldList+=";"}if(this.dataTable.theValueList!=""){this.dataTable.theValueList+=";"}if(this.dataTable.theCondiIndentList!=""){this.dataTable.theCondiIndentList+=";"}},ExecuteQuery:function(nStartPos,nRecords){nStartPos=nStartPos==undefined?0:nStartPos;nRecords=nRecords==undefined?this.dataTable.getDefaultPageCount():nRecords;this.dataTable.theSQLCondi=this.GetQuerySQL();this.dataTable.getData(nStartPos,nRecords)},ExecuteQueryForSP:function(nStartPos,nRecords){nStartPos=nStartPos==undefined?0:nStartPos;nRecords=nRecords==undefined?this.dataTable.getDefaultPageCount():nRecords;this.setCondiForSP();this.dataTable.getData(nStartPos,nRecords)},clearData:function(){for(var i=0;i<this.controls.length;i++){if(this.controls[i].setValue){this.controls[i].setValue("")}}},addQueryControl:function(name,controlId,operationIndent,logicConnect){var config={name:name,controlId:controlId,operationIndent:operationIndent,logicConnect:logicConnect};this.queryControl.add(config)},addQueryControlForLike:function(name,controlId,operationIndent,logicConnect,likeMode){var config={name:name,controlId:controlId,operationIndent:operationIndent,logicConnect:logicConnect,likeMode:likeMode};this.queryControl.add(config)},getQueryControl:function(){return this.queryControl},setQueryControl:function(value){this.queryControl=value},clearQueryControl:function(){this.queryControl=[]},findFieldValue:function(fieldName){for(var i=0;i<this.controls.length;i++){if(this.controls[i].fieldName==fieldName){return this.controls[i].getValue()}}return null},AddMTVField:function(fieldName,dataTable,valueField){var obj=new Object;obj.fieldName=fieldName;obj.dataTable=dataTable;obj.valueField=valueField;this.MTVFieldList[this.MTVFieldList.length]=obj},BuildMTVWhere:function(objColumn){var MTVFieldList=this.MTVFieldList;var SQLWhere="";for(var i=0;i<MTVFieldList.length;i++){if(objColumn.fieldName==MTVFieldList[i].fieldName){var tableName=this.dataTable.TableName;if(objColumn.fieldKind==0){tableName=this.dataTable.TableName}else if(objColumn.fieldKind==2){tableName="al"+objColumn.foreignKeyField}else if(objColumn.fieldKind==10){tableName="al"+objColumn.foreignKeyField}else{break}var dt=MTVFieldList[i].dataTable;for(var n=0;n<dt.getRecordCount();n++){dt.SetIndexNoEvent(n);var value=dt.getFieldValue(MTVFieldList[i].valueField);if(value==null||value==undefined)value="";if(objColumn.fieldType=="Float"||objColumn.fieldType=="Double"||objColumn.fieldType=="Money"||objColumn.fieldType=="Numeric"||objColumn.fieldType=="Long"||objColumn.fieldType=="Byte"||objColumn.fieldType=="Short"||objColumn.fieldType=="Int"){}else{if(value!=""){if(objColumn.operationIndent=="Like"){value="'%"+value+"%'"}else{value="'"+value+"'"}}}if(n==0){if(value!=""){SQLWhere=SQLWhere+" "+objColumn.leftBracket+tableName+"."+objColumn.fieldName+" "+objColumn.operationIndent+" "+value+objColumn.rightBracket+" "}else{SQLWhere=SQLWhere+" "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}else{if(value!=""){SQLWhere=SQLWhere+" OR "+objColumn.leftBracket+tableName+"."+objColumn.fieldName+" "+objColumn.operationIndent+" "+value+objColumn.rightBracket+" "}else{SQLWhere=SQLWhere+" OR "+objColumn.leftBracket+"1=1"+objColumn.rightBracket+" "}}}break}}if(SQLWhere!="")return"("+SQLWhere+")";else return""}});UCML.Query.prototype.validateSQL=function(el,e){this.fireEvent("blur",e);var target=UCML.isElement(e)?e:e.target;var $target=$(target);var reg=/select|update|delete|exec|count|'|"|=|>|<|%/i;if(reg.test($target.val())){alert("参数非法、请勿输入特殊字符和SQL关键字！");$target.focus()}};(function($){$.fn.UCML_resizable=function(options){function resize(e){var resizeData=e.data;var options=$.data(resizeData.target,"resizable").options;if(resizeData.dir.indexOf("e")!=-1){var width=resizeData.startWidth+e.pageX-resizeData.startX;width=Math.min(Math.max(width,options.minWidth),options.maxWidth);resizeData.width=width}if(resizeData.dir.indexOf("s")!=-1){var height=resizeData.startHeight+e.pageY-resizeData.startY;height=Math.min(Math.max(height,options.minHeight),options.maxHeight);resizeData.height=height}if(resizeData.dir.indexOf("w")!=-1){resizeData.width=resizeData.startWidth-e.pageX+resizeData.startX;if(resizeData.width>=options.minWidth&&resizeData.width<=options.maxWidth){resizeData.left=resizeData.startLeft+e.pageX-resizeData.startX}}if(resizeData.dir.indexOf("n")!=-1){resizeData.height=resizeData.startHeight-e.pageY+resizeData.startY;if(resizeData.height>=options.minHeight&&resizeData.height<=options.maxHeight){resizeData.top=resizeData.startTop+e.pageY-resizeData.startY}}}function applySize(e){var resizeData=e.data;var target=resizeData.target;if($.boxModel==true){$(target).css({width:resizeData.width-resizeData.deltaWidth,height:resizeData.height-resizeData.deltaHeight,left:resizeData.left,top:resizeData.top})}else{$(target).css({width:resizeData.width,height:resizeData.height,left:resizeData.left,top:resizeData.top})}}function doDown(e){$.data(e.data.target,"resizable").options.onStartResize.call(e.data.target,e);return false}function doMove(e){resize(e);if($.data(e.data.target,"resizable").options.onResize.call(e.data.target,e)!=false){}return false}function doUp(e){resize(e,true);var doc=e.data.document||document;$(doc).unbind(".resizable");$.data(e.data.target,"resizable").options.onStopResize.call(e.data.target,e);return false}return this.each(function(){var opts=null;var state=$.data(this,"resizable");if(state){$(this).unbind(".resizable");opts=$.extend(state.options,options||{})}else{opts=$.extend({},$.fn.UCML_resizable.defaults,options||{})}if(opts.disabled==true){return}$.data(this,"resizable",{options:opts});var target=this;var doc=opts.document||document;$(this).bind("mousemove.resizable",{document:doc},onMouseMove).bind("mousedown.resizable",{document:doc},onMouseDown);function onMouseMove(e){var dir=getDirection(e);if(dir==""){$(target).css("cursor","default")}else{$(target).css("cursor",dir+"-resize")}}function onMouseDown(e){var dir=getDirection(e);if(dir=="")return;var data={target:this,dir:dir,startLeft:getCssValue("left"),startTop:getCssValue("top"),left:getCssValue("left"),top:getCssValue("top"),startX:e.pageX,startY:e.pageY,startWidth:$(target).outerWidth(),startHeight:$(target).outerHeight(),width:$(target).outerWidth(),height:$(target).outerHeight(),deltaWidth:$(target).outerWidth()-$(target).width(),deltaHeight:$(target).outerHeight()-$(target).height(),document:e.data.document};var doc=e.data.document;$(doc).bind("mousedown.resizable",data,doDown);$(doc).bind("mousemove.resizable",data,doMove);$(doc).bind("mouseup.resizable",data,doUp)}function getDirection(e){var dir="";var offset=$(target).offset();var width=$(target).outerWidth();var height=$(target).outerHeight();var edge=opts.edge;if(e.pageY>offset.top&&e.pageY<offset.top+edge){dir+="n"}else if(e.pageY<offset.top+height&&e.pageY>offset.top+height-edge){dir+="s"}if(e.pageX>offset.left&&e.pageX<offset.left+edge){dir+="w"}else if(e.pageX<offset.left+width&&e.pageX>offset.left+width-edge){dir+="e"}var handles=opts.handles.split(",");for(var i=0;i<handles.length;i++){var handle=handles[i].replace(/(^\s*)|(\s*$)/g,"");if(handle=="all"||handle==dir){return dir}}return""}function getCssValue(css){var val=parseInt($(target).css(css));if(isNaN(val)){return 0}else{return val}}})};$.fn.UCML_resizable.defaults={disabled:false,document:null,handles:"n, e, s, w, ne, se, sw, nw, all",minWidth:10,minHeight:10,maxWidth:1e4,maxHeight:1e4,edge:5,onStartResize:function(e){},onResize:function(e){},onStopResize:function(e){}}})(jQuery);(function($){function drag(e){var opts=$.data(e.data.target,"draggable").options;var dragData=e.data;var left=dragData.startLeft+e.pageX-dragData.startX;var top=dragData.startTop+e.pageY-dragData.startY;if(opts.deltaX!=null&&opts.deltaX!=undefined){left=e.pageX+opts.deltaX}if(opts.deltaY!=null&&opts.deltaY!=undefined){top=e.pageY+opts.deltaY}var doc=e.data.document||document;if(e.data.parnet!=doc.body){if($.boxModel==true){left+=$(e.data.parent).scrollLeft();top+=$(e.data.parent).scrollTop()}}if(opts.axis=="h"){dragData.left=left}else if(opts.axis=="v"){dragData.top=top}else{dragData.left=left;dragData.top=top}}function applyDrag(e){var opts=$.data(e.data.target,"draggable").options;var proxy=$.data(e.data.target,"draggable").proxy;if(proxy){proxy.css("cursor",opts.cursor)}else{proxy=$(e.data.target);$.data(e.data.target,"draggable").handle.css("cursor",opts.cursor)}proxy.css({left:e.data.left,top:e.data.top})}function doDown(e){var opts=$.data(e.data.target,"draggable").options;var droppables=$(".droppable").filter(function(){return e.data.target!=this}).filter(function(){var accept=$.data(this,"droppable").options.accept;if(accept){return $(accept).filter(function(){return this==e.data.target}).length>0}else{return true}});$.data(e.data.target,"draggable").droppables=droppables;var proxy=$.data(e.data.target,"draggable").proxy;if(!proxy){if(opts.proxy){if(opts.proxy=="clone"){proxy=$(e.data.target).clone().insertAfter(e.data.target)}else{proxy=opts.proxy.call(e.data.target,e.data.target)}$.data(e.data.target,"draggable").proxy=proxy}else{proxy=$(e.data.target)}}proxy.css("position","absolute");drag(e);applyDrag(e);opts.onStartDrag.call(e.data.target,e);return false}function doMove(e){drag(e);if($.data(e.data.target,"draggable").options.onDrag.call(e.data.target,e)!=false){applyDrag(e)}var source=e.data.target;$.data(e.data.target,"draggable").droppables.each(function(){var dropObj=$(this);var p2=$(this).offset();if(e.pageX>p2.left&&e.pageX<p2.left+dropObj.outerWidth()&&e.pageY>p2.top&&e.pageY<p2.top+dropObj.outerHeight()){if(!this.entered){$(this).trigger("_dragenter",[source,e]);this.entered=true}$(this).trigger("_dragover",[source,e])}else{if(this.entered){$(this).trigger("_dragleave",[source,e]);this.entered=false}}});return false}function doUp(e){drag(e);var proxy=$.data(e.data.target,"draggable").proxy;var opts=$.data(e.data.target,"draggable").options;if(opts.revert){if(checkDrop()==true){removeProxy();$(e.data.target).css({position:e.data.startPosition,left:e.data.startLeft,top:e.data.startTop})}else{if(proxy){proxy.animate({left:e.data.startLeft,top:e.data.startTop},function(){removeProxy()})}else{$(e.data.target).animate({left:e.data.startLeft,top:e.data.startTop},function(){$(e.data.target).css("position",e.data.startPosition)})}}}else{$(e.data.target).css({position:"absolute",left:e.data.left,top:e.data.top});removeProxy();checkDrop()}opts.onStopDrag.call(e.data.target,e);function removeProxy(){if(proxy){proxy.remove()}$.data(e.data.target,"draggable").proxy=null}function checkDrop(){var dropped=false;$.data(e.data.target,"draggable").droppables.each(function(){var dropObj=$(this);var p2=$(this).offset();if(e.pageX>p2.left&&e.pageX<p2.left+dropObj.outerWidth()&&e.pageY>p2.top&&e.pageY<p2.top+dropObj.outerHeight()){if(opts.revert){$(e.data.target).css({position:e.data.startPosition,left:e.data.startLeft,top:e.data.startTop})}$(this).trigger("_drop",[e.data.target]);dropped=true;this.entered=false}});return dropped}var doc=e.data.document||document;$(doc).unbind(".draggable");return false}$.fn.UCML_draggable=function(options){if(typeof options=="string"){switch(options){case"options":return $.data(this[0],"draggable").options;case"proxy":return $.data(this[0],"draggable").proxy;case"enable":return this.each(function(){$(this).UCML_draggable({disabled:false})});case"disable":return this.each(function(){$(this).UCML_draggable({disabled:true})})}}return this.each(function(){var opts;var state=$.data(this,"draggable");if(state){state.handle.unbind(".draggable");opts=$.extend(state.options,options)}else{opts=$.extend({},$.fn.UCML_draggable.defaults,options||{})}if(opts.disabled==true){$(this).css("cursor","default");return}var handle=null;if(typeof opts.handle=="undefined"||opts.handle==null){handle=$(this)}else{handle=typeof opts.handle=="string"?$(opts.handle,this):handle}$.data(this,"draggable",{options:opts,handle:handle});handle.bind("mousedown.draggable",{target:this,document:opts.document},onMouseDown);handle.bind("mousemove.draggable",{target:this,document:opts.document},onMouseMove);function onMouseDown(e){if(checkArea(e)==false)return;var position=$(e.data.target).position();var data={startPosition:$(e.data.target).css("position"),startLeft:position.left,startTop:position.top,left:position.left,top:position.top,startX:e.pageX,startY:e.pageY,target:e.data.target,parent:$(e.data.target).parent()[0],document:opts.document};var doc=e.data.document||document;$(doc).bind("mousedown.draggable",data,doDown);$(doc).bind("mousemove.draggable",data,doMove);$(doc).bind("mouseup.draggable",data,doUp)}function onMouseMove(e){if(checkArea(e)){$(this).css("cursor",opts.cursor)}else{$(this).css("cursor","default")}}function checkArea(e){var offset=$(handle).offset();var width=$(handle).outerWidth();var height=$(handle).outerHeight();var t=e.pageY-offset.top;var r=offset.left+width-e.pageX;var b=offset.top+height-e.pageY;var l=e.pageX-offset.left;return Math.min(t,r,b,l)>opts.edge}})};$.fn.UCML_draggable.defaults={proxy:null,revert:false,document:null,cursor:"move",deltaX:null,deltaY:null,handle:null,disabled:false,edge:0,axis:null,onStartDrag:function(e){},onDrag:function(e){},onStopDrag:function(e){}}})(jQuery);(function($){function init(target){$(target).addClass("droppable");$(target).bind("_dragenter",function(e,source,a){$.data(target,"droppable").options.onDragEnter.apply(target,[e,source,a])});$(target).bind("_dragleave",function(e,source,a){$.data(target,"droppable").options.onDragLeave.apply(target,[e,source,a])});$(target).bind("_dragover",function(e,source,a){$.data(target,"droppable").options.onDragOver.apply(target,[e,source,a])});$(target).bind("_drop",function(e,source){$.data(target,"droppable").options.onDrop.apply(target,[e,source])})}$.fn.UCML_droppable=function(options){options=options||{};return this.each(function(){var state=$.data(this,"droppable");if(state){$.extend(state.options,options)}else{init(this);$.data(this,"droppable",{options:$.extend({},$.fn.UCML_droppable.defaults,options)})}})};$.fn.UCML_droppable.defaults={accept:null,onDragEnter:function(e,source){},onDragOver:function(e,source){},onDragLeave:function(e,source){},onDrop:function(e,source){}};$.fn.resizable=$.fn.UCML_resizable;$.fn.draggable=$.fn.UCML_draggable;$.fn.droppable=$.fn.UCML_droppable})(jQuery);UCML.DataGrid=function(id){this.frozenColumns=new Array;this.notfrozenColumns=new Array;this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellkeydown","cellmousedown","rowmousedown","headermousedown","groupmousedown","containermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","groupclick","groupdblclick","containerclick","containerdblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","groupcontextmenu","containercontextmenu","bodyscroll","columnresize","sortchange","groupchange","beginedit","beforebeginedit","fieldchange","endedit","beforerowrender","afterrowrender","checkchange","aftercheckchange","checkChange");this.checkOID=[];this.checkKeys=[];this.checkRecord=new UCML.Common.HasTable;UCML.DataGrid.superclass.constructor.call(this,id)};UCML.extend(UCML.DataGrid,UCML.Applet,{itemFirstText:UCML.Languge.DLLitemFirstText,headRowCount:1,pasteRowFormat:"",rowNumbers:false,rowNumberWidth:null,rowNumberText:UCML.Languge.DBRowNumberText,showCheckBox:false,crossPageCheck:false,showCheckBoxWidth:null,border:true,striped:true,havePage:true,rowHeight:null,headRowHeight:null,rowNumberBeforeCheckbox:true,haveCustomMenu:false,autoSort:true,haveQueryRow:false,haveMergerTable:false,keyFieldName:null,mergerFields:null,haveMenu:false,enabledEdit:true,colUnit:"px",nowrap:true,noHeader:false,rowOverCls:"datagrid-row-over",rowSelectCls:"datagrid-row-selected",cellSelectCls:"active-cell",activeRowCls:"datagrid-row-active",ruleCheckCellCls:"rulecheck-cell",trackMouseOver:false,clicksToEdit:1,enterToEdit:false,enterToInsert:true,clicksToCheck:1,rowSelectMode:1,groupToggleMode:1,showPager:true,cellSelectMode:1,showLoadMask:true,changeDataToView:true,enabledSelect:false,insertRecordTop:false,insertRecordByActiveRow:false,insertRecordByActiveRowTop:false,asyncLoadData:true,asyncLoadDataByRecordCount:300,paginationCtype:"UCML.PaginationMin",frozenMasterStr:'<div class="datagrid-view"><textarea class="toexcel-area" ></textarea><div class="datagrid-view1"style="{view1style}">'+'<div class="datagrid-header"><div class="datagrid-header-inner">{frozenHeaderStr}</div></div>'+'<div class="datagrid-body"><div class="datagrid-body-inner">{frozenBodyStr}</div></div></div>'+'<div class="datagrid-view2" style="{view2style}"><div class="datagrid-header"><div class="datagrid-header-inner">'+'{headerStr}</div></div><div class="datagrid-body">{bodyStr}</div></div>'+'<div class="datagrid-resize-proxy"></div></div><div class="datagrid-pager"></div><div class="datagrid-edit-body"></div>',
masterStr:'<div tabindex="-1" hidefocus="on" class="datagrid-view"><textarea class="toexcel-area" ></textarea><div class="datagrid-header"><div class="datagrid-header-inner">'+'{headerStr}</div></div><div class="datagrid-body">{bodyStr}</div>'+'<div class="datagrid-resize-proxy"></div></div><div class="datagrid-pager"></div><div class="datagrid-edit-body"></div>',frozenHeaderStr:'<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}" class="datagrid-header-table table"><tbody>{columnRow}{rows}</tbody></table>',headerStr:'<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}" class="datagrid-header-table table"><tbody>{columnRow}{rows}</tbody></table>',frozenBodyStr:'<table tabindex="-1" hidefocus="on" border="0" cellspacing="0" cellpadding="0" style="{tstyle}" class="datagrid-body-table table"><tbody>{columnRow}{rows}</tbody></table>',bodyStr:'<table tabindex="-1" border="0"  cellspacing="0" cellpadding="0" style="{tstyle}"  class="datagrid-body-table table"><tbody>{columnRow}{rows}</tbody></table>',headerRowStr:'<tr style="{style}">{cells}</tr>',headerCellStr:'<td style="{style}" fieldName="{fieldName}" frozen="{frozen}" title="{title}" class="datagrid-header-cell"><div class="datagrid-cell" ><span class="datagrid-header-text">{value}</span><span class="datagrid-sort-icon">&#160;</span></div></td>',headerNumberStr:'<td style="{style}"class="datagrid-header-cell" rowspan="{rowspan}"><div class="datagrid-header-rownumber" >{value}</div></td>',headerShowCheckBoxStr:'<td style="{style}" class="datagrid-header-cell" rowspan="{rowspan}" ><div class="datagrid-cell datagrid-header-check datagrid-cell-nowrap" ><span class="chk"><input type="checkbox" value="on" /></span></div></td>',bodyRowStr:'<tr class="datagrid-row {cls}" rowType="bodyRow" OID="{OID}" style="{style}"  >{cells}</tr>',bodyCellStr:'<td tabIndex="0" hidefocus="on" style="{style}"  class="datagrid-td datagrid-column-{fieldName}" fieldName="{fieldName}" >'+'<div  class="datagrid-cell {cls}"  title="{title}" >{value}'+"</div></td>",columnStr:'<td  style="height: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-color: currentColor; border-right-color: currentColor; border-bottom-color: currentColor; border-left-color: currentColor; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none;{style}"   fieldName="{fieldName}" ></td>',columnRowStr:'<tr style="{style}" rowType="colRow" >{cells}</tr>',bodyNumberStr:'<td class="datagrid-td-rownumber datagrid-cell-height" style="{style}"><div class=" datagrid-cell-rownumber">{value}</div></td>',bodyShowCheckBoxStr:'<td class="datagrid-td" style="{style}"><div class="datagrid-cell datagrid-cell-check datagrid-cell-nowrap"><span class="chk {on}"><input type="checkbox" value="on"  {checked} /></span></div></td>',queryCellStr:'<td  fieldName="{fieldName}"  style="{style}" class="datagrid-header-query-cell"><TABLE border=0 cellSpacing=0 cellPadding=0  class="datagrid-header-query-tb"><TBODY><TR>'+'<TD class="datagrid-header-query-tb-cell" style="padding:0px; margin:0px;border:0px;"  width="100%" noWrap><INPUT  fieldName="{fieldName}" id="queryInput_{fieldName}{VCName}" isCodeTable="{isCodeTable}" codeTable="{codeTable}"  ctype="{ctype}"  style="BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; WIDTH: 100%; BORDER-TOP: 0px; BORDER-RIGHT: 0px" class="UCML-Grid-Row UCML-Cell-Brd queryEdit" ></TD>'+'<TD class="datagrid-header-query-tb-cell" style="padding:0px; margin:0px;border:0px;" bgColor=#ffffff  width="15" noWrap><span style="CURSOR: hand"  class="queryEditImg"  ></span></TD></TR></TBODY></TABLE></td>',groupRowStr:'<tr style="{style}" class="datagrid-row datagrid-groupRow {cls}" rowType="groupRow" ><td tabIndex="0" hidefocus="on" style="{style}" colspan={colspan} ><div class="datagrid-cell-group" OID="{OID}" groupValue="{groupValue}">{groupItems}</div></td></tr>',groupItemStr:"",onRender:function(){var elColumn=$("#"+this.id+"_ColumnSetup");if(elColumn.length>0){var conf=elColumn.val().split(";");for(var i=0;i<conf.length;i++){var objColumn=this.getColumn(conf[i]);if(objColumn){objColumn.display=false}}}UCML.DataGrid.superclass.onRender.call(this);this.el.addClass("datagrid-wrap");this.setColumns(this.getColumns());if(this.frozen){this.setFrozenRender(this.totalWidth)}else{this.setRender(this.totalWidth,this.alignWidth)}if(this.border==true){this.el.removeClass("datagrid-noborder")}else{this.el.addClass("datagrid-noborder")}for(var i=0;i<this.columns.length;i++){var col=this.columns[i];if(col.isCustomerControl==true){if(!col.EditControl){var el=$("#"+col.controlID);if(el.length>0){var obj={};obj.ctype=el.attr("ctype")||"UCML.TextBox";obj.dom=el[0];obj.isRuleCheck=false;obj.applet=this;obj.BusinessObject=this.BusinessObject;obj.fieldName=col.fieldName;obj.dataTable=this.dataTable;obj.rendeTo=this.el.find(".datagrid-edit-body");col.EditControl=UCML.create(obj,obj.ctype);col.EditControl.hide()}}}if(this.haveQueryRow){var el=$("#queryInput_"+col.fieldName+this.id);if(el.length>0){var obj={};obj.ctype=el.attr("ctype");obj.ctype=obj.ctype||"UCML.TextBox";if(col.isCodeTable&&col.codeTable){obj.ctype="UCML.CheckBoxGroupBox"}obj.dom=el[0];obj.applet=this;obj.BusinessObject=this.BusinessObject;col.queryEditControl=UCML.create(obj,obj.ctype)}}}this.setPager()},setPager:function(){if(this.showPager){if(typeof IsHTMLPage!=="undefined"&&IsHTMLPage&&(typeof BPOIsJQMPage!=="undefined"&&BPOIsJQMPage||this.IsJQMPage)){this.paginationCtype="UCML.PaginationMobile"}this.setPagination()}else{this.el.children(".datagrid-pager").hide()}},bindHeader:function(){this.setHeaderResizable();var opts=this;this.headerTable.find("tr td .datagrid-header-check :checkbox").bind("click",function(){opts.checkRows(this.checked);if(this.checked==true)$(this).parent("span.chk").addClass("on");else $(this).parent("span.chk").removeClass("on")})},setRender:function(totalWidth,fit){var headerStr="";var bodyStr="";var columnRowStr=this.getRenderColumns(this.columns,true);if(this.noHeader===false){headerStr=this.createHeader(this.headRowCount,this.columns,true,totalWidth,columnRowStr)}var bodyTpl=new UCML.Template(this.bodyStr);bodyStr=bodyTpl.apply({columnRow:columnRowStr,rows:"",tstyle:"width:"+totalWidth+this.colUnit});var masterTpl=new UCML.Template(this.masterStr);var masterStr=masterTpl.apply({headerStr:headerStr,bodyStr:bodyStr,vcid:this.id});this.el.append(masterStr);this.view=this.el.children("div.datagrid-view");this.body=this.view.children(".datagrid-body");this.bodyTable=this.body.children("table");this.header=this.view.children(".datagrid-header");this.headerTable=this.header.find(".datagrid-header-inner .datagrid-header-table");this.bindHeader();if(fit){if(this.haveScroll){this.body.css("overflow-x","hidden").css("overflow-y","auto")}else{this.body.css("overflow","hidden")}}else{if(this.haveScroll){this.body.css("overflow","auto")}else{this.body.css("overflow","hidden")}}this.setRenderTotalRow(columnRowStr);var opts=this;this.body.scroll(function(){opts.endEdit();opts.header.children(".datagrid-header-inner").scrollLeft(opts.body.scrollLeft());if(opts.totalRowBody){opts.totalRowBody.scrollLeft(opts.body.scrollLeft())}opts.fireEvent("bodyscroll",opts.body)})},setRenderTotalRow:function(columnRowStr){var havaTotalRow=this.getHaveTotalRow();var totalRowPosition=this.getTotalRowPosition();if(havaTotalRow){if(this.totalRowBody){this.totalRowBody.replaceWith("")}var totalRowBodyTpl=new UCML.Template(this.totalRowBodyStr);var totalStr=this.renderTotalRow(this.columns,true);var totalRowBodyStr=totalRowBodyTpl.apply({columnRow:columnRowStr,tstyle:"width:"+this.totalWidth+this.colUnit,totalStr:totalStr});if(totalRowPosition=="top"){this.header.after(totalRowBodyStr)}else{this.body.after(totalRowBodyStr)}}this.totalRowBody=this.view.children(".datagrid-totalrowbody");this.totalRowTable=this.totalRowBody.children(".datagrid-body-table")},bindFrozenHeader:function(){this.setHeaderResizable();var opts=this;this.frozenHeaderTable.find("tr td .datagrid-header-check :checkbox").bind("click",function(){opts.checkRows(this.checked);if(this.checked==true)$(this).parent("span.chk").addClass("on");else $(this).parent("span.chk").removeClass("on")})},setFrozenRender:function(totalWidth){var frozenTotalWidth=this.getTotalWidth(this.frozenColumns);var notTotalWidth=this.getTotalWidth(this.notfrozenColumns);frozenTotalWidth=frozenTotalWidth+(totalWidth-frozenTotalWidth-notTotalWidth);var frozenColumnRowStr=this.getRenderColumns(this.frozenColumns,true);var notfrozenColumnRowStr=this.getRenderColumns(this.notfrozenColumns,false);var frozenHeaderStr="";var frozenBodyStr="";if(this.noHeader===false){frozenHeaderStr=this.createHeader(this.headRowCount,this.frozenColumns,true,frozenTotalWidth,frozenColumnRowStr)}var frozenBodyTpl=new UCML.Template(this.frozenBodyStr);frozenBodyStr=frozenBodyTpl.apply({columnRow:frozenColumnRowStr,rows:"",tstyle:"width:"+frozenTotalWidth+this.colUnit});var headerStr="";var bodyStr="";if(this.noHeader===false){headerStr=this.createHeader(this.headRowCount,this.notfrozenColumns,false,notTotalWidth,notfrozenColumnRowStr)}var bodyTpl=new UCML.Template(this.bodyStr);bodyStr=bodyTpl.apply({columnRow:notfrozenColumnRowStr,rows:"",tstyle:"width:"+notTotalWidth+this.colUnit});var masterTpl=new UCML.Template(this.frozenMasterStr);var masterStr=masterTpl.apply({frozenHeaderStr:frozenHeaderStr,headerStr:headerStr,frozenBodyStr:frozenBodyStr,bodyStr:bodyStr,vcid:this.id});this.el.append(masterStr);this.view=this.el.children("div.datagrid-view");this.header=this.view.find(".datagrid-view2 .datagrid-header");this.headerTable=this.header.find(".datagrid-header-inner .datagrid-header-table");this.body=this.view.find(".datagrid-view2 .datagrid-body");this.bodyTable=this.body.children("table");this.frozenHeader=this.view.find(".datagrid-view1 .datagrid-header");this.frozenHeaderTable=this.frozenHeader.find(".datagrid-header-inner .datagrid-header-table");this.frozenBody=this.view.find(".datagrid-view1 .datagrid-body");this.frozenBodyTable=this.frozenBody.find(".datagrid-body-inner table");this.setFrozenRenderTotalRow(frozenTotalWidth,notTotalWidth,frozenColumnRowStr,notfrozenColumnRowStr);this.bindFrozenHeader();var opts=this;opts.body.scroll(function(){opts.endEdit();opts.header.children(".datagrid-header-inner").scrollLeft(opts.body.scrollLeft());opts.frozenBody.scrollTop(opts.body.scrollTop());opts.frozenBody.children(".datagrid-body-inner").scrollTop(opts.body.scrollTop());if(opts.totalRowBody){opts.totalRowBody.scrollLeft(opts.body.scrollLeft())}opts.fireEvent("bodyscroll",opts.body)});if(this.haveScroll){this.body.css("overflow","auto")}else{this.body.css("overflow","hidden")}},setFrozenRenderTotalRow:function(frozenTotalWidth,notTotalWidth,frozenColumnRowStr,notfrozenColumnRowStr){var havaTotalRow=this.getHaveTotalRow();var totalRowPosition=this.getTotalRowPosition();if(havaTotalRow){if(this.totalRowBody){this.totalRowBody.replaceWith("")}if(this.frozenTotalRowBody){this.frozenTotalRowBody.replaceWith("")}var totalRowBodyTpl=new UCML.Template(this.totalRowBodyStr);var frozenTotalStr=this.renderTotalRow(this.frozenColumns,true);var totalStr=this.renderTotalRow(this.notfrozenColumns,false);var totalRowBodyStr=totalRowBodyTpl.apply({columnRow:notfrozenColumnRowStr,tstyle:"width:"+notTotalWidth+this.colUnit,totalStr:totalStr});if(totalRowPosition=="top"){this.header.after(totalRowBodyStr)}else{this.body.after(totalRowBodyStr)}var frozenTotalRowBodyStr=totalRowBodyTpl.apply({columnRow:frozenColumnRowStr,tstyle:"width:"+frozenTotalWidth+this.colUnit,totalStr:frozenTotalStr});if(totalRowPosition=="top"){this.frozenHeader.after(frozenTotalRowBodyStr)}else{this.frozenBody.after(frozenTotalRowBodyStr)}}this.frozenTotalRowBody=this.view.find(".datagrid-view1 .datagrid-totalrowbody");this.frozenTotalRowTable=this.frozenTotalRowBody.children(".datagrid-body-table");this.totalRowBody=this.view.find(".datagrid-view2 .datagrid-totalrowbody");this.totalRowTable=this.totalRowBody.children(".datagrid-body-table")},setHeaderResizable:function(){var opts=this;$(".datagrid-header .datagrid-header-cell",opts.el).UCML_resizable({handles:"e",minWidth:50,onStartResize:function(e){$(".datagrid-resize-proxy",opts.el).css({left:e.pageX-$(opts.el).offset().left-1});$(".datagrid-resize-proxy",opts.el).css("display","block")},onResize:function(e){$(".datagrid-resize-proxy",opts.el).css({left:e.pageX-$(opts.el).offset().left-1});return false},onStopResize:function(e){opts.fixColumnSize(this,e.data);$(".datagrid-view2 .datagrid-header",opts.el).scrollLeft($(".datagrid-view2 .datagrid-body",opts.el).scrollLeft());$(".datagrid-resize-proxy",opts.el).css("display","none");opts.setSize()}});$(".datagrid-view1 .datagrid-header .datagrid-header-cell",opts.el).UCML_resizable({onStopResize:function(e){opts.fixColumnSize(this,e.data);$(".datagrid-view2 .datagrid-header",opts.el).scrollLeft($(".datagrid-view2 .datagrid-body",opts.el).scrollLeft());$(".datagrid-resize-proxy",opts.el).css("display","none");opts.setSize()}})},getRenderColumns:function(columns,frozen){var columnsTpl=new UCML.Template(this.columnRowStr);var cellsStr=[];if(frozen==true&&this.rowNumbers){var headerNumberTpl=new UCML.Template(this.columnStr);cellsStr.add(headerNumberTpl.apply({style:"width:"+this.rowNumberWidth+this.colUnit,value:this.rowNumberText}))}if(frozen==true&&this.showCheckBox){var headerShowCheckBoxTpl=new UCML.Template(this.columnStr);cellsStr.add(headerShowCheckBoxTpl.apply({style:"width:"+this.showCheckBoxWidth+this.colUnit,value:""}))}for(var j=0;j<columns.length;j++){var col=columns[j];var display="";if(!col.display){display=" display:none;"}var headerCellTpl=new UCML.Template(this.columnStr);cellsStr.add(headerCellTpl.apply({value:col.caption,fieldName:col.fieldName,style:"width:"+col.width+this.colUnit+";"+display}))}return columnsTpl.apply({style:"height:0px;",cells:cellsStr.join("")})},setHeader:function(value){this.headerTable.html(value);var tds=this.headerTable.find("td,th");for(var i=0;i<tds.length;i++){var tdel=$(tds[i]);var tempcolspan=tdel.attr("colspan")||"1";var temprowspan=tdel.attr("rowspan")||"1";var tdstyle="";var fieldName=tdel.attr("fieldName");var strAttr;var dwidth="";if(parseInt(tempcolspan)==1&&fieldName!=""){var col=this.getColumn(fieldName);if(col){tdstyle="width:"+col.width+this.colUnit+";";strAttr=" fieldName='"+fieldName+"' ";dwidth=col.width+this.colUnit}}else{strAttr=""}tdel.replaceWith("<td class='datagrid-header-cell'  "+strAttr+" style='"+tdstyle+"' rowspan='"+temprowspan+"' colspan='"+tempcolspan+'\'><div class="datagrid-cell" ><span>'+tdel.html()+"</span></div></td>")}this.header.width(this.body.width());this.body.width(this.body.width());var tableWidth=this.bodyTable.width();this.headerTable.width(tableWidth);this.setSize()},checkRows:function(checked){var count=this.getRowCount();for(var i=0;i<count;i++){if(this.showCheckBox){var rowIndex=i;var row;if(this.frozen){row=this.getFrozenRow(rowIndex)}else{row=this.getRow(rowIndex)}if(row){if(checked){this.onRowSelect(row)}else{this.unRowSelect(row)}this.setFocusRow(row);this.checkChange(row,checked)}}}},afterRender:function(){UCML.DataGrid.superclass.afterRender.call(this);if(typeof BPOIsJQMPage!=="undefined"&&BPOIsJQMPage){var theme=BPOPageTheme||"a";this.header.addClass("datagrid-header-"+theme);if(this.pagination){this.pagination.el.addClass("toolbar-"+theme)}}else if(this.IsJQMPage){var theme=this.JQMPageTheme||"a";this.header.addClass("datagrid-header-"+theme);if(this.pagination){this.pagination.el.addClass("toolbar-"+theme)}}},open:function(){UCML.DataGrid.superclass.open.call(this)},setColumns:function(value){UCML.DataGrid.superclass.setColumns.call(this,value);var totalWidth=this.getTotalWidth(this.columns);if(this.alignWidth){var dWdith=100;this.rowNumberWidth=this.rowNumberWidth||5;this.showCheckBoxWidth=this.showCheckBoxWidth||5;if(this.rowNumbers){dWdith-=this.rowNumberWidth}if(this.showCheckBox){dWdith-=this.showCheckBoxWidth}for(var i=0;i<this.columns.length;i++){this.columns[i].width=this.columns[i].width/totalWidth*dWdith}this.frozen=false;this.totalWidth=100;this.colUnit="%"}else{this.rowNumberWidth=this.rowNumberWidth||40;this.showCheckBoxWidth=this.showCheckBoxWidth||40;if(this.rowNumbers){totalWidth+=this.rowNumberWidth}if(this.showCheckBox){totalWidth+=this.showCheckBoxWidth}this.totalWidth=totalWidth;this.setFrozenColumns();var frozen=this.showCheckBox||this.rowNumbers||this.frozenColumns&&this.frozenColumns.length>0;this.frozen=frozen}},getTotalWidth:function(columns){var totalWidth=0;for(var j=0;j<columns.length;j++){var col=columns[j];if(col.display==true){totalWidth+=parseFloat(col.width)}}return totalWidth},onQueryMenuReady:function(){var queryMenu=new UCML.Menu;queryMenu.addMenuItem("cmd_NOTSET",UCML.Languge.DBNOTSET);queryMenu.addSeparator();queryMenu.addMenuItem("cmd_GreaterEQU",UCML.Languge.DBGreaterEQU);queryMenu.addMenuItem("cmd_Greater",UCML.Languge.DBGreater);queryMenu.addMenuItem("cmd_EQU",UCML.Languge.DBEQU,"icon-ok");queryMenu.addMenuItem("cmd_LessEQU",UCML.Languge.DBLessEQU);queryMenu.addMenuItem("cmd_Less",UCML.Languge.DBLess);queryMenu.addMenuItem("cmd_NOTEQU",UCML.Languge.DBNOTEQU);queryMenu.addMenuItem("cmd_LIKE",UCML.Languge.DBLIKE);queryMenu.addMenuItem("cmd_BETWEEN",UCML.Languge.DBBETWEEN);queryMenu.addSeparator();queryMenu.addMenuItem("cmd_IS",UCML.Languge.DBIS);queryMenu.addMenuItem("cmd_ISNOT",UCML.Languge.DBISNOT);queryMenu.addMenuItem("cmd_EQUEmpty",UCML.Languge.DBEQUEmpty);queryMenu.addMenuItem("cmd_NOTEQUEmpty",UCML.Languge.DBNOTEQUEmpty);queryMenu.addSeparator();queryMenu.addMenuItem("cmd_RunQuery",UCML.Languge.DBRunQuery);queryMenu.addMenuItem("cmd_ClearThisQuery",UCML.Languge.DBClearThisQuery);queryMenu.addMenuItem("cmd_ClearQuery",UCML.Languge.DBClearQuery);this.queryMenu=queryMenu;for(var i=0;i<this.columns.length;i++){if(this.columns[i].display==true){this.columns[i].queryCmd=this.columns[i].queryCmd||"LIKE";this.columns[i].cmd=this.columns[i].cmd||"cmd_LIKE"}}},onMenuReady:function(){var menu=new UCML.Menu;menu.addMenuItem("cmd_LoadFirstPage",UCML.Languge.DBLoadFirstPage);menu.addMenuItem("cmd_LoadPrevPage",UCML.Languge.DBLoadPrevPage);menu.addMenuItem("cmd_LoadMore",UCML.Languge.DBLoadMore);menu.addMenuItem("cmd_LoadLastPage",UCML.Languge.DBLoadLastPage);if(this.enabledEdit){menu.addSeparator();menu.addMenuItem("cmd_InsertRecord",UCML.Languge.DBInsertRecord);menu.addMenuItem("cmd_DeleteRecord",UCML.Languge.DBDeleteRecord);menu.addSeparator();menu.addMenuItem("cmd_Submit",UCML.Languge.DBSubmit);menu.addMenuItem("cmd_Cancel",UCML.Languge.DBCancel)}menu.addSeparator();menu.addMenuItem("cmd_OutExcel",UCML.Languge.DBOutExcel);menu.addMenuItem("cmd_AllOutExcel",UCML.Languge.DBAllOutExcel);menu.addMenuItem("cmd_Refresh",UCML.Languge.DBRefresh);menu.addMenuItem("cmd_ConfigColumns",UCML.Languge.DBConfigColumns);this.menu=menu},onQueryMenuItemClick:function(menuId,menuItem){var queryMenu=this.queryMenu;var column=this.getColumn(queryMenu.fieldName);if(menuId=="cmd_NOTSET"){column.queryCmd="";queryMenu.setCheckedMenuItem(menuId);column.cmd=menuId;this.dataTable.SetCondiList("","","")}else if(menuId=="cmd_GreaterEQU"){column.queryCmd=">=";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_Greater"){column.queryCmd=">";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_EQU"){column.queryCmd="=";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_NOTEQU"){column.queryCmd="<>";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_LessEQU"){column.queryCmd="<=";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_Less"){column.queryCmd="<";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_LIKE"){column.queryCmd="LIKE";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_IS"){column.queryCmd="IS";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_ISNOT"){column.queryCmd="IS NOT";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_EQUEmpty"){column.queryCmd="Empty";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_NOTEQUEmpty"){column.queryCmd="Not Empty";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_BETWEEN"){column.queryCmd="BETWEEN";column.cmd=menuId;queryMenu.setCheckedMenuItem(menuId)}else if(menuId=="cmd_RunQuery"){if(this.customQuery&&window[this.customQueryFn]){this.onRunQueryCustom()}else{this.onRunQuery()}}else if(menuId=="cmd_ClearThisQuery"){this.setQueryEditValue(queryMenu.fieldName,"");if(this.customQuery&&window[this.customQueryFn]){this.onRunQueryCustom()}else{this.onRunQuery()}}else if(menuId=="cmd_ClearQuery"){for(var i=0;i<this.columns.length;i++){if(this.columns[i].display==true){this.setQueryEditValue(this.columns[i].fieldName,"")}}if(this.customQuery&&window[this.customQueryFn]){this.onRunQueryCustom()}else{this.onRunQuery()}}},addColumn:function(fieldName,caption,display,allowModify,width){var objColumn=new Object;objColumn.fieldName=fieldName||"column_"+this.columns.length++;objColumn.caption=caption||"列_"+this.columns.length++;objColumn.display=display||true;objColumn.allowModify=allowModify||true;objColumn.width=width||100;objColumn.isFixColumnValue=false;objColumn.fixColumnValue="";objColumn.isCustomerControl=true;objColumn.customerControl="";objColumn.editContrl="";objColumn.EditType="UCML.TextBox";objColumn.mutiValueCol=false;this.columns.add(objColumn)},rebuildTotalRow:function(){if(!this.frozen){var columnRowStr=this.getRenderColumns(this.columns,true);this.setRenderTotalRow(columnRowStr)}else{var frozenColumnRowStr=this.getRenderColumns(this.frozenColumns,true);var notfrozenColumnRowStr=this.getRenderColumns(this.notfrozenColumns,false);var frozenTotalWidth=this.getTotalWidth(this.frozenColumns);var notTotalWidth=this.getTotalWidth(this.notfrozenColumns);this.setFrozenRenderTotalRow(frozenTotalWidth,notTotalWidth,frozenColumnRowStr,notfrozenColumnRowStr)}this.updateTotalRow()},rebuildHeader:function(){if(!this.frozen){var columnRowStr=this.getRenderColumns(this.columns,true);var headerStr="";if(this.noHeader===false){headerStr=this.createHeader(this.headRowCount,this.columns,true,this.totalWidth,columnRowStr)}this.headerTable.replaceWith(headerStr);this.headerTable=this.header.find(".datagrid-header-inner .datagrid-header-table");this.bindHeader()}else{var frozenTotalWidth=this.getTotalWidth(this.frozenColumns);var notTotalWidth=this.getTotalWidth(this.notfrozenColumns);frozenTotalWidth=frozenTotalWidth+(this.totalWidth-frozenTotalWidth-notTotalWidth);var frozenColumnRowStr=this.getRenderColumns(this.frozenColumns,true);var notfrozenColumnRowStr=this.getRenderColumns(this.notfrozenColumns,false);var headerStr="";var frozenHeaderStr="";if(this.noHeader===false){headerStr=this.createHeader(this.headRowCount,this.notfrozenColumns,false,notTotalWidth,notfrozenColumnRowStr);frozenHeaderStr=this.createHeader(this.headRowCount,this.frozenColumns,true,frozenTotalWidth,frozenColumnRowStr)}this.headerTable.replaceWith(headerStr);this.frozenHeaderTable.replaceWith(frozenHeaderStr);this.headerTable=this.header.find(".datagrid-header-inner .datagrid-header-table");this.frozenHeaderTable=this.frozenHeader.find(".datagrid-header-inner .datagrid-header-table");this.bindFrozenHeader()}},rebuildDataBody:function(){if(this.frozen){var frozenColumnRowStr=this.getRenderColumns(this.frozenColumns,true);var notfrozenColumnRowStr=this.getRenderColumns(this.notfrozenColumns,false);var frozenTotalWidth=this.getTotalWidth(this.frozenColumns);var notTotalWidth=this.getTotalWidth(this.notfrozenColumns);frozenTotalWidth=frozenTotalWidth+(this.totalWidth-frozenTotalWidth-notTotalWidth);this.bodyTable.empty();this.frozenBodyTable.empty();var frozenBodyStr=this.renderRows(this.frozenColumns,true);var bodyStr=this.renderRows(this.notfrozenColumns,false);this.frozenBodyTable.append(frozenColumnRowStr).width(frozenTotalWidth+this.colUnit);this.bodyTable.append(notfrozenColumnRowStr).width(notTotalWidth+this.colUnit)}else{this.bodyTable.empty();var columnRowStr=this.getRenderColumns(this.columns,true);var bodyStr=this.renderRows(this.columns,true);this.bodyTable.append(columnRowStr).width(this.totalWidth+this.colUnit)}this.loadData()},rebuildQueryRow:function(){for(var i=0;i<this.columns.length;i++){var col=this.columns[i];if(this.haveQueryRow){var el=$("#queryInput_"+col.fieldName+this.id);if(el.length>0){var obj={};obj.ctype=el.attr("ctype");obj.ctype=obj.ctype||"UCML.TextBox";if(col.isCodeTable&&col.codeTable){obj.ctype="UCML.CheckBoxGroupBox"}obj.dom=el[0];obj.applet=this;obj.BusinessObject=this.BusinessObject;col.queryEditControl=UCML.create(obj,obj.ctype)}}}},rebuildGrid:function(){this.setColumns(this.getColumns());this.rebuildHeader();this.rebuildQueryRow();this.setPagination();this.rebuildDataBody();this.rebuildTotalRow();this.setSize()},onRunQuery:function(){var fieldList="";var valueList="";var condiIndentList="";var flag=0;var dataTable=this.dataTable;var bpo=this.BusinessObject;var SQLCondi="";if(this.SQLCondi){SQLCondi=this.SQLCondi}var flagCodeTable=false;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];var fieldName=column.fieldName;if(column.display==true){var value="";if(column&&column.queryEditControl){value=column.queryEditControl.getValue()}var cmd=column.queryCmd||"";var fieldKind=column.fieldKind;if(value!=""&&cmd!=""){if(fieldKind==0){fieldName=dataTable.TableName+"."+fieldName}else if(fieldKind==2){fieldName="al"+column.foreignKeyField+"."+column.lookupResultField}else if(fieldKind==10){fieldName="al"+column.foreignKeyField+"."+fieldName}else if(fieldKind==5&&column.QueryRefColumn){fieldName=column.QueryRefColumn}else{continue}if(column.QueryRefColumn){fieldName=column.QueryRefColumn}if(column.isCodeTable&&column.codeTable){if(flagCodeTable){SQLCondi+=" and "}SQLCondi+=codeTableWhereByValue(fieldName,value);flagCodeTable=true}else{if(cmd=="BETWEEN"){var v=value.toUpperCase();var r=v.match("AND");if(r==null){alert('请输入"value1 and value2"格式条件');return}}fieldList+=fieldName+";";valueList=valueList+value+";";condiIndentList=condiIndentList+cmd+";"}flag=1}else if(cmd!=""){if(fieldKind==0){fieldName=dataTable.TableName+"."+fieldName}else if(fieldKind==2){fieldName="al"+column.foreignKeyField+"."+column.lookupResultField}else if(fieldKind==10){fieldName="al"+column.foreignKeyField+"."+fieldName}else if(fieldKind==5&&column.QueryRefColumn){fieldName=column.QueryRefColumn}if(column.QueryRefColumn){fieldName=column.QueryRefColumn}if(cmd=="IS"||cmd=="IS NOT"){if(flagCodeTable){SQLCondi+=" and "}SQLCondi+=fieldName+" "+cmd+" NULL";flagCodeTable=true;continue}else if(cmd=="Empty"||cmd=="Not Empty"){if(flagCodeTable){SQLCondi+=" and "}if(cmd=="Empty")SQLCondi+=fieldName+" = ''";else SQLCondi+=fieldName+" <> ''";flagCodeTable=true;continue}}}}dataTable.setSQLCondi(SQLCondi);dataTable.SetCondiList(dataTable.theDefaultFieldList+fieldList,dataTable.theDefaultValueList+valueList,dataTable.theDefaultCondiIndentList+condiIndentList);this.dataTable.getData(0,this.dataTable.getDefaultPageCount());function codeTableWhereByValue(fieldName,value){value=value.replace(/\'/g,"");var values=value.split(";");var logicConnect=" or ";var sql="";if(values.length>0){sql=" ( ";for(var i=0;i<values.length;i++){if(i>0){sql+=" "+logicConnect+" "}sql+=fieldName+" = '"+values[i]+"'"}sql+=" )"}return sql}},onRunQueryCustom:function(){var SQLCondi="";if(this.SQLCondi){SQLCondi=this.SQLCondi}var flagCodeTable=false;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];var fieldName=column.fieldName;if(column.display==true){var value="";if(column&&column.queryEditControl){value=column.queryEditControl.getValue()}var cmd=column.queryCmd||"";var fieldType=column.fieldType;if(value!=""&&cmd!=""){if(column.isCodeTable&&column.codeTable){if(SQLCondi!=""){SQLCondi+=" and "}SQLCondi+=codeTableWhereByValue(fieldName,value);flagCodeTable=true}else{if(SQLCondi!=""){SQLCondi+=" and "}if(cmd=="BETWEEN"){alert("不支持BETWEEN！");return}if(fieldType=="VarChar"||fieldType=="Char"||fieldType=="NVarChar"||fieldType=="NChar"||fieldType=="Text"){if(cmd=="LIKE"){SQLCondi+=fieldName+" "+cmd+" "+"'%"+value+"%'"}else if(cmd=="="||cmd=="<>"){SQLCondi+=fieldName+" "+cmd+" "+"'"+value+"'"}}else if(fieldType=="Int"||fieldType=="Long"||fieldType=="Numeric"||fieldType=="Money"||fieldType=="Short"||fieldType=="Float"||fieldType=="Double"){if(cmd==">="||cmd==">"||cmd=="="||cmd=="<="||cmd=="<"||cmd=="<>"){SQLCondi+=fieldName+" "+cmd+" "+value}}}}else if(cmd!=""){if(cmd=="IS"||cmd=="IS NOT"){if(SQLCondi!=""){SQLCondi+=" and "}SQLCondi+=fieldName+" "+cmd+" NULL";flagCodeTable=true;continue}else if(cmd=="Empty"||cmd=="Not Empty"){if(SQLCondi!=""){SQLCondi+=" and "}if(fieldType=="VarChar"||fieldType=="Char"||fieldType=="NVarChar"||fieldType=="NChar"||fieldType=="Text"){if(cmd=="Empty")SQLCondi+=fieldName+" = ''";else SQLCondi+=fieldName+" <> ''"}flagCodeTable=true;continue}}}}if(this.customQuery&&window[this.customQueryFn]){window[this.customQueryFn](SQLCondi)}else{}function codeTableWhereByValue(fieldName,value){value=value.replace(/\'/g,"");var values=value.split(";");var logicConnect=" or ";var sql="";if(values.length>0){sql=" ( ";for(var i=0;i<values.length;i++){if(i>0){sql+=" "+logicConnect+" "}sql+=fieldName+" = '"+values[i]+"'"}sql+=" )"}return sql}},setQueryEditValue:function(fieldName,value){var col=this.getColumn(fieldName);if(col&&col.queryEditControl){col.queryEditControl.setValue(value)}},mergerData:function(keyFieldName,mergerFields){if(keyFieldName==null||mergerFields==null){return}var fieldIndex=mergerFields.split(";");if(fieldIndex==null||fieldIndex.length==0){return}var col=this.getColumn(keyFieldName);var keyIndex=-1;var tb;if(this.frozen){if(col.fixedColumn){keyIndex=this.getFrozenColumnIndex(keyFieldName);tb=this.frozenBodyTable[0];if(!this.alignWidth){if(this.rowNumbers){keyIndex++}if(this.showCheckBox){keyIndex++}}}else{keyIndex=this.getNotFrozenColumnIndex(keyFieldName);tb=this.bodyTable[0];if(this.alignWidth){if(this.rowNumbers){keyIndex++}if(this.showCheckBox){keyIndex++}}}}else{keyIndex=this.getColumnIndex(keyFieldName);tb=this.bodyTable[0];if(this.alignWidth){if(this.rowNumbers){keyIndex++}if(this.showCheckBox){keyIndex++}}}var fieldList=[];for(var m=0;m<fieldIndex.length;m++){var fieldName=fieldIndex[m];var fieldCol=this.getColumn(fieldName);var zi=-1;var t;if(this.frozen){if(fieldCol.fixedColumn){zi=this.getFrozenColumnIndex(fieldName);t=this.frozenBodyTable[0];if(!this.alignWidth){if(this.rowNumbers){zi++}if(this.showCheckBox){zi++}}}else{zi=this.getNotFrozenColumnIndex(fieldName);t=this.bodyTable[0];if(this.alignWidth){if(this.rowNumbers){zi++}if(this.showCheckBox){zi++}}}}else{zi=this.getColumnIndex(fieldName);t=this.bodyTable[0];if(this.alignWidth){if(this.rowNumbers){zi++}if(this.showCheckBox){zi++}}}if(zi>=0&&t!=null){fieldList.add({tb:t,index:zi})}}if(keyIndex>=0&&tb!=null&&fieldList.length>0){for(var i=1;i<tb.rows.length;i++){var n=1;for(var j=i+1;j<tb.rows.length;j++){var deleteCellCount=0;if(tb.rows[i].cells.length>=keyIndex&&tb.rows[j].cells.length>=keyIndex&&tb.rows[i].cells[keyIndex].innerHTML==tb.rows[j].cells[keyIndex].innerHTML){n=n+1;for(var m=0;m<fieldList.length;m++){var field=fieldList[m];field.tb.rows[j].deleteCell(field.index-deleteCellCount);deleteCellCount++;field.tb.rows[i].cells[field.index].rowSpan=n}}else{break}}i=i+n-1}}},mergeHeadCells:function(startRow,endRow,startCol,endCol,text){var table=this.headerTable[0];this.mergeTableCells(table,startRow,endRow,startCol,endCol,text)},mergeFrozeHeadCells:function(startRow,endRow,startCol,endCol,text){var table=this.frozenHeaderTable[0];this.mergeTableCells(table,startRow,endRow,startCol,endCol,text);
},mergeBodyTableCells:function(startRow,endRow,startCol,endCol,text){var table=this.bodyTable[0];this.mergeTableCells(table,startRow,endRow,startCol,endCol,text)},mergeFrozenBodyCells:function(startRow,endRow,startCol,endCol,text){var table=this.frozenBodyTable[0];this.mergeTableCells(table,startRow,endRow,startCol,endCol,text)},mergeTableCells:function(table,startRow,endRow,startCol,endCol,text){startRow++;endRow++;var colSpan=endCol-startCol+1;var rowSpan=endRow-startRow+1;var width=0;for(var i=startCol;i<=endCol;i++){var cell=$(table.rows[startRow].cells[i]);width=width+cell.outerWidth()}for(var n=startRow;n<=endRow;n++){for(var i=startCol;i<endCol;i++){table.rows[n].deleteCell(startCol+1)}}for(var n=startRow+1;n<=endRow;n++){table.rows[n].deleteCell(startCol)}table.rows[startRow].cells[startCol].rowSpan=rowSpan;table.rows[startRow].cells[startCol].colSpan=colSpan;var cell=table.rows[startRow].cells[startCol];var cellEl=$(cell);cellEl.find(".datagrid-cell").html(text);var c=cellEl.outerWidth()-cellEl.width()},clearAllBCLink:function(){for(var i=0;i<this.columns.length;i++){var fieldName=this.columns[i].fieldName;this.setShowBCLink(fieldName,false)}},setShowBCLink:function(fieldName,value){var objColumn=this.getColumn(fieldName);if(objColumn){objColumn.showBCLink=value}},onLoadPrevPage:function(){if(this.dataTable){this.dataTable.LoadPrevPage()}},onLoadMoreData:function(){if(this.dataTable){this.dataTable.LoadMoreData()}},onLoadFirstPage:function(){if(this.dataTable){this.dataTable.LoadFirstPage()}},onLoadLastPage:function(){if(this.dataTable){this.dataTable.LoadLastPage()}},onGotoPage:function(pageIndex){if(this.dataTable){this.dataTable.GotoPage(pageIndex)}},ExportToExcel:function(){}});UCML.DataGrid.prototype.init=function(){UCML.DataGrid.superclass.init.call(this)};UCML.DataGrid.prototype.setFrozenColumns=function(columns){columns=columns||this.columns;this.frozenColumns=[];this.notfrozenColumns=[];for(var i=0;i<columns.length;i++){if(columns[i].fixedColumn){this.frozenColumns[this.frozenColumns.length]=columns[i]}else{this.notfrozenColumns[this.notfrozenColumns.length]=columns[i]}}};UCML.DataGrid.prototype.getFrozenColumns=function(){return this.frozenColumns};UCML.DataGrid.prototype.getFrozenColumnIndex=function(fieldName){if(fieldName==null||this.frozenColumns==null){return-1}for(var i=0;i<this.frozenColumns.length;i++){if(this.frozenColumns[i].fieldName==fieldName){return i}}return-1};UCML.DataGrid.prototype.getNotFrozenColumnIndex=function(fieldName){if(fieldName==null||this.notfrozenColumns==null){return-1}for(var i=0;i<this.notfrozenColumns.length;i++){if(this.notfrozenColumns[i].fieldName==fieldName){return i}}return-1};UCML.DataGrid.prototype.getColumnIndex=function(fieldName){if(fieldName==null||this.columns==null){return-1}for(var i=0;i<this.columns.length;i++){if(this.columns[i].fieldName==fieldName){return i}}return-1};UCML.DataGrid.prototype.getNotfrozenColumns=function(){return this.notfrozenColumns};UCML.DataGrid.prototype.setPagination=function(){if(!this.showPager){return}var pager=this.el.children(".datagrid-pager");if(pager.length==0){return}if(!this.pagination){if(this.paginationCtype){this.pagination=new UCML.create({dom:pager[0],dataTable:this.dataTable,applet:this,havePage:this.havePage},this.paginationCtype)}else{this.pagination=new UCML.Pagination({dom:pager[0],dataTable:this.dataTable,applet:this,havePage:this.havePage})}}else{this.pagination.updateMsg()}};UCML.DataGrid.prototype.createHeader=function(headRowCount,columns,frozen,totalWidth,columnRowStr){var headerTpl=new UCML.Template(frozen==true?this.frozenHeaderStr:this.headerStr);var rowsStr=[];for(var i=0;i<headRowCount;i++){var headerRowTpl=new UCML.Template(this.headerRowStr);var cellsStr=[];if(i==0){if(frozen==true&&this.rowNumbers&&this.showCheckBox){var headerNumberTpl=new UCML.Template(this.headerNumberStr);var headerShowCheckBoxTpl=new UCML.Template(this.headerShowCheckBoxStr);if(this.rowNumberBeforeCheckbox){cellsStr.add(headerNumberTpl.apply({value:this.rowNumberText,rowspan:headRowCount+(this.haveQueryRow?1:0)}));cellsStr.add(headerShowCheckBoxTpl.apply({value:"",rowspan:headRowCount+(this.haveQueryRow?1:0)}))}else{cellsStr.add(headerShowCheckBoxTpl.apply({value:"",rowspan:headRowCount+(this.haveQueryRow?1:0)}));cellsStr.add(headerNumberTpl.apply({value:this.rowNumberText,rowspan:headRowCount+(this.haveQueryRow?1:0)}))}}else{if(frozen==true&&this.rowNumbers){var headerNumberTpl=new UCML.Template(this.headerNumberStr);cellsStr.add(headerNumberTpl.apply({value:this.rowNumberText,rowspan:headRowCount+(this.haveQueryRow?1:0)}))}if(frozen==true&&this.showCheckBox){var headerShowCheckBoxTpl=new UCML.Template(this.headerShowCheckBoxStr);cellsStr.add(headerShowCheckBoxTpl.apply({value:"",rowspan:headRowCount+(this.haveQueryRow?1:0)}))}}}for(var j=0;j<columns.length;j++){var col=columns[j];var display="";if(!col.display){display=" display:none;"}var title="";if(col.inputTip&&col.inputTip!=""){title=col.inputTip}var headerCellTpl=new UCML.Template(this.headerCellStr);var caption=col.caption;if(col.headFormatter){caption=col.headFormatter.call(this,{caption:caption,fieldName:col.fieldName,column:col},col)}cellsStr.add(headerCellTpl.apply({value:caption,fieldName:col.fieldName,style:display,title:title}))}rowsStr[i]=headerRowTpl.apply({style:"height:"+this.headRowHeight+"px;",cells:cellsStr.join("")})}if(this.haveQueryRow){var headerRowTpl=new UCML.Template(this.headerRowStr);var cellsStr=[];for(var j=0;j<columns.length;j++){var col=columns[j];var display="";if(!col.display){display=" display:none;"}var queryCellTpl=new UCML.Template(this.queryCellStr);cellsStr.add(queryCellTpl.apply({value:col.caption,fieldName:col.fieldName,BCName:this.dataTable.BCName,VCName:this.id,ctype:col.EditType,style:display,isCodeTable:col.isCodeTable,codeTable:col.codeTable}))}rowsStr[rowsStr.length]=headerRowTpl.apply({style:"height:"+this.headRowHeight+"px;",cells:cellsStr.join("")})}return headerTpl.apply({columnRow:columnRowStr,rows:rowsStr.join(""),tstyle:"width:"+totalWidth+this.colUnit})};UCML.DataGrid.prototype.setFrozenBodySize=function(param){var beginDate=new Date;var width=this.el.width();var height=this.el.height();var el=this.el;var view=el.children("div.datagrid-view");var view1=view.children("div.datagrid-view1");var view2=view.children("div.datagrid-view2");var view1_header=view1.children("div.datagrid-header");var view2_header=view2.children("div.datagrid-header");var table1=view1_header.find("table");var table2=view2_header.find("table");if(this.alignWidth){view2.find(".datagrid-header .datagrid-header-inner").css("padding","0")}else{view1.width(view1.find("table").width());view2.width(width-view1.outerWidth());view1.children("div.datagrid-header,div.datagrid-body,div.datagrid-totalrowbody").width(view1.width());view2.children("div.datagrid-header,div.datagrid-body,div.datagrid-totalrowbody").width(view2.width());view2.css("left",view1.outerWidth())}var hh;view1_header.css("height","auto");view2_header.css("height","auto");table1.css("height","auto");table2.css("height","auto");hh=Math.max(table1.height(),table2.height());if($.boxModel==true){view1_header.height(hh-(view1_header.outerHeight()-view1_header.height()));view2_header.height(hh-(view2_header.outerHeight()-view2_header.height()))}else{view1_header.height(hh-(view1_header.outerHeight()-view1_header.height()));view2_header.height(hh-(view2_header.outerHeight()-view2_header.height()))}var body=el.find("div.datagrid-body");if(this.height=="auto"){this.updataBody()}else{var bodyHeight=height-view2.children("div.datagrid-header").outerHeight(true)-el.children(".datagrid-pager:visible").outerHeight(true)-this.totalRowBody.outerHeight(true);body.height(bodyHeight);view.height(view2.height());this.frozenHeaderTable.height(this.headerTable.outerHeight());this.frozenBodyTable.height(this.bodyTable.outerHeight(true));var innerHeight=body[1].offsetHeight-body[1].clientHeight;if(body[1].clientHeight>0&&innerHeight>0){bodyHeight=bodyHeight-innerHeight;view1.find(".datagrid-body .datagrid-body-inner").height(bodyHeight)}else{view1.find(".datagrid-body .datagrid-body-inner").css("height","auto")}}var innerWidth=body[1].offsetWidth-body[1].clientWidth;if(body[1].clientWidth>0&&innerWidth>0){var view2Width=view2.width();view2_header.children(".datagrid-header-inner").width(view2Width-innerWidth);this.totalRowBody.width(view2Width-innerWidth)}else{view2_header.children(".datagrid-header-inner").css("width","100%")}};UCML.DataGrid.prototype.setSize=function(param,a){UCML.DataGrid.superclass.setSize.call(this,param);if(this.frozen){this.setFrozenBodySize()}else{var el=this.el;var width=this.el.width();var height=this.el.height();var view=el.children("div.datagrid-view");var body=this.body;var header=this.header;if(this.alignWidth){view.width(width);body.width(width);header.width(width);this.toolbar.width(width);this.totalRowBody.width(width);if(this.pagination){this.pagination.setSize({width:width})}el.css("width",null)}else{body.width(width);header.width(width);this.toolbar.width(width);this.totalRowBody.width(width)}if(this.height=="auto"){this.updataBody()}else{var viewHeight=height-el.children(".datagrid-pager:visible").outerHeight(true);view.height(viewHeight);var bodyHeight=viewHeight-header.outerHeight(true)-this.totalRowBody.outerHeight(true);body.height(bodyHeight)}var innerWidth=body[0].offsetWidth-body[0].clientWidth;if(body[0].clientWidth>0&&innerWidth>0){header.children(".datagrid-header-inner").width(width-innerWidth);this.totalRowBody.width(width-innerWidth)}else{header.children(".datagrid-header-inner").css("width","100%")}}};UCML.DataGrid.prototype.updataBody=function(){if(this.haveMergerTable){if(typeof this.keyFieldName=="string"){this.mergerData(this.keyFieldName,this.mergerFields)}else if(typeof this.keyFieldName=="object"){for(var i=0;i<this.keyFieldName.length;i++){this.mergerData(this.keyFieldName[i],this.mergerFields[i])}}}if(this.height=="auto"){if(this.frozen){var view=this.el.children("div.datagrid-view");var view1=view.children("div.datagrid-view1");var view2=view.children("div.datagrid-view2");var body=this.el.find("div.datagrid-body");var bodyHeight=$(".datagrid-body table",view2).outerHeight();this.frozenHeaderTable.height(this.headerTable.outerHeight());this.frozenBodyTable.height(bodyHeight);var innerHeight=body[1].offsetHeight-body[1].clientHeight;if(body[1].clientHeight>0&&innerHeight>0){bodyHeight=bodyHeight+innerHeight;body.height(bodyHeight)}else{body.css("height","auto")}view.height(view2.height())}else{var el=this.el;var width=this.el.width();var height=this.el.height();var view=el.children("div.datagrid-view");var body=view.children("div.datagrid-body");var header=view.children("div.datagrid-header");var bodyHeight=this.bodyTable.outerHeight();body.height(bodyHeight);var innerHeight=body[0].offsetHeight-body[0].clientHeight;if(body[0].clientHeight>0&&innerHeight>0){bodyHeight=bodyHeight+innerHeight;body.height(bodyHeight)}else{body.css("height","auto")}}}else{if(this.frozen){this.setSize()}else{var el=this.el;var width=this.el.width();var height=this.el.height();var view=el.children("div.datagrid-view");var body=view.children("div.datagrid-body");var header=view.children("div.datagrid-header");var innerWidth=body[0].offsetWidth-body[0].clientWidth;if(body[0].clientWidth>0&&innerWidth>0){header.children(".datagrid-header-inner").width(width-innerWidth);this.totalRowBody.width(width-innerWidth)}else{header.children(".datagrid-header-inner").css("width","100%")}}}};UCML.DataGrid.prototype.bindEvents=function(){UCML.DataGrid.superclass.bindEvents.call(this);var opt=this;if(!UCML.isEmpty(this.dataTable)){this.BusinessObject.on("onAfterLoadData",this.onAfterLoadData,this);this.dataTable.on("onLoad",this.BCLoadData,this);this.dataTable.on("OnFieldChange",this.onFieldChange,this);this.dataTable.on("OnAfterInsert",this.addRow,this);this.dataTable.on("OnAfterDelete",this.delRow,this);this.dataTable.on("OnValiate",this.onValiate,this);if(this.rowSelectMode==1){this.dataTable.on("OnRecordChange",this.onRecordChange,this)}}if(this.cellSelectMode==1){UCML.on(this.view,"keydown",this.handleKeyDown,this)}UCML.on(this.el,"mousedown",this.onMouseDown,this);UCML.on(this.el,"click",this.onClick,this);UCML.on(this.el,"dblclick",this.onDblClick,this);UCML.on(this.el,"keydown",this.onKeyDown,this);this.el.bind("contextmenu",function(e){opt.processEvent("contextmenu",e)});if(this.trackMouseOver){UCML.on(this.bodyTable,"mouseover",this.onRowOver,this);if(this.frozenBodyTable){UCML.on(this.frozenBodyTable,"mouseover",this.onRowOver,this);UCML.on(this.frozenBodyTable,"mouseout",this.onRowOut,this)}UCML.on(this.bodyTable,"mouseout",this.onRowOut,this)}this.bindSelectCellEvents();this.on("cellclick",this.cellClick,this);this.on("celldblclick",this.cellDbClick,this);this.on("rowclick",this.onRowClick,this);if(this.groupToggleMode==1){this.on("groupclick",this.groupClick,this)}else if(this.groupToggleMode==2){this.on("groupdblclick",this.groupClick,this)}this.on("headerclick",onHeaderCellClick);function onHeaderCellClick(headerCell,e){var headerCell=$(headerCell);if($(e.target).hasClass("datagrid-header-text")==true||$(e.target).hasClass("datagrid-sort-icon")==true){var fieldName=headerCell.attr("fieldName");if(!fieldName){return}var col=opt.getColumn(fieldName);if(!col){return}if(this.autoSort===false||col.autoSort===false)return;if(this.fireEvent("sortchange",col)!==false){var sortMode=col.sortMode;var c="";if(sortMode==null||sortMode==3){sortMode=0;c="datagrid-sort-asc";sortOrder="desc"}else if(sortMode==0){sortMode=1;c="datagrid-sort-desc"}else{c="";sortMode=3}col.sortMode=sortMode;$(".datagrid-header .datagrid-cell",this.el).removeClass("datagrid-sort-asc datagrid-sort-desc");headerCell.children(".datagrid-cell").addClass(c);if(this.customSort&&window[this.customSortFn]){window[this.customSortFn](fieldName,sortMode)}else{opt.dataTable.sort(fieldName,sortMode)}}}}$(".datagrid-header td:has(.datagrid-cell)",this.el).hover(function(){$(this).addClass("datagrid-header-over")},function(){$(this).removeClass("datagrid-header-over")});if(this.haveQueryRow){this.onQueryMenuReady();this.el.on("keydown",".datagrid-header .datagrid-header-query-cell[fieldName] .queryEdit",function(e){if(e.keyCode==13){var col=opt.getColumn($(this).attr("fieldName"));if(col&&col.queryEditControl){col.queryEditControl.blur()}setTimeout(function(){if(opt.customQuery&&window[opt.customQueryFn]){opt.onRunQueryCustom()}else{opt.onRunQuery()}},200);return false}}).on("click",".datagrid-header .datagrid-header-query-cell[fieldName] .queryEdit",function(){opt.clearActiveCell()});this.el.on("click",".datagrid-header .datagrid-header-query-cell[fieldName] .queryEditImg",function(e){e.stopPropagation();var fieldName=$(this).parent().parent().parent().parent().parent().attr("fieldName");var queryMenu=opt.queryMenu;queryMenu.fieldName=fieldName;var x=e.clientX;var y=e.clientY;var dbody=$(window.document.body);var dbWidth=dbody.outerWidth();var qmWidth=queryMenu.el.outerWidth();var dbHeight=dbody.outerHeight();var qmHeight=queryMenu.el.outerHeight();if(qmWidth>dbWidth){x=0}else if(x+qmWidth>dbWidth){x=x-(x+qmWidth-dbWidth)}if(qmHeight>dbHeight){y=0}else if(y+qmHeight>dbHeight){y=y-(y+qmHeight-dbHeight)}var column=opt.getColumn(queryMenu.fieldName);queryMenu.setCheckedMenuItem(column.cmd);opt.queryMenu.show({left:x-4,top:y})});this.queryMenu.on("menuItemClick",this.onQueryMenuItemClick,this)}};UCML.DataGrid.prototype.delRow=function(OID){if(!this.changeDataToView){return}this.activeRow=null;this.activeCell=null;var index=this.getRowIndexByOID(OID);var rowCount=this.getRowCount();if(this.rowNumbers){if(this.frozen)this.updateRowNumber(this.getFrozenRowByOID(OID));else this.updateRowNumber(this.getRowByOID(OID))}this.getRowByOID(OID).remove();if(this.frozen){this.getFrozenRowByOID(OID).remove()}this.updateTotalRow();this.setSize()};UCML.DataGrid.prototype.updateRowNumber=function(tr,rownumber){var text=!isNaN(rownumber)?rownumber+1:tr.find(".datagrid-cell-rownumber").text();var nexttr=tr.next();if(nexttr.length>0){nexttr.find(".datagrid-cell-rownumber").text(text);this.updateRowNumber(nexttr,parseInt(text))}};UCML.DataGrid.prototype.onRecordChange=function(e,sender){if(sender==this){return}var OID=this.dataTable.OID_GUID();var row=this.getRowByOID(OID);if(row.length){this.clearActiveCell();this.setFocusRow(row)}};UCML.DataGrid.prototype.clearActiveCell=function(e,sender){if(this.activeCell){this.unCellSelect(this.activeCell);this.activeCell=null}};UCML.DataGrid.prototype.insertRecord=function(){this.dataTable.Insert()};UCML.DataGrid.prototype.addRow=function(){if(!this.changeDataToView){return}var rowCount=this.dataTable.getRecordCount();if(this.frozen){var frozenBodyStr=this.renderRows(this.frozenColumns,true,rowCount-1,rowCount);var bodyStr=this.renderRows(this.notfrozenColumns,false,rowCount-1,rowCount);if(this.insertRecordByActiveRow&&this.activeRow){var selectTr,frozenSelectTr;selectTr=this.bodyTable.find("tr."+this.activeRowCls);frozenSelectTr=this.frozenBodyTable.find("tr."+this.activeRowCls);if(this.insertRecordByActiveRowTop){frozenSelectTr.before(frozenBodyStr);selectTr.before(bodyStr)}else{frozenSelectTr.after(frozenBodyStr);selectTr.after(bodyStr)}}else if(this.insertRecordTop){this.frozenBodyTable.find("tr:first").after(frozenBodyStr);this.bodyTable.find("tr:first").after(bodyStr)}else{this.frozenBodyTable.append(frozenBodyStr);this.bodyTable.append(bodyStr)}}else{var bodyStr=this.renderRows(this.columns,true,rowCount-1,rowCount);if(this.insertRecordByActiveRow&&this.activeRow){var selectTr;selectTr=this.bodyTable.find("tr."+this.activeRowCls);if(this.insertRecordByActiveRowTop){selectTr.before(bodyStr)}else{selectTr.after(bodyStr)}}else if(this.insertRecordTop){this.bodyTable.find("tr:first").after(bodyStr)}else{this.bodyTable.append(bodyStr)}}this.setSize();if(this.insertRecordTop||rowCount<=1){this.body.scrollTop(0);this.setFocusRowAt(0)}else{this.body.scrollTop(this.bodyTable.innerHeight());this.setFocusRowAt(rowCount-1)}};UCML.DataGrid.prototype.onValiate=function(config){var tr=this.getRowByOID(config.OID);var td=this.getCellByName(tr,config.fieldName);return this.doRuleCheck(td,config.columnInfo,config.value)};UCML.DataGrid.prototype.onFieldChange=function(e){if(!this.changeDataToView){return}var col=this.getColumn(e.fieldName);var bcCol=this.dataTable.getColumn(e.fieldName);if(col){var OID=this.dataTable.OID_GUID();var tr,td;if(this.frozen&&col.fixedColumn){tr=this.getFrozenRowByOID(OID);td=this.getCellByName(tr,e.fieldName)}else{tr=this.getRowByOID(OID);td=this.getCellByName(tr,e.fieldName)}if(this.fireEvent("fieldchange",td,e)===false){return}this.doRuleCheck(td,bcCol,e.value);this.setCellText(td,this.renderCell(col));this.updateTotalRowByFieldName(e.fieldName,col)}};UCML.DataGrid.prototype.setBCLink=function(fieldName,index,config){var OID=this.dataTable.OID_GUID();this.rows=this.rows||{};this.rows[OID]=this.rows[OID]||{};this.rows[OID][fieldName]=this.rows[OID][fieldName]||{};this.rows[OID][fieldName]["BCLink"]=this.rows[OID][fieldName]["BCLink"]||{};if(this.rows[OID][fieldName]["BCLink"][index]){UCML.apply(this.rows[OID][fieldName]["BCLink"][index],config)}else{this.rows[OID][fieldName]["BCLink"][index]=config}};UCML.DataGrid.prototype.getBCLink=function(fieldName,index){var OID=this.dataTable.OID_GUID();if(!this.rows){return false}if(!this.rows[OID]){return false}if(!this.rows[OID][fieldName]){return false}if(!this.rows[OID][fieldName]["BCLink"]){return false}if(!this.rows[OID][fieldName]["BCLink"][index]){return false}return this.rows[OID][fieldName]["BCLink"][index]};UCML.DataGrid.prototype.renderCell=function(col){var bcCol=this.dataTable.getColumn(col.fieldName);var OID=this.dataTable.OID_GUID();var value="";if(col.isFixColumnValue){value=UCML.isEmpty(col.fixColumnValue)?"":col.fixColumnValue}else{value=this.dataTable.getFieldValue(col.fieldName)}var text="";if(col.EditControl&&col.EditControl.renderedValue){text=col.EditControl.renderedValue(value)}else{if(bcCol.isCodeTable){value=this.BusinessObject.GetCodeCaption(bcCol.codeTable,value)}if(col.cellFormatter){col.isShowTitle=false;var returnText=col.cellFormatter.call(this,{text:text,OID:OID,fieldName:col.fieldName,column:col});if(returnText){return returnText}}var objBCLinkColl=col.objBCLinkColl||bcCol.objBCLinkColl;if(col.showBCLink!==false&&objBCLinkColl){col.isShowTitle=false;text="";this.CustomButtonPerm=new UCML.DataGrid.CustomButtonPerm(this);var flag=true;for(var i=0;i<objBCLinkColl.length;i++){if(objBCLinkColl[i].BCRunMode!=1){flag=false;break}}for(var n=0;n<objBCLinkColl.length;n++){if(objBCLinkColl[n].isDropDownMode==false){var caption="";if(objBCLinkColl[n].BCRunMode==5){caption=value==""?objBCLinkColl[n].caption==""?UCML.Languge.BCLinkText:objBCLinkColl[n].caption:value}else{caption=value==""?UCML.Languge.BCLinkText:value;if(flag){if(objBCLinkColl[n].condiFieldName&&objBCLinkColl[n].constValue){if(this.dataTable.getFieldValue(objBCLinkColl[n].condiFieldName)!=objBCLinkColl[n].constValue){continue}}}}var BCLinkConfig=this.getBCLink(col.fieldName,n);var style="";var disabled="";if(BCLinkConfig){if(BCLinkConfig.disable===true){style="color: gray;";disabled=" disabled=true"}if(BCLinkConfig.hiden===true){style=style+"display: none;"}if(BCLinkConfig.caption){caption=BCLinkConfig.caption}}else{if(this.CustomButtonPerm){for(var i=0;i<this.CustomButtonPerm.length;i++){var enabled=this.CustomButtonPerm[i]["enabled"];var visible=this.CustomButtonPerm[i]["visible"];var buttonid=this.CustomButtonPerm[i]["buttonid"];if(buttonid){var obj=buttonid.split("$");if(col.fieldName==obj[0]&&n==obj[1]){if(enabled=="false"||enabled==0){style="color: gray;";disabled=" disabled=true"}if(visible=="false"||visible==0){style=style+"display: none;"}break}}}}}BCLinkConfig.cls=BCLinkConfig.cls||"";text+="<a ctype='UCML.BCLink' dataFld='"+col.fieldName+"'  '"+disabled+"' style='"+style+"' linkIndex='"+n+"' href='javascript:void(0)' title='"+(BCLinkConfig.title||"")+"' class='datagrid-cell-bclink "+(BCLinkConfig.cls||"")+" ' BCName='"+this.dataTable.BCName+"'  >"+caption+"</a>"}}}else{text=value;if(col.EditType=="UCML.CheckBox"||UCML.isEmpty(col.EditType)==true&&bcCol.fieldType=="Boolean"){col.isShowTitle=false;col.align="center";var attrStr="";var chkStr="";if(value=="true"){attrStr+="checked ";chkStr="on "}if(!col.allowModify||this.enabledEdit==false){attrStr+="disabled ";chkStr+="no"}text="<span class='chk "+chkStr+"'><input type='CheckBox' ctype='UCML.CheckBox' dataFld='"+col.fieldName+"' "+attrStr+"  BCName='"+this.dataTable.BCName+"' /></span>"}else if(col.EditType=="UCML.Image"){if(text!=""){if(text==".jpg"||text==".png"||text==".jpeg"||text==".gif"||text==".bmp"){var src=UCMLLocalResourcePath+"File/Images/"+this.dataTable.TableName+"_"+col.fieldName+"/"+this.dataTable.getUserOID()+"/"+this.dataTable.getOID()+text}else if(text.indexOf("https://")!=-1||text.indexOf("http://")!=-1){var src=text}else if(text.indexOf("/")!=-1){var src=UCMLLocalResourcePath+text}else{var src=UCMLLocalResourcePath+"File/Images/System/"+text}text="<img height='"+this.rowHeight+"px' width='100%' src='"+src+"'>"}}}}return UCML.isEmpty(text)?"&#160;":text};UCML.DataGrid.prototype.renderRows=function(columns,frozen,start,end,number){var rowCount=this.dataTable.getRecordCount();var rowsStr=[];start=UCML.isEmpty(start)?0:start;end=UCML.isEmpty(end)?rowCount:end;var oldIndex=this.dataTable.recordIndex;for(var i=start;i<end;i++){this.dataTable.SetIndexNoEvent(i);var OID=this.dataTable.OID_GUID();var rowData={};if(this.beforeRowrender){rowData=this.beforeRowrender.call(this,{OID:OID})||{}}this.fireEvent("beforerowrender",{OID:OID},rowsStr);var bodyRowTpl=new UCML.Template(this.bodyRowStr);var cellsStr=[];var cls="";if(i%2&&this.striped){cls+=" datagrid-row-alt"}if(typeof BPOIsJQMPage!=="undefined"&&BPOIsJQMPage){var theme=BPOPageTheme||"a";if(i%2&&this.striped){cls+=" datagrid-row-alt-"+theme}else{cls+=" datagrid-row-"+theme}}else if(this.IsJQMPage){var theme=this.JQMPageTheme||"a";if(i%2&&this.striped){cls+=" datagrid-row-alt-"+theme}else{cls+=" datagrid-row-"+theme}}if(frozen==true&&this.rowNumbers&&this.showCheckBox){var bodyNumberTpl=new UCML.Template(this.bodyNumberStr);var text=number||i+1+this.dataTable.StartPos;var checkBoxValue="";if(this.dataTable.PrimaryKey==this.dataTable.TableName+"OID"){if(this.checkOID&&this.checkOID.indexOf(OID)!=-1){checkBoxValue="checked"}}else{if(this.checkKeys){var pkey=this.dataTable.getFieldValue(this.dataTable.PrimaryKey);for(var isun=0;isun<this.checkKeys.length;isun++){if(pkey==this.checkKeys[isun]){checkBoxValue="checked";break}}}}var bodyShowCheckBoxTpl=new UCML.Template(this.bodyShowCheckBoxStr);if(this.rowNumberBeforeCheckbox){cellsStr.add(bodyNumberTpl.apply({value:text}));cellsStr.add(bodyShowCheckBoxTpl.apply({checked:checkBoxValue,on:checkBoxValue==""?"":"on"}))}else{cellsStr.add(bodyShowCheckBoxTpl.apply({checked:checkBoxValue,on:checkBoxValue==""?"":"on"}));cellsStr.add(bodyNumberTpl.apply({value:text}))}}else{if(frozen==true&&this.rowNumbers){var bodyNumberTpl=new UCML.Template(this.bodyNumberStr);var text=number||i+1+this.dataTable.StartPos;cellsStr.add(bodyNumberTpl.apply({value:text}))}if(frozen==true&&this.showCheckBox){var checkBoxValue="";if(this.dataTable.PrimaryKey==this.dataTable.TableName+"OID"){if(this.checkOID&&this.checkOID.indexOf(OID)!=-1){checkBoxValue="checked"}}else{if(this.checkKeys){var pkey=this.dataTable.getFieldValue(this.dataTable.PrimaryKey);for(var isun=0;isun<this.checkKeys.length;isun++){if(pkey==this.checkKeys[isun]){checkBoxValue="checked";break}}}}var bodyShowCheckBoxTpl=new UCML.Template(this.bodyShowCheckBoxStr);cellsStr.add(bodyShowCheckBoxTpl.apply({checked:checkBoxValue,on:checkBoxValue==""?"":"on"}))}}for(var j=0;j<columns.length;j++){var col=columns[j];var display="";if(!col.display){display=" display:none;"}var bodyCellTpl=new UCML.Template(this.bodyCellStr);var text=this.renderCell(col);var cellCls="";if(this.nowrap){cellCls="datagrid-cell-nowrap"}var title="";if(col.isShowTitle!==false){if(col.EditType!="UCML.Image")title=text}var cellData={};if(col.beforeCellrender){cellData=col.beforeCellrender.call(this,{OID:OID,value:text,fieldName:col.fieldName})||{}}cellData["style"]="text-align:"+(col.align||"left")+";"+display+(cellData["style"]||"");cellData=UCML.apply({value:text,fieldName:col.fieldName,cls:cellCls,title:title},cellData);cellsStr.add(bodyCellTpl.apply(cellData))}rowData=UCML.apply({style:"height:"+this.rowHeight+"px;",cells:cellsStr.join(""),OID:OID,cls:cls},rowData);rowsStr.add(bodyRowTpl.apply(rowData));this.fireEvent("afterrowrender",{OID:OID,columns:columns,frozen:frozen},rowsStr)}this.dataTable.recordIndex=oldIndex;return rowsStr.join("")};UCML.DataGrid.prototype.updateRow=function(OID){var OID=OID||this.dataTable.OID_GUID();var index=this.dataTable.GetOIDIndex(OID);if(index<0){return}if(this.frozen){var frozenBodyStr=this.renderRows(this.frozenColumns,true,index,index+1);this.getFrozenRowByOID(OID).replaceWith(frozenBodyStr);var bodyStr=this.renderRows(this.notfrozenColumns,false,index,index+1);this.getRowByOID(OID).replaceWith(bodyStr)}else{var bodyStr=this.renderRows(this.columns,true,index,index+1);this.getRowByOID(OID).replaceWith(bodyStr)}};UCML.DataGrid.prototype.setDataBody=function(){if(this.frozen){var notfrozenColumnRow=this.bodyTable.find("tr:first");var frozenColumnRow=this.frozenBodyTable.find("tr:first");this.bodyTable.empty();this.frozenBodyTable.empty();var oldIndex=this.dataTable.recordIndex;var rowCount=this.dataTable.getRecordCount();var frozenBodyStr=this.renderRows(this.frozenColumns,true,0,rowCount);var bodyStr=this.renderRows(this.notfrozenColumns,false,0,rowCount);this.frozenBodyTable.append(frozenColumnRow);this.frozenBodyTable.append(frozenBodyStr);this.bodyTable.append(notfrozenColumnRow);this.bodyTable.append(bodyStr)}else{var notfrozenColumnRow=this.bodyTable.find("tr:first");this.bodyTable.empty();var bodyStr=this.renderRows(this.columns,true);this.bodyTable.append(notfrozenColumnRow);this.bodyTable.append(bodyStr)}};UCML.DataGrid.prototype.onAfterLoadData=function(data){if(this.BusinessObject.dataLoading==true){if(typeof IsHTMLPage!="undefined"&&IsHTMLPage==true&&typeof FUseMultiLanguage!="undefined"&&FUseMultiLanguage==true){if(this.moduleMode==0){var currTab=$("ul.tabs>li[ownervc='"+this.id+"']");if(currTab.length>0){currTab.find("span").text(getResourceData(this.id))}}else if(this.moduleMode==1||this.moduleMode==3){this.module.el.find(">div.panel-header>div.panel-title").text(getResourceData(this.id))}if($("#"+this.id+"Toolbar_Module").length>0){var vctbl=eval("ToolBar"+this.id);for(var i=0;i<vctbl.items.length;i++){if(typeof vctbl.items[i].text!="undefined"){vctbl.items[i].setText(getResourceData(vctbl.items[i].id))}}}if(this.rowNumbers){this.frozenHeader.find("div.datagrid-header-rownumber").text(UCML.Languge.DBRowNumberText)}for(var i=0;i<this.columns.length;i++){var headercell=$("td.datagrid-header-cell[fieldname='"+this.columns[i].fieldName+"']");if(headercell.length>0){headercell.find("span.datagrid-header-text").text(getResourceData(this.id+"_"+this.columns[i].fieldName))}}}var rowCount=this.dataTable.getRecordCount();if(this.asyncLoadData&&rowCount>this.asyncLoadDataByRecordCount){var opts=this;setTimeout(function(){opts.loadData(data)},100)}else{this.loadData(data)}}};UCML.DataGrid.prototype.BCLoadData=function(data){if(this.BusinessObject.dataLoading==false){return}this.loadData(data)};UCML.DataGrid.prototype.loadData=function(data){this.fireEvent("beforeloaddata",{});this.activeRow=null;this.activeCell=null;if(!this.crossPageCheck){this.checkOID=[];this.checkRecord.clear();this.checkKeys=[]}var beginDate=new Date;if(this.groupField){this.loadDataByGroup();this.updateTotalRow();this.updataBody()}else{this.setDataBody();this.updateTotalRow();this.updataBody()}this.fireEvent("loaddata",{});if(this.OnAppendDataPacket){this.OnAppendDataPacket.call(this)}};UCML.DataGrid.prototype.loadDataByGroup=function(data){var rowCount=this.dataTable.getRecordCount();var oldIndex=this.dataTable.recordIndex;var groupField=this.groupField;var groupTotalFields=null;var groupTotalCaptions=null;if(this.groupTotalFields)groupTotalFields=this.groupTotalFields.split(";");if(this.groupTotalCaptions)groupTotalCaptions=this.groupTotalCaptions.split(";");var groupDatas={};var col=this.getColumn(groupField);for(var i=0;i<rowCount;i++){this.dataTable.SetIndexNoEvent(i);var OID=this.dataTable.OID_GUID();var groupValue=this.dataTable.getFieldValue(groupField);if(col.isCodeTable&&col.codeTable){groupValue=GetCodeCaption(col.codeTable,groupValue)}if(!groupDatas[groupValue]){groupDatas[groupValue]={};groupDatas[groupValue]["OID"]=OID;groupDatas[groupValue]["groupValue"]=groupValue;groupDatas[groupValue]["items"]=[];groupDatas[groupValue]["total"]=[];if(groupTotalFields!=null)for(var j=0;j<groupTotalFields.length;j++){groupDatas[groupValue]["total"][groupTotalFields[j]]={};groupDatas[groupValue]["total"][groupTotalFields[j]].caption=groupTotalCaptions[j];groupDatas[groupValue]["total"][groupTotalFields[j]].value=0;var totalcol=this.getColumn(groupTotalFields[j]);groupDatas[groupValue]["total"][groupTotalFields[j]].col=totalcol}}groupDatas[groupValue]["items"].add(OID);if(groupTotalFields!=null)for(var j=0;j<groupTotalFields.length;j++){groupDatas[groupValue]["total"][groupTotalFields[j]].value+=parseFloat(this.dataTable.getFieldValue(groupTotalFields[j]))}}this.dataTable.recordIndex=oldIndex;this.groupDatas=groupDatas;if(this.frozen){this.bodyTable.empty();this.frozenBodyTable.empty();this.frozenBodyTable.append(this.renderGroupGrid(groupDatas,this.frozenColumns,true));this.bodyTable.append(this.renderGroupGrid(groupDatas,this.notfrozenColumns,false))}else{this.bodyTable.empty();this.bodyTable.append(this.renderGroupGrid(groupDatas,this.columns,true))}};UCML.DataGrid.prototype.renderGroupGrid=function(groupDatas,columns,fisrtTable){var rowsStr=[];
var columnRowStr=this.getRenderColumns(columns,fisrtTable);rowsStr.add(columnRowStr);var columnCount=columns.length;if(fisrtTable){if(this.rowNumbers){columnCount++}if(this.showCheckBox){columnCount++}}var number=1;for(var name in groupDatas){var groupItem=groupDatas[name];this.fireEvent("beforegrouprender",{OID:groupItem.OID,groupValue:groupItem.groupValue});var groupRowTpl=new UCML.Template(this.groupRowStr);var groupItems="";if(fisrtTable){groupItems="<a class='datagrid-group-icon datagrid-group-collapse' >&#160;</a>"+(groupItem.groupValue==""?"&#160;":groupItem.groupValue)}else{groupItems="<a class='datagrid-group-icon'>&#160;</a>"+"&#160;"}var groupTotalFields=null;var groupTotalCaptions=null;if(this.groupTotalFields)groupTotalFields=this.groupTotalFields.split(";");if(this.groupTotalCaptions)groupTotalCaptions=this.groupTotalCaptions.split(";");if(this.groupTotalFields)for(var j=0;j<groupTotalFields.length;j++){var value=groupDatas[groupItem.groupValue]["total"][groupTotalFields[j]].value;var col=groupDatas[groupItem.groupValue]["total"][groupTotalFields[j]].col;if(col.EditControl&&col.EditControl.renderedValue){value=col.EditControl.renderedValue(value)}groupItems+="&#160;&#160;&#160;&#160;<a >"+groupDatas[groupItem.groupValue]["total"][groupTotalFields[j]].caption+":"+value+"</a>"+"&#160;"}rowsStr.add(groupRowTpl.apply({style:"height:"+this.rowHeight+"px;",groupItems:groupItems,colspan:columnCount,cls:"",OID:groupItem.OID,groupValue:groupItem.groupValue}));for(var i=0;i<groupItem["items"].length;i++){var itemOID=groupItem["items"][i];index=this.dataTable.GetOIDIndex(itemOID);if(index>-1){rowsStr.add(this.renderRows(columns,fisrtTable,index,index+1,number++))}}}return rowsStr.join("")};UCML.DataGrid.prototype.showGroupItem=function(groupValue){this.setGroupItemState(groupValue,true)};UCML.DataGrid.prototype.hideGroupItem=function(groupValue){this.setGroupItemState(groupValue,false)};UCML.DataGrid.prototype.setGroupItemState=function(groupValue,v){var groupItem=this.groupDatas[groupValue];if(groupItem){for(var i=0;i<groupItem["items"].length;i++){var itemOID=groupItem["items"][i];if(this.frozen){if(v){this.getFrozenRowByOID(itemOID).show();this.getRowByOID(itemOID).show()}else{this.getFrozenRowByOID(itemOID).hide();this.getRowByOID(itemOID).hide()}}else{if(v){this.getRowByOID(itemOID).show()}else{this.getRowByOID(itemOID).hide()}}}}};UCML.DataGrid.prototype.groupToggle=function(target){if(this.fireEvent("groupchange")!==false){var el=$(target);var groupValue=el.attr("groupValue");var icons=el.children(".datagrid-group-icon");if(icons.hasClass("datagrid-group-collapse")){icons.removeClass("datagrid-group-collapse").addClass("datagrid-group-expand");this.hideGroupItem(groupValue)}else if(icons.hasClass("datagrid-group-expand")){icons.removeClass("datagrid-group-expand").addClass("datagrid-group-collapse");this.showGroupItem(groupValue)}else{this.groupToggle(this.frozenBodyTable.find("tr[rowType=groupRow] > td > div[groupValue="+groupValue+"]"))}}};UCML.DataGrid.prototype.processEvent=function(name,e){this.fireEvent(name,e);var target=UCML.isElement(e)?e:e.target;var el=$(target);var headerCell=this.findHeaderCell(el);if(headerCell!=false){this.fireEvent("header"+name,headerCell,e);return}var cell=this.findCell(el);if(cell!=false){var row=cell.parentNode;this.fireEvent("row"+name,row,e);this.fireEvent("cell"+name,row,cell,e)}else{var row=this.findRow(target);var elRow=$(row);if(row!=false&&elRow.attr("rowType")=="bodyRow"){this.fireEvent("row"+name,row,e)}if(row!=false&&elRow.attr("rowType")=="groupRow"){this.fireEvent("group"+name,row,e)}else{this.fireEvent("container"+name,e)}}};UCML.DataGrid.prototype.onClick=function(el,e){var target=$(e.target);this.processEvent("click",e);if(this.showCheckBox&&(this.clicksToCheck==1&&this.rowSelectMode==2)==false&&target.parents().hasClass("datagrid-cell-check")){this.checkChange(this.findRow(e.target),e.target.checked);return}if(target.attr("ctype")=="UCML.BCLink"){var fieldName=target.attr("dataFld");var index=parseInt(target.attr("linkIndex"))||0;var BCLinkConfig=this.getBCLink(fieldName,index);var style="";if(BCLinkConfig){if(BCLinkConfig.disable===true){return}}startBCLink(target[0])}else if(target.attr("ctype")=="UCML.CheckBox"){var value=e.target.checked?"true":"false";this.dataTable.setFieldValue(target.attr("dataFld"),value)}};UCML.DataGrid.prototype.onMouseDown=function(el,e){this.processEvent("mousedown",e)};UCML.DataGrid.prototype.onMouseup=function(el,e){this.processEvent("mouseup",e)};UCML.DataGrid.prototype.onMouseMove=function(el,e){this.processEvent("mousemove",e)};UCML.DataGrid.prototype.onDblClick=function(el,e){this.processEvent("dblclick",e)};UCML.DataGrid.prototype.onKeyDown=function(el,e){this.processEvent("keydown",e)};UCML.DataGrid.prototype.onRowOver=function(el,e){var rowIndex=this.findRowIndex(e.target);if(rowIndex!==false){this.addRowClass(rowIndex,this.rowOverCls)}};UCML.DataGrid.prototype.onRowOut=function(el,e){var rowIndex=this.findRowIndex(e.target);if(rowIndex!==false){this.removeRowClass(rowIndex,this.rowOverCls)}};UCML.DataGrid.prototype.setColumnVisible=function(fieldName,visible){var col=this.getColumn(fieldName);if(col){col.display=visible}};UCML.DataGrid.prototype.setColumnEnabled=function(fieldName,canModify){var col=this.getColumn(fieldName);if(col){col.allowModify=canModify}};UCML.DataGrid.prototype.setFieldPermission=function(fieldName,visible,canModify){var col=this.getColumn(fieldName);if(col){col.allowModify=canModify;col.display=visible}};UCML.DataGrid.prototype.setFocusRowAt=function(rowIndex){rowIndex=rowIndex||0;var row=this.frozen?this.getFrozenRow(rowIndex):this.getRow(rowIndex);this.setFocusRow(row)};UCML.DataGrid.prototype.setFocusRow=function(row){var el=$(row);var OID=el.attr("OID");if(this.dataTable.OID_GUID()!=OID){this.dataTable.LocateOID_GUID(OID,this)}if(this.rowSelectMode<=0){return}else if(this.rowSelectMode==1){if(this.activeRow){this.removeRowClass(this.getRowIndex(this.activeRow),this.activeRowCls)}this.unRowSelect(this.activeRow);this.onRowSelect(row)}else{if(this.isRowSelect(row)){this.unRowSelect(row)}else{this.onRowSelect(row)}}this.addRowClass(this.getRowIndex(row),this.activeRowCls);this.activeRow=row};UCML.DataGrid.prototype.unRowSelect=function(row){if(!UCML.isEmpty(row)){var rowIndex=this.getRowIndex(row);if(rowIndex<0){return}this.removeRowClass(rowIndex,this.rowSelectCls)}};UCML.DataGrid.prototype.clearCheckRows=function(){var count=this.getRowCount();for(var i=0;i<count;i++){if(this.showCheckBox){var rowIndex=i;var row;if(this.frozen){row=this.getFrozenRow(rowIndex)}else{row=this.getRow(rowIndex)}if(row){this.checkChange(row,false,false)}}}};UCML.DataGrid.prototype.checkChange=function(row,checked,noEvent){if(!UCML.isEmpty(row)){var rowIndex=this.getRowIndex(row);if(rowIndex<0){return}if(this.frozen){row=this.getFrozenRow(rowIndex)}else{row=this.getRow(rowIndex)}if(row){var el=$(row);var checkBox=el.find(".datagrid-cell-check :checkbox");if(checkBox.length){checkBox.attr("checked",checked);if(checked==true){checkBox.parent("span.chk").addClass("on")}else{checkBox.parent("span.chk").removeClass("on")}if(noEvent==undefined||noEvent==false)this.fireEvent("checkChange",checked,row);if(checked){this.onRowSelect(el);var OID=el.attr("OID");this.checkOID.remove(OID);this.checkOID.add(OID);var pkey=this.dataTable.getFieldValue(this.dataTable.PrimaryKey);this.checkKeys.remove(pkey);this.checkKeys.add(pkey);this.checkRecord.replace(pkey,this.dataTable.getCurrentRecord())}else{this.unRowSelect(el);var OID=el.attr("OID");this.checkOID.remove(OID);var pkey=this.dataTable.getFieldValue(this.dataTable.PrimaryKey);this.checkKeys.remove(pkey);this.checkRecord.removeKey(pkey)}}}}this.fireEvent("aftercheckchange",checked,row)};UCML.DataGrid.prototype.removeRowCheckBoxByOID=function(OID){if(this.frozen){var height=this.getFrozenRowByOID(OID).find(".datagrid-cell-check").outerHeight(true);this.getFrozenRowByOID(OID).find(".datagrid-cell-check").find("input").remove();this.getFrozenRowByOID(OID).find(".datagrid-cell-check").height(height)}else{var height=this.getRowByOID(OID).find(".datagrid-cell-check").outerHeight(true);this.getRowByOID(OID).find(".datagrid-cell-check").find("input").remove();this.getRowByOID(OID).find(".datagrid-cell-check").height(height)}};UCML.DataGrid.prototype.removeRowCheckBoxByAt=function(i){if(this.frozen){var height=$(this.getFrozenRows()[i+1]).find(".datagrid-cell-check").outerHeight(true);$(this.getFrozenRows()[i+1]).find(".datagrid-cell-check").find("input").remove();$(this.getFrozenRows()[i+1]).find(".datagrid-cell-check").height(height)}else{var height=$(this.getRows()[i+1]).find(".datagrid-cell-check").outerHeight(true);$(this.getRows()[i+1]).find(".datagrid-cell-check").find("input").remove();$(this.getRows()[i+1]).find(".datagrid-cell-check").height(height)}};UCML.DataGrid.prototype.onRowSelect=function(row){if(!UCML.isEmpty(row)){var rowIndex=this.getRowIndex(row);if(rowIndex<0){return}this.addRowClass(rowIndex,this.rowSelectCls)}};UCML.DataGrid.prototype.isRowSelect=function(row){if(row){row=$(row);return row.hasClass(this.rowSelectCls)}};UCML.DataGrid.prototype.isRowCheck=function(row){if(row){row=$(row);return row.find(".datagrid-cell-check :checkbox")[0].checked}};UCML.DataGrid.prototype.isRowCheckByOID=function(OID){if(OID){var row;if(this.frozen){row=this.getFrozenRowByOID(OID)}else{row=this.getRowByOID(OID)}if(row&&row.length>0){return this.isRowCheck(row)}return false}};UCML.DataGrid.prototype.deleteCheckRow=function(){var checks=this.getCheckOID();for(var i=0;i<checks.length;i++){if(this.dataTable.LocateOID_GUID(checks[i])){this.dataTable.Delete()}}};UCML.DataGrid.prototype.isRowSelectByOID=function(OID){if(OID){row=this.getRowByOID(OID);if(row&&row.length>0){return row.hasClass(this.rowSelectCls)}return false}};UCML.DataGrid.prototype.getSelectRows=function(){return this.bodyTable.find("tr."+this.rowSelectCls)};UCML.DataGrid.prototype.getSelectOID=function(){var rows=this.bodyTable.find("tr."+this.rowSelectCls);var OIDS=[];for(var i=0;i<rows.length;i++){OIDS.add($(rows[i]).attr("OID"))}return OIDS};UCML.DataGrid.prototype.getCheckOID=function(separator){if(separator){return this.checkOID.join(separator)}else{return this.checkOID}};UCML.DataGrid.prototype.getCheckRecord=function(){return this.checkRecord};UCML.DataGrid.prototype.getCheckKeys=function(){return this.checkKeys};UCML.DataGrid.prototype.setCheckOID=function(values,separator){checkRows=values;if(separator){checkRows=values.split(separator)}for(var i=0;i<checkRows.length;i++){var oid=checkRows[i];var row=this.getRowByOID(oid);if(row.length>0){this.checkChange(row,true,true)}}};UCML.DataGrid.prototype.getCheckByFieldValues=function(fieldName,separator){var checkRows=this.getCheckOID();var dataTable=this.dataTable;var values=[];var oldIndex=dataTable.getRecordIndex();for(var i=0;i<checkRows.length;i++){var oid=checkRows[i];if(dataTable.LocateOID_GUID(oid)){values.add(dataTable.getFieldValue(fieldName))}}dataTable.SetIndexNoEvent(oldIndex);if(separator){return values.join(separator)}else{return values}};UCML.DataGrid.prototype.setFocusCell=function(cell,preventFocus){if(this.rowSelectMode>0){var row=cell.parentNode;if(this.activeRow!=row){this.setFocusRow(row)}}if(this.cellSelectMode<=0||this.rowSelectMode==2){return}if(this.cellSelectMode==1){this.unCellSelect(this.activeCell);this.onCellSelect(cell)}if(preventFocus!==true){cell.focus()}cell=$(cell);this.activeCell=cell[0]};UCML.DataGrid.prototype.isCellSelect=function(cell){if(cell){cell=$(cell);return cell.hasClass(this.cellSelectCls)}};UCML.DataGrid.prototype.unCellSelect=function(cell){if(cell){cell=$(cell);cell.removeClass(this.cellSelectCls)}};UCML.DataGrid.prototype.onCellSelect=function(cell){if(cell){cell=$(cell);cell.addClass(this.cellSelectCls)}};UCML.DataGrid.prototype.onRowClick=function(row){if(this.endEdit()===false){return}this.setFocusRow(row);if(this.showCheckBox&&this.clicksToCheck==1&&this.rowSelectMode==2){var checked=this.isRowSelect(row);this.checkChange(row,checked)}};UCML.DataGrid.prototype.groupClick=function(row){this.groupToggle($(row).find("td .datagrid-cell-group"))};UCML.DataGrid.prototype.cellClick=function(row,cell){if(this.endEdit()===false){return}if(this.clicksToEdit==1){this.beginEdit(cell)}else if(this.cellSelectMode==1){this.setFocusCell(cell)}if(this.onCellDbClick){this.onCellDbClick(row,cell)}if(this.OnCellClick){this.OnCellClick(row,cell)}};UCML.DataGrid.prototype.cellDbClick=function(row,cell){if(this.clicksToEdit==2){this.beginEdit(cell)}else if(this.cellSelectMode==2){this.setFocusCell(cell)}if(this.onCellDbClick){this.onCellDbClick(row,cell)}if(this.OnCellDbClick){this.OnCellDbClick(row,cell)}if(this.OnCellDblClick){this.OnCellDblClick(row,cell)}};UCML.DataGrid.prototype.handleKeyDown=function(el,e){if(!this.activeCell){return}var tr=this.activeCell.parentNode;var table=tr.parentNode.parentNode;var td;if(e.keyCode==38&&!this.activeEditor){if(tr.rowIndex>1){tr=table.rows[tr.rowIndex-1];td=tr.cells[this.activeCell.cellIndex];if(td==null){var i=tr.rowIndex-1;while(td==null&&i>0){td=table.rows[i].cells[this.activeCell.cellIndex];i--}}}}else if(e.keyCode==40&&!this.activeEditor){if(tr.rowIndex<table.rows.length-1){tr=table.rows[tr.rowIndex+this.activeCell.rowSpan];td=tr.cells[this.activeCell.cellIndex]}}else if(e.keyCode==37&&!this.activeEditor){var nIndex=0;if(this.showCheckBox){nIndex++}if(this.rowNumbers){nIndex++}if(this.activeCell.cellIndex>0){td=tr.cells[this.activeCell.cellIndex-this.activeCell.colSpan]}else if(this.activeCell.cellIndex==nIndex&&this.frozen==true&&this.bodyTable[0]==table){td=this.frozenBodyTable[0].rows[tr.rowIndex].cells[this.frozenBodyTable[0].rows[tr.rowIndex].cells.length-1]}}else if(e.keyCode==39&&!this.activeEditor){if(this.activeCell.cellIndex<tr.cells.length-1){td=tr.cells[this.activeCell.cellIndex+this.activeCell.colSpan]}else if(this.activeCell.cellIndex==tr.cells.length-1&&this.frozen==true&&this.frozenBodyTable[0]==table&&this.frozenBodyTable[0].rows[tr.rowIndex].cells.length>0){td=this.bodyTable[0].rows[tr.rowIndex].cells[0]}else if(this.activeCell.cellIndex+this.activeCell.colSpan-1==tr.cells.length-1&&tr.rowIndex<table.rows.length-1){td=table.rows[tr.rowIndex+1].cells[0]}}else if(e.keyCode==13&&!this.activeEditor){if(!this.beginEdit(this.activeCell)){this.selectNextCell();if(this.enterToEdit){this.beginEdit(this.activeCell)}}}if(td){this.setFocusCell(td);return}if(!e.ctrlKey&&this.activeCell&&this.clicksToEdit==2){if(this.activeEditor){}else{this.beginEdit(this.activeCell)}}};UCML.DataGrid.prototype.selectUpRow=function(){if(!this.activeRow){this.setFocusRowAt(0)}else if(this.activeRow.rowIndex>1&&this.activeRow.rowIndex<=this.getRowCount()){this.setFocusRowAt(this.activeRow.rowIndex-2)}};UCML.DataGrid.prototype.selectNextRow=function(){if(!this.activeRow){this.setFocusRowAt(0)}else if(this.activeRow.rowIndex>0&&this.activeRow.rowIndex<this.getRowCount()){this.setFocusRowAt(this.activeRow.rowIndex)}};UCML.DataGrid.prototype.selectNextCell=function(){if(!this.activeCell){return}var td;var tr=this.activeCell.parentNode;var table=tr.parentNode.parentNode;var nIndex=0;if(this.showCheckBox){nIndex++}if(this.rowNumbers){nIndex++}if(this.activeCell.cellIndex<tr.cells.length-1){td=tr.cells[this.activeCell.cellIndex+this.activeCell.colSpan]}else if(this.activeCell.cellIndex==tr.cells.length-1&&this.frozen==true&&this.frozenBodyTable[0]==table&&this.frozenBodyTable[0].rows[tr.rowIndex].cells.length>0){td=this.bodyTable[0].rows[tr.rowIndex].cells[0]}else if(this.activeCell.cellIndex+this.activeCell.colSpan-1==tr.cells.length-1&&tr.rowIndex<table.rows.length-1){if(this.frozen){td=this.frozenBodyTable[0].rows[tr.rowIndex+1].cells[0]}else{td=table.rows[tr.rowIndex+1].cells[0]}}else{this.setFocusCell(this.activeCell)}if(td){this.setFocusCell(td);if(UCML.isIE7||UCML.isIE6){var body=$(table).parents(".datagrid-body");var scrollWidth=body[0].scrollWidth;var width=body.width();var left=parseInt((scrollWidth-width)/width*$(this.activeCell).position().left);$(table).parents(".datagrid-body")[0].scrollLeft=left}return}else{if(!this.dataTable.EnabledAppend||!this.enterToInsert){return}this.dataTable.Insert();if(this.frozen){td=this.frozenBodyTable[0].rows[tr.rowIndex+1].cells[0]}else{td=table.rows[tr.rowIndex+1].cells[0]}this.setFocusCell(td);if(UCML.isIE7||UCML.isIE6){var body=$(table).parents(".datagrid-body");var scrollWidth=body[0].scrollWidth;var width=body.width();var left=parseInt((scrollWidth-width)/width*$(this.activeCell).position().left);$(table).parents(".datagrid-body")[0].scrollLeft=left}return}};UCML.DataGrid.prototype.addRowClass=function(rowIndex,cls){$(this.getRow(rowIndex)).addClass(cls);if(this.frozen){$(this.getFrozenRow(rowIndex)).addClass(cls)}};UCML.DataGrid.prototype.removeRowClass=function(rowIndex,cls){$(this.getRow(rowIndex)).removeClass(cls);if(this.frozen){$(this.getFrozenRow(rowIndex)).removeClass(cls)}};UCML.DataGrid.prototype.findRowIndex=function(el){var row=this.findRow(el);return row?row.rowIndex:false};UCML.DataGrid.prototype.findRow=function(el){var tr;el=$(el);if(el.hasClass("datagrid-row")){return el[0]}tr=el.parents("tr.datagrid-row");if(tr.length>0){return tr[0]}else{return false}};UCML.DataGrid.prototype.getFrozenRowByOID=function(OID){return this.frozenBodyTable.find("tr[OID="+OID+"]")};UCML.DataGrid.prototype.getFrozenRow=function(rowIndex){if(rowIndex>=0){return this.getFrozenRows()[rowIndex+1]}};UCML.DataGrid.prototype.getCellByName=function(row,name){return $(row).children("[fieldName="+name+"]")};UCML.DataGrid.prototype.getRow=function(rowIndex){if(rowIndex>=0){return this.getRows()[rowIndex+1]}};UCML.DataGrid.prototype.getRowIndex=function(row){var rowIndex=-1;if(!UCML.isNumber(row)){row=$(row);if(row.length>0){rowIndex=row[0].rowIndex-1}}else{rowIndex=row}return rowIndex};UCML.DataGrid.prototype.getRowByOID=function(OID){if(OID.length<36){if(this.dataTable){OID=this.dataTable.GetGUIDBy_OID(OID)}}return this.bodyTable.find("tr[OID="+OID+"]")};UCML.DataGrid.prototype.getRowCount=function(){if(this.frozen){return this.getFrozenRows().length-1}else{return this.getRows().length-1}};UCML.DataGrid.prototype.getRowIndexByOID=function(OID){var row;var index=-1;if(this.frozen){row=this.getFrozenRowByOID(OID)}else{row=this.getRowByOID(OID)}if(row&&row.length>0){index=row[0].rowIndex-1}return index};UCML.DataGrid.prototype.getRows=function(){return this.bodyTable[0].rows};UCML.DataGrid.prototype.getFrozenRows=function(){return this.frozenBodyTable[0].rows};UCML.DataGrid.prototype.findCell=function(el){var td;el=$(el);if(el.hasClass("datagrid-td")){return el[0]}td=el.parents("td.datagrid-td");if(td.length>0){return td[0]}else{return false}};UCML.DataGrid.prototype.findHeaderCell=function(el){var td;el=$(el);if(el.hasClass("datagrid-header-cell")){return el[0]}td=el.parents("td.datagrid-header-cell");if(td.length>0){return td[0]}else{return false}};UCML.DataGrid.prototype.findCellIndex=function(el){var cell=this.findCell(el);return cell?cell.cellIndex:false};UCML.DataGrid.prototype.getCells=function(row){return row.cells};UCML.DataGrid.prototype.getCell=function(row,cellIndex){return this.getCells(row)[cellIndex]};UCML.DataGrid.prototype.isFrozenColumn=function(fieldName){var col=this.getColumn(fieldName);if(col.fixedColumn){return true}return false};UCML.DataGrid.prototype.getCurrentColumnInfo=function(){if(this.activeCell!=null){var fieldName=$(this.activeCell).attr("fieldName");return this.getColumn(fieldName)}else return this.columns[0]};UCML.DataGrid.prototype.columnIsNumber=function(fieldName){return this.dataTable.columnIsNumber(fieldName)};UCML.DataGrid.prototype.getTotalDataByFieldName=function(fieldName,mode){if(!fieldName||!mode){return""}var columnInfo=this.dataTable.getColumn(fieldName);var curField=this.dataTable.TableName+"."+columnInfo.fieldName;if(columnInfo.fieldKind==2)curField="al"+columnInfo.foreignKeyField+"."+columnInfo.lookupResultField;else if(columnInfo.fieldKind==5&&columnInfo.QueryRefColumn){curField=bcColumn.QueryRefColumn}var cond=this.dataTable.getForeignCondition();return getTotalData(this.dataTable.BCName,cond.fieldList+this.dataTable.getFieldList(),cond.valueList+this.dataTable.getValueList(),cond.condiIndentList+this.dataTable.getCondiIndentList(),this.dataTable.theSQLCondi,0,"",curField,mode,function(){},function(obj,text){alert("统计出错:"+text)},null,false)};UCML.DataGrid.prototype.setCellText=function(cell,value){$(cell).find("div.datagrid-cell").html(value).removeClass("datagrid-editable")};UCML.DataGrid.prototype.beginEdit=function(cell){this.setFocusCell(cell,true);cell=$(cell);if(this.enabledEdit==false){return false}if(this.dataTable.IsRecordOwner()==false){alert("您现在无权修改这条记录!");return false}else{var fieldName=cell.attr("fieldName");var col=this.getColumn(fieldName);if(!col){return false}var bcColumn=this.dataTable.getColumn(col.fieldName);var value=this.dataTable.getFieldValue(col.fieldName);var objBCLinkColl=col.objBCLinkColl||bcColumn.objBCLinkColl;if(!col.allowModify||objBCLinkColl){return false}var config={column:col,bcColumn:bcColumn,value:value,fieldName:fieldName};var col=config.column;var fieldName=config.fieldName;var value=config.value;var bcColumn=config.bcColumn;if(this.fireEvent("beforebeginedit",{value:value,fieldName:fieldName})===false){return false}var ctype=col.EditType||col.editContrl;if(this.endEdit()===false){return false}this.editCell=cell[0];var obj=new Object;if(bcColumn.isCodeTable){document.body.onselectstart=document.body.ondrag=function(){return false};ctype="UCML.DropDownList";obj.isCodeTable=true;obj.isSetProperties=false;obj.codeTable=bcColumn.codeTable}else{document.body.onselectstart=null}obj.dataTable=this.dataTable;obj.fieldName=fieldName;obj.value=value;obj.applet=this;obj.BusinessObject=this.BusinessObject;if(this.dataTable.columnIsNumber(fieldName)){obj.precision=bcColumn.decLength}if(!col.EditControl){if(!ctype){switch(bcColumn.fieldType){case"Date":ctype="UCML.TextBox";break;case"DateTime":ctype="UCML.TextBox";break;case"Time":ctype="UCML.TextBox";break;case"Boolean":return false;break}}else{switch(ctype){case"INPUT":ctype="UCML.TextBox";break;case"UCML.CheckBox":return;case"DATETIME":case"UCML.DateTimeBox":case"DATEEDIT":ctype="UCML.TextBox";break;case"DATE":case"UCML.DateBox":ctype="UCML.TextBox";break;case"TIME":case"UCML.TimeBox":ctype="UCML.TextBox";break;case"TEXTAREA":ctype="UCML.TextArea";break;case"UCML.Html":ctype="UCML.TextBox";break}}obj.ctype=ctype||"UCML.TextBox";if(ctype=="UCML.TextArea"){var cellWidth=cell.outerWidth();var cellHeight=cell.outerHeight();obj.width=cellWidth<200?200:cellWidth;obj.height=cellHeight<50?50:cellHeight}this.activeEditor=this.createEdit(cell,obj)}else{col.EditControl.dataTable=this.dataTable;col.EditControl.fieldName=fieldName;obj.value=value;this.activeEditor=col.EditControl;this.setEditOffset(cell,obj);this.activeEditor.show()}if(ctype!="UCML.TextArea"){UCML.on(this.activeEditor,"keydown",this.onActiveEditorKeyDown,this);this.activeEditor.el.bind("keypress",function(e){if(e.keyCode==13){return false}})}this.activeEditor.on("blur",this.onEditBlur,this);this.activeEditor.on("setValue",this.setControlValue,this.activeEditor);this.updateEdit(cell,this.activeEditor,obj);if(this.activeEditor.focus){this.activeEditor.focus()}if(this.activeEditor.select){this.activeEditor.select()}return true}};UCML.DataGrid.prototype.setControlValue=function(value){var bcCol=this.applet.dataTable.getColumn(this.fieldName);this.applet.doRuleCheck(this.applet.editCell,bcCol,value);this.dataTable.setFieldValue(this.fieldName,value,this)};UCML.DataGrid.prototype.onEditBlur=function(edit){document.body.onselectstart=null;this.endEdit()};UCML.DataGrid.prototype.onActiveEditorKeyDown=function(el,e){if(e.keyCode==13){var col=this.getCurrentColumnInfo();if(this.activeEditor&&this.activeEditor.blur){this.activeEditor.blur()}var opts=this;setTimeout(function(){if(opts.endEdit()===false){return false}if(col.nextEditField!=undefined&&col.nextEditField!=""){var targetCol=opts.getColumn(col.nextEditField);if(opts.getColumnIndex(targetCol.fieldName)>opts.getColumnIndex(col.fieldName)){if(targetCol.display){var cell=opts.getCellByName(opts.activeRow,col.nextEditField);opts.setFocusCell(cell)}else{opts.selectNextCell()}}else{if(opts.activeRow.rowIndex<opts.getRowCount()){opts.selectNextRow();var cell=opts.getCellByName(opts.activeRow,col.nextEditField);opts.setFocusCell(cell)}else{opts.dataTable.Insert();if(targetCol.display){var cell=opts.getCellByName(opts.activeRow,col.nextEditField);opts.setFocusCell(cell)}else{if(this.frozen){td=this.frozenBodyTable[0].rows[tr.rowIndex+1].cells[0]}else{td=table.rows[tr.rowIndex+1].cells[0]}opts.setFocusCell(td)}}}}else{opts.selectNextCell()}if(opts.enterToEdit&&opts.activeCell){opts.beginEdit(opts.activeCell)}},200)}};UCML.DataGrid.prototype.createEdit=function(cell,obj){this.setEditOffset(cell,obj);obj.rendeTo=this.el.children(".datagrid-edit-body");obj.isRuleCheck=false;var dataCell=UCML.create(obj,obj.ctype);if(dataCell.tagName=="input"||dataCell.tagName=="textarea"){dataCell.addClass("datagrid-editable-input")}return dataCell};UCML.DataGrid.prototype.setEditOffset=function(cell,obj){var offset=cell.offset();obj.top=obj.top||offset.top;obj.left=obj.left||offset.left;obj.width=obj.width||cell.outerWidth();obj.height=obj.height||cell.outerHeight();var body=cell.parents(".datagrid-body");var bodyLeft=body.offset().left;var bodyRight=bodyLeft+body[0].clientWidth;if(obj.left+obj.width>bodyRight){obj.width=bodyRight-obj.left}if(obj.left<0){obj.width=obj.width-(bodyLeft-obj.left);obj.left=bodyLeft}else if(obj.left<bodyLeft){obj.left=bodyLeft;obj.width=obj.width-(bodyLeft-obj.left)}var w=cell.outerWidth(true)-cell.innerWidth();var h=cell.outerHeight(true)-cell.innerHeight();obj.left=obj.left-w;obj.top=obj.top-h;this.el.children(".datagrid-edit-body").offset({top:obj.top,left:obj.left})};UCML.DataGrid.prototype.updateEdit=function(cell,dataCell,obj){dataCell.setValue(obj.value,false);dataCell.resize(obj.width,obj.height);return dataCell};UCML.DataGrid.prototype.doRuleCheck=function(cell,col,val){var value=val;var objColumn=col;var result=null;if(typeof ACColumnInputRule!="undefined"){for(var m=0;m<ACColumnInputRule.length;m++){if(objColumn.fieldName==ACColumnInputRule[m].FieldName&&this.dataTable.BCName==ACColumnInputRule[m].BCName){var inputParams=new Array;inputParams[inputParams.length]=value;if(ACColumnInputRule[m].ExParam1!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam2!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam3!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(ACColumnInputRule[m].ExParam4!=""){var strsrl=new Array;var strrlist=ACColumnInputRule[m].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var rresult=ExecuteRule(ACColumnInputRule[m].RuleMethod,inputParams);rresult.PromptMode=ACColumnInputRule[m].PromptMode;result=rresult;if(result){cell=$(cell);if(cell.length>0){if(result.ReturnCode!="OK"){cell.addClass(this.ruleCheckCellCls);if(!cell[0].Validatebox){cell[0].Validatebox=new UCML.Validatebox(cell[0])}cell[0].Validatebox.setTipMessage(result.ReturnDescText);cell[0].Validatebox.showTip();return false}else{cell.removeClass(this.ruleCheckCellCls);if(cell[0].Validatebox){cell[0].Validatebox.hideTip()}}}}}}}if(result==null)if(objColumn.allowNull==true&&!UCML.isEmpty(value)&&(objColumn.RuleList!=null&&objColumn.RuleList.length>0)){for(var i=0;i<objColumn.RuleList.length;i++){var inputParams=new Array;inputParams[inputParams.length]=value;if(objColumn.RuleList[i].ExParam1!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam1;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam2!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam2;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam3!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam3;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}if(objColumn.RuleList[i].ExParam4!=""){var strsrl=new Array;var strrlist=objColumn.RuleList[i].ExParam4;strsrl=strrlist.split("[");if(strsrl[0]==""){var thisvalue=strsrl[1].split("]")[0];inputParams[inputParams.length]=this.dataTable.getFieldValue(thisvalue)}else{inputParams[inputParams.length]=strrlist}}var rresult=ExecuteRule(objColumn.RuleList[i].RuleMethod,inputParams);rresult.PromptMode=objColumn.RuleList[i].PromptMode;if(objColumn.RuleList[i].InputTip!=""){rresult.ReturnDescText=objColumn.RuleList[i].InputTip}result=rresult;if(result){cell=$(cell);if(cell.length>0){if(result.ReturnCode!="OK"){if(result.PromptMode==0){cell.addClass(this.ruleCheckCellCls);if(!cell[0].Validatebox){cell[0].Validatebox=new UCML.Validatebox(cell[0])}cell[0].Validatebox.setTipMessage(result.ReturnDescText);cell[0].Validatebox.showTip();return false}else if(result.PromptMode==1){alert(result.ReturnDescText)}}else{cell.removeClass(this.ruleCheckCellCls);if(cell[0].Validatebox){cell[0].Validatebox.hideTip()}}}}}}else if(objColumn.allowNull==false&&UCML.isEmpty(value)){cell=$(cell);if(cell.length>0){cell.addClass(this.ruleCheckCellCls);if(!cell[0].Validatebox){cell[0].Validatebox=new UCML.Validatebox(cell[0])}error=UCML.Languge.BCfieldLanguge+" "+objColumn.caption+" "+UCML.Languge.BCnotForNull;cell[0].Validatebox.setTipMessage(error);cell[0].Validatebox.showTip();return false}}else{cell=$(cell);cell.removeClass(this.ruleCheckCellCls);if(cell[0]&&cell[0].Validatebox){cell[0].Validatebox.hideTip()}}return true};UCML.DataGrid.prototype.endEdit=function(){if(this.activeEditor){var fieldName=this.activeEditor.fieldName;var bcCol=this.dataTable.getColumn(fieldName);var value=this.activeEditor.getValue();var col=this.getColumn(fieldName);if(!this.doRuleCheck(this.editCell,bcCol,value)){if(this.activeEditor.focus){this.activeEditor.focus()}return false}this.activeEditor.un("blur",this.onEditBlur,this);if(this.fireEvent("endedit",this.editCell,{value:value,fieldName:fieldName})===false){return false}if(col.EditControl){this.activeEditor.hide()}else{this.activeEditor.destroy()}if(bcCol.isCodeTable){value=this.BusinessObject.GetCodeCaption(bcCol.codeTable,value)}this.setCellText(this.editCell,this.renderCell(col));delete this.activeEditor;delete this.editCell}return true};UCML.DataGrid.prototype.fixColumnSize=function(cell,data){var opts=this;if(cell){fix(cell,data)}else{$(".datagrid-header td",this.el).each(function(){var headerCell=$(this);var fieldName=headerCell.attr("fieldName");var col=opts.getColumn(fieldName);col.width=$.boxModel==true?headerCell.width():headerCell.outerWidth();fix(this)})}function fix(cell){var headerCell=$(cell);if(headerCell.width()==0)return;
var fieldName=headerCell.attr("fieldName");var col=opts.getColumn(fieldName);if(!col){return}this.fireEvent("columnresize",{fieldName:fieldName,col:col,data:data});col.width=data.width;opts.el.find("tr[rowType='colRow'] > td[fieldName='"+fieldName+"']").width(col.width);$(this).css("width",null);var totalWidth;if(!opts.alignWidth){if(col.fixedColumn){totalWidth=opts.getTotalWidth(opts.frozenColumns);if(this.rowNumbers){totalWidth=+this.rowNumberWidth}if(this.showCheckBox){totalWidth=+this.showCheckBoxWidth}opts.frozenBodyTable.width(totalWidth+"px");if(opts.frozenTotalRowTable){opts.frozenTotalRowTable.width(totalWidth+"px")}}else{totalWidth=opts.getTotalWidth(opts.notfrozenColumns);opts.bodyTable.width(totalWidth+"px");if(opts.totalRowTable){opts.totalRowTable.width(totalWidth+"px")}}headerCell.parent().parent().parent().width(totalWidth+"px")}}};UCML.override(UCML.DataGrid,{totalRowBodyStr:'<div class="datagrid-totalrowbody"><table border="0" cellspacing="0" cellpadding="0" style="{tstyle}" class="datagrid-body-table"><tbody>{columnRow}{totalStr}</tbody></table></div>',totalRowStr:'<tr class=" {cls}"  style="{style}"  >{cells}</tr>',totalCellStr:'<td  style="{style}"  class="datagrid-column-{fieldName}" fieldName="{fieldName}" frozen="{frozen}">'+'<div  class="datagrid-cell {cls}" >{value}'+"</div></td>",totalText:"合计",totalTextFieldName:null,haveTotalRow:false,ComputeFieldList:null,haveBottomTotalRow:true,getTotalText:function(){return this.totalText},getHaveTotalRow:function(){return this.haveTotalRow?true:false},getComputeFieldList:function(){return this.ComputeFieldList||""},isTotalField:function(fieldName){var bcCol=this.dataTable.getColumn(fieldName);var flgComputeFieldList=false;var computeFieldList=this.getComputeFieldList();var fieldListArray=computeFieldList.split(";");if(fieldListArray.length>0&&fieldListArray[0]!=""){flgComputeFieldList=true}if(getExistComputeField(fieldName)){return true}else if(!flgComputeFieldList&&this.columnIsNumber(fieldName)){return true}return false;function getExistComputeField(fieldName){if(flgComputeFieldList){for(var i=0;i<fieldListArray.length;i++){if(fieldListArray[i]==fieldName){return true}}}return false}},getTotalRowPosition:function(){if(this.haveBottomTotalRow){return"bottom"}else{return"top"}},updateTotalRow:function(columns){columns=columns||this.columns;for(var j=0;j<columns.length;j++){var col=columns[j];if(this.totalTextFieldName==col.fieldName){this.setTotalRowByFieldName(col.fieldName,this.getTotalText())}else{this.updateTotalRowByFieldName(col.fieldName,col)}}},updateTotalRowByFieldName:function(fieldName,col){if(this.totalTextFieldName==fieldName){return}else if(col.totalCompute||this.isTotalField(fieldName)){if(col.serverTotalComputeMode){var value=this.getTotalDataByFieldName(fieldName,col.serverTotalComputeMode);this.setTotalRowByFieldName(fieldName,value)}else{switch(col.totalComputeMode){case"SUM":this.setTotalRowByFieldName(fieldName,this.dataTable.sum(fieldName));break;case"AVG":this.setTotalRowByFieldName(fieldName,this.dataTable.avg(fieldName));break;case"MAX":this.setTotalRowByFieldName(fieldName,this.dataTable.max(fieldName));break;case"MIN":this.setTotalRowByFieldName(fieldName,this.dataTable.min(fieldName));break;case"COUNT":this.setTotalRowByFieldName(fieldName,this.dataTable.count(fieldName));break;default:this.setTotalRowByFieldName(fieldName,this.dataTable.sum(fieldName));break}}}},setTotalRowByFieldName:function(fieldName,value){var table=this.totalRowTable;if(this.isFrozenColumn(fieldName)){table=this.frozenTotalRowTable||table}table.find("td[fieldName="+fieldName+"] > .datagrid-cell").html(value)},renderTotalRow:function(columns,frozen){var totalRowTpl=new UCML.Template(this.totalRowStr);var totalStr="";var cellsStr=[];var cls="";if(frozen==true&&this.rowNumbers){var totalCellTpl=new UCML.Template(this.totalCellStr);var text=this.getTotalText();this.totalTextFieldName="rowNumber";cellsStr.add(totalCellTpl.apply({value:text}))}if(frozen==true&&this.showCheckBox){var totalCellTpl=new UCML.Template(this.totalCellStr);cellsStr.add(totalCellTpl.apply({value:""}))}for(var j=0;j<columns.length;j++){var col=columns[j];var display="";if(!col.display){display=" display:none;"}var totalCellTpl=new UCML.Template(this.totalCellStr);var text="&#160;";if(!this.totalTextFieldName&&j==0){this.totalTextFieldName=col.fieldName}cellsStr.add(totalCellTpl.apply({value:text,fieldName:col.fieldName,frozen:frozen,style:"text-align:"+(col.align||"left")+";"+display,cls:""}))}totalStr=totalRowTpl.apply({style:"height:"+this.rowHeight+"px;",cells:cellsStr.join(""),cls:cls});return totalStr}});UCML.override(UCML.DataGrid,{clipboardCellSign:"\t",clipboardRowSign:"\r\n",setSelelctIndex:function(){this.selectMouseUp=null;this.selectRowStart=-1;this.selectRowEnd=-1;this.selectCellStart=-1;this.selectCellEnd=-1;this.selectRowStart_old=-1;this.selectRowEnd_old=-1;this.selectCellStart_old=-1;this.selectCellEnd_old=-1},bindSelectCellEvents:function(){if(this.enabledSelect){this.on("beforeloaddata",function(){this.setSelelctIndex()},this);UCML.on(this.bodyTable,"mousedown",onTableMousedown,this);UCML.on(this.bodyTable,"mouseup",onTableMouseup,this);UCML.on(this.bodyTable,"mousemove",onTableMousemove,this);UCML.on(this.bodyTable,"keydown",onTableKeydown,this);UCML.on(this.bodyTable,"selectstart",onTableSelectstart,this);function onTableMousedown(el,e){if(e.button<2){var target=e.target;var el=$(target);var cell=this.findCell(el);if(cell){var row=cell.parentNode;this.selectMouseUp=true;this.selectCellStart=cell.cellIndex;this.selectRowStart=row.rowIndex;drawCellBackGround.call(this,-1,-1,-1,-1)}}}function onTableMouseup(el,e){if(e.button<2&&this.selectRowStart&&this.selectCellStart){var target=e.target;var el=$(target);var cell=this.findCell(el);if(cell){var row=cell.parentNode;this.selectMouseUp=false;this.selectCellEnd=cell.cellIndex;this.selectRowEnd=row.rowIndex;if(this.selectRowEnd<this.selectRowStart){var c=this.selectRowStart;this.selectRowStart=this.selectRowEnd;this.selectRowEnd=c}if(this.selectCellEnd<this.selectCellStart){var c=this.selectCellStart;this.selectCellStart=this.selectCellEnd;this.selectCellEnd=c}drawCellBackGround.call(this,this.selectRowStart,this.selectRowEnd,this.selectCellStart,this.selectCellEnd)}}}function onTableMousemove(el,e){if(e.button<2&&this.selectRowStart&&this.selectCellStart){var _rowStart=this.selectRowStart;var _cellStart=this.selectCellStart;if(_rowStart==-1&&_cellStart==-1)return;if(this.selectMouseUp!=true)return;var target=e.target;var el=$(target);var cell=this.findCell(el);if(cell){var row=cell.parentNode;this.selectMouseUp=false;this.selectCellEnd=cell.cellIndex;this.selectRowEnd=row.rowIndex;if(this.selectRowEnd<this.selectRowStart){var c=this.selectRowStart;this.selectRowStart=this.selectRowEnd;this.selectRowEnd=c}if(this.selectCellEnd<this.selectCellStart){var c=this.selectCellStart;this.selectCellStart=this.selectCellEnd;this.selectCellEnd=c}drawCellBackGround.call(this,this.selectRowStart,this.selectRowEnd,this.selectCellStart,this.selectCellEnd)}}}function onTableSelectstart(){if(this.selectMouseUp)return false;else return true}function onTableKeydown(el,e){if(e.ctrlKey&&e.keyCode==67){this.copyRowData(this.selectRowStart,this.selectRowEnd,this.selectCellStart,this.selectCellEnd);return false}else if(e.ctrlKey&&e.keyCode==86){this.pasteRowData(this.selectRowStart,this.selectRowEnd,this.selectCellStart,this.selectCellEnd);return false}}function drawCellBackGround(srartRows,endRows,srartCells,endCells){if(this.selectRowStart_old!=-1&&this.selectRowEnd_old!=-1&&this.selectCellStart_old!=-1&&this.selectCellEnd_old!=-1){for(i=this.selectRowStart_old;i<=this.selectRowEnd_old;i++){if(i<this.bodyTable[0].rows.length){for(j=this.selectCellStart_old;j<=this.selectCellEnd_old;j++){var td=this.bodyTable[0].rows(i).cells(j);var el=$(td);var fieldName=el.attr("fieldName");if(fieldName){el.css("backgroundColor","")}}}}}this.selectRowStart_old=srartRows;this.selectRowEnd_old=endRows;this.selectCellStart_old=srartCells;this.selectCellEnd_old=endCells;if(srartRows==-1&&srartCells==-1)return;if(srartRows==endRows&&srartCells==endCells)return;for(i=srartRows;i<=endRows;i++){for(j=srartCells;j<=endCells;j++){var td=this.bodyTable[0].rows(i).cells(j);var el=$(td);var fieldName=el.attr("fieldName");if(fieldName){el.css("backgroundColor","#0000ff")}}}}this.drawCellBackGround=drawCellBackGround}},pasteRowData:function(srartRows,endRows,srartCells,endCells){srartRows=srartRows||this.selectRowStart;endRows=endRows||this.selectRowEnd;srartCells=srartCells||this.selectCellStart;endCells=endCells||this.selectCellEnd;if(srartRows==-1||endRows==-1||srartCells==-1||endCells==-1){alert("请选择单元格");return}var ss=this.el.find(".toexcel-area");ss.focus();ss.select();var opts=this;setTimeout(function(){opts.setRowData(ss.val(),srartRows,endRows,srartCells,endCells);opts.drawCellBackGround(srartRows,endRows,srartCells,endCells)},50);return;this.drawCellBackGround(srartRows,endRows,srartCells,endCells)},setRowData:function(str,srartRows,endRows,srartCells,endCells){var rowList=str.split("\n");var index=this.dataTable.recordIndex;var rowlength=rowList.length;if(index+rowlength>this.dataTable.recordCount){rowlength=this.dataTable.recordCount-index}endRows=srartRows+rowlength-1;var irTop=this.insertRecordTop;this.insertRecordTop=false;var pasteFM=this.pasteRowFormat.split(",");var useFormatPaste=false;if(pasteFM.length>1){useFormatPaste=true}for(var m=srartRows;m<srartRows+rowlength;m++){if(rowList[m-srartRows]!=null&&rowList[m-srartRows]!=""){if(m>this.getRowCount()){this.dataTable.Insert()}this.dataTable.SetIndexNoEvent(m-1);var cellList=rowList[m-srartRows].split(this.clipboardCellSign);var celllength=cellList.length;if(srartCells+celllength>this.getRow(m-1).cells.length)celllength=this.getRow(m-1).cells.length-srartCells;endCells=srartCells+celllength-1;if(useFormatPaste){var pasteFMlength=pasteFM.length;for(var n=0;n<pasteFMlength;n++){var colIndex=parseInt(pasteFM[n]);if(colIndex==NaN||colIndex>this.getRow(m-1).cells.length){alert("贴入格式定义错误!");return}if(colIndex>0){var td=this.getRow(m-1).cells[colIndex-1];var fieldName=$(td).attr("fieldName");if(fieldName!=null)this.dataTable.setFieldValue(fieldName,cellList[n])}}}else{for(var n=srartCells;n<srartCells+celllength;n++){var td=this.getRow(m-1).cells[n];var fieldName=$(td).attr("fieldName");if(fieldName!=null)this.dataTable.setFieldValue(fieldName,cellList[n-srartCells])}}}}this.insertRecordTop=irTop;this.dataTable.SetIndexNoEvent(index)},copyRowData:function(srartRows,endRows,srartCells,endCells){srartRows=srartRows||this.selectRowStart;endRows=endRows||this.selectRowEnd;srartCells=srartCells||this.selectCellStart;endCells=endCells||this.selectCellEnd;if(srartRows==-1||endRows==-1||srartCells==-1||endCells==-1){alert("请选择单元格");return}var str="";var index=this.dataTable.recordIndex;for(var i=srartRows;i<=endRows;i++){this.dataTable.SetIndexNoEvent(i-1);for(var j=srartCells;j<=endCells;j++){var fieldName=$(this.bodyTable[0].rows(i).cells(j)).attr("fieldName");if(fieldName!=null){str+=this.dataTable.getFieldValue(fieldName);if(j!=endCells){str+=this.clipboardCellSign}}}if(i!=endRows)str+=this.clipboardRowSign}this.dataTable.SetIndexNoEvent(index);try{window.clipboardData.setData("Text",str)}catch(e){alert("禁止访问剪切板,错误代码:"+e.message)}}});UCML.DataGrid.prototype.setCustomColumn=function(){for(var i=0;i<this.columns.length;i++){this.columns[i].display=true}this.rebuildGrid()};UCML.DataGrid.prototype.setCellValue=function(fieldName,val,OID){if(OID){this.dataTable.LocateOID(OID)}this.dataTable.setFieldValueBack(fieldName,val);var row=this.getRow(this.dataTable.getRecordIndex());var cell=this.getCellByName(row,fieldName);this.setCellText(cell,val)};UCML.extend(UCML.DataGrid,{cellDbClick:function(){}});UCML.override(UCML.DataGrid,{gridSearchPanel:null,createSearchPanel:function(){this.gridSearchPanel=new UCML.GridSearch({title:"选择",applet:this,condiIsUser:this.condiIsUser})},condiIsUser:false,DoSearch:function(isUser){if(isUser&&isUser==true)this.condiIsUser=true;else this.condiIsUser=false;if(this.gridSearchPanel)this.gridSearchPanel.open();else this.createSearchPanel()}});UCML.DataGrid.CustomButtonPerm=function(vc){var objList=[];try{this.data=BusinessData[vc.id+"CustomButtonPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"AllowModify");var visible=this.getValue(i,"AllowVisible");var buttonid=this.getValue(i,"ButtonID");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["buttonid"]=buttonid;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.DataGrid.CustomButtonPerm.fields=["RESP_AppletCustomButtonOID","AllowModify","AllowVisible","Caption","ButtonType","AppletName","ButtonID","UCMLClass_FK","Applet_FK","UCML_RESPONSIBILITY_FK","AppletButton_FK"];UCML.DataGrid.CustomButtonPerm.prototype.getFieldIndex=function(name){return UCML.DataGrid.CustomButtonPerm.fields.indexOf(name)};UCML.DataGrid.CustomButtonPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.BPOLink=function(id){UCML.BPOLink.superclass.constructor.call(this,id)};UCML.extend(UCML.BPOLink,UCML.Applet,{ctype:"UCML.BPOLink",scroll:"no",autoFrameHeight:true,setBusinessObjectURL:function(value){if(this.frame&&this.frame.length>0){this.frame[0].contentWindow.document.write("");this.frame[0].src="";this.frame.remove();delete this.frame;if($.browser.msie){CollectGarbage()}}this.iframe=$("<iframe src='"+value+"' scrolling="+this.scroll+" width='100%'   frameborder=0 ></IFRAME>");this.el.empty();var opts=this;this.iframe.bind("load",function(){if(opts.autoFrameHeight){if($){$(opts.iframe[0].contentWindow).bind("resize",function(){opts.iframe.height($(opts.iframe[0].contentWindow.document.body).height())});opts.iframe.height($(opts.iframe[0].contentWindow.document.body).height())}opts.iframe.attr("height","100%")}});this.el.append(this.iframe);this.setSize()},setSize:function(param){UCML.BPOLink.superclass.setSize.call(this,param);if(this.iframe){if(!isNaN(this.width)){this.iframe.width(this.el.width())}if(!isNaN(this.height)){this.iframe.height(this.el.height())}if(this.autoFrameHeight){}}},destroy:function(){if(this.frame){if(this.frame.length>0){this.frame[0].contentWindow.document.write("");this.frame[0].contentWindow.document.clear();this.frame[0].src="";if($.browser.msie){CollectGarbage()}}this.frame.remove();delete this.frame}UCML.BPOLink.superclass.destroy.call(this)}});UCML.BPOLink.prototype.setHight=function(value){if(this.iframe){this.iframe.height(value)}};UCML.BPOLink.prototype.setHightAuto=function(){if(this.iframe){var dh=this.iframe[0].contentWindow.document.documentElement.scrollHeight;var bh=this.iframe[0].contentWindow.document.body.scrollHeight;var h=Math.max(bh,dh);this.iframe.height(h)}};UCML.BusinessUnit=function(el){this.CodeTableList=new Array;this.onLoad=function(){};this.el=window||el;UCML.apply(el,this);UCML.BusinessUnit.superclass.constructor.call(this);this.UseTableList=new Array;this.applets=new Array;this.addEvents("onInit","beforeOpen","afterOpen","onLoad","onLoadData","onBeforeLoadData","onAfterLoadData","beforerender","render","afterrender","AfterCondiQuery");return this};UCML.extend(UCML.BusinessUnit,UCML.util.Observable,{servicePath:"",initState:false,dataLoading:false,promptSubmit:true,theBPOName:"",theDeltaData:null,fitWindow:false,getPath:function(){return this.servicePath},setPath:function(servicePath){this.servicePath=servicePath},setSkin:function(name,value){var ucmlappCss=document.getElementById("ucmlappCss");if(ucmlappCss){ucmlappCss.href=UCMLLocalResourcePath+value+"css/ucmlapp.css"}this.fireEvent("skinChange",name,value);if(this.el.skinChange){this.el.skinChange(name,value)}},open:function(){UCML.applyIf(this.el,this);if(this.el.PrepareColumn){this.el.PrepareColumn()}this.fireEvent("beforerender");if(this.el.beforeRender){this.el.beforeRender()}if(this.fitWindow){$("html").css({height:"100%",overflow:"hidden"});$("body").css({height:"100%",overflow:"hidden",border:"none"});var MainPanel=new UCML.Container({el:$("#MainPanel"),alignWidth:true,alignHeight:true})}else{if($("div.public-head[data-role='header']").length>0){$("div.public-head[data-role='header']").addClass("ui-header-fix");$("#MainPanel").addClass("hasTopBar");$("#MainPanel").css("min-height",$("#MainPanel").height()-43+"px")}if($("div.bpo-toolbar").length>0){$("#MainPanel").addClass("hasBottomBar");$("#MainPanel").css("min-height",$("#MainPanel").height()-50+"px")}}if(this.el.onRender){this.el.onRender();this.fireEvent("render")}if(this.el.setTemplate){this.el.setTemplate()}if(this.el.afterRender){this.el.afterRender();this.fireEvent("afterrender")}if(this.el.setFlowBusiness){this.el.setFlowBusiness()}if(this.el.onInit){this.el.onInit()}this.fireEvent("beforeOpen");if(this.el.onBeforeOpen){this.el.onBeforeOpen()}if(this.el.currentWindow){this.el.currentWindow.setSize()}if(typeof IsHTMLPage!="undefined"&&IsHTMLPage==true){if(this.el.BusinessInit){var opts=this;var bu_methodName="BusiViewString";var bu_params={};var sURL=window.location.href.toString();if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");bu_params={urlParams:arrParams[1]}}if(window["BusiView_MethodName"]){bu_methodName=window["BusiView_MethodName"]}if(window["BusiView_Params"]){bu_params=window["BusiView_Params"]}var config={methodName:bu_methodName,params:bu_params,onSuccess:function(obj,text,methodName){var o=eval(text);if(typeof FUseMultiLanguage!="undefined"&&FUseMultiLanguage==true){document.title=getResourceData(opts.BPOName);if($("div.public-head[data-role='header']").length>0){$("div.public-head[data-role='header']").find("a").text(getResourceData("Header-Back"));$("div.public-head[data-role='header']").find("h1").text(getResourceData($("div[data-role='header']").attr("id")==undefined?opts.BPOName:$("div[data-role='header']").attr("id")))}}if(opts.el.setFlowBusiness){opts.el.setFlowBusiness()}opts.fireEvent("onLoad");window.RecordCountInfo=RecordCountInfo;if(BusinessData&&opts.el.BusinessData==null){opts.el.BusinessData=BusinessData}opts.loadData(opts.el.BusinessData);opts.afterLoadData();opts.el.BusinessInit()},onFailure:this.failed_ChangeBusiViewString,useGet:false};return this.invoke(config)}else{this.fireEvent("onLoad");this.loadData(this.el.BusinessData);this.afterLoadData()}}else this.fireEvent("onLoad");this.loadData(this.el.BusinessData);this.afterLoadData();if(this.el.BusinessInit){this.el.BusinessInit()}this.fireEvent("afterOpen");if(this.el.onAfterOpen){this.el.onAfterOpen()}this.BPOToolBarPerm();this.initState=true},setFlowBusiness:function(){if(this.el.BusinessData){this.flowActionlist={};var permissionCodeList=this.el.BusinessData["PermissionCodeEx"];if(permissionCodeList){var appletColumnPerm={};var appletButtonPerm={};var appletPerm=[];for(var i=0;i<permissionCodeList.length;i++){var objectType=permissionCodeList[i][1];var appletName=permissionCodeList[i][10];if(objectType==3){var ColumnPerm=appletColumnPerm[appletName]||[];var obj={};obj["fieldName"]=permissionCodeList[i][3];obj["allowModify"]=permissionCodeList[i][4];obj["allowVisible"]=permissionCodeList[i][5];obj["defaultValue"]=permissionCodeList[i][12];obj["notAllowNull"]=permissionCodeList[i][11];ColumnPerm.add(obj);appletColumnPerm[appletName]=ColumnPerm}else if(objectType==2){var ButtonPerm=appletButtonPerm[appletName]||[];var obj={};obj["caption"]=permissionCodeList[i][3];obj["enabled"]=permissionCodeList[i][4];obj["visible"]=permissionCodeList[i][5];ButtonPerm.add(obj);appletButtonPerm[appletName]=ButtonPerm}else if(objectType==1){var obj={};obj["caption"]=permissionCodeList[i][2];obj["appletname"]=permissionCodeList[i][3];obj["enabled"]=permissionCodeList[i][4];obj["visible"]=permissionCodeList[i][5];appletPerm.add(obj)}else if(objectType==4){var obj={name:permissionCodeList[i][3],caption:permissionCodeList[i][2],type:permissionCodeList[i][7]};this.flowActionlist[permissionCodeList[i][3]]=obj}}}this.el["appletColumnPerm"]=appletColumnPerm;this.el["appletButtonPerm"]=appletButtonPerm;this.el["appletPerm"]=appletPerm}},loadData:function(data){if(data){this.NotifyTable(data);this.fireEvent("onLoadData",data);this.dataLoading=true}},addApplet:function(applet){this.applets.add(applet)},afterLoadData:function(){this.fireEvent("onAfterLoadData")},addTask:function(methodName){this.taskList=this.taskList||{};this.taskList[methodName]={};this.taskList[methodName]["status"]=0},setTask:function(methodName,config){this.taskList=taskList||{};this.taskList[methodName]={};UCML.apply(this.taskList[methodName],config)},getTask:function(methodName){this.taskList=this.taskList||{};return this.taskList[methodName]},removeTask:function(methodName){this.taskList=this.taskList||{};delete this.taskList[methodName]},invoke:function(servicePath,methodName,useGet,params,onSuccess,onFailure,userContext,async,toTask,classFullName){if(arguments.length==1){var p=servicePath;methodName=p.methodName;useGet=p.useGet;params=p.params||{};onSuccess=p.onSuccess;onFailure=p.onFailure;onFailure=p.onFailure;userContext=p.userContext;async=p.async;servicePath=p.servicePath;classFullName=p.classFullName||""}servicePath=servicePath||this.servicePath;if(toTask&&getTask(methodName)){return}else{addTask(methodName)}var _lastparaName="";for(var n in params){_lastparaName=n}var newparams={};var _parameters="";var parametCount=0;var _paraNames="";for(var n in params){if(parametCount>0){_parameters+=",";_paraNames+=","}if(n==_lastparaName&&UCML.isArray(params[n])){var _lastparV="";var _lastparN="";var _lastparcount=0;for(var nn=0;nn<params[n].length;nn++){if(_lastparcount>0){_lastparV+=",";_lastparN+=","}_lastparV+=params[n][nn];_lastparN+=n+"_ucmlparams_"+nn;_lastparcount++;newparams[n+"_ucmlparams_"+nn]=params[n][nn]}_parameters+=_lastparV;_paraNames+=_lastparN;parametCount=parametCount+_lastparcount}else{_parameters+=params[n];_paraNames+=n;newparams[n]=params[n];parametCount++}}var _pUrl="";var sURL=window.document.URL.toString();while(true){if(sURL.lastIndexOf("#")==sURL.length-1)sURL=sURL.substring(0,sURL.length-1);else break}if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");_pUrl=arrParams[1]}params={_bpoName:this.BPOName+"Service",_methodName:methodName,_parameters:newparams,_paraNames:_paraNames,_pUrl:_pUrl,_classFullName:classFullName};var path=UCMLLocalResourcePath+"UCMLWebServiceEntryForJs.aspx";var meName="";var dataType="text";async=async==undefined?true:async;var type="post";if(useGet){type="GET"}var opt=this;var soect=userContext||this;if(async){$.ajax({type:type,dataType:dataType,url:path,data:params,success:function(o){removeTask(methodName);var text=o;var obj=eval(o);if(obj&&obj.status==0){onFailure.call(soect,o,obj.text,methodName)}else{onSuccess.call(soect,o,obj.text,methodName)}},error:function(o){removeTask(methodName);onFailure.call(soect,o,o.responseText,methodName)}})}else{var obj=$.ajax({type:type,url:path,data:params,dataType:dataType,async:false});var text=obj.responseText;removeTask(methodName);var obj=eval(text);if(obj&&obj.status==0&&onFailure){onFailure.call(soect,text,obj.text,methodName)}else if(onSuccess){onSuccess.call(soect,text,obj.text,methodName)}return obj.text}},startBCLink:function(BCLink){BCLink.el=$(BCLink.el);if(BCLink.BCRunMode){var fieldName=BCLink.el.attr("dataFld");if(!fieldName){return}BCLink.fieldName=fieldName;var bc;if(!BCLink.dataTable){bc=eval(BCLink.el.attr("BCName")+"Base");BCLink.dataTable=bc}else{bc=BCLink.dataTable}var objBCLinkColl=bc.getColumn(fieldName).objBCLinkColl;if(objBCLinkColl){BCLink.objBCLoadCondiColl=objBCLinkColl[0].objBCLoadCondiColl}}else if(UCML.isElement(BCLink)){var el=$(BCLink);var fieldName=el.attr("dataFld");if(!fieldName){return}var bc=eval(el.attr("BCName")+"Base");if(!bc){return}var linkIndex=el.attr("linkIndex")||0;var objBCLinkColl=bc.getColumn(fieldName).objBCLinkColl;if(!objBCLinkColl){return}BCLink=objBCLinkColl[linkIndex];BCLink.el=el;BCLink.dataTable=bc;BCLink.fieldName=fieldName}if(BCLink.BCRunMode!=4){if(BCLink.BCRunMode==5){var fn=eval(BCLink.urlFuncName);fn(BCLink);return}var bcLinKBPOName=BCLink.BCName+"BPO";var linkWindow=UCML.get(bcLinKBPOName);if(!linkWindow){linkWindow=BCLink.showWindow=new UCML.Window({id:bcLinKBPOName,isSetProperties:false,title:BCLink.caption,rendeTo:window.document.body,closable:true,collapsible:true,doSize:true,closed:true,draggable:true,resizable:true,modal:false,width:BCLink.dropDownWidth,height:BCLink.dropDownHeight});var offset=BCLink.showWindow.getOffsetForWindow(BCLink.combo||BCLink.el);linkWindow.move({left:offset.left,top:offset.top,width:BCLink.dropDownWidth,height:BCLink.dropDownHeight});linkWindow.linkState=1;linkWindow.open();$(document).bind("mousedown.linkWindow",function(e){var el=$(e.target);if(el.hasClass("window")||el.parents(".window").length>0){}else if(el.hasClass("menu")||el.parents(".menu").length>0){}else{linkWindow.close()}})}else{BCLink.showWindow=linkWindow;var offset=BCLink.showWindow.getOffsetForWindow(BCLink.combo||BCLink.el);linkWindow.move({left:offset.left,top:offset.top,width:BCLink.dropDownWidth,height:BCLink.dropDownHeight});linkWindow.open()}if(linkWindow.linkState==1){$.getScript(UCMLLocalResourcePath+"BCClient/"+BCLink.BCName+".js",function(){linkWindow.linkState=2;var AppletObject=eval("new UCML.AppletUnit."+BCLink.BCName+"Service()");AppletObject.el=AppletObject;AppletObject.BCLink=BCLink;AppletObject.open();if(BCLink.setAppletObject){BCLink.setAppletObject(AppletObject)}else{BCLink.AppletObject=AppletObject}linkWindow.AppletObject=AppletObject;linkWindow.AppletObject.dataLoading=true;BCLink.AppletObject.InitBusinessEnv()})}else{if(BCLink.setAppletObject){BCLink.setAppletObject(linkWindow.AppletObject)}else{BCLink.AppletObject=linkWindow.AppletObject}linkWindow.AppletObject.dataLoading=true;linkWindow.AppletObject.BCLink=BCLink;linkWindow.AppletObject.InitBusinessEnv()}}else{window.open(eval(BCLink.urlFuncName+"(BCLink)"),"","location=no,menubar=yes,toolbar=no,status=no,directories=no,scrollbars=yes,resizable=yes")}},ShowMask:function(){var body=$(document.body);var mask=body.children(".datagrid-mask");var maskmsg=body.children(".datagrid-mask").children(".datagrid-mask-msg");if(mask.length==0){body.append('<div class="datagrid-mask"><div class="datagrid-mask-msg">'+UCML.Languge.BCRefreshLanguge+"</div></div>");mask=body.children(".datagrid-mask");maskmsg=body.children(".datagrid-mask").children(".datagrid-mask-msg")}mask.css({height:$(window).height(),width:$(window).width(),display:"block"});maskmsg.css({top:(mask.height()-maskmsg.height())/2,left:(mask.width()-maskmsg.width())/2})},hidenMask:function(){$(document.body).children(".datagrid-mask").css({display:"none"})},CheckUniqueID:function(BCName,FieldName,Value,KeyValue,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"CheckUniqueID",false,{BCName:BCName,FieldName:FieldName,Value:Value,KeyValue:KeyValue},succeededCallback,failedCallback,userContext)},GetUniqueID:function(KindStr,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetUniqueID",false,{KindStr:KindStr},succeededCallback,failedCallback,userContext)},GetSequenceNo:function(KindStr){var config={methodName:"GetSequenceNo",params:{KindStr:KindStr},async:false};return this.invoke(config)},putTOExcel:function(nBCName,FieldLists,nStartPos,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"putTOExcel",false,{nBCName:nBCName,FieldLists:FieldLists,nStartPos:nStartPos,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix},succeededCallback,failedCallback,userContext)},GetResourceData:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetResourceData",false,{},succeededCallback,failedCallback,userContext)},GetReportURL:function(ReportID,nStartPos,nRecords,ReportParam,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetReportURL",false,{ReportID:ReportID,nStartPos:nStartPos,nRecords:nRecords,ReportParam:ReportParam},succeededCallback,failedCallback,userContext)},GetSrvReportResult:function(ReportID,nStartPos,nRecords,ReportParam,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetSrvReportResult",false,{ReportID:ReportID,nStartPos:nStartPos,nRecords:nRecords,ReportParam:ReportParam},succeededCallback,failedCallback,userContext)},GetDateSequenceNo:function(KindStr,format,sequenceCount,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetDateSequenceNo",false,{KindStr:KindStr,format:format,sequenceCount:sequenceCount},succeededCallback,failedCallback,userContext)},GetIndicatorValue:function(auth,KpiID,Owner,OwnerType,StartDate,EndDate,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetIndicatorValue",false,{auth:auth,KpiID:KpiID,Owner:Owner,OwnerType:OwnerType,StartDate:StartDate,EndDate:EndDate},succeededCallback,failedCallback,userContext)},GetDetailBusinessURL:function(auth,KpiID,Owner,OwnerType,StartDate,EndDate,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetDetailBusinessURL",false,{auth:auth,KpiID:KpiID,Owner:Owner,OwnerType:OwnerType,StartDate:StartDate,EndDate:EndDate},succeededCallback,failedCallback,userContext)},Login:function(UserName,Password,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"Login",false,{UserName:UserName,Password:Password},succeededCallback,failedCallback,userContext)},LoginMobile:function(UserName,Password,DeviceID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"LoginMobile",false,{UserName:UserName,Password:Password,DeviceID:DeviceID},succeededCallback,failedCallback,userContext)},Logout:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"Logout",false,{},succeededCallback,failedCallback,userContext)},GetUserName:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetUserName",false,{},succeededCallback,failedCallback,userContext)},GetSystemDateTime:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetSystemDateTime",false,{},succeededCallback,failedCallback,userContext,false)},BusinessSubmit_Inner:function(xmlData,succeededCallback,failedCallback,userContext,async){if(async==undefined||async==null){async=true}return this.invoke(this.getPath(),"BusinessSubmit",false,{xmlData:xmlData},succeededCallback,failedCallback,userContext,async)},RightSystemInit:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"RightSystemInit",false,{},succeededCallback,failedCallback,userContext)},ComputeClassCode:function(TableName,ParentFieldName,ClassCodeFieldName,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"ComputeClassCode",false,{TableName:TableName,ParentFieldName:ParentFieldName,ClassCodeFieldName:ClassCodeFieldName},succeededCallback,failedCallback,userContext)},getCondiActorData:function(TableName,nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getCondiActorDataString",false,{TableName:TableName,nStartPos:nStartPos,nRecords:nRecords,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix},succeededCallback,failedCallback,userContext,true,false)},getCondiActorDataBC:function(BCName,nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,succeededCallback,failedCallback,userContext,async){async=async==undefined?true:async;return this.invoke(this.getPath(),"getCondiActorDataBCString",false,{
BCName:BCName,nStartPos:nStartPos,nRecords:nRecords,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix},succeededCallback,failedCallback,userContext,async,false)},getCondiActorDataBCPage:function(BCName,nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,inTotalRecord,succeededCallback,failedCallback,userContext,async){async=async==undefined?true:async;return this.invoke(this.getPath(),"getCondiActorDataBCStringPage",false,{BCName:BCName,nStartPos:nStartPos,nRecords:nRecords,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix,inTotalRecord:inTotalRecord},succeededCallback,failedCallback,userContext,async,false)},getTotalData:function(BCName,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,TotalFields,TotalModes,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getTotalData",false,{BCName:BCName,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix,TotalFields:TotalFields,TotalModes:TotalModes},succeededCallback,failedCallback,userContext,false)},getTreeGridSubData:function(BCName,parentFieldName,parentOID,SQLCondi,succeededCallback,failedCallback,nStartPos,nRecords,userContext){return this.invoke(this.getPath(),"getTreeGridSubData",false,{BCName:BCName,parentFieldName:parentFieldName,parentOID:parentOID,SQLCondi:SQLCondi,nStartPos:nStartPos,nRecords:nRecords},succeededCallback,failedCallback,userContext,false)},getDynTreeSubNodes:function(BCName,parentFieldName,parentOID,CaptionField,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getDynTreeSubNodes",false,{BCName:BCName,parentFieldName:parentFieldName,parentOID:parentOID,CaptionField:CaptionField},succeededCallback,failedCallback,userContext,false,false)},getReBuildWhereTreeNodes:function(BCName,parentFieldName,parentOID,CaptionField,Condi,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getReBuildWhereTreeNodes",false,{BCName:BCName,parentFieldName:parentFieldName,parentOID:parentOID,CaptionField:CaptionField,Condi:Condi},succeededCallback,failedCallback,userContext,false,false)},getTreeSubNodesWithChild:function(BCName,VCName,parentFieldName,parentOID,CaptionField,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getTreeSubNodesWithChild",false,{BCName:BCName,VCName:VCName,parentFieldName:parentFieldName,parentOID:parentOID,CaptionField:CaptionField},succeededCallback,failedCallback,userContext,true,false)},getCondiBusinessData:function(nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"getCondiBusinessDataString",false,{nStartPos:nStartPos,nRecords:nRecords,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix},succeededCallback,failedCallback,userContext,true,false)},loadChildDataEx:function(BCName,OID,recordXml,SubBC_SQLCondi,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"loadChildDataExString",false,{BCName:BCName,OID:OID,recordXml:recordXml,SubBC_SQLCondi:SubBC_SQLCondi},succeededCallback,failedCallback,userContext,false)},CondiInitBusinessEnvEx:function(fieldList,valueList,condiIndentList,sqlCondi,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"CondiInitBusinessEnvExString",false,{fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,sqlCondi:sqlCondi},succeededCallback,failedCallback,userContext)},LoadLanugeDataForBCLink:function(){return this.invoke(this.getPath(),"LoadLanugeDataForBCLink",false,{},this.succeeded_LoadLanugeDataForBCLink,this.failed_LoadLanugeDataForBCLink,this,false)},succeeded_LoadLanugeDataForBCLink:function(result,text,methodName){if(text){eval(text);if(BusinessData["ResourceData"]){BusinessData["ResourceData"]=BusinessData["ResourceData"].concat(BusinessData["ResourceData_BCLink"])}}},failed_LoadLanugeDataForBCLink:function(result,text,methodName){},createEventObject:function(){return new Object},HideSelect:function(){},ShowSelect:function(){},AddUseTable:function(DataTable){this.UseTableList[this.UseTableList.length]=DataTable;DataTable.setDeltaData(this.theDeltaData)},NotifyTable:function(data){for(var i=0;i<this.UseTableList.length;i++){this.UseTableList[i].loadData(data[this.UseTableList[i].BCName])}},NotifyTableBC:function(BCName,data){var bcBase=this.getDataTableByBCName(BCName);if(bcBase){bcBase.LoadResults(data)}},getRootTable:function(){return this.UseTableList[0]},getBCList:function(){return this.UseTableList},MergeChange:function(){for(var i=0;i<this.UseTableList.length;i++){this.UseTableList[i].MergeChange()}},getURLParameters:function(ParamName){var sURL=window.document.URL.toString();while(true){if(sURL.lastIndexOf("#")==sURL.length-1)sURL=sURL.substring(0,sURL.length-1);else break}if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");var arrURLParams=arrParams[1].split("&");var arrParamNames=new Array(arrURLParams.length);var arrParamValues=new Array(arrURLParams.length);var i=0;for(i=0;i<arrURLParams.length;i++){var sParam=arrURLParams[i].split("=");arrParamNames[i]=sParam[0];if(sParam[1]!="")arrParamValues[i]=decodeURI(sParam[1]);else arrParamValues[i]="No Value"}for(i=0;i<arrURLParams.length;i++){if(arrParamNames[i]==ParamName)return arrParamValues[i]}}return null},ShowMessage:function(str){var el=$("#message_panel");if(el.length==0){el=$("<div id='message_panel'><span class='message_text'></span><span class='loading_image'><img src='"+UCMLLocalResourcePath+"Images/message_panel.gif' width='16' height='16' /></span></div>");$(window.document.body).append(el)}var content=$(window);var top=(content.height()-el.height())/2;var left=(content.width()-el.width())/2;el.css({top:top,left:left,position:"absolute"});el.show().find(".message_text").html(str)},HideMessage:function(){var el=$("#message_panel");el.hide()},condiQuery:function(fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,nStartPos,nRecords){this.ShowMessage(UCML.Languge.BCRefreshLanguge);var rootTable=this.getRootTable();rootTable.SetCondiList(fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType);SQLCondiType=SQLCondiType||0;if(!SQLCondi){SQLCondi="";SQLCondiType=0}nStartPos=nStartPos||0;nRecords=nRecords||-1;this.getCondiBusinessData(nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,"",this.condiQueryObj,this.failedCallback,null)},condiActorQuery:function(BCName,nStartPos,nRecords,fieldList,valueList,condiIndentList,SQLCondi,SQLCondiType,SQLFix,succeededCallback,failedCallback,userContext){var bcBase=this.getDataTableByBCName(BCName);if(!bcBase){return}if(!succeededCallback){succeededCallback=bcBase.onAfterGetData}if(!failedCallback){failedCallback=bcBase.onFailureCall}if(!userContext){userContext=bcBase}return this.invoke(this.getPath(),"getCondiActorDataBCString",false,{BCName:BCName,nStartPos:nStartPos,nRecords:nRecords,fieldList:fieldList,valueList:valueList,condiIndentList:condiIndentList,SQLCondi:SQLCondi,SQLCondiType:SQLCondiType,SQLFix:SQLFix},succeededCallback,failedCallback,userContext,true,false)},failedCallback:function(result,text){alert(text)},onCondiQuerySuccessCall:function(result,text){this.onQueryResult(text)},failedCallback:function(result,text){alert(text)},onCondiQuerySuccessCall:function(result,text){this.onQueryResult(result,text)},onQueryResult:function(result,text){this.HideMessage();if(text){eval(text)}this.loadData(BusinessData)},condiQueryObj:function(result,text){this.HideMessage();if(text){eval(text)}this.loadData(BusinessData);if(this.OnAfterCondiQuery){this.OnAfterCondiQuery()}this.fireEvent("OnAfterCondiQuery")},getDataTableByBCName:function(bcName){for(var i=0;i<this.UseTableList.length;i++){if(this.UseTableList[i].BCName==bcName){return this.UseTableList[i]}}return null},getXMLData:function(){var strXML="<NewDataSet>";var codeXML="";for(var t=0;t<this.UseTableList.length;t++){var bcBase=this.UseTableList[t].dataStore;var bcCols=this.UseTableList[t].getColumns();for(var j=0;j<bcBase.getLength();j++){strXML+="<"+bcBase.BCName+">";var RecordData=bcBase.getRecordData(j);for(var i=0;i<bcCols.length;i++){var value=UCML.util.Format.htmlEncode(RecordData[i]);if(bcCols[i].isCodeTable&&bcCols[i].codeTable){var caption=GetCodeCaption(bcCols[i].codeTable,RecordData[i]);if(caption){value=UCML.util.Format.htmlEncode(caption)}else{value=""}}strXML+="<"+bcCols[i].fieldName+"><![CDATA["+value+"]]></"+bcCols[i].fieldName+">"}strXML+="</"+bcBase.BCName+">"}var codeTableList=[];var j=0;for(var k=0;k<bcCols.length;k++){if(bcCols[k].isCodeTable==true){var isHave=false;for(var n=0;n<codeTableList.length;n++){if(bcCols[k].codeTable==codeTableList[n].codeTableID){isHave=true;break}}if(!isHave){var objCode={codeTableID:bcCols[k].codeTable};codeTableList[j]=objCode;j++}}}for(var m=0;m<codeTableList.length;m++){var codeList=this.GetCodeValue(codeTableList[m].codeTableID);for(var cl=0;cl<codeList.length;cl++){codeXML+="<"+codeTableList[m].codeTableID+">";codeXML+="<CodeValueOID><![CDATA["+codeList[cl].codeTableID+"]]></CodeValueOID>";codeXML+="<CodeID><![CDATA["+codeList[cl].value+"]]></CodeID>";codeXML+="<CodeName><![CDATA["+codeList[cl].caption+"]]></CodeName>";codeXML+="</"+codeTableList[m].codeTableID+">"}}}if(codeXML!=""){strXML+=codeXML}strXML+="</NewDataSet>";return strXML},getChangeXML:function(){var strXML="<root>";for(var t=0;t<this.UseTableList.length;t++){var bcBase=this.UseTableList[t].dataStore;if(this.UseTableList[t].isChangeData){for(var i=0;i<bcBase.changeData.items.length;i++){strXML+="<"+bcBase.BCName+' UpdateKind="';if(bcBase.changeData.items[i][bcBase.record.length+1]!=""&&bcBase.changeData.items[i][bcBase.record.length+1]!="null"){strXML+=bcBase.changeData.items[i][bcBase.record.length+1]}strXML+='">';for(var j=0;j<bcBase.record.length;j++){var value=UCML.util.Format.htmlEncode(bcBase.changeData.items[i][j]);strXML+="<"+bcBase.record[j].fieldName+">"+value+"</"+bcBase.record[j].fieldName+">"}strXML+="</"+bcBase.BCName+">"}}}strXML+="</root>";return strXML},AssignTaskTo:function(TaskOIDs,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"AssignTaskTo",false,{TaskOIDs:TaskOIDs},succeededCallback,failedCallback,userContext)},AssignTaskForRead:function(AssignTaskID,MasualAssign,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"AssignTaskForRead",false,{AssignTaskID:AssignTaskID,MasualAssign:MasualAssign},succeededCallback,failedCallback,userContext)},AssignTaskForSign:function(AssignTaskID,MasualAssign,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"AssignTaskForSign",false,{AssignTaskID:AssignTaskID,MasualAssign:MasualAssign},succeededCallback,failedCallback,userContext)},AssignTaskToMe:function(TaskOIDs,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"AssignTaskToMe",false,{TaskOIDs:TaskOIDs},succeededCallback,failedCallback,userContext)},TaskReturn:function(succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"TaskReturn",false,{},succeededCallback,failedCallback,userContext)},GetbackTask:function(FlowID,TaskID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"GetbackTask",false,{FlowID:FlowID,TaskID:TaskID},succeededCallback,failedCallback,userContext)},RollbackTask:function(FlowID,TaskID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"RollbackTask",false,{FlowID:FlowID,TaskID:TaskID},succeededCallback,failedCallback,userContext)},FinishTask:function(AssignTaskID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"FinishTask",false,{AssignTaskID:AssignTaskID},succeededCallback,failedCallback,userContext)},FinishTaskEx:function(FlowID,AssignTaskID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"FinishTaskEx",false,{FlowID:FlowID,AssignTaskID:AssignTaskID},succeededCallback,failedCallback,userContext)},CreateFlow:function(FlowID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"CreateFlow",false,{FlowID:FlowID},succeededCallback,failedCallback,userContext)}});UCML.BusinessUnit.prototype.havePermisionCode=function(PermisionCode){var BPOPermControlCode=this.el.BusinessData[this.BPOName+"PermControlCode"];var flag=false;if(BPOPermControlCode&&BPOPermControlCode.length>0){for(var i=0;i<BPOPermControlCode.length;i++){if(BPOPermControlCode[i][1]==PermisionCode&&BPOPermControlCode[i][3]=="true"){flag=true;break}}}return flag};UCML.BusinessUnit.prototype.BusinessSubmit=function(val,async){if(this.BeforeSubmit&&this.BeforeSubmit()===true){if(val!==false){if(this.CanSubmit()==false)return}this.ShowMessage("正在提交信息，请等待......");this.ShowMask();var changeXML=this.getChangeXML();this.BusinessSubmit_Inner(changeXML,this.OnSubmitSuccessCall,this.OnSubmitFailureCall,this,async)}};UCML.BusinessUnit.prototype.BusinessSubmitByBcName=function(BcName,val){if(this.BeforeSubmit&&this.BeforeSubmit()===true){this.BeforeSubmit()}var bcBase=this.getDataTableByBCName(BcName);if(bcBase){if(val!==false){bcBase.Valiate()}this.ShowMessage("正在提交信息，请等待......");this.ShowMask();this.BusinessSubmit_Inner(bcBase.getChangeXML(),this.OnSubmitSuccessCall,this.OnSubmitFailureCall,this)}};UCML.BusinessUnit.prototype.isChangeData=function(){for(var i=0;i<this.UseTableList.length;i++){if(this.UseTableList[i].ChangeCount()>0){return true}}return false};UCML.BusinessUnit.prototype.CanSubmit=function(){var result=true;for(var i=0;i<this.UseTableList.length;i++){result=this.UseTableList[i].Valiate();if(result==false){break}}return result};UCML.BusinessUnit.prototype.OnSubmitSuccessCall=function(result,text,methodName){this.HideMessage();this.hidenMask();this.fireEvent("SubmitSuccess");for(var i=0;i<this.UseTableList.length;i++){if(this.UseTableList[i].fIDENTITYKey==true){var rows=text.split("@");for(var m=0;m<rows.length;m++){var fields=rows[m].split(";");if(fields.length==1)break;var bcBase=eval(fields[0]+"Base");if(bcBase.LocateOID_GUID(fields[1])!=null)bcBase.setFieldValue(bcBase.PrimaryKey,fields[2])}break}}this.MergeChange();var name=BusinessObject.BPOName+"_changeXML";this.setStorageData(name,"");if(this.promptSubmit==true){if(text.indexOf("BC")==0){alert(UCML.Languge.BPO_Submit_OK)}else{alert(text)}}if(this.AfterSubmit){this.AfterSubmit()}return};UCML.BusinessUnit.prototype.OnSubmitFailureCall=function(result,text,methodName){this.HideMessage();this.hidenMask();if((result.status=="404"||result.status=="12029")&&window.localStorage&&window["isChangeDataToStorage"]){alert("您的网络可能遇到点故障，我们将您需要保存的数据存在本地浏览器中，以便下次网络畅通后继续提交");var changeXML=this.getChangeXML();var name=BusinessObject.BPOName+"_changeXML";this.setStorageData(name,changeXML)}else{alert(text)}};UCML.BusinessUnit.prototype.loadStorageDataChangeXML=function(){var name=BusinessObject.BPOName+"_changeXML";var data=this.getStorageData(name);if(!UCML.isEmpty(data)){if(confirm("您上次有未提交的数据,是否进行提交")){this.BusinessSubmit_Inner(data,this.OnSubmitSuccessCall,this.OnSubmitFailureCall,this)}}};UCML.BusinessUnit.prototype.setStorageData=function(name,data){if(window.localStorage){localStorage[name]=data}};UCML.BusinessUnit.prototype.getStorageData=function(name){if(window.localStorage){return localStorage[name]}else{return null}};UCML.BusinessUnit.prototype.mergeChangeAll=function(){this.MergeChange()};UCML.BusinessUnit.prototype.GetCodeValue=function(CodeTableID){var evObj=this.createEventObject();evObj.result=false;evObj.CodeTableID=CodeTableID;evObj.CodeList=null;this.fireEvent("OnGetCodeValue",evObj);if(evObj.result==true){return evObj.CodeList}for(var i=0;i<this.CodeTableList.length;i++){obj=this.CodeTableList[i];if(obj.CodeTableID==CodeTableID){return obj.CodeList}}var codeData=BusinessData[CodeTableID];if(codeData==null||codeData.length==0)return null;var CodeList=new Array;for(var i=0;i<codeData.length;i++){var obj=new Object;obj.codeTableID=codeData[i][0];obj.value=codeData[i][1];obj.caption=codeData[i][2];CodeList[i]=obj}var obj=new Object;obj.CodeTableID=CodeTableID;obj.CodeList=CodeList;this.CodeTableList[this.CodeTableList.length]=obj;return CodeList};UCML.BusinessUnit.prototype.GetCodeID=function(CodeTableID,caption){var CodeList=this.GetCodeValue(CodeTableID);if(CodeList!=null){for(var j=0;j<CodeList.length;j++){if(caption==CodeList[j].caption){return CodeList[j].value}}}return null};UCML.BusinessUnit.prototype.GetCodeCaption=function(CodeTableID,CodeValue){var CodeList=this.GetCodeValue(CodeTableID);if(CodeList!=null){for(var j=0;j<CodeList.length;j++){if(CodeValue==CodeList[j].value){return CodeList[j].caption}}}return""};UCML.BusinessUnit.prototype.OpenWindow=function(url,title,openMode,config){openMode=openMode==undefined?1:openMode;if(openMode==1){if(!window.currentWindow&&window.opener&&window.UCMLLocalResourcePath){var pathname=window.location.pathname.toString();var path=pathname.substring(0,pathname.lastIndexOf("/")+1);var rootPath=path+window.UCMLLocalResourcePath;url=rootPath+url}else{}var defaultConfig={frameMode:"frame",maximizable:true,collapsible:true,URL:url,scroll:"yes",draggable:true,resizable:true,title:title};if(config){UCML.apply(defaultConfig,config)}config=defaultConfig;if(UCML.isEmpty(config.width)&&UCML.isEmpty(config.ratioWidth)){config.alignWidth=true}if(UCML.isEmpty(config.height)&&UCML.isEmpty(config.ratioWidth)){config.alignHeight=true}var w=new UCML.OpenShowWindow(config);w.open();return w}else if(openMode==2){window.location.href=url}else if(openMode==3){window.open(url,"","location=no,menubar=no,toolbar=no,status=yes,directories=no,scrollbars=yes,resizable=no,width=800,height=600")}};UCML.BusinessUnit.prototype.saveQueryCondi=function(BPOName,VCName,CondiName,CondiValue,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"SaveQueryCondi",false,{BPOName:BPOName,VCName:VCName,CondiName:CondiName,CondiValue:CondiValue},succeededCallback,failedCallback,userContext)};UCML.BusinessUnit.prototype.loadQueryCondi=function(BPOName,VCName,IsUser,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"LoadQueryCondi",false,{BPOName:BPOName,VCName:VCName,IsUser:IsUser},succeededCallback,failedCallback,userContext)};UCML.BusinessUnit.prototype.deleteQueryCondi=function(OID,succeededCallback,failedCallback,userContext){return this.invoke(this.getPath(),"DeleteQueryCondi",false,{OID:OID},succeededCallback,failedCallback,userContext)};UCML.BusinessUnit.prototype.UpdateServerProperty=function(name,value){var ServerPropertyChange=window["ServerPropertyChange"]||{};ServerPropertyChange[name]=value;window["ServerPropertyChange"]=ServerPropertyChange};UCML.BusinessUnit.prototype.getServerPropertyXML=function(){var ServerPropertyChange=window["ServerPropertyChange"];if(ServerPropertyChange){var xmlStr="<PropertyList UpdateKind='ukModify'>";var xmlStr2="<PropertyList  >";for(var item in ServerProperty){xmlStr+="<"+item+">";xmlStr+="null";xmlStr+="</"+item+">";xmlStr2+="<"+item+">";var updateValue=ServerPropertyChange[item];if(updateValue){xmlStr2+=updateValue}else{xmlStr2+="null"}xmlStr2+="</"+item+">"}xmlStr+="</PropertyList>";xmlStr2+="</PropertyList>";return xmlStr+xmlStr2}else{return""}};UCML.BusinessUnit.prototype.selectManObj=null;UCML.BusinessUnit.prototype.openSelectManForMobile=function(selType,bcName,idField,titleField){selType=selType||1;this.selectManObj={bcName:bcName,idField:idField,titleField:titleField,selType:selType};var url="ucml_mobile/Common/BPO_CommonSelectMan_mobile.HTML?selType="+selType+"&callbackSelect=callbackSelectManMobile";var w=OpenWindow(url,"选择联系人");return w};UCML.BusinessUnit.prototype.callbackSelectManMobile=function(str,strN){if(selectManObj){try{var bcObj=eval(selectManObj.bcName+"Base");if(selectManObj.selType%2==false){bcObj.setFieldValue(selectManObj.idField,str);bcObj.setFieldValue(selectManObj.titleField,strN)}else{bcObj.setFieldValue(selectManObj.idField,str);bcObj.setFieldValue(selectManObj.titleField,strN)}}catch(e){}}};UCML.BusinessUnit.prototype.openSelectMan=function(selTyle,openMode,bcName,idField,titleField,obj){openMode=openMode||1;selTyle=selTyle||1;this.selectManObj={bcName:bcName,idField:idField,titleField:titleField};var url="BPO_Select_User_Organize_MainJS.aspx?type="+selTyle+"&mode="+openMode+"&callbackFn=callBackSelectMan&initFn=initSelectMan";if(openMode==1){var config={frameMode:"frame",maximizable:true,collapsible:true,URL:url,scroll:"yes",draggable:true,resizable:true,width:750,height:550,title:UCML.Languge.BU_SelectMan_Title};obj=obj||{};UCML.apply(config,obj);var w=new UCML.OpenShowWindow(config);w.open();return w}else if(openMode==2){return window.open(UCMLLocalResourcePath+url,UCML.Languge.BU_SelectMan_Title,"location=no;menubar=no;toolbar=no;status=no;directories=no;scrollbars=auto;resizable=no;width=750px;height=420px")}};UCML.BusinessUnit.prototype.initSelectMan=function(){if(!selectManObj)return null;try{var id=eval(selectManObj.bcName+"Base.getFieldValue('"+selectManObj.idField+"')");var Caption=eval(selectManObj.bcName+"Base.getFieldValue('"+selectManObj.titleField+"')");if(id.indexOf(",")==0)id=id.substring(1,id.length-1);var idarr=id.split(",");var Captionarr=Caption.split(",");var objArr=new Array;for(var i=0;i<idarr.length;i++){var o=new Object;o.tp=idarr[i].split(":")[0].substring(idarr[i].split(":")[0].length-1,idarr[i].split(":")[0].length);o.id=idarr[i].split(":")[1].substring(0,36);o.name=Captionarr[i];o.fvalue=idarr[i];objArr.push(o)}return objArr}catch(e){return null}};UCML.BusinessUnit.prototype.callBackSelectMan=function(str,strN){if(selectManObj){try{eval(selectManObj.bcName+"Base.setFieldValue('"+selectManObj.idField+"',str)");eval(selectManObj.bcName+"Base.setFieldValue('"+selectManObj.titleField+"',strN)")}catch(e){}}};UCML.BusinessUnit.prototype.CallChangeBusiView=function(viewIndex){var config={methodName:"ChangeBusiViewString",params:{viewIndex:viewIndex},onSuccess:this.succeeded_ChangeBusiViewString,onFailure:this.failed_ChangeBusiViewString};return this.invoke(config)};UCML.BusinessUnit.prototype.succeeded_ChangeBusiViewString=function(obj,text,methodName){eval(text);this.loadData(this.el.BusinessData)};UCML.BusinessUnit.prototype.failed_ChangeBusiViewString=function(obj,text,methodName){};function getResourceData(id){if(BusinessData["ResourceData"]&&BusinessData["ResourceData"].length>0){for(var i=0;i<BusinessData["ResourceData"].length;i++){if(id==BusinessData["ResourceData"][i][0]){return BusinessData["ResourceData"][i][1]}}}return""}function ResetColumns(OldColumns,VCName){var value=$("#"+VCName+"_ColumnSetup").val();if(value==undefined||value=="")return OldColumns;eval(value);var newVCCloumns=[];var existColIndex=[];for(var i=0;i<cusColumns.length;i++){for(var j=0;j<OldColumns.length;j++){if(cusColumns[i].fieldName==OldColumns[j].fieldName){existColIndex.add(j);OldColumns[j].width=cusColumns[i].width;OldColumns[j].display=cusColumns[i].display;newVCCloumns[newVCCloumns.length]=OldColumns[j];break}}}for(var k=0;k<OldColumns.length;k++){if(existColIndex.indexOf(k)==-1){newVCCloumns[newVCCloumns.length]=OldColumns[k]}}eval(VCName+"Columns=newVCCloumns;");return newVCCloumns}UCML.BusinessUnit.ButtonPerm=function(bpo){if(typeof BusinessData=="undefined")return null;if(!BusinessData[bpo.BPOName+"ButtonPerm"]){return null}var objList=[];try{this.data=BusinessData[bpo.BPOName+"ButtonPerm"];if(this.data){for(var i=0;i<this.data.length;i++){var caption=this.getValue(i,"Caption");var enabled=this.getValue(i,"Enabled");var visible=this.getValue(i,"AllowVisible");var RESP_BU_BUTTONOID=this.getValue(i,"RESP_BU_BUTTONOID");var buttontype=this.getValue(i,"ButtonType");var obj={};obj["caption"]=caption;obj["enabled"]=enabled;obj["visible"]=visible;obj["resp_bu_buttonoid"]=RESP_BU_BUTTONOID;obj["buttontype"]=buttontype;objList.add(obj)}}}catch(e){this.data=null}return objList};UCML.BusinessUnit.ButtonPerm.fields=["RESP_BU_BUTTONOID","Choiced","Enabled","AllowVisible","ApplicationID","Caption","ButtonType","ClassName","UCML_RESPONSIBILITY_FK","BU_Button_FK","UCMLClass_FK","RESP_BU_FK"];UCML.BusinessUnit.ButtonPerm.prototype.getFieldIndex=function(name){return UCML.BusinessUnit.ButtonPerm.fields.indexOf(name)};UCML.BusinessUnit.ButtonPerm.prototype.getValue=function(rowIndex,name){var cellIndex=this.getFieldIndex(name);if(this.data&&cellIndex>-1){return this.data[rowIndex][cellIndex]}};UCML.BusinessUnit.prototype.BPOToolBarPerm=function(){this.ButtonPerm=new UCML.BusinessUnit.ButtonPerm(this);if(this.ButtonPerm){var toolbar=window[this.BPOName+"Toolbar_Module"];if(toolbar){for(var i=0;i<this.ButtonPerm.length;i++){var caption=this.ButtonPerm[i]["caption"];var enabled=this.ButtonPerm[i]["enabled"];var visible=this.ButtonPerm[i]["visible"];var resp_bu_buttonoid=this.ButtonPerm[i]["resp_bu_buttonoid"];var buttontype=this.ButtonPerm[i]["buttontype"];var button=toolbar.getItem(i);if(button){if(button.setDisabled&&(enabled=="true"||enabled==1)){button.enable()}else if(button.setDisabled&&enabled=="false"||enabled==0){button.disable()}if(visible=="false"||visible==0){button.hide()}else if(visible=="true"||visible==1){button.show()}}}}}};UCML.GropBox=function(id){this.title=null;UCML.Container.superclass.constructor.call(this,id)};UCML.extend(UCML.GropBox,UCML.Container,{ctype:"UCML.GropBox"});UCML.GropBox.prototype.init=function(){UCML.GropBox.superclass.init.call(this)};UCML.GropBox.prototype.setProperties=function(){UCML.GropBox.superclass.setProperties.call(this);this.title=this.el.attr("title")||this.title};UCML.GropBox.prototype.onRender=function(){if(this.title){this.legend=$("<legend>"+this.title+"</legend>").prependTo(this.el)}};UCML.GropBox.prototype.setSize=function(param){UCML.GropBox.superclass.setSize.call(this,param)};UCML.Window=function(id){UCML.Window.superclass.constructor.call(this,id)};UCML.Window.zIndex=9e3;UCML.extend(UCML.Window,UCML.Panel,{draggable:true,resizable:false,showShadow:true,modal:false,border:false,closable:true,onRender:function(){this.headerCls="window-header "+this.headerCls;this.bodyCls="window-body "+this.bodyCls;this.cls="window "+this.cls;UCML.Window.superclass.onRender.call(this);if(this.mask){this.mask.remove()}if(this.modal==true){this.mask=$('<div class="window-mask"></div>',this.window.document).appendTo(this.window.document.body);this.mask.css({width:getPageArea(this.window.document).width,height:getPageArea(this.window.document).height,display:"none"})}if(this.showShadow==true){this.shadow=$('<div class="window-shadow"></div>',this.window.document).insertAfter(this.el);this.shadow.css({display:"none"})}},bindEvents:function(){var opts=this;if(this.draggable){this.el.UCML_draggable({document:opts.window.document,handle:">div.panel-header>div.panel-title",onStartDrag:function(e){if(!opts.proxy){opts.proxy=$('<div class="window-proxy"></div>',opts.window.document).insertAfter(opts.el)}opts.proxy.css({display:"none",zIndex:UCML.Window.zIndex,left:e.data.left,top:e.data.top,width:$.boxModel==true?opts.el.outerWidth()-(opts.proxy.outerWidth()-opts.proxy.width()):opts.el.outerWidth(),height:$.boxModel==true?opts.el.outerHeight()-(opts.proxy.outerHeight()-opts.proxy.height()):opts.el.outerHeight()});setTimeout(function(){if(opts.proxy)opts.proxy.show()},500)},onDrag:function(e){opts.proxy.css({display:"block",left:e.data.left,top:e.data.top});return false},onStopDrag:function(e){opts.left=e.data.left;opts.top=e.data.top;opts.move();opts.proxy.remove();opts.proxy=null}});if(this.window&&(opts.alignHeight==true||opts.alignWidth==true||UCML.isEmpty(opts.ratioHeight)==false||UCML.isEmpty(opts.ratioWidth)==false)){$(this.window).resize(function(){opts.resize();if(opts.mask){opts.mask.css({width:$(opts.window).width(),height:$(opts.window).height()});setTimeout(function(){if(opts.mask){opts.mask.css({width:getPageArea(opts.window.document).width,height:getPageArea(opts.window.document).height})}},50)}})}}if(this.resizable){this.el.UCML_resizable({document:opts.window.document,onStartResize:function(e){if(!opts.proxy){opts.proxy=$('<div class="window-proxy"></div>',opts.window.document).insertAfter(opts.el)}opts.proxy.css({zIndex:UCML.Window.zIndex,left:e.data.left,top:e.data.top,width:$.boxModel==true?e.data.width-(opts.proxy.outerWidth()-opts.proxy.width()):e.data.width,height:$.boxModel==true?e.data.height-(opts.proxy.outerHeight()-opts.proxy.height()):e.data.height})},onResize:function(e){opts.proxy.css({left:e.data.left,top:e.data.top,width:$.boxModel==true?e.data.width-(opts.proxy.outerWidth()-opts.proxy.width()):e.data.width,height:$.boxModel==true?e.data.height-(opts.proxy.outerHeight()-opts.proxy.height()):e.data.height});return false},onStopResize:function(e){opts.left=e.data.left;opts.top=e.data.top;opts.width=e.data.width;opts.height=e.data.height;opts.resize();opts.proxy.remove();opts.proxy=null}})}},close:function(){UCML.Window.superclass.close.call(this);if(this.closed==true){if(this.shadow)this.shadow.hide();if(this.mask)this.mask.hide()}},open:function(){UCML.Window.superclass.open.call(this);if(this.mask){this.mask.css({display:"block",zIndex:UCML.Window.zIndex++})}if(this.shadow){this.shadow.css({zIndex:UCML.Window.zIndex++})}this.el.css("z-index",UCML.Window.zIndex++);this.resize()},getOffsetForWindow:function(targetEl){var offset=targetEl.offset();var left=offset.left;var top=offset.top+targetEl.outerHeight(true);var elHeight=parseInt(this.height);if(top+elHeight>$(window).height()+$(document).scrollTop()){top=offset.top-elHeight}top=top<0?0:top;var elWidth=parseInt(this.width);if(left+elWidth>$(window).width()+$(document).scrollLeft()){left=left+targetEl.outerWidth(true)-elWidth}left=left<0?0:left;return{left:left,top:top}},setSize:function(param){UCML.Window.superclass.setSize.call(this,param);if(this.left==null){var width=this.width;if(isNaN(width)){width=this.el.outerWidth()}this.left=($(this.window).width()-width)/2+$(this.window.document).scrollLeft();this.left=this.left<0?0:this.left}if(this.top==null){var height=this.height;if(isNaN(height)){height=this.el.outerHeight()}this.top=($(this.window).height()-height)/2+$(this.window.document).scrollTop();this.top=this.top<0?0:this.top}this.el.css({left:this.left,top:this.top});var shadowWidth=this.el.outerWidth();var shadowHeight=this.el.outerHeight();if($.boxModel==true){shadowWidth=shadowWidth-(shadowWidth-this.el.width());shadowHeight=shadowHeight-(shadowHeight-this.el.height())}if(this.shadow){this.shadow.css({left:this.left,top:this.top,width:shadowWidth,height:shadowHeight})}},move:function(param){UCML.Window.superclass.move.call(this,param);if(this.shadow){this.shadow.css({left:this.left,top:this.top})}},minimize:function(){UCML.Window.superclass.minimize.call(this);if(this.shadow)this.shadow.hide();if(this.mask)this.mask.hide()},collapse:function(){UCML.Window.superclass.collapse.call(this);if(this.shadow)this.shadow.hide()},expand:function(){UCML.Window.superclass.expand.call(this);if(this.shadow){this.shadow.show()}},destroy:function(){UCML.Window.superclass.destroy.call(this);if(this.mask){this.mask.remove();delete this.mask}if(this.shadow){this.shadow.remove();delete this.shadow}}});function getPageArea(document){if(document.compatMode=="BackCompat"){return{width:Math.max(document.body.scrollWidth,document.body.clientWidth),height:Math.max(document.body.scrollHeight,document.body.clientHeight)}}else{return{width:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth),height:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)}}}UCML.Messager=function(id){UCML.Messager.superclass.constructor.call(this,id)};UCML.Messager.moveShow=function(win,type,speed,timeout){if(!win)return;
switch(type){case null:win.show();break;case"slide":win.slideDown(speed);break;case"fade":win.fadeIn(speed);break;case"show":win.show(speed);break}var timer=null;if(timeout>0){timer=setTimeout(function(){UCML.Messager.moveHide(win,type,speed)},timeout)}win.hover(function(){if(timer){clearTimeout(timer)}},function(){if(timeout>0){timer=setTimeout(function(){UCML.Messager.moveHide(win,type,speed)},timeout)}})};UCML.Messager.moveHide=function(win,type,speed){if(!win)return;switch(type){case null:win.hide();break;case"slide":win.slideUp(speed);break;case"fade":win.fadeOut(speed);break;case"show":win.hide(speed);break}setTimeout(function(){win.remove()},speed)};UCML.extend(UCML.Messager,UCML.util.Observable,{ok:"确定",cancel:"取消",bodyCls:"messager-body",show:function(options){var opts=$.extend({showType:"slide",showSpeed:600,width:250,height:100,msg:"",title:"",timeout:4e3},options||{});var body=$('<div class="messager-body"></div>').html(opts.msg);var win=new UCML.Window({title:opts.title,width:opts.width,height:opts.height,collapsible:false,minimizable:false,maximizable:false,closable:true,body:body,rendeTo:window.document.body,shadow:false,draggable:false,resizable:false,closed:true,onBeforeOpen:function(){UCML.Messager.moveShow(win.el,opts.showType,opts.showSpeed,opts.timeout);return false},onBeforeClose:function(){UCML.Messager.moveHide(win.el,opts.showType,opts.showSpeed);return false}});win.el.css({left:null,top:null,right:0,bottom:-document.body.scrollTop-document.documentElement.scrollTop});win.open()},alert:function(title,msg,icon,fn){var content="<div>"+(msg||"")+"</div>";icon=icon||"info";switch(icon){case"error":content='<div class="messager-icon messager-error"></div>'+content;break;case"info":content='<div class="messager-icon messager-info"></div>'+content;break;case"question":content='<div class="messager-icon messager-question"></div>'+content;break;case"warning":content='<div class="messager-icon messager-warning"></div>'+content;break}content+='<div style="clear:both;"/>';var buttons={};buttons[this.ok]=function(){win.dialog({closed:true});if(fn){fn();return false}};var opts=this;buttons[this.ok]=function(){opts.window.close();if(fn){fn();return false}};this.window=this.createDialog(title,content,buttons)},confirm:function(title,msg,fn){var content='<div class="messager-icon messager-question"></div>'+"<div>"+msg+"</div>"+'<div style="clear:both;"/>';var buttons={};var opts=this;buttons[this.ok]=function(){opts.window.close();if(fn){fn(true);return false}};buttons[this.cancel]=function(){opts.window.close();if(fn){fn(false);return false}};this.window=this.createDialog(title,content,buttons)},prompt:function(title,msg,fn){var content='<div class="messager-icon messager-question"></div>'+"<div>"+msg+"</div>"+"<br/>"+'<input class="messager-input" type="text"/>'+'<div style="clear:both;"/>';var buttons={};var opts=this;buttons[this.ok]=function(){opts.window.close();if(fn){fn($(".messager-input",win).val());return false}};buttons[this.cancel]=function(){opts.window.close();if(fn){fn();return false}};this.window=this.createDialog(title,content,buttons)},popup:function(title,position,fn,msg){position=position||"bottom";msg=msg||"";var content='<div class="messager-icon messager-question"></div>'+'<div style="clear:both;"/>';var buttons={};var opts=this;var arr=title.split(";");for(var i=0;i<arr.length;i++){var index=i;buttons[arr[i]]=function(index){return function(){opts.window.close();if(fn){fn(index);return false}}}(i)}buttons["取消"]=function(){opts.window.close();return false};var body=$('<div class="messager-body"></div>');if(buttons){var tb=$('<div class="messager-button"></div>').appendTo(body);for(var label in buttons){new UCML.Linkbutton({text:label,rendeTo:tb,onClick:buttons[label]})}}this.window=new UCML.Window({title:msg,width:"100%",height:"auto",bodyCls:"popup-bottom",cls:position=="bottom"?"popup-bottom-window":"popup-center-window",modal:true,body:body,rendeTo:window.document.body,collapsible:false,minimizable:false,maximizable:false,resizable:false,closable:false,onClose:function(){setTimeout(function(){opts.window.destroy()},100)}});this.window.mask.on("click",function(){opts.window.close()});if(position=="center"){this.window.el.css("top",($(window).height()-this.window.el.height())/2)}},createDialog:function(title,content,buttons){var body=$('<div class="messager-body">'+content+"</div>");if(buttons){var tb=$('<div class="messager-button"></div>').appendTo(body);for(var label in buttons){new UCML.Linkbutton({text:label,rendeTo:tb,onClick:buttons[label]})}}var win=new UCML.Window({title:title,width:300,height:"auto",modal:true,body:body,rendeTo:window.document.body,collapsible:false,minimizable:false,maximizable:false,resizable:false,closable:false,onClose:function(){setTimeout(function(){win.destroy()},100)}});return win}});UCML.alert=function(title,msg,icon,fn){return(new UCML.Messager).alert(title,msg,icon,fn)};UCML.confirm=function(title,msg,icon,fn){return(new UCML.Messager).confirm(title,msg,fn)};UCML.popup=function(title,position,fn,msg){return(new UCML.Messager).popup(title,position,fn,msg)};UCML.PopupMenu=function(id){this.items=[];UCML.PopupMenu.superclass.constructor.call(this,id)};UCML.extend(UCML.PopupMenu,UCML.Commponent,{});UCML.PopupMenu.prototype.onRender=function(){UCML.PopupMenu.superclass.onRender.call(this)};UCML.PopupMenu.prototype.init=function(){UCML.PopupMenu.superclass.init.call(this);var opts=this;this.el.on("click",function(event){opts.show()})};UCML.PopupMenu.prototype.show=function(){if(this.items.length>0){var body=$('<div class="messager-body"></div>');var tb=$('<div class="messager-button"></div>').appendTo(body);var opts=this;for(var i=0;i<this.items.length;i++){var item=this.items[i];var fn=function(item){return function(){opts.window.close();if(item.onClick){item.onClick();return false}}}(item);new UCML.Linkbutton({text:item.text,iconCls:item.iconCls,isMobile:true,rendeTo:tb,onClick:fn})}var win=new UCML.Window({title:"",width:"auto",height:"auto",bodyCls:"popup-window",modal:true,body:body,rendeTo:window.document.body,collapsible:false,minimizable:false,maximizable:false,resizable:false,closable:false,onClose:function(){setTimeout(function(){win.destroy()},100)}});this.window=win;this.window.mask.on("click",function(){win.close()});var top=this.el.offset().top+this.el.outerHeight();var left=this.el.offset().left;if(left+win.el.outerWidth()+5>$(window).width()){left=$(window).width()-win.el.outerWidth()-5}win.el.css({top:top,left:left})}};UCML.PopupMenu.prototype.addItem=function(item){this.items.add(item)};UCML.PopupMenu.prototype.getItem=function(index){return this.items[index]};UCML.reg("UCML.PopupMenu",UCML.PopupMenu);UCML.TabPanel=function(id){this.panels=[];this.addEvents("tabSelect","tabChange");UCML.TabPanel.superclass.constructor.call(this,id)};UCML.extend(UCML.TabPanel,UCML.Container,{ctype:"UCML.TabPanel",selectPanel:null,plain:false,border:true,showMode:0,scrollIncrement:100,scrollDuration:400,onLoad:function(){},onSelect:function(title){},onClose:function(title){},onRender:function(){UCML.TabPanel.superclass.onRender.call(this);this.el.addClass("tabs-container");this.el.wrapInner('<div class="tabs-content"/>');var opts=this;this.header=$('<div class="tabs-header">'+'<div class="tabs-scroller-left"></div>'+'<div class="tabs-scroller-right"></div>'+'<div class="tabs-wrap">'+'<ul class="tabs"></ul>'+"</div>"+"</div>");if(typeof BPOIsJQMPage!=="undefined"&&BPOIsJQMPage){var theme=BPOPageTheme||"a";this.header.addClass("tabs-header-"+theme)}else if(this.el.attr("data-role")=="page"&&!UCML.isEmpty(this.el.attr("data-theme"))){var theme=this.el.attr("data-theme")||"a";this.el.addClass("tabs-container-"+theme);this.header.addClass("tabs-header-"+theme)}if(this.showMode==0){this.el.prepend(this.header)}else{this.el.append(this.header)}this.content=$(">div.tabs-content",this.el);this.tabs=$("ul.tabs",this.header);if(opts.plain==true){this.header.addClass("tabs-header-plain")}else{this.header.removeClass("tabs-header-plain")}if(opts.border==true){this.header.removeClass("tabs-header-noborder");this.content.removeClass("tabs-content-noborder")}else{this.header.addClass("tabs-header-noborder");this.content.addClass("tabs-content-noborder")}},afterRender:function(){var opts=this;$(">div.tabs-content>div",this.el).each(function(){var el=$(this);opts.addTab({body:el,title:el.attr("title"),scrollers:false});el.removeAttr("title")});if(this.panels.length>0){this.selectPanel=this.panels[0];this.selectPanel.show();this.selectPanel.tab.addClass("tabs-selected");this.selectPanel.tab.addClass("active");this.selectPanel.tab.blur();this.tabs.attr("tabs-count",this.panels.length)}UCML.TabPanel.superclass.afterRender.call(this)},setProperties:function(){UCML.TabPanel.superclass.setProperties.call(this);this.border=this.el.attr("border")?this.el.attr("border")=="true":this.border;this.plain=this.el.attr("plain")?this.el.attr("plain")=="true":this.plain},getPanel:function(v){var index=this.getPanelIndex(v);if(index>-1){return this.panels[index]}return false}});UCML.TabPanel.prototype.getTabLeftPosition=function(tab){var w=0;var b=true;$("ul.tabs li",this.header).each(function(){if(this==tab){b=false}if(b==true){w+=$(this).outerWidth(true)}});return w};UCML.TabPanel.prototype.getMaxScrollWidth=function(){var tabsWidth=0;$("ul.tabs li",this.header).each(function(){tabsWidth+=$(this).outerWidth(true)});var wrapWidth=$(".tabs-wrap",this.header).width();var padding=parseInt($(".tabs",this.header).css("padding-left"));return tabsWidth-wrapWidth+padding};UCML.TabPanel.prototype.setScrollers=function(){var tabsWidth=0;$("ul.tabs li",this.header).each(function(){tabsWidth+=$(this).outerWidth(true)});if(tabsWidth>this.header.width()){$(".tabs-scroller-left",this.header).css("display","block");$(".tabs-scroller-right",this.header).css("display","block");$(".tabs-wrap",this.header).addClass("tabs-scrolling");if($.boxModel==true){$(".tabs-wrap",this.header).css("left",2)}else{$(".tabs-wrap",this.header).css("left",0)}var width=this.header.width()-$(".tabs-scroller-left",this.header).outerWidth()-$(".tabs-scroller-right",this.header).outerWidth();$(".tabs-wrap",this.header).width(width)}else{$(".tabs-scroller-left",this.header).css("display","none");$(".tabs-scroller-right",this.header).css("display","none");$(".tabs-wrap",this.header).removeClass("tabs-scrolling").scrollLeft(0);$(".tabs-wrap",this.header).width(this.header.width());$(".tabs-wrap",this.header).css("left",0)}};UCML.TabPanel.prototype.setSize=function(param,a){UCML.TabPanel.superclass.setSize.call(this,param,a);if(this.height!="auto"){var height=this.el.height();var contentHeight=height;if($.boxModel==true){contentHeight=height-this.header.outerHeight(true)-(this.content.outerHeight(true)-this.content.height())}else{contentHeight=height-this.header.outerHeight(true)-(this.content.outerHeight(true)-this.content.height())}this.selectPanel.body.css("overflow","hidden");this.content.height(contentHeight);if(this.selectPanel){this.selectPanel.setSize({height:contentHeight,width:this.el.width()},"TabPanel")}}else{this.content.height("auto");if(this.selectPanel){this.selectPanel.setSize({height:"auto",width:this.width},"TabPanel")}}this.setScrollers()};UCML.TabPanel.prototype.bindEvents=function(){UCML.TabPanel.superclass.bindEvents.call(this);var opts=this;$(".tabs-scroller-left, .tabs-scroller-right",this.header).hover(function(){$(this).addClass("tabs-scroller-over")},function(){$(this).removeClass("tabs-scroller-over")});$(".tabs-scroller-left",this.header).unbind(".tabs").bind("click.tabs",function(){var wrap=$(".tabs-wrap",this.header);var pos=wrap.scrollLeft()-opts.scrollIncrement;wrap.animate({scrollLeft:pos},opts.scrollDuration)});$(".tabs-scroller-right",this.header).unbind(".tabs").bind("click.tabs",function(){var wrap=$(".tabs-wrap",this.header);var pos=Math.min(wrap.scrollLeft()+opts.scrollIncrement,opts.getMaxScrollWidth());wrap.animate({scrollLeft:pos},opts.scrollDuration)})};UCML.TabPanel.prototype.createTab=function(panel){var opts=this;var tab=$("<li></li>");if(typeof panel.body!="undefined"&&panel.body.length>0){tab.attr("ownervc",panel.body[0].id.substring(4))}var tab_span=$("<span></span>").html(panel.title);var tab_a=$('<a class="tabs-inner"></a>').attr("href","javascript:void(0)").append(tab_span);tab.append(tab_a).appendTo(this.tabs);if(panel.closable){tab_span.addClass("tabs-closable");tab_a.after('<a href="javascript:void(0)" class="tabs-close"></a>')}if(panel.icon){tab_span.addClass("tabs-with-icon");tab_span.after($("<span/>").addClass("tabs-icon").addClass(options.icon))}if(panel.content){panel.body.html(panel.content)}tab.unbind(".tabs").bind("click.tabs",function(){opts.selectTab(tab)});$(".tabs-close",tab).unbind(".tabs").bind("click.tabs",function(){opts.closeTab(tab)});return tab};UCML.TabPanel.prototype.addTab=function(options){if(UCML.isString(options)){options={title:options}}options=options||{};options=UCML.apply({id:null,title:"",content:"",href:null,cache:true,icon:null,closable:false,selected:false,rendeTo:this.content,noheader:true,border:false,doSize:false,closed:true,scrollers:true},options);if(options.scrollers){this.setScrollers()}var panel=new UCML.Panel(options);panel.tab=this.createTab(panel);this.panels.add(panel)};UCML.TabPanel.prototype.getPanelIndex=function(v){var name="title";if(UCML.isNumber(v)){return v}if(UCML.isObject(v)){name="tab"}for(var i=0;i<this.panels.length;i++){if(this.panels[i][name]==v){return i}}return-1};UCML.TabPanel.prototype.closeTab=function(v){var panel=this.getPanel(v);if(panel){var index=this.panels.indexOf(panel);this.panels.remove(panel);if(this.panels.length>0&&index==this.panels.length){this.selectTab(index-1)}else if(index<=this.panels.length-1){this.selectTab(index)}else{this.selectTab(0)}panel.tab.remove();panel.destroy();this.setScrollers()}};UCML.TabPanel.prototype.getHeader=function(v){var panel=this.getPanel(v);if(panel){return panel.tab}};UCML.TabPanel.prototype.hidenTab=function(v){var panel=this.getPanel(v);if(panel){var index=this.panels.indexOf(panel);if(this.panels.length>0&&index==this.panels.length){this.selectTab(index-1)}else if(index<=this.panels.length-1){this.selectTab(index)}else{this.selectTab(0)}panel.tab.hide();panel.close();this.setScrollers()}};UCML.TabPanel.prototype.showTab=function(v){var panel=this.getPanel(v);if(panel){var index=this.panels.indexOf(panel);if(this.panels.length>0&&index==this.panels.length){this.selectTab(index-1)}else if(index<=this.panels.length-1){this.selectTab(index)}else{this.selectTab(0)}panel.tab.show();panel.open();this.setScrollers()}};UCML.TabPanel.prototype.selectTab=function(v){var beginData=new Date;var panel=this.getPanel(v);if(panel){if(this.selectPanel){this.selectPanel.tab.removeClass("tabs-selected");this.selectPanel.tab.removeClass("active");this.selectPanel.hide()}panel.tab.addClass("tabs-selected");panel.tab.addClass("active");this.selectPanel=panel;panel.show();this.setSize(null,"selectTab");var paenlIndex=this.panels.indexOf(panel);var tabVC=eval(panel.tab.attr("ownervc"));if(tabVC&&tabVC.initState===false&&tabVC.paginationCtype!="undefined"){tabVC.open();tabVC.BCLoadData();if(tabVC.showPager)tabVC.setPagination();else tabVC.el.children(".datagrid-pager").hide()}this.fireEvent("tabSelect",panel,paenlIndex);this.onSelect.call(this,panel,paenlIndex);this.el.find(".ucml-widget-toolbar").removeClass("active");this.el.find(".ucml-widget-toolbar.widget-toolbar-"+panel.tab.attr("ownervc")).addClass("active")}};UCML.TabPanel.prototype.exists=function(v){return this.getPanel(v)};UCML.ImageButton=function(id){this.disabled=false;UCML.ImageButton.superclass.constructor.call(this,id)};UCML.extend(UCML.ImageButton,UCML.InputList,{ctype:"UCML.ImageButton",autoEl:"img",bindEvents:function(){this.on("click",this.click,this);this.on("mousemove",this.addBgk,this);this.on("mouseout",this.removeBgk,this)}});UCML.ImageButton.prototype.init=function(){UCML.ImageButton.superclass.init.call(this)};UCML.ImageButton.prototype.setProperties=function(){UCML.ImageButton.superclass.setProperties.call(this);this.src=this.src||this.el.attr("src");this.alt=this.alt||this.el.attr("alt");this.width=this.width||this.el.attr("width");this.height=this.height||this.el.attr("height");this.text=this.text||this.el.attr("title")};UCML.ImageButton.prototype.onRender=function(){UCML.ImageButton.superclass.onRender.call(this);this.el.attr("src",this.src);this.el.attr("alt",this.alt);this.el.attr("width",this.width);this.el.attr("height",this.height);this.el.attr("title",this.text);this.el.css({cursor:"pointer"})};UCML.ImageButton.prototype.click=function(el,e){if(!this.disabled){this.onClick.call(this,el,e)}};UCML.ImageButton.prototype.addBgk=function(){if(this.src2!=""){this.el.attr("src",this.src2)}};UCML.ImageButton.prototype.removeBgk=function(){this.el.attr("src",this.src)};UCML.ImageButton.prototype.setDisabled=function(disabled){if(disabled){this.disabled=true;var href=this.el.attr("href");if(href){this.href=href;this.attr("href","javascript:void(0)")}var onclick=this.el.attr("onclick");if(onclick){this.onclick=onclick;this.el.attr("onclick",null)}this.el.css({cursor:"default"})}else{this.disabled=false;if(this.href){this.el.attr("href",this.href)}if(this.onclick){this.dom.onclick=this.onclick}this.el.css({cursor:"pointer"})}};UCML.ImageButton.prototype.enable=function(){this.setDisabled(false)};UCML.ImageButton.prototype.disable=function(){this.setDisabled(true)};UCML.reg("UCML.ImageButton",UCML.ImageButton);(function(){UCML.ToolBar=function(id){this.items=new Array;UCML.ToolBar.superclass.constructor.call(this,id)};UCML.extend(UCML.ToolBar,UCML.Container,{ctype:"UCML.ToolBar",disable:function(){for(var i=0;i<this.items.length;i++){if(this.items[i].disable){this.items[i].disable()}}},enable:function(){for(var i=0;i<this.items.length;i++){if(this.items[i].enable){this.items[i].enable()}}}});UCML.ToolBar.prototype.init=function(){UCML.ToolBar.superclass.init.call(this)};UCML.ToolBar.prototype.onRender=function(){this.el.append('<table cellspacing="0" ><tr></tr></table>');this.el.addClass("toolbar");this.tr=this.el.find("tr");var items=this.el.find("[ctype]");for(var i=0;i<items.length;i++){var opt=UCML.create(items[i],$(items[i]).attr("ctype"));if(opt){this.addItem(opt)}}};UCML.ToolBar.prototype.nextBlock=function(item){var td=document.createElement("td");if(this.Wrap){this.tr.parent().parent().hide();var table=$("<div style='float:left'><table cellspacing=\"0\" ><tr><td></td></tr></table></div>");this.el.append(table);td=table.find("td").last();td.append(item.el)}else{td=$(td);this.tr.append(td);td.append(item.el)}item.td=td;return td};UCML.ToolBar.prototype.addItem=function(item){item.render(this.nextBlock(item));this.items.add(item);return item};UCML.ToolBar.prototype.getItem=function(index){return this.items[index]};UCML.ToolBar.prototype.addFillCtl=function(config){return this.addItem(new T.FillCtl(config))};UCML.ToolBar.prototype.addDropDownList=function(config){return this.addItem(new T.DropDownList(config))};UCML.ToolBar.prototype.addTextBox=function(config){return this.addItem(new T.TextBox(config))};UCML.ToolBar.prototype.addImageButton=function(config){return this.addItem(new T.ImageButton(config))};UCML.ToolBar.prototype.addDateBox=function(config){var opts=new T.DateBox(config);var el=opts.combo;this.addElement(el);this.items.add(opts);return opts};UCML.ToolBar.prototype.addSeparator=function(config){return this.addItem(new T.Separator(config))};UCML.ToolBar.prototype.addSpacer=function(config){return this.addItem(new T.Spacer(config))};UCML.ToolBar.prototype.addFill=function(config){return this.addItem(new T.Fill(config))};UCML.ToolBar.prototype.addLabel=function(config){return this.addItem(new T.Label(config))};UCML.ToolBar.prototype.addElement=function(el){return this.nextBlock({el:$(el)})};UCML.ToolBar.prototype.addButton=function(config){return this.addItem(new T.Button(config))};UCML.ToolBar.prototype.addCheckButton=function(config){return this.addItem(new T.CheckButton(config))};UCML.ToolBar.prototype.addSplitButton=function(config){return this.addItem(new T.SplitButton(config))};UCML.ToolBar.prototype.addText=function(config){return this.addItem(new T.TextItem(text,id))};UCML.ToolBar.prototype.FillSpaceCtl=function(index,ctl){this.items[index].td.html("").append(ctl.el)};var T=UCML.ToolBar;UCML.Toolbar=UCML.ToolBar;UCML.reg("UCML.ToolBar",UCML.ToolBar);T.Item=function(config){this.config=config;T.Item.superclass.constructor.call(this,config)};UCML.extend(T.Item,UCML.Commponent,{ctype:"UCML.ToolBar.Item",getIndex:function(){return this.td[0].cellIndex},render:function(td){}});T.Item.prototype.init=function(){};T.Item.prototype.onClick=function(el,e){e.preventDefault();if(this.handler){this.handler.call(this.scope||this,el,e)}};T.Item.prototype.show=function(){this.hidden=false;this.td.show()};T.Item.prototype.hide=function(){this.hidden=true;this.td.hide()};T.Item.prototype.setVisible=function(visible){if(visible){this.show()}else{this.hide()}};T.Item.prototype.disable=function(){this.td.addClass("item-disabled");this.disabled=true};T.Item.prototype.enable=function(){this.td.removeClass("item-disabled");this.disabled=false};UCML.reg("UCML.ToolBar.Item",T.Item);T.Button=UCML.extend(UCML.Linkbutton,{getIndex:function(){return this.td[0].cellIndex},hide:function(){this.hidden=true;this.td.hide()},show:function(){this.hidden=false;this.td.show()},setVisible:function(visible){if(visible){this.show()}else{this.hide()}}});T.ImageButton=UCML.extend(UCML.ImageButton,{getIndex:function(){return this.td[0].cellIndex},hide:function(){this.hidden=true;this.td.hide()},show:function(){this.hidden=false;this.td.show()},setVisible:function(visible){if(visible){this.show()}else{this.hide()}}});T.CheckButton=UCML.extend(UCML.CheckButton,{getIndex:function(){return this.td[0].cellIndex},hide:function(){this.hidden=true;this.td.hide()},show:function(){this.hidden=false;this.td.show()},setVisible:function(visible){if(visible){this.show()}else{this.hide()}}});T.SplitButton=UCML.extend(UCML.Splitbutton,{getIndex:function(){return this.td[0].cellIndex}});T.DropDownList=UCML.extend(UCML.DropDownList,{getIndex:function(){return this.td[0].cellIndex}});T.TextBox=UCML.extend(UCML.TextBox,{getIndex:function(){return this.td[0].cellIndex}});T.DateBox=UCML.extend(UCML.JQMDate,{getIndex:function(){return this.td[0].cellIndex}});UCML.reg("UCML.ToolBar.Button",T.Button);UCML.reg("UCML.ToolBar.SplitButton",T.SplitButton);UCML.reg("UCML.ToolBar.DropDownList",T.DropDownList);UCML.reg("UCML.ToolBar.TextBox",T.TextBox);UCML.reg("UCML.ToolBar.TextBox",T.DateBox);T.Separator=function(){T.Separator.superclass.constructor.call(this)};UCML.extend(T.Separator,T.Item,{enable:UCML.emptyFn,disable:UCML.emptyFn,focus:UCML.emptyFn,autoEl:"span",render:function(td){T.Separator.superclass.render.call(this,td);td.html("<span class='separator'></span>")}});UCML.reg("UCML.ToolBar.Separator",T.Separator);T.Spacer=function(){T.Spacer.superclass.constructor.call(this)};UCML.extend(T.Spacer,T.Item,{enable:UCML.emptyFn,disable:UCML.emptyFn,focus:UCML.emptyFn,render:function(td){T.Spacer.superclass.render.call(this,td);td.addClass("spacer")}});UCML.reg("UCML.ToolBar.Spacer",T.Spacer);T.Fill=UCML.extend(T.Spacer,{render:function(td){T.Fill.superclass.render.call(this,td);td.css("width","100%")}});UCML.reg("UCML.ToolBar.Fill",T.Fill);T.Label=function(config){if(UCML.isString(config)){this.text=config}else{this.text=config.text||""}T.Label.superclass.constructor.call(this,config)};UCML.extend(T.Label,T.Item,{enable:UCML.emptyFn,disable:UCML.emptyFn,focus:UCML.emptyFn,autoEl:"span",render:function(td){T.Label.superclass.render.call(this,td);this.el=$("<span class='label'>"+this.text+"</span>");td.html(this.el)},setText:function(text){this.el.html(text)},getText:function(){return this.el.html()}});UCML.reg("UCML.ToolBar.Label",T.Label);UCML.Pagination=function(id){this.dataTable=null;UCML.Pagination.superclass.constructor.call(this,id)};UCML.extend(UCML.Pagination,UCML.ToolBar,{ctype:"UCML.Pagination",pageIndex:1,total:0,pageSize:10,pageNumber:0,pageCount:0,displayMsg:null,bindEvents:function(){UCML.Pagination.superclass.bindEvents.call(this);this.dataTable.on("onLoad",this.updateMsg,this);this.dataTable.on("OnAfterInsert",this.updateMsg,this);this.dataTable.on("OnAfterDelete",this.updateMsg,this)}});UCML.Pagination.prototype.init=function(){UCML.Pagination.superclass.init.call(this)};UCML.Pagination.prototype.onRender=function(){UCML.Pagination.superclass.onRender.call(this);this.addFill();this.addLabel("&nbsp;");if(this.havePage){this.addButton({text:UCML.Languge.DBLoadFirstPage,pagination:this,onClick:this.onLoadFirstPage});this.addButton({text:UCML.Languge.DBLoadPrevPage,pagination:this,onClick:this.onLoadPrevPage});this.addButton({text:UCML.Languge.DBLoadMore,pagination:this,onClick:this.onLoadMoreData});this.addButton({text:UCML.Languge.DBLoadLastPage,pagination:this,onClick:this.onLoadLastPage});this.addLabel(UCML.Languge.DBTogether2);this.indexBox=this.addTextBox();this.indexBox.el.width(20);this.addLabel(UCML.Languge.DBTogether3);this.gotoPageBtn=this.addButton({text:UCML.Languge.DBGoto,pagination:this});this.gotoPageBtn.on("click",function(){if(this.applet){if(this.indexBox.getValue()!=""&&!isNaN(this.indexBox.getValue())){this.applet.onGotoPage(parseInt(this.indexBox.getValue()))}}},this)}};UCML.Pagination.prototype.updateMsg=function(){var msg="";var totalRecordCount=parseInt(this.dataTable.getTotalRecordCount());var pageNumber=parseInt(this.dataTable.getDefaultPageCount());var recordCount=this.dataTable.getRecordCount();if(totalRecordCount==0){totalRecordCount=recordCount;msg=UCML.Languge.DBPool+totalRecordCount+UCML.Languge.DBNote}else if(recordCount==0){msg=UCML.Languge.DBPool+"0"+UCML.Languge.DBNote}else if(this.havePage&&pageNumber>0){if(!this.displayMsg){this.displayMsg=UCML.Languge.Pagination_DisplayMsg}var msgTmp=new UCML.Template(this.displayMsg);this.total=totalRecordCount;this.pageNumber=pageNumber;if(this.pageNumber=="-1"){this.pageNumber=0;this.pageIndex=1}else{this.pageCount=parseInt(this.total/this.pageNumber);if(this.total%this.pageNumber!=0){this.pageCount++}this.pageIndex=parseInt(parseInt(this.dataTable.StartPos)/this.pageNumber)+1}msg=msgTmp.apply({pageIndex:this.pageIndex,total:this.total,pageCount:this.pageCount,pageNumber:this.pageNumber,pageSize:this.pageSize})}else{msg=UCML.Languge.DBPool+totalRecordCount+UCML.Languge.DBNote+UCML.Languge.DBFrom+parseInt(parseInt(this.dataTable.StartPos)+parseInt(1))+UCML.Languge.DBBeginReadCount+this.dataTable.ReadCount+UCML.Languge.DBNote}$(this.getItem(1).td).children("span").html(msg)};UCML.Pagination.prototype.onLoadPrevPage=function(){if(this.pagination.applet){this.pagination.applet.onLoadPrevPage()}};UCML.Pagination.prototype.onLoadMoreData=function(){if(this.pagination.applet){this.pagination.applet.onLoadMoreData()}};UCML.Pagination.prototype.onLoadFirstPage=function(){if(this.pagination.applet){this.pagination.applet.onLoadFirstPage()}};UCML.Pagination.prototype.onLoadLastPage=function(){if(this.pagination.applet){this.pagination.applet.onLoadLastPage()}};UCML.reg("UCML.Pagination",UCML.Pagination);UCML.PaginationMin=function(id){UCML.PaginationMin.superclass.constructor.call(this,id)};UCML.extend(UCML.PaginationMin,UCML.Pagination,{ctype:"UCML.PaginationMin",displayMsg:null,onRender:function(){UCML.Pagination.superclass.onRender.call(this);this.addFill();this.addLabel("&nbsp;");var opts=this;if(this.havePage){if(this.applet.showPageCount){this.addLabel("每页记录数");var dpl=this.addDropDownList();var currentPageCount=RecordCountInfo[this.dataTable.BCName].PageCount;var indexKey=this.applet.pageCountKey||[10,15,20,30,50,100];if(indexKey.indexOf(currentPageCount)==-1){dpl.add(currentPageCount,currentPageCount,true)}for(var i=0;i<indexKey.length;i++){var seleced=false;if(currentPageCount==indexKey[i])seleced=true;dpl.add(indexKey[i],indexKey[i],seleced)}var dt=this.dataTable;dpl.on("change",function(text,value){dt.setDefaultPageCount(value);CallSetPageCount(dt.BCName,text)});function CallSetPageCount(BCName,pageCount){var config={methodName:"SetPageCount",params:{BCName:BCName,pageCount:pageCount},onSuccess:succeeded_SetPageCount,onFailure:failed_SetPageCount};return this.invoke(config)}function succeeded_SetPageCount(obj,text,methodName){dt.Refresh()}function failed_SetPageCount(obj,text,methodName){alert(text)}}var firstbtn=$("<div title='"+UCML.Languge.DBLoadFirstPage+"' class='firstbtn'>&#160;</div>");firstbtn.bind("click",function(){opts.applet.onLoadFirstPage()});this.addElement(firstbtn);var prevbtn=$("<div title='"+UCML.Languge.DBLoadPrevPage+"' class='prevbtn'>&#160;</div>");prevbtn.bind("click",function(){opts.applet.onLoadPrevPage()});var morebtn=$("<div title='"+UCML.Languge.DBLoadMore+"' class='morebtn'>&#160;</div>");morebtn.bind("click",function(){opts.applet.onLoadMoreData()});var lastbtn=$("<div title='"+UCML.Languge.DBLoadLastPage+"' class='lastbtn'>&#160;</div>");lastbtn.bind("click",function(){opts.applet.onLoadLastPage()});var refreshbtn=$("<div title='"+UCML.Languge.DBRefresh+"' class='refreshbtn'>&#160;</div>");refreshbtn.bind("click",function(){opts.applet.dataTable.Refresh()});this.addElement(firstbtn);this.addElement(prevbtn);this.addElement(morebtn);this.addElement(lastbtn);this.addElement(refreshbtn);if(this.applet.showGotoBtn){this.addLabel(UCML.Languge.DBTogether2);this.indexBox=this.addTextBox();this.indexBox.el.width(20);this.addLabel(UCML.Languge.DBTogether3);var gotoPageBtn=$("<div title='"+UCML.Languge.DBGoto+"' class='gotopagebtn'>&#160;</div>");var opt=this;gotoPageBtn.bind("click",function(){if(opt.applet){if(opt.indexBox.getValue()!=""&&!isNaN(opt.indexBox.getValue())){opt.applet.onGotoPage(parseInt(opt.indexBox.getValue()))}}});this.addElement(gotoPageBtn)}}}});UCML.reg("UCML.PaginationMin",UCML.PaginationMin);UCML.PaginationMobile=function(id){UCML.PaginationMobile.superclass.constructor.call(this,id)};UCML.extend(UCML.PaginationMobile,UCML.Pagination,{ctype:"UCML.PaginationMobile",displayMsg:null,onRender:function(){UCML.Pagination.superclass.onRender.call(this);this.addFill();this.addLabel("&nbsp;");this.addFill();var opts=this;if(this.havePage){this.addButton({id:"Btn_firstPage",isMobile:true,tooltip:"",toolbar:opts,iconCls:"ui-icon-carat-l",onClick:function(el,e){opts.applet.onLoadPrevPage()}});this.addButton({id:"Btn_lastPage",tooltip:"",isMobile:true,toolbar:opts,iconCls:"ui-icon-carat-r",onClick:function(el,e){opts.applet.onLoadMoreData()}})}}});UCML.reg("UCML.PaginationMobile",UCML.PaginationMobile)})();UCML.FitLayout=function(id){UCML.FitLayout.superclass.constructor.call(this,id)};UCML.extend(UCML.FitLayout,UCML.Container,{ctype:"UCML.FitLayout",onRender:function(){this.items=[];var cds=this.el.children();for(var i=0;i<cds.length;i++){var el=$(cds[i]);var id=el.attr("id");var elObj=null;if(id){var cmObj=UCML.get(id);if(cmObj&&cmObj.el){elObj=cmObj}else{elObj=new UCML.Container({el:el})}elObj.resizeTo=false;this.items.add(elObj)}}UCML.FitLayout.superclass.onRender.call(this)},resize:function(param){this.setSize(param)},setSize:function(param){UCML.FitLayout.superclass.setSize.call(this,param,"FitLayout");var opts=this;var sumHeight=this.el.height();if(sumHeight<=0){return}for(var i=0;i<this.items.length;i++){var cmObj=this.items[i];var height=cmObj.getHeight();if(i<this.items.length-1&&sumHeight>=height){cmObj.resize(null,"FitLayout");sumHeight=sumHeight-cmObj.getOuterHeight(true)}else{cmObj.resize({height:sumHeight,width:this.getWidth()},"FitLayout")}}}});UCML.Layout=function(id){UCML.Layout.superclass.constructor.call(this,id)};UCML.extend(UCML.Layout,UCML.Container,{alignWidth:true,alignHeight:true,onRender:function(){if(this.tagName=="body"){$("html").css({height:"100%",overflow:"hidden"});$("body").css({height:"100%",overflow:"hidden",border:"none"})}this.cls="layout "+this.cls;this.el.css({margin:0,
padding:0});UCML.Layout.superclass.onRender.call(this);$('<div class="layout-split-proxy-h"></div>').appendTo(this.el);$('<div class="layout-split-proxy-v"></div>').appendTo(this.el);var panels={center:this.createPanel("center")};panels.north=this.createPanel("north");panels.south=this.createPanel("south");panels.east=this.createPanel("east");panels.west=this.createPanel("west");this.panels=panels},createPanel:function(dir){var opts=this;var pp=$(">div[region="+dir+"]",this.el);var toolCls=null;if(dir=="north"){toolCls="layout-button-up"}else if(dir=="south"){toolCls="layout-button-down"}else if(dir=="east"){toolCls="layout-button-right"}else if(dir=="west"){toolCls="layout-button-left"}var cls="layout-panel layout-panel-"+dir;if(pp.attr("split")=="true"){cls+=" layout-split-"+dir}pp=new UCML.Panel({cls:cls,doSize:false,el:pp,bodyCls:"layout-body",isSetProperties:true,border:pp.attr("border")=="false"?false:true,tools:[{iconCls:toolCls,handler:function(){opts.collapsePanel(dir)}}]});if(pp.el.attr("split")=="true"){var panel=pp.el;var handles="";if(dir=="north")handles="s";if(dir=="south")handles="n";if(dir=="east")handles="w";if(dir=="west")handles="e";panel.resizable({handles:handles,onStartResize:function(e){resizing=true;if(dir=="north"||dir=="south"){var proxy=$(">div.layout-split-proxy-v",opts.el)}else{var proxy=$(">div.layout-split-proxy-h",opts.el)}var top=0,left=0,width=0,height=0;var pos={display:"block"};if(dir=="north"){pos.top=parseInt(panel.css("top"))+panel.outerHeight()-proxy.height();pos.left=parseInt(panel.css("left"));pos.width=panel.outerWidth();pos.height=proxy.height()}else if(dir=="south"){pos.top=parseInt(panel.css("top"));pos.left=parseInt(panel.css("left"));pos.width=panel.outerWidth();pos.height=proxy.height()}else if(dir=="east"){pos.top=parseInt(panel.css("top"))||0;pos.left=parseInt(panel.css("left"))||0;pos.width=proxy.width();pos.height=panel.outerHeight()}else if(dir=="west"){pos.top=parseInt(panel.css("top"))||0;pos.left=panel.outerWidth()-proxy.width();pos.width=proxy.width();pos.height=panel.outerHeight()}proxy.css(pos);$('<div class="layout-mask"></div>').css({left:0,top:0,width:opts.el.width(),height:opts.el.height()}).appendTo(opts.el)},onResize:function(e){if(dir=="north"||dir=="south"){var proxy=$(">div.layout-split-proxy-v",opts.el);proxy.css("top",e.pageY-opts.el.offset().top-proxy.height()/2)}else{var proxy=$(">div.layout-split-proxy-h",opts.el);proxy.css("left",e.pageX-opts.el.offset().left-proxy.width()/2)}return false},onStopResize:function(e){$(">div.layout-split-proxy-v",opts.el).css("display","none");$(">div.layout-split-proxy-h",opts.el).css("display","none");pp.width=e.data.width;pp.height=e.data.height;pp.left=e.data.left;pp.top=e.data.top;pp.resize();opts.setSize();resizing=false;opts.el.find(">div.layout-mask").remove()}})}return pp},isPanelVisible:function(pp){if(!pp)return false;if(pp){return pp.el.is(":visible")}else{return false}},setSize:function(param){UCML.Layout.superclass.setSize.call(this,param);var opts=this;var panels=this.panels;var cpos={top:0,left:0,width:this.el.width(),height:this.el.height()};function setNorthSize(pp){if(!pp)return;pp.resize({width:opts.el.width(),height:pp.height,left:0,top:0});cpos.top+=Number(pp.height);cpos.height-=Number(pp.height)}if(opts.isPanelVisible(panels.expandNorth)){setNorthSize(panels.expandNorth)}else{setNorthSize(panels.north)}function setSouthSize(pp){if(!pp)return;pp.resize({width:opts.el.width(),height:pp.height,left:0,top:opts.el.height()-pp.height});cpos.height-=Number(pp.height)}if(opts.isPanelVisible(panels.expandSouth)){setSouthSize(panels.expandSouth)}else{setSouthSize(panels.south)}function setEastSize(pp){if(!pp)return;pp.resize({width:pp.width,height:cpos.height,left:opts.el.width()-pp.width,top:cpos.top});cpos.width-=Number(pp.width)}if(opts.isPanelVisible(panels.expandEast)){setEastSize(panels.expandEast)}else{setEastSize(panels.east)}function setWestSize(pp){if(!pp)return;pp.resize({width:pp.width,height:cpos.height,left:0,top:cpos.top});cpos.left+=Number(pp.width);cpos.width-=Number(pp.width)}if(opts.isPanelVisible(panels.expandWest)){setWestSize(panels.expandWest)}else{setWestSize(panels.west)}panels.center.resize(cpos)},collapsePanel:function(region){var panels=this.panels;var opts=this;function createExpandPanel(dir){var icon;if(dir=="east")icon="layout-button-left";else if(dir=="west")icon="layout-button-right";else if(dir=="north")icon="layout-button-down";else if(dir=="south")icon="layout-button-up";var p=$("<div></div>").appendTo(opts.el);p=new UCML.Panel({cls:"layout-expand",title:"&nbsp;",el:p,closed:true,doSize:false,tools:[{iconCls:icon,handler:function(){opts.expandPanel(region)}}]});p.el.hover(function(){$(this).addClass("layout-expand-over")},function(){$(this).removeClass("layout-expand-over")});return p}if(region=="east"){if(panels.east.onBeforeCollapse.call(panels.east)==false)return;panels.center.resize({width:panels.center.width+panels.east.width-28});panels.east.el.animate({left:opts.el.width()},function(){panels.east.close();panels.expandEast.open();panels.expandEast.resize({top:panels.east.top,left:opts.el.width()-28,width:28,height:panels.east.height});panels.east.onCollapse.call(panels.east)});if(!panels.expandEast){panels.expandEast=createExpandPanel("east");panels.expandEast.el.click(function(){panels.east.open();panels.east.resize({left:opts.el.width()});panels.east.el.animate({left:opts.el.width()-panels.east.width});return false})}}else if(region=="west"){if(panels.west.onBeforeCollapse.call(panels.west)==false)return;panels.center.resize({width:panels.center.width+panels.west.width-28,left:28});panels.west.el.animate({left:-panels.west.width},function(){panels.west.close();panels.expandWest.open();panels.expandWest.resize({top:panels.west.top,left:0,width:28,height:panels.west.height});panels.west.onCollapse.call(panels.west)});if(!panels.expandWest){panels.expandWest=createExpandPanel("west");panels.expandWest.el.click(function(){panels.west.open();panels.west.resize({left:-panels.west.width});panels.west.el.animate({left:0});return false})}}else if(region=="north"){if(panels.north.onBeforeCollapse.call(panels.north)==false)return;var hh=this.el.height()-28;if(opts.isPanelVisible(panels.expandSouth)){hh-=panels.expandSouth.height}else if(opts.isPanelVisible(panels.south)){hh-=panels.south.height}panels.center.resize({top:28,height:hh});panels.east.resize({top:28,height:hh});panels.west.resize({top:28,height:hh});if(opts.isPanelVisible(panels.expandEast))panels.expandEast.resize({top:28,height:hh});if(opts.isPanelVisible(panels.expandWest))panels.expandWest.resize({top:28,height:hh});panels.north.el.animate({top:-panels.north.height},function(){panels.north.close();panels.expandNorth.open();panels.expandNorth.resize({top:0,left:0,width:opts.el.width(),height:28});panels.north.onCollapse.call(panels.north)});if(!panels.expandNorth){panels.expandNorth=createExpandPanel("north");panels.expandNorth.el.click(function(){panels.north.open();panels.north.resize({top:-panels.north.height});panels.north.el.animate({top:0});return false})}}else if(region=="south"){if(panels.south.onBeforeCollapse.call(panels.south)==false)return;var hh=opts.el.height()-28;if(opts.isPanelVisible(panels.expandNorth)){hh-=panels.expandNorth.height}else if(opts.isPanelVisible(panels.north)){hh-=panels.north.height}panels.center.resize({height:hh});panels.east.resize({height:hh});panels.west.resize({height:hh});if(opts.isPanelVisible(panels.expandEast))panels.expandEast.resize({height:hh});if(opts.isPanelVisible(panels.expandWest))panels.expandWest.resize({height:hh});panels.south.el.animate({top:opts.el.height()},function(){panels.south.close();panels.expandSouth.open();panels.expandSouth.resize({top:opts.el.height()-28,left:0,width:opts.el.width(),height:28});panels.south.onCollapse.call(panels.south)});if(!panels.expandSouth){panels.expandSouth=createExpandPanel("south");panels.expandSouth.el.click(function(){panels.south.open();panels.south.resize({top:opts.el.height()});panels.south.el.animate({top:opts.el.height()-panels.south.height});return false})}}},expandPanel:function(region){var panels=this.panels;var cc=this.el;var opts=this;if(region=="east"&&panels.expandEast){if(panels.east.onBeforeExpand.call(panels.east)==false)return;panels.expandEast.close();panels.east.el.stop(true,true);panels.east.open();panels.east.resize({left:cc.width()});panels.east.el.animate({left:cc.width()-panels.east.width},function(){opts.setSize();panels.east.onExpand.call(panels.east)})}else if(region=="west"&&panels.expandWest){if(panels.west.onBeforeExpand.call(panels.west)==false)return;panels.expandWest.close();panels.west.el.stop(true,true);panels.west.open();panels.west.resize({left:-panels.west.width});panels.west.el.animate({left:0},function(){opts.setSize();panels.west.onExpand.call(panels.west)})}else if(region=="north"&&panels.expandNorth){if(panels.north.onBeforeExpand.call(panels.north)==false)return;panels.expandNorth.close();panels.north.el.stop(true,true);panels.north.open();panels.north.resize({top:-panels.north.height});panels.north.el.animate({top:0},function(){opts.setSize();panels.north.onExpand.call(panels.north)})}else if(region=="south"&&panels.expandSouth){if(panels.south.onBeforeExpand.call(panels.south)==false)return;panels.expandSouth.close();panels.south.el.stop(true,true);panels.south.open();panels.south.resize({top:cc.height()});panels.south.el.animate({top:cc.height()-panels.south.height},function(){opts.setSize();panels.south.onExpand.call(panels.south)})}}});UCML.OpenShowWindow=function(id){UCML.OpenShowWindow.superclass.constructor.call(this,id)};UCML.extend(UCML.OpenShowWindow,UCML.Window,{URL:null,draggable:false,resizable:false,showShadow:true,modal:true,border:false,closable:true,title:"请选择....",height:600,width:600,scroll:"no",doSize:false,frameMode:"self",close:function(){$(this.window.document.body).removeClass("body-fixed");UCML.OpenShowWindow.superclass.close.call(this);if(this.closed==true){this.destroy()}},closeOpener:function(){this.close();if(window.openerWindow&&window.openerWindow.openWindowList){for(var i=0;i<window.openerWindow.openWindowList.length;i++){window.openerWindow.openWindowList[i].closeOpener()}}},init:function(){window.openWindowList=window.openWindowList||[];window.openWindowList.add(this);if(this.frameMode=="parent"){this.window=this.window||window.parent}else if(this.frameMode=="frame"){this.window=this.window||window;while(this.window.parent&&this.window.parent!=this.window){this.window=this.window.parent}}else{this.window=this.window||window}if(this.window==window){this.frameMode="self"}this.window["window-max-zIndex"]=this.window["window-max-zIndex"]||UCML.Window.zIndex++;UCML.Window.zIndex=this.window["window-max-zIndex"]++;this.rendeTo=this.window.document.body;UCML.OpenShowWindow.superclass.init.call(this)},open:function(){this.window["window-max-zIndex"]=this.window["window-max-zIndex"]||UCML.Window.zIndex++;UCML.Window.zIndex=this.window["window-max-zIndex"]++;$(this.window.document.body).addClass("body-fixed");UCML.OpenShowWindow.superclass.open.call(this)},onRender:function(){UCML.OpenShowWindow.superclass.onRender.call(this);if(this.URL){if(this.URL.toLowerCase().indexOf("http://",0)==-1&&this.URL.toLowerCase().indexOf("https://",0)==-1){if(this.frameMode=="frame"&&this.window["localResourcePath"]){this.URL=this.window["localResourcePath"]+this.URL}else if(this.frameMode=="self"&&this.window["UCMLLocalResourcePath"]){this.URL=UCMLLocalResourcePath+this.URL}else if(this.frameMode=="frame"&&this.window["UCMLLocalResourcePath"]){this.URL=this.window["UCMLLocalResourcePath"]+this.URL}}var dt=new Date;var opentimeurl="opentime="+dt.getFullYear()+dt.getMonth()+dt.getDate()+dt.getHours()+dt.getMinutes()+dt.getSeconds();var content=null;if(this.URL.indexOf("?")>0){content=$("<iframe src="+this.URL+"&"+opentimeurl+"  scrolling="+this.scroll+"  frameborder=0></iframe>",this.window.document.body)}else{content=$("<iframe src="+this.URL+"?"+opentimeurl+"  scrolling="+this.scroll+"  frameborder=0></iframe>",this.window.document.body)}this.frame=content;var w=window;var opts=this;this.frame.bind("load",function(){try{this.contentWindow.openerWindow=w;this.contentWindow.opener=w;this.contentWindow.currentWindow=opts;this.contentWindow.close=function(){opts.close()}}catch(e){}});this.body.append(content);try{content[0].contentWindow.openerWindow=w;content[0].contentWindow.currentWindow=opts}catch(e){}if(this.scroll=="yes"){if(isTouchDevice()){this.body.css("-webkit-overflow-scrolling","touch").css("overflow:","scroll").css("position","relative")}try{this.frame.contents().find("body").css("overflow-x","hidden").css("overflow-y","auto")}catch(e){}}}},destroy:function(){if(this.frame){if(this.frame.length>0){try{this.frame[0].contentWindow.document.write("");this.frame[0].src=""}catch(e){}if($.browser.msie){CollectGarbage()}}this.frame.remove();delete this.frame}UCML.OpenShowWindow.superclass.destroy.call(this)},setSize:function(param){UCML.OpenShowWindow.superclass.setSize.call(this,param);if(this.frame){this.frame.width("auto");this.frame.height(this.body.height());this.frame.width(this.body.width())}}});UCML.Report=function(id){UCML.Report.superclass.constructor.call(this,id)};UCML.extend(UCML.Report,UCML.Applet,{ReportID:null,ReportObject:null,DataPacketXML:null,ShowPrintDialog:true,createReportObject:function(){var url=window.location.toString();var path=url.substring(0,url.lastIndexOf("/")+1);var rootPath=path+window.UCMLLocalResourcePath;var sHTML='<OBJECT id="UCMLREPORT" classid="clsid:77439687-CD41-4D51-A48B-2CE97239A2F9" codeBase="'+rootPath+'plugin/UCMLReport2.ocx#version=2012,12,25,1"></OBJECT>';this.ReportObject=this.el.append(sHTML).find("#UCMLREPORT").width("100%").height("100%").get(0);if(!this.ReportObject)alert("创建报表控件失败！");else{var opts=this;if(this.ReportObject.attachEvent){this.ReportObject.attachEvent("OnSaveReport",function(data){opts.saveReport(data)});this.ReportObject.attachEvent("OnAfterPrint",function(){opts.afterPrint()})}else{var handler=document.createElement("script");handler.setAttribute("for","UCMLREPORT");handler.event="OnSaveReport(data)";handler.appendChild(document.createTextNode(""+opts.id+".saveReport(data);"));document.body.appendChild(handler)}}},show:function(){if(!this.ReportObject)this.createReportObject();this.BusinessObject.ShowMessage("正在加载报表...");this.loadData();this.showReport()},showReport:function(){var url=window.location.toString();var path=url.substring(0,url.lastIndexOf("/")+1);var rootPath=path+window.UCMLLocalResourcePath;var rootTable=this.BusinessObject.getRootTable();this.ReportObject.GetReportRes(rootPath);var theMainDataPacket=this.createXMLObject();theMainDataPacket.loadXML(this.DataPacketXML);this.ReportObject.GetReportData(this.BusinessObject.BPOName,rootPath,this.DataPacketXML,this.dataTable.BCName);var BCList=this.BusinessObject.getBCList();for(var i=0;i<BCList.length;i++){this.ReportObject.SetBCData(theMainDataPacket,BCList[i].BCName)}this.ReportObject.SetBCIndex(rootTable.BCName,rootTable.getOID());this.setBCIndex(rootTable.getDetailTables());this.ReportObject.GetReportShape(rootPath+"OtherSource/UCMLReport2.aspx?ReportNo="+this.ReportID);this.BusinessObject.HideMessage();this.ReportObject.ShowReport()},loadData:function(){this.DataPacketXML=this.BusinessObject.getXMLData()},createXMLObject:function(){try{var xmlObject=new ActiveXObject("Msxml2.DOMDocument");return xmlObject}catch(e){try{xmlObject=new ActiveXObject("Msxml.DOMDocument");return xmlObject}catch(e){try{xmlObject=new ActiveXObject("Microsoft.XMLDOM");return xmlObject}catch(e){errorHandler(e,"createXMLObject")}}}},setBCIndex:function(detailTables){if(detailTables==null)return;for(var i=0;i<detailTables.length;i++){if(detailTables[i].getRecordCount()>0){this.ReportObject.SetBCIndex(detailTables[i].BCName,detailTables[i].getOID());this.setBCIndex(detailTables[i].getDetailTables())}}},setMainIndex:function(mainTables){if(mainTables==null)return;for(var i=0;i<mainTables.getRecordCount();i++){mainTables.setRecordIndex(i);this.ReportObject.SetBCIndex(mainTables.BCName,mainTables.getOID());this.setBCIndex(mainTables.getDetailTables())}},designReport:function(){this.show();this.ReportObject.DesignReport()},designReportNet:function(data){if(!this.ReportObject)this.createReportObject();this.BusinessObject.ShowMessage("正在加载报表...");this.ReportObject.DesignReportNet(data);this.BusinessObject.HideMessage()},saveReport:function(data){this.BusinessObject.invoke("","SaveReportDefine",false,{ReportNo:this.ReportID,ReportData:data},function(o,xml){if(this.onAfterPrint&&typeof this.onAfterPrint=="function"){this.onAfterPrint.call()}},function(o,text){if(this.onAfterPrint&&typeof this.onAfterPrint=="function"){this.onAfterPrint.call()}},this,true)},onSaveReport:null,afterPrint:function(){if(this.onAfterPrint&&typeof this.onAfterPrint=="function"){this.onAfterPrint.call()}},onAfterPrint:null,print:function(){this.ReportObject.ShowPrintDialog=this.ShowPrintDialog;this.ReportObject.Print()},exportPDF:function(fileName){this.ReportObject.ExportPDF(fileName);this.showReport()},exportHTML:function(fileName){this.ReportObject.ExportHTML(fileName);this.showReport()},exportJPEG:function(fileName){this.ReportObject.ExportJPG(fileName);this.showReport()},exportBMP:function(fileName){this.ReportObject.ExportBMP(fileName);this.showReport()},exportExcel:function(fileName){this.ReportObject.ExportExcel(fileName);this.showReport()},exportRTF:function(fileName){this.ReportObject.ExportRTF(fileName);this.showReport()},showToolbar:function(value){if(typeof value=="boolean")this.ReportObject.DisplayToolbar=value.toString()},hasToolbar:function(){return this.ReportObject.DisplayToolbar},reportHtmlWebService:function(ReportID,StartPos,Records,ReportParam){GetReportURL(ReportID,StartPos,Records,ReportParam,this.succeeded_ReportHtmlWebService,this.failed_ReportHtmlWebService,this)},succeeded_ReportHtmlWebService:function(result,text){if(!this.ReportHTMLFrame){this.ReportHTMLFrame=$("<iframe  scrolling=yes width=100% height=100% frameborder=0 id=UCMLBPO_View"+this.id+" ></IFRAME>");this.el.append(this.ReportHTMLFrame)}this.ReportHTMLFrame.attr("src",UCMLLocalResourcePath+text);var opts=this;this.ReportHTMLFrame.on("load",function(){if(opts.afterPrint){opts.afterPrint()}})},failed_ReportHtmlWebService:function(result,text){alert("报表显示错误："+text)},reportSrvWebService:function(ReportID,StartPos,Records,ReportParam){if(!this.ReportObject)this.createReportObject();GetSrvReportResult(ReportID,StartPos,Records,ReportParam,this.succeeded_ReportSrvWebService,this.failed_ReportHtmlWebService,this)},succeeded_ReportSrvWebService:function(result,text){this.ReportObject.SetPrepareData(text)}});UCML.UserInfo={};UCML.UserInfo.getUserOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.userOID=BusinessData.UCMLUserSystemInfo[0][0]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.userOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getPersonOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.personOID=BusinessData.UCMLUserSystemInfo[0][1]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.personOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getUserId=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.userId=BusinessData.UCMLUserSystemInfo[0][2]||""}return UCML.UserInfo.userId||""};UCML.UserInfo.getMasterPostOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.masterPostOID=BusinessData.UCMLUserSystemInfo[0][3]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.masterPostOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getPostPrimaryOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.postPrimaryOID=BusinessData.UCMLUserSystemInfo[0][4]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.postPrimaryOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getDivisionOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.divisionOID=BusinessData.UCMLUserSystemInfo[0][5]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.divisionOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getOrgOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.orgOID=BusinessData.UCMLUserSystemInfo[0][6]||"00000000-0000-0000-0000-000000000000"}return UCML.UserInfo.orgOID||"00000000-0000-0000-0000-000000000000"};UCML.UserInfo.getPostnName=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.postnName=BusinessData.UCMLUserSystemInfo[0][7]||""}return UCML.UserInfo.postnName||""};UCML.UserInfo.getPersonName=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.personName=BusinessData.UCMLUserSystemInfo[0][8]||""}return UCML.UserInfo.personName||""};UCML.UserInfo.getPersonName=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.personName=BusinessData.UCMLUserSystemInfo[0][8]||""}return UCML.UserInfo.personName||""};UCML.UserInfo.getLoginState=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.loginState=BusinessData.UCMLUserSystemInfo[0][9]}return UCML.UserInfo.loginState||""};UCML.UserInfo.getLoginTime=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.loginTime=BusinessData.UCMLUserSystemInfo[0][10]}return UCML.UserInfo.loginTime||""};UCML.UserInfo.getSSID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.SSID=BusinessData.UCMLUserSystemInfo[0][11]}return UCML.UserInfo.SSID||""};UCML.UserInfo.getOrgNO=function(){var config={methodName:"GetOrgNoOrDivisionNo",params:{infotype:1},async:false};UCML.UserInfo.orgNO=invoke(config);return UCML.UserInfo.orgNO||""};UCML.UserInfo.getDepartNO=function(){var config={methodName:"GetOrgNoOrDivisionNo",params:{infotype:0},async:false};UCML.UserInfo.departNO=invoke(config);return UCML.UserInfo.departNO||""};UCML.UserInfo.getPostnID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.postnID=BusinessData.UCMLUserSystemInfo[0][14]}return UCML.UserInfo.postnID||""};UCML.UserInfo.getSystemtime=function(){var config={methodName:"GetSystemDateTime",params:{},async:false};return invoke(config)};UCML.UserInfo.getOrgName=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.orgName=BusinessData.UCMLUserSystemInfo[0][12]}return UCML.UserInfo.orgName||""};UCML.UserInfo.getDivisionName=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.divisionName=BusinessData.UCMLUserSystemInfo[0][13]}return UCML.UserInfo.divisionName||""};UCML.UserInfo.getRESPOID=function(){if(BusinessData.UCMLUserSystemInfo!=null&&BusinessData.UCMLUserSystemInfo.length>0){UCML.UserInfo.respOID=BusinessData.UCMLUserSystemInfo[0][21]}return UCML.UserInfo.respOID||""};UCML.FuzzyQuerys=function(id){UCML.FuzzyQuerys.superclass.constructor.call(this,id)};UCML.extend(UCML.FuzzyQuerys,UCML.Applet,{onRender:function(){var $table=$('<table style="height:100%;width: 100%"><tr><td class="textInput"></td><td style="width:24px" align="center" valign="middle"  class="btnInput"></td></tr></table>');var $input=$('<input type="text" value="请输入查询关键字(多个空格隔开)">');var src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA5FBMVEUQk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk90Qk93///+4HOQ0AAAASnRSTlMADHnK9vvcmCpD6oQCQvrJVRkRO5z8lg6bA0z5dtDLVgr1IRzFRRe/UddG7S6Mr1ngHvdnLOtomiMNbvB/b+bdq/3GWIEGJysPgJnwjVQAAAABYktHREtpC4VQAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQY01WO1RLCUAxEF2iR4lKguLu7u3X//4MotzLDPiTZk0lmAcDl9kiy1+eHpYBCITkYEj4cYTQWTyRTKtM/n1GY1cQml2fMaG56NOu2wKJRSyzbzypV1gCJdRugwSYQYcsBbXaALnu21/ocAEOObDDmxEgynXFu+sXSnFbkegNsd3vyIDZHlTydZRHfJIuLRF5v94dD8Hy9P0bTSR1/0nV8AQxKGP7vP9VnAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE0LTA0LTEzVDE0OjAyOjQzKzAyOjAwJzY5rQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0wNC0xM1QxNDowMjo0MyswMjowMFZrgREAAAAASUVORK5CYII=";var $btn=$('<img src="'+src+'" border="0"  align="middle" />');this.el.css({"font-size":"16px"});$input.css({width:"99%",height:"20px",margin:"5px",border:"1px solid #b6b6b6","border-color":"#9a9a9a #cdcdcd #cdcdcd #9a9a9a",color:"rgb(146, 140, 140)"});$btn.css({width:"16px",height:"16px",margin:"0px","border-radius":"0px","letter-spacing":"5px"});$table.find(".textInput").append($input);$table.find(".btnInput").append($btn);this.el.append($table);this.input=$input;this.btn=$btn},setProperties:function(){UCML.FuzzyQuerys.superclass.setProperties.call(this)},getIndex:function(){return this.td[0].cellIndex},bindEvents:function(){UCML.FuzzyQuerys.superclass.bindEvents.call(this);var opts=this;this.input.focus(function(e){if(this.value=="请输入查询关键字(多个空格隔开)")this.value=""}).blur(function(e){if(this.value=="")this.value="请输入查询关键字(多个空格隔开)"});this.btn.click(function(e){var queryValue=opts.input.attr("value");queryValue=queryValue.replace(/\s+/g," ");if(opts.FieldList!=""){var SqlCondi="";if(queryValue!=""&&queryValue!="请输入查询关键字(多个空格隔开)"){var queryArr=queryValue.split(" ");var fieldList=opts.FieldList.split(";");var typeList=opts.TypeList.split(";");var tableList=opts.TableList.split(";");for(var i=0;i<fieldList.length;i++){SqlCondi+="(";for(var j=0;j<queryArr.length;j++){var fieldType=typeList[i];if(fieldType=="13"||fieldType=="14"||fieldType=="15"||fieldType=="4"||fieldType=="31"||fieldType=="12"||fieldType=="11"||fieldType=="10"){if(opts.checkNum(queryArr[j])){SqlCondi+=tableList[i]+"."+fieldList[i]+" = "+queryArr[j]}else{SqlCondi+=" 0 = 0 "}if(j<queryArr.length-1)SqlCondi+=" or "}else{SqlCondi+=tableList[i]+"."+fieldList[i]+" like '%"+queryArr[j]+"%'";if(j<queryArr.length-1)SqlCondi+=" or "}}SqlCondi+=")";if(i<fieldList.length-1)SqlCondi+=" or "}}else{SqlCondi=""}opts.BusinessObject.condiQuery("","","",SqlCondi)}else{alert("未指定查询字段")}})}});UCML.FuzzyQuerys.prototype.checkNum=function(str){var letter;if(str.indexOf(".")!=-1){if(str.charAt[0]=="."||str.charAt[str.length-1]==".")return false;var temp=str.replace(".","");if(temp.indexOf(".")!=-1)return false;letter="1234567890."}else{if(str.charAt[0]=="0")return false;letter="1234567890"}for(var i=0;i<str.length;i++){var c=str.charAt(i);if(letter.indexOf(c)==-1){return false}}return true};UCML.FuzzyQuerys.prototype.init=function(){UCML.FuzzyQuerys.superclass.init.call(this)};UCML.BDMap=function(id){this.id=id;this.map={};this.addEvents("aftergetposition");UCML.BDMap.superclass.constructor.call(this,id)};UCML.extend(UCML.BDMap,UCML.Applet,{mapkey:"",initLongitude:116.404,initLatitude:39.915,initLevel:11,isInitName:false,initName:"北京",isNavigation:true,isScale:true,isOverview:false,isMapType:false,isMarker:false,onRender:function(){UCML.BDMap.superclass.onRender.call(this)},setProperties:function(){UCML.BDMap.superclass.setProperties.call(this)},open:function(){UCML.BDMap.superclass.open.call(this)},init:function(){UCML.BDMap.superclass.init.call(this);this.map=new BMap.Map(this.id);var initPoint;if(this.isInitName){initPoint=this.initName}else{initPoint=new BMap.Point(this.initLongitude,this.initLatitude);if(this.isMarker){var marker=this.createMarker(initPoint);this.addOverlay(marker)}}this.map.centerAndZoom(initPoint,this.initLevel);if(this.isNavigation){this.map.addControl(new BMap.NavigationControl)}if(this.isScale){this.map.addControl(new BMap.ScaleControl)}if(this.isOverview){this.map.addControl(new BMap.OverviewMapControl)}if(this.isMapType){this.map.addControl(new BMap.MapTypeControl)}},bindEvents:function(){UCML.BDMap.superclass.bindEvents.call(this)}});UCML.BDMap.prototype.clean=function(){};UCML.BDMap.prototype.hide=function(){this.el.hide()};UCML.BDMap.prototype.show=function(){this.el.show()};UCML.BDMap.prototype.getMapContainer=function(){return this.map.getContainer()};UCML.BDMap.prototype.setCenter=function(point){if(typeof point==="object"){var p=new BMap.Point(point.longitude,point.latitude);this.map.setCenter(p)}else{this.map.setCenter(point)}};UCML.BDMap.prototype.panCenter=function(point,isMarker){this.map.panTo(point);if(isMarker){this.addOverlay(this.createMarker(point))}};UCML.BDMap.prototype.restore=function(){this.map.reset()};UCML.BDMap.prototype.setType=function(type){this.map.setMapType(type)};UCML.BDMap.prototype.zoomIn=function(){this.map.zoomIn()};UCML.BDMap.prototype.zoomOut=function(){this.map.zoomOut()};UCML.BDMap.prototype.setZoom=function(zoom){this.map.setZoom(zoom)};UCML.BDMap.prototype.getCurrentLocation=function(){};UCML.BDMap.prototype.showUserLocation=function(){};UCML.BDMap.prototype.setCurrentCity=function(cityName){this.map.setCurrentCity(cityName)};UCML.BDMap.prototype.setScrollWheelZoom=function(disable){if(disable==undefined||disable===true){this.map.enableScrollWheelZoom()}else{this.map.disableScrollWheelZoom()}};UCML.BDMap.prototype.setDragging=function(disable){if(disable==undefined||disable===true){this.map.enableDragging()}else{this.map.disableDragging()}};UCML.BDMap.prototype.setDoubleClickZoom=function(disable){if(disable==undefined||disable===true){this.map.enableDoubleClickZoom()}else{this.map.disableDoubleClickZoom()}};UCML.BDMap.prototype.setPinchToZoom=function(disable){if(disable==undefined||disable===true){this.map.enablePinchToZoom()}else{this.map.disablePinchToZoom()}};UCML.BDMap.prototype.setAutoResize=function(disable){if(disable==undefined||disable===true){this.map.enableAutoResize()}else{this.map.disableAutoResize()}};UCML.BDMap.prototype.setMinMaxZoom=function(min,max){if(min!=null){this.map.setMinZoom(min)}if(max!=null){this.map.setMaxZoom(max)}};UCML.BDMap.prototype.getCenter=function(){return this.map.getCenter()};UCML.BDMap.prototype.getDistance=function(startP,endP){return this.map.getDistance(startP,endP)};UCML.BDMap.prototype.getMapType=function(){return this.map.getMapType()};UCML.BDMap.prototype.getZoom=function(){return this.map.getZoom()};UCML.BDMap.prototype.addMapTypeControl=function(position){var option={anchor:BMAP_ANCHOR_TOP_LEFT};if(position=="top-left"){}else if(position=="top-right"){option.anchor=BMAP_ANCHOR_TOP_RIGHT}else if(position=="bottom-left"){option.anchor=BMAP_ANCHOR_BOTTOM_LEFT}else if(position=="bottom-right"){option.anchor=BMAP_ANCHOR_BOTTOM_RIGHT}this.map.addControl(new BMap.MapTypeControl(option))};UCML.BDMap.prototype.removeMapTypeControl=function(){this.map.removeControl(new BMap.MapTypeControl)};UCML.BDMap.prototype.addScaleControl=function(position){var option={anchor:BMAP_ANCHOR_TOP_LEFT};if(position=="top-left"){}else if(position=="top-right"){option.anchor=BMAP_ANCHOR_TOP_RIGHT}else if(position=="bottom-left"){option.anchor=BMAP_ANCHOR_BOTTOM_LEFT}else if(position=="bottom-right"){option.anchor=BMAP_ANCHOR_BOTTOM_RIGHT}this.map.addControl(new BMap.ScaleControl(option))};UCML.BDMap.prototype.removeScaleControl=function(){this.map.removeControl(new BMap.ScaleControl)};UCML.BDMap.prototype.addNavigationControl=function(position,type){var option={anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_LARGE};if(position=="top-left"){}else if(position=="top-right"){option.anchor=BMAP_ANCHOR_TOP_RIGHT}else if(position=="bottom-left"){
option.anchor=BMAP_ANCHOR_BOTTOM_LEFT}else if(position=="bottom-right"){option.anchor=BMAP_ANCHOR_BOTTOM_RIGHT}if(type=="normal"){}else if(type=="small"){option.type=BMAP_NAVIGATION_CONTROL_SMALL}else if(type=="pan"){option.type=BMAP_NAVIGATION_CONTROL_PAN}else if(type=="zoom"){option.type=BMAP_NAVIGATION_CONTROL_ZOOM}this.map.addControl(new BMap.NavigationControl(option))};UCML.BDMap.prototype.removeNavigationControl=function(){this.map.removeControl(new BMap.NavigationControl)};UCML.BDMap.prototype.addOverviewControl=function(position){var option={anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_LARGE};if(position=="top-left"){}else if(position=="top-right"){option.anchor=BMAP_ANCHOR_TOP_RIGHT}else if(position=="bottom-left"){option.anchor=BMAP_ANCHOR_BOTTOM_LEFT}else if(position=="bottom-right"){option.anchor=BMAP_ANCHOR_BOTTOM_RIGHT}this.map.addControl(new BMap.OverviewMapControl(option))};UCML.BDMap.prototype.removeOverviewControl=function(){this.map.removeControl(new BMap.OverviewMapControl)};UCML.BDMap.prototype.addCustomControl=function(){function ZoomControl(){this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new BMap.Size(10,10)}ZoomControl.prototype=new BMap.Control;ZoomControl.prototype.initialize=function(map){var div=document.createElement("div");div.appendChild(document.createTextNode("放大2级"));div.style.cursor="pointer";div.style.border="1px solid gray";div.style.backgroundColor="white";div.onclick=function(e){map.setZoom(map.getZoom()+2)};map.getContainer().appendChild(div);return div};var myZoomCtl=new ZoomControl;this.map.addControl(myZoomCtl)};UCML.BDMap.prototype.addPanoramaControl=function(offset){var stCtl=new BMap.PanoramaControl;stCtl.setOffset(new BMap.Size(offset.top,offset.left));this.map.addControl(stCtl)};UCML.BDMap.prototype.createPoint=function(longitude,latitude){return new BMap.Point(longitude,latitude)};UCML.BDMap.prototype.createMarker=function(point){return new BMap.Marker(point)};UCML.BDMap.prototype.markerDragging=function(marker,dragging){if(dragging){marker.enableDragging()}else{marker.disableDragging()}};UCML.BDMap.prototype.createPolyline=function(ptArr,config){return new BMap.Polyline(ptArr,config)};UCML.BDMap.prototype.createCircle=function(point,radius,config){return new BMap.Circle(point,radius,config)};UCML.BDMap.prototype.createPolygon=function(ptArr,config){return new BMap.Polygon(ptArr,config)};UCML.BDMap.prototype.createLabel=function(point,text,config,css){var opts={position:point,offset:new BMap.Size(config.top,config.left)};var label=new BMap.Label(text,opts);label.setStyle(css);return label};UCML.BDMap.prototype.createCurveLine=function(ptArr,config){return new BMapLib.CurveLine(ptArr,config)};UCML.BDMap.prototype.createInfoWindow=function(text,config){return new BMap.InfoWindow(text,config)};UCML.BDMap.prototype.openInfoWindow=function(infoWindow,point){this.map.openInfoWindow(infoWindow,point)};UCML.BDMap.prototype.getInfoWindowContent=function(infoWindow){return infoWindow.getContent()};UCML.BDMap.prototype.ployEditing=function(ploy,edited){if(edited){ploy.enableEditing()}else{ploy.disableEditing()}};UCML.BDMap.prototype.addOverlay=function(overlay){this.map.addOverlay(overlay)};UCML.BDMap.prototype.removeOverlay=function(){this.map.clearOverlays()};UCML.BDMap.prototype.setOverlayVisible=function(overlay,visible){if(visible){overlay.show()}else{overlay.hide()}};UCML.BDMap.prototype.setMarkerAndAction=function(point,action,config){var marker;if(action==1){marker=new BMap.Marker(point);marker.setAnimation(MAP_ANIMATION_BOUNCE)}else if(action==2){var myIcon=new BMap.Icon(config.url,new BMap.Size(config.top,config.left));marker=new BMap.Marker(point,{icon:myIcon})}else if(action==3){marker=new BMap.Marker(point);marker.setLabel(config)}this.map.addOverlay(marker)};UCML.BDMap.prototype.getPositionByBrowse=function(){var geolocation=new BMap.Geolocation;var opts=this;geolocation.getCurrentPosition(function(r){if(this.getStatus()==BMAP_STATUS_SUCCESS){var result={status:0,point:r.point};opts.fireEvent("aftergetposition",result,r)}else{var result={status:1};opts.fireEvent("aftergetposition",result,r)}},{enableHighAccuracy:true})};UCML.BDMap.prototype.searchByKeys=function(keys){var local=new BMap.LocalSearch(this.map,{renderOptions:{map:this.map}});local.search(keys)};UCML.ListGroup=function(id){this.type="singlecol";this.titleField;this.descField;this.extraTitleFields;this.iconField;this.srcDataTable;this.totalField;this.dividerField;this.listviewEl;this.hasScroll=false;this.scrollEl;this.UCMLIScroll;this.hasMore=false;this.hasSearch=false;this.searchObj;this.hasSelectedList=false;this.selectedListEl;this.hasChecked=false;this.checkOID=[];this.addEvents("listclick","imgclick","deleteitemclick");UCML.ListGroup.superclass.constructor.call(this,id)};UCML.extend(UCML.ListGroup,UCML.Commponent,{ctype:"UCML.ListGroup",hasNumber:false,inset:true,hasLinked:true,hasFilter:false,filter_placeholder:"",hasCount:false,alignRight:false,setProperties:function(){UCML.ListGroup.superclass.setProperties.call(this);this.type=this.getAttribute("type")||this.type;this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName")||this.getAttribute("BCName")||this.srcBCName)||undefined;this.titleField=this.getAttribute("titleField")||this.getAttribute("dataFld")||this.titleField;this.totalField=this.getAttribute("totalField")||this.totalField;this.extraTitleFields=this.getAttribute("extralTitleFields")||this.extraTitleFields;this.iconField=this.getAttribute("iconField")||this.iconField;this.descField=this.getAttribute("descField")||this.descField;this.dividerField=this.getAttribute("dividerField")||this.dividerField;this.hasLinked=UCML.isEmpty(this.getAttribute("hasLinked"))||this.getAttribute("hasLinked")=="false"?false:this.hasLinked;this.hasNumber=this.getAttribute("hasNumber")=="true"?true:this.hasNumber;this.inset=UCML.isEmpty(this.getAttribute("inset"))||this.getAttribute("inset")=="false"?false:this.inset;this.hasCount=this.getAttribute("hasCount")=="true"?true:this.hasCount;this.alignRight=this.getAttribute("alignRight")=="true"?true:this.alignRight;this.listviewEl=this.hasNumber&&this.hasNumber!="false"?$('<ol data-role="listview"'+(this.inset?' data-inset="true"':' data-inset="false"')+">"):$('<ul data-role="listview"'+(this.inset?' data-inset="true"':'  data-inset="false"')+">");this.hasScroll=this.getAttribute("hasScroll")=="true"?true:this.hasScroll;this.scrollEl=$('<div class="scroller"><div id="'+this.id+'_pullDown" class="pullDown"><span class="pullDownIcon"></span><span class="pullDownLabel">准备刷新...</span></div><div id="'+this.id+'_pullUp" class="pullUp"><span class="pullUpIcon"></span><span class="pullUpLabel">上拉加载更多...</span></div></div>');this.UCMLIScroll=new UCML.IScroll({pEl:this.el,ctl:this});this.hasSearch=this.getAttribute("hasSearch")=="true"?true:this.hasSearch;if(this.hasSearch){this.searchObj=new UCML.MSearch({srcDataTable:this.srcDataTable,searchField:this.titleField})}this.hasSelectedList=this.getAttribute("hasSelectedList")=="true"?true:this.hasSelectedList;this.selectedListEl=$('<div id="selectedList" class="man-list fman-list"></div>');this.hasMore=this.getAttribute("hasMore")=="true"?true:this.hasMore;this.clickLoadMore=$('<div class="click-load-more"><a href="javascript:void(0);">+点击加载更多</a></div>');this.hasChecked=this.getAttribute("hasChecked")=="true"?true:this.hasChecked}});UCML.ListGroup.prototype.init=function(){UCML.ListGroup.superclass.init.call(this);if(this.hasSearch){this.el.before(this.searchObj.el)}if(this.hasSelectedList&&this.type=="checkgroup"){this.el.before(this.selectedListEl)}if(this.hasMore){this.el.after(this.clickLoadMore)}this.setScrollTop()};UCML.ListGroup.prototype.setScrollTop=function(){var prevs=this.el.prevAll();if(prevs.length>0){var height=0;prevs.each(function(index,context){var height1=$(this).outerHeight(true);var height2=$(this).children().outerHeight(true);height+=height1>height2?height1:height2});this.el.css({top:height+"px"})}};UCML.ListGroup.prototype.onRender=function(){UCML.ListGroup.superclass.onRender.call(this);if(this.hasScroll){this.el.addClass("wrapper")}};UCML.ListGroup.prototype.clearData=function(){if(!this.reserveData){this.srcDataTable.ClearData()}};UCML.ListGroup.prototype.delItem=function(oid){var item=this.el.find("li[lid='"+oid+"']");if(item.length>0)item.remove()};UCML.ListGroup.prototype.bindEvents=function(){UCML.ListGroup.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.titleField)){this.srcDataTable.isLoadHistoryData=true;this.srcDataTable.on("onLoad",this.dataBind,this);this.srcDataTable.on("beforeGetData",this.clearData,this);this.srcDataTable.on("OnAfterDelete",this.delItem,this)}else{this.bindCustomData()}var opts=this;this.listviewEl.on("click",function(e){var itemEl=null;var thisEl=$(e.target);if(e.target.nodeName.toLowerCase()=="li"){itemEl=$(e.target)}else{itemEl=$(e.target).parents("li[lid]")}if(itemEl){var lid=itemEl.attr("lid");if(UCML.isEmpty(lid)){if(thisEl.attr("data-role")=="list-divider"){$("html,body").animate({scrollTop:thisEl.offset().top},1e3)}return}if(opts.srcDataTable)opts.srcDataTable.LocateOID(lid);if(e.target.nodeName.toLowerCase()=="img")opts.fireEvent("imgclick",itemEl);else if(thisEl.hasClass("bclink-action")){var fn=thisEl.attr("urlFn");if(!UCML.isEmpty(fn)){eval(fn)()}}else if(thisEl.hasClass("image-check")){if(thisEl.attr("checked")=="checked"){opts.checkOID.add(lid)}else{opts.checkOID.remove(lid)}}else opts.fireEvent("listclick",itemEl);var chk=itemEl.find("input[type]").not($(".image-check"));if(chk.length>0){if(e.target.nodeName.toLowerCase()=="input"){if(thisEl.attr("type")=="checkbox"){if(chk.attr("checked")){var str='<a class="selectedItem man-item" sid="'+lid+'"><span>'+itemEl.text()+"</span></a>";opts.selectedListEl.append(str);opts.checkOID.remove(lid);opts.checkOID.add(lid);chk.parent().addClass("ui-checkbox-checked");opts.setScrollTop()}else{var selectedItem=opts.selectedListEl.find('a[sid="'+lid+'"]');if(selectedItem.length>0){selectedItem.remove()}var deleteItem=opts.selectedListEl.find('div[indexid="'+lid+'"]');if(deleteItem.length>0){deleteItem.remove()}opts.checkOID.remove(lid);chk.parent().removeClass("ui-checkbox-checked");opts.setScrollTop()}}else if(thisEl.attr("type")=="radio"){opts.listviewEl.find("div.ui-radio").removeClass("ui-radio-checked");chk.parent().addClass("ui-radio-checked")}e.stopPropagation()}else if(chk.attr("type")=="checkbox"){if(chk.attr("checked")=="checked"){chk.removeAttr("checked");var selectedItem=opts.selectedListEl.find('a[sid="'+lid+'"]');if(selectedItem.length>0){selectedItem.remove()}var deleteItem=opts.selectedListEl.find('div[indexid="'+lid+'"]');if(deleteItem.length>0){deleteItem.remove()}opts.checkOID.remove(lid);chk.parent().removeClass("ui-checkbox-checked");opts.setScrollTop()}else{chk.attr("checked","checked");var str='<a class="selectedItem man-item" sid="'+lid+'"><span>'+itemEl.text()+"</span></a>";opts.selectedListEl.append(str);opts.checkOID.remove(lid);opts.checkOID.add(lid);chk.parent().addClass("ui-checkbox-checked");opts.setScrollTop()}}else if(chk.attr("type")=="radio"){if(chk.attr("checked")=="checked"){}else{chk.attr("checked","checked")}opts.listviewEl.find("div.ui-radio").removeClass("ui-radio-checked");chk.parent().addClass("ui-radio-checked")}}}});this.selectedListEl.on("click","a",function(e){var lid=$(this).attr("sid");var checkedItem=opts.el.find("li[lid='"+lid+"']").find("input[type]");if(checkedItem.length>0){checkedItem.removeAttr("checked")}$(this).remove();opts.checkOID.remove(lid);checkedItem.parent().removeClass("ui-checkbox-checked");opts.setScrollTop()});this.clickLoadMore.on("click",function(e){opts.reserveData=true;opts.srcDataTable.LoadMoreData();opts.reserveData=false})};UCML.ListGroup.prototype.getListGroup=function(){var recordCount=this.srcDataTable.getRecordCount();var arr_group=[];for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var groupvalue=this.srcDataTable.getFieldValue(this.dividerField);if(arr_group.indexOf(groupvalue)==-1){arr_group.add(groupvalue)}}return arr_group};UCML.ListGroup.prototype.getDividerText=function(value){var col=this.srcDataTable.getColumn(this.dividerField);if(col.isCodeTable){return GetCodeCaption(col.codeTable,value)}else{return value}};UCML.ListGroup.prototype.getListStrGroup=function(data){var recordCount=this.srcDataTable.getRecordCount();var listviewStr="";var groupList=this.getListGroup();for(var g=0;g<groupList.length;g++){listviewStr+='<li data-role="list-divider">'+this.getDividerText(groupList[g])+"</li>";listviewStr+=this.getListStr(groupList[g])}return listviewStr};UCML.ListGroup.prototype.getListStr=function(filter){var recordCount=this.srcDataTable.getRecordCount();var listviewStr="";if(this.type=="singlecol"){for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();if(this.hasLinked){listviewStr+='<li lid="'+oid+'"><a href="javascript:;">';if(this.getCustomTitle){listviewStr+=this.getCustomTitle()}else{listviewStr+=this.srcDataTable.getFieldValue(this.titleField)}listviewStr+=(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</a></li>"}else{listviewStr+='<li lid="'+oid+'">';if(this.getCustomTitle){listviewStr+=this.getCustomTitle()}else{listviewStr+=this.srcDataTable.getFieldValue(this.titleField)}listviewStr+=(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</li>"}}}else if(this.type=="multicol"){var colnum=1,extraField=[];if(!UCML.isEmpty(this.extraTitleFields)){extraField=this.extraTitleFields.split(";");colnum=colnum+extraField.length}for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();if(this.hasLinked){listviewStr+='<li lid="'+oid+'"><a href="javascript:;">'+this.srcDataTable.getFieldValue(this.titleField)+(colnum==1?"":colnum==2?'<span class="ui-text-right">'+this.srcDataTable.getFieldValue(extraField[0])+"</span>":'<span class="ui-text-center">'+this.srcDataTable.getFieldValue(extraField[0])+'</span><span class="ui-text-right">'+this.srcDataTable.getFieldValue(extraField[1])+"</span>")+(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</a></li>"}else{listviewStr+='<li lid="'+oid+'">'+this.srcDataTable.getFieldValue(this.titleField)+(colnum==1?"":colnum==2?'<span class="ui-text-right">'+this.srcDataTable.getFieldValue(extraField[0])+"</span>":'<span class="ui-text-center">'+this.srcDataTable.getFieldValue(extraField[0])+'</span><span class="ui-text-right">'+this.srcDataTable.getFieldValue(extraField[1])+"</span>")+(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</li>"}}}else if(this.type=="imageIcon"){for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();var imgsrc=this.srcDataTable.getFieldValue(this.iconField);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();if(this.hasLinked){listviewStr+='<li lid="'+oid+'"><a href="javascript:;">'+(!UCML.isEmpty(this.iconField)?'<img class="ui-li-icon" src="'+this.formatUrl(imgsrc)+'">':"")+this.srcDataTable.getFieldValue(this.titleField)+(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</a></li>"}else{listviewStr+='<li lid="'+oid+'">'+(!UCML.isEmpty(this.iconField)?'<img class="ui-li-icon" src="'+this.formatUrl(imgsrc)+'">':"")+this.srcDataTable.getFieldValue(this.titleField)+(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</li>"}}}else if(this.type=="checkgroup"){var name=this.id+"_checkbox";for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();var defaultCheck="";if(this.hasSelectedList&&this.selectedListEl.find('div[sid="'+oid+'"]').length>0){defaultCheck="checked"}if(this.hasLinked){listviewStr+='<li class="checkgroup" lid="'+oid+'">';listviewStr+='<div class="ui-checkbox '+(defaultCheck=="checked"?"ui-checkbox-checked":"")+'"><input type="checkbox" '+defaultCheck+' id="checkitem'+i+'" data-role="none" name="'+name+'"></div>';listviewStr+="<a>"+this.srcDataTable.getFieldValue(this.titleField)+"</a></li>"}else{listviewStr+='<li class="checkgroup" lid="'+oid+'">';listviewStr+='<div class="ui-checkbox '+(defaultCheck=="checked"?"ui-checkbox-checked":"")+'"><input type="checkbox" '+defaultCheck+' id="checkitem'+i+'" data-role="none" name="'+name+'"></div>';listviewStr+=this.srcDataTable.getFieldValue(this.titleField)+"</li>"}}}else if(this.type=="radiogroup"){var name=this.id+"_radiobox";for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();if(this.hasLinked){listviewStr+='<li class="radiogroup" lid="'+oid+'">';listviewStr+='<div class="ui-radio"><input type="radio" id="radioitem'+i+'" data-role="none" name="'+name+'"></div>';listviewStr+="<a>";listviewStr+=this.srcDataTable.getFieldValue(this.titleField)+"</a></li>"}else{listviewStr+='<li class="radiogroup" lid="'+oid+'">';listviewStr+='<div class="ui-radio"><input type="radio" id="radioitem'+i+'" data-role="none" name="'+name+'"></div>';listviewStr+=this.srcDataTable.getFieldValue(this.titleField)+"</li>"}}}else if(this.type=="imageDesc"){var name=this.id+"_checkbox";for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(!UCML.isEmpty(filter)&&this.srcDataTable.getFieldValue(this.dividerField)!=filter){continue}var oid=this.srcDataTable.getOID();var imgsrc=this.srcDataTable.getFieldValue(this.iconField);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();if(this.hasLinked){listviewStr+='<li lid="'+oid+'"><a href="javascript:;">'+(!UCML.isEmpty(this.iconField)?'<img src="'+this.formatUrl(imgsrc)+'">':"");if(this.getListTitle)listviewStr+="<h3>"+this.getListTitle()+"</h3>";else listviewStr+=!UCML.isEmpty(this.titleField)?"<h3>"+this.srcDataTable.getFieldValue(this.titleField)+"</h3>":"";if(this.getListContent)listviewStr+="<p>"+this.getListContent()+"</p>";else listviewStr+=!UCML.isEmpty(this.descField)?"<p>"+this.srcDataTable.getFieldValue(this.descField)+"</p>":"";listviewStr+=(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"</a></li>"}else{listviewStr+='<li lid="'+oid+'">'+(!UCML.isEmpty(this.iconField)?'<img src="'+this.formatUrl(imgsrc)+'">':"");if(this.getListTitle)listviewStr+="<h3>"+this.getListTitle()+"</h3>";else listviewStr+=!UCML.isEmpty(this.titleField)?"<h3>"+this.srcDataTable.getFieldValue(this.titleField)+"</h3>":"";if(this.getListContent)listviewStr+="<p>"+this.getListContent()+"</p>";else listviewStr+=!UCML.isEmpty(this.descField)?"<p>"+this.srcDataTable.getFieldValue(this.descField)+"</p>":"";listviewStr+=(this.hasCount&&!UCML.isEmpty(this.totalField)?'<span class="ui-li-count">'+this.srcDataTable.getFieldValue(this.totalField)+"</span>":"")+"<span>"+this.renderBCLink()+"</span>"+"</li>"}}}return listviewStr};UCML.ListGroup.prototype.hideBCLink=function(index){if(index){$("a.bclink-action[linkIndex="+index+"]").hide()}else{$("a.bclink-action").hide()}};UCML.ListGroup.prototype.showBCLink=function(index){if(index){$("a.bclink-action[linkIndex="+index+"]").show()}else{$("a.bclink-action").show()}};UCML.ListGroup.prototype.renderBCLink=function(){var col=this.srcDataTable.getColumn(this.titleField);var linkStr="";if(col.objBCLinkColl){for(var i=col.objBCLinkColl.length;i>0;i--){var objBCLink=col.objBCLinkColl[i-1];if(objBCLink.BCRunMode==5){linkStr+='<a class="ui-btn ui-btn-inline ui-mini bclink-action" linkIndex="'+(i-1)+'" urlFn="'+objBCLink.urlFuncName+'">'+objBCLink.caption+"</a>"}}}if(this.hasChecked){linkStr+='<input class="image-check" type="checkbox" data-role="none" style="float:right;width:15px;height:15px;margin-top:-30px;" />'}return linkStr};UCML.ListGroup.prototype.dataBind=function(data){var listviewStr="";if(!UCML.isEmpty(this.dividerField)){listviewStr=this.getListStrGroup()}else{listviewStr=this.getListStr()}this.listviewEl.html("").append(listviewStr);if(this.hasScroll){this.scrollEl.find(".pullUp").before(this.listviewEl);this.el.append(this.scrollEl).trigger("create");if(this.hasSearch&&this.UCMLIScroll.myScroll){this.UCMLIScroll.myScroll.refresh()}}else{this.el.append(this.listviewEl).trigger("create")}this.listviewEl.listview("refresh");if(this.hasScroll&&!this.UCMLIScroll.myScroll){this.UCMLIScroll.loaded()}};UCML.ListGroup.prototype.getCheckOID=function(){return this.checkOID};UCML.ListGroup.prototype.formatUrl=function(url){if(url.indexOf("http://")>-1||url.indexOf("https://")>-1){return url}else{url=UCMLLocalResourcePath+url;return url}};UCML.ListGroup.prototype.getSysImgSrc=function(){var imgURL="File/Images/"+this.srcDataTable.TableName+"_"+this.iconField+"/"+UCML.UserInfo.getUserOID()+"/"+this.srcDataTable.getOID()+this.srcDataTable.getFieldValue(this.iconField);return imgURL};UCML.ListGroup.prototype.bindCustomData=function(){var str='<ul data-role="listview">'+"<li><a>没有绑定数据源!</a></li>"+"</ul>";this.el.append(str).trigger("create")};UCML.reg("UCML.ListGroup",UCML.ListGroup);UCML.IScroll=function(config){this.myScroll=null;this.pullDownEl;this.pullDownOffset;this.pullUpEl;this.pullUpOffset;this.generatedCount=0;this.pEl=config.pEl;this.ctl=config.ctl||undefined;this.pullDownActionCallback=config.pullDownAction||undefined;this.pullUpActionCallback=config.pullUpAction||undefined};UCML.IScroll.prototype.loaded=function(){this.pullDownEl=document.getElementById(this.pEl.attr("id")+"_pullDown");if(this.pullDownEl)this.pullDownOffset=this.pullDownEl.offsetHeight;this.pullUpEl=document.getElementById(this.pEl.attr("id")+"_pullUp");if(this.pullUpEl)this.pullUpOffset=this.pullUpEl.offsetHeight;var opts=this;this.myScroll=new iScroll(this.pEl[0],{scrollbarClass:"myScrollbar",useTransition:false,topOffset:51,onRefresh:function(){if($(opts.pullDownEl).hasClass("loading")){$(opts.pullDownEl).removeClass("loading");opts.pullDownEl.querySelector(".pullDownLabel").innerHTML="下拉刷新..."}else if($(opts.pullUpEl).hasClass("loading")){$(opts.pullUpEl).removeClass("loading");opts.pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉加载更多..."}},onScrollMove:function(){if(this.y>5&&!$(opts.pullDownEl).hasClass("flip")){$(opts.pullDownEl).addClass("flip");opts.pullDownEl.querySelector(".pullDownLabel").innerHTML="松手开始更新...";this.minScrollY=0}else if(this.y<5&&$(opts.pullDownEl).hasClass("flip")){$(opts.pullDownEl).removeClass("flip");opts.pullDownEl.querySelector(".pullDownLabel").innerHTML="下拉刷新...";this.minScrollY=-opts.pullDownOffset}else if(this.y<this.maxScrollY-5&&!$(opts.pullUpEl).hasClass("flip")){$(opts.pullUpEl).addClass("flip");opts.pullUpEl.querySelector(".pullUpLabel").innerHTML="松手开始更新...";this.maxScrollY=this.maxScrollY}else if(this.y>this.maxScrollY+5&&$(opts.pullUpEl).hasClass("flip")){$(opts.pullUpEl).removeClass("flip");opts.pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉加载更多...";this.maxScrollY=opts.pullUpOffset}},onScrollEnd:function(){if($(opts.pullDownEl).hasClass("flip")){$(opts.pullDownEl).removeClass("flip");$(opts.pullDownEl).addClass("loading");opts.pullDownEl.querySelector(".pullDownLabel").innerHTML="加载中...";opts.pullDownAction()}else if($(opts.pullUpEl).hasClass("flip")){$(opts.pullUpEl).removeClass("flip");$(opts.pullUpEl).addClass("loading");opts.pullUpEl.querySelector(".pullUpLabel").innerHTML="加载中...";opts.pullUpAction()}}})};UCML.IScroll.prototype.pullDownAction=function(){var opts=this;setTimeout(function(){if(opts.pullDownActionCallback){opts.pullDownActionCallback.call(opts)}opts.myScroll.refresh()},100)};UCML.IScroll.prototype.pullUpAction=function(){var opts=this;setTimeout(function(){if(opts.pullUpActionCallback){opts.pullUpActionCallback.call(opts)}else if(opts.ctl&&opts.ctl.srcDataTable){opts.ctl.reserveData=true;opts.ctl.srcDataTable.LoadMoreData();opts.ctl.reserveData=false}opts.myScroll.refresh()},100)};UCML.FoldList=function(id){this.parentBC;this.parentTitleField;this.childBC;this.childTitleField;this.foreignKeyField;this.addEvents("childlistclick");UCML.FoldList.superclass.constructor.call(this,id)};UCML.extend(UCML.FoldList,UCML.Commponent,{ctype:"UCML.FoldList",mini:"false",inset:"true",iconpos:"left",theme:"a",content_theme:"a",collapsed:"false",collapsed_icon:"",expanded_icon:"",setProperties:function(){UCML.FoldList.superclass.setProperties.call(this);this.parentBC=BusinessObject.getDataTableByBCName(this.getAttribute("parentBC"))||undefined;this.parentTitleField=this.getAttribute("parentTitleField")||this.parentTitleField;this.childBC=BusinessObject.getDataTableByBCName(this.getAttribute("childBC"))||undefined;this.childTitleField=this.getAttribute("childTitleField")||this.childTitleField;this.foreignKeyField=this.getAttribute("foreignKeyField")||this.foreignKeyField;this.theme=this.getAttribute("theme")||this.theme;this.content_theme=this.getAttribute("content_theme")||this.content_theme}});UCML.FoldList.prototype.init=function(){UCML.FoldList.superclass.init.call(this);if(!UCML.isEmpty(this.parentBC)&&!UCML.isEmpty(this.parentTitleField)){this.parentBC.on("onLoad",this.dataBind,this)}else{this.bindCustomData()}};UCML.FoldList.prototype.bindEvents=function(){UCML.FoldList.superclass.bindEvents.call(this);var opts=this;$(document).on("collapsibleexpand","div.ucml-"+this.id+"-foldlist",function(){if($(this).attr("loaded")){return}var oid=$(this).attr("oid");opts.parentBC.LocateOID(oid);if(!opts.parentBC.isChildData()){var cur=opts.parentBC.getCurrentRecord();opts.parentBC.BusinessObject.loadChildDataEx(opts.parentBC.BCName,opts.parentBC.getOID(),opts.parentBC.turnArrayDataToXml(cur),opts.parentBC.subBC_SQLCondi,opts.parentBC.LoadChildResults,opts.parentBC.OnFailureCall,opts.parentBC)}var childRecordCount=opts.childBC.getRecordCount();var listviewStr='<ul data-role="listview">';for(var i=0;i<childRecordCount;i++){opts.childBC.SetIndexNoEvent(i);var oid=opts.childBC.getOID();var title=opts.childBC.getFieldValue(opts.childTitleField);listviewStr+='<li class="'+opts.id+'-foldlist-li" lid="'+oid+'"><a href="#">'+title+"</a></li>"}listviewStr+="</ul>";$(this).attr("loaded","true");$(this).find(".ui-collapsible-content").append(listviewStr).trigger("create")});$(document).on("click","li."+this.id+"-foldlist-li",function(e){var lid=$(this).attr("lid");opts.childBC.LocateOID(lid);opts.fireEvent("childlistclick",$(this));e.stopPropagation();e.preventDefault()})};UCML.FoldList.prototype.dataBind=function(data){var recordCount=this.parentBC.getRecordCount();var collapsibleStr="";for(var i=0;i<recordCount;i++){this.parentBC.SetIndexNoEvent(i);var oid=this.parentBC.getOID();var title=this.parentBC.getFieldValue(this.parentTitleField);collapsibleStr+='<div data-role="collapsible" class="ucml-'+this.id+'-foldlist" data-theme="'+this.theme+'" data-content-theme="'+this.content_theme+'" oid="'+oid+'"><h3>'+title+"</h3></div>"}this.el.append(collapsibleStr);this.el.trigger("create")};UCML.FoldList.prototype.bindCustomData=function(){var str='<div data-role="collapsible"><h3>aaa</h3><ul data-role="listview"><li><a>abc</a></li><li><a>abc</a></li></ul></div>'+'<div data-role="collapsible"><h3>bbb</h3><ul data-role="listview"><li><a>abc</a></li><li><a>abc</a></li></ul></div>'+'<div data-role="collapsible"><h3>ccc</h3><ul data-role="listview"><li><a>abc</a></li><li><a>abc</a></li></ul></div>';this.el.append(str);this.el.trigger("create")};UCML.reg("UCML.FoldList",UCML.FoldList);UCML.MSearch=function(id){UCML.MSearch.superclass.constructor.call(this,id)};UCML.extend(UCML.MSearch,UCML.Input,{ctype:"UCML.MSearch",placeholder:"请输入关键字...",onRender:function(){UCML.MSearch.superclass.onRender.call(this);this.el.addClass("search-nav");this.el.append(this.inputEl);this.el.append(this.queryEl)},setProperties:function(){UCML.MSearch.superclass.setProperties.call(this);this.placeholder=this.getAttribute("placeholder")||this.placeholder;this.searchEl=$('<input id="searchInput" placeholder="'+this.placeholder+'" data-type="search" class="ui-input-text ui-body-c" />');this.inputEl=$('<input type="text" class="search-input" placeholder="'+this.placeholder+'"/>');this.queryEl=$('<a href="javascript:void(0);" class="search-submit"></a>');this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("srcBCName"))||BusinessObject.getDataTableByBCName(this.getAttribute("BCName"))||this.srcDataTable;this.searchField=this.getAttribute("searchField")||this.searchField;this.tableList=this.getAttribute("tablelist")||"";this.fieldList=this.getAttribute("fieldlist")||"";this.typeList=this.getAttribute("typelist")||""},bindEvents:function(){UCML.MSearch.superclass.bindEvents.call(this);var opts=this;this.inputEl.on("keydown",function(e){if(e.keyCode==13){opts.exeQuery();return false}});this.queryEl.on("click",function(e){opts.exeQuery()})}});UCML.MSearch.prototype.exeQuery=function(){var opts=this;var inputText=opts.inputEl.val();if(UCML.isEmpty(inputText)){opts.srcDataTable.isLoadHistoryData=false;opts.srcDataTable.theSQLCondi="";opts.srcDataTable.getData();return}if(opts.srcDataTable&&!UCML.isEmpty(opts.searchField)){var sqlcondi="";var fieldList=opts.searchField.split(";");for(var i=0;i<fieldList.length;i++){sqlcondi+="(";var fieldType=opts.srcDataTable.getFieldType(fieldList[i]);if(fieldType=="Float"||fieldType=="Double"||fieldType=="Money"||fieldType=="Numeric"||fieldType=="Long"||fieldType=="Byte"||fieldType=="Short"||fieldType=="Int"){if(opts.checkNum(inputText)){sqlcondi+=opts.srcDataTable.TableName+"."+fieldList[i]+" = "+inputText}else{sqlcondi+=" 0=1 "}}else{sqlcondi+=opts.srcDataTable.TableName+"."+fieldList[i]+" like '%"+inputText+"%'"}sqlcondi+=")";if(i<fieldList.length-1)sqlcondi+=" or "}opts.srcDataTable.isLoadHistoryData=false;opts.srcDataTable.theSQLCondi=sqlcondi;opts.srcDataTable.getData()}else if(!UCML.isEmpty(opts.tableList)&&!UCML.isEmpty(opts.fieldList)&&!UCML.isEmpty(opts.typeList)){var sqlcondi="";var fieldList=opts.fieldList.split(";");var typeList=opts.typeList.split(";");var tableList=opts.tableList.split(";");for(var i=0;i<fieldList.length;i++){sqlcondi+="(";var fieldType=typeList[i];if(fieldType=="13"||fieldType=="14"||fieldType=="15"||fieldType=="4"||fieldType=="31"||fieldType=="12"||fieldType=="11"||fieldType=="10"){if(opts.checkNum(inputText)){sqlcondi+=tableList[i]+"."+fieldList[i]+" = "+inputText}else{sqlcondi+=" 0=1 "}}else{sqlcondi+=tableList[i]+"."+fieldList[i]+" like '%"+inputText+"%'"}sqlcondi+=")";if(i<fieldList.length-1)sqlcondi+=" or "}opts.srcDataTable.isLoadHistoryData=false;opts.srcDataTable.theSQLCondi=sqlcondi;opts.srcDataTable.getData()}};UCML.MSearch.prototype.checkNum=function(str){var letter;if(str.indexOf(".")!=-1){if(str.charAt[0]=="."||str.charAt[str.length-1]==".")return false;var temp=str.replace(".","");if(temp.indexOf(".")!=-1)return false;letter="1234567890."}else{if(str.charAt[0]=="0")return false;letter="1234567890"}for(var i=0;i<str.length;i++){var c=str.charAt(i);if(letter.indexOf(c)==-1){return false}}return true};UCML.reg("UCML.MSearch",UCML.MSearch);
UCML.TreeList=function(id){this.navbarEl;this.searchObj;this.selectedListEl;this.checkOID=[];this.items={};UCML.TreeList.superclass.constructor.call(this,id)};UCML.extend(UCML.TreeList,UCML.Applet,{ctype:"UCML.TreeList",rootId:"00000000-0000-0000-0000-000000000000",hasSearch:true,checkMode:0,hasSelectedList:true,getRootId:function(){var keyFiledType=this.dataTable.getColumn(this.dataTable.PrimaryKey).fieldType;var ParentOID;if(keyFiledType=="UCMLKey"||keyFiledType=="Guid")ParentOID=this.dataTable.getEmptyGuid();else ParentOID="0";return ParentOID},setProperties:function(){UCML.TreeList.superclass.setProperties.call(this);this.rootId=this.getRootId();this.checkMode=this.getAttribute("checkMode")||this.checkMode;this.searchObj=new UCML.MSearch({srcDataTable:this.dataTable,searchField:this.TextFieldName});this.selectedListEl=$('<div id="selectedList" class="man-list fman-list"></div>');this.navbarEl=$('<div id="UNavbar"></div>');this.content=$('<div id="content_container"></div>')}});UCML.TreeList.prototype.bindEvents=function(){UCML.TreeList.superclass.bindEvents.call(this);if(this.dataTable){this.dataTable.on("onLoad",this.loadData,this)}var opts=this;this.el.on("click","#content_container a",function(){if(!UCML.isEmpty($(this).attr("cid"))){var cid=$(this).attr("cid");var pul=$(this).parents("ul[data-role='listview']");opts.doExpand(cid,$(this),pul)}});this.el.on("click","#content_container li.hasCheck",function(){var chkOuter=$(this).find(".ui-checkbox");var chkEl=chkOuter.children("input");var oid=chkEl.attr("oid");if(opts.checkMode==0){if(chkOuter.hasClass("ui-checkbox-checked")){chkOuter.removeClass("ui-checkbox-checked");var selectedItem=opts.selectedListEl.find('a[sid="'+oid+'"]');if(selectedItem.length>0){selectedItem.remove()}chkEl.removeAttr("checked");opts.checkOID.remove(oid)}else{chkOuter.addClass("ui-checkbox-checked");var text=$(this).text();var str='<a class="selectedItem man-item" sid="'+oid+'"><span>'+text+"</span></a>";opts.selectedListEl.append(str);chkEl.attr("checked","checked");opts.checkOID.add(oid)}}else if(opts.checkMode==1){if(!chkOuter.hasClass("ui-checkbox-checked")){var checkedItem=opts.el.find(".ui-checkbox.ui-checkbox-checked");if(checkedItem.length>0){checkedItem.removeClass("ui-checkbox-checked");checkedItem.children("input").removeAttr("checked")}chkOuter.addClass("ui-checkbox-checked");chkEl.attr("checked","checked");opts.checkOID=[];opts.checkOID.add(oid)}}});this.el.on("click","#selectedList .selectedItem",function(){var oid=$(this).attr("sid");var chkEl=opts.content.find("input[oid='"+oid+"']");chkEl.removeAttr("checked");chkEl.parent().removeClass("ui-checkbox-checked");opts.checkOID.remove(oid);$(this).remove()})};UCML.TreeList.prototype.init=function(){UCML.TreeList.superclass.init.call(this);if(this.hasSearch){this.navbarEl.append(this.searchObj.el)}if(this.hasSelectedList){this.navbarEl.append(this.selectedListEl)}this.el.append(this.navbarEl);this.el.append(this.content)};UCML.TreeList.prototype.setItem=function(child){var childInfo=child||eval(this.dataTable.BCName+"_ChildInfo");for(var i=0;i<childInfo.length;i++){this.items[childInfo[i]]={};this.items[childInfo[i]].haveChild=true;this.items[childInfo[i]].childs=[]}};UCML.TreeList.prototype.loadData=function(data){this.setItem();this.el.find("#content_container").html("").append(this.renderList(this.rootId,false,0)).trigger("create")};UCML.TreeList.prototype.setSubTreeData=function(OID){this.items[OID].loaded=true;var text=this.BusinessObject.getTreeGridSubData(this.dataTable.BCName,this.ParentFieldName,OID,"",null,null,0,-1,this);var oldIndex=this.dataTable.recordIndex;var index=this.dataTable.getRecordCount();var datas=eval(text)||{};for(var i=0;i<datas.length;i++){var bcValue=datas[i].data;var strBCBase=datas[i].BCName+"Base";var bcBase=eval(strBCBase);for(var j=0;j<bcValue.length;j++){var bcD=bcValue[j];bcBase.addRecord(bcD)}this.items[OID]["haveChilds"]=datas[i].haveChilds;this.setItem(datas[i].haveChilds)}};UCML.TreeList.prototype.doExpand=function(OID,el,pul){if(!this.items[OID].loaded){this.setSubTreeData(OID);if(UCML.isEmpty(el.attr("loaded"))){var listview="";if(pul.length>0)listview=this.renderList(OID,false,parseInt(pul.eq(0).attr("data-level"))+1);else listview=this.renderList(OID,false);el.after(listview);el.attr("loaded","true");el.addClass("expanded");el.parent().trigger("create")}else{if(el.hasClass("expanded")){el.addClass("collapsed").removeClass("expanded");el.next().hide()}else{el.addClass("expanded").removeClass("collapsed");el.next().show()}}}else{if(el.hasClass("expanded")){el.addClass("collapsed").removeClass("expanded");el.next().hide()}else{el.addClass("expanded").removeClass("collapsed");el.next().show()}}};UCML.TreeList.prototype.renderList=function(parentID,hasBack,level){var pid=parentID||this.rootId;var str='<ul data-role="listview" data-inset="true" style="text-indent:'+level*2+'em" data-level="'+level+'">';if(hasBack){str+='<li data-icon="back" class="pageback"><a href="#" data-rel="back">返回上一级</a></li>'}var recordCount=this.dataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.dataTable.SetIndexNoEvent(i);if(this.dataTable.getFieldValue(this.ParentFieldName)==pid){var cid=this.dataTable.getOID();var hasChild=this.hasChild(cid,i);if(hasChild){str+='<li><a cid="'+cid+'"><span>'+this.dataTable.getFieldValue(this.TextFieldName)+"</span></a></li>"}else{str+='<li class="hasCheck"><div class="ui-checkbox"><input type="checkbox" oid="'+cid+'" name="checkbox_'+this.id+'" data-role="none" /></div><span>'+this.dataTable.getFieldValue(this.TextFieldName)+"</span></li>"}}}str+="</ul>";return str};UCML.TreeList.prototype.hasChild=function(cid,recIndex){var haveChild=false;if(this.items[cid]!=undefined&&this.items[cid].haveChild){haveChild=true}return haveChild};UCML.TreeList.prototype.getCheckOID=function(){return this.checkOID};UCML.FilterCategory=function(id){this.items={};this.addEvents("categoryclick");UCML.FilterCategory.superclass.constructor.call(this,id)};UCML.extend(UCML.FilterCategory,UCML.Applet,{ctype:"UCML.FilterCategory",onRender:function(){UCML.FilterCategory.superclass.onRender.call(this);this.el.addClass("category-nav-bar");this.el.css("overflow","visible")},open:function(){UCML.FilterCategory.superclass.open.call(this)},setProperties:function(){UCML.FilterCategory.superclass.setProperties.call(this);this.navbar=$('<ul class="category-nav"></ul>');this.dropdown=$('<div class="dropdown-wrapper"><div class="scroller-wrapper"><div id="dropdown_scroller" class="dropdown-scroller"><ul></ul></div><div id="dropdown_sub_scroller" class="dropdown-sub-scroller"><ul></ul></div></div></div>');this.el.append(this.navbar).append(this.dropdown)},bindEvents:function(){UCML.FilterCategory.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.dataTable)){this.dataTable.on("onLoad",this.loadData,this)}var opts=this;this.navbar.on("click","li",function(e){var data_nav=$(this).attr("data-nav-id");if($(this).hasClass("active")){$(this).removeClass("active")}else{opts.navbar.find("li").removeClass("active");$(this).addClass("active")}if(opts.items[data_nav]==undefined){opts.dropdown.hide();if(opts.dataTable)opts.dataTable.LocateOID(data_nav);opts.fireEvent("categoryclick",$(this),data_nav,opts);return}else{opts.setDropDown(data_nav);opts.setDropdownSize(false)}});this.dropdown.on("click","li[data-category-id]",function(e){opts.dropdown.find("li[data-category-id]").removeClass("active");$(this).addClass("active");var oid=$(this).attr("data-category-id");if(opts.dataTable)opts.dataTable.LocateOID(oid);if($(this).attr("data-haschild")=="true"){opts.setSubDropdown(oid)}else{if(!($(this).attr("data-ischild")=="true")){opts.setDropdownSize(false)}opts.fireEvent("categoryclick",$(this),oid,opts)}})}});UCML.FilterCategory.prototype.loadData=function(data){this.setItem();this.navbar.html("").append(this.renderNavbarItem());this.dropdown.find("#dropdown_scroller>ul").html("");this.dropdown.find("#dropdown_sub_scroller>ul").html("")};UCML.FilterCategory.prototype.renderNavbarItem=function(){var navbarStr="";var recordCount=this.dataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.dataTable.SetIndexNoEvent(i);navbarStr+='<li class="dropdown-toggle caret" data-nav-id="'+this.dataTable.getOID()+'"><span class="nav-head-name">'+this.dataTable.getFieldValue(this.TextFieldName)+"</span></li>"}this.dataTable.SetIndexNoEvent(0);return navbarStr};UCML.FilterCategory.prototype.setDropDown=function(oid){if(this.dropdown.find("li.nav-item.active[nav-item-id='"+oid+"']").length>0){this.dropdown.toggle();return}this.dropdown.show();if(!this.items[oid].loaded){this.setSubTreeData(oid);var dropdownStr='<li class="nav-item active" nav-item-id="'+oid+'"><ul class="dropdown-list">';var recordCount=this.dataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.dataTable.SetIndexNoEvent(i);if(this.dataTable.getFieldValue(this.ParentFieldName)==oid){var hasChild=this.hasChild(this.dataTable.getOID());dropdownStr+='<li data-type="'+oid+'" data-haschild="'+(hasChild?"true":"false")+'" class="right-arrow-point-right" data-category-id="'+this.dataTable.getOID()+'"><span>';dropdownStr+=this.dataTable.getFieldValue(this.TextFieldName);dropdownStr+="</span>";if(hasChild){dropdownStr+='<span class="quantity"><b></b></span>'}dropdownStr+="</li>"}}this.dataTable.SetIndexNoEvent(0);dropdownStr+="</ul></li>";this.dropdown.find("#dropdown_scroller>ul>li.active").removeClass("active");this.dropdown.find("#dropdown_scroller>ul").append(dropdownStr)}else{this.dropdown.find("li.nav-item.active").removeClass("active");this.dropdown.find("li.nav-item[nav-item-id='"+oid+"']").addClass("active")}};UCML.FilterCategory.prototype.setItem=function(child){var childInfo=child||eval(this.dataTable.BCName+"_ChildInfo");for(var i=0;i<childInfo.length;i++){this.items[childInfo[i]]={};this.items[childInfo[i]].haveChild=true;this.items[childInfo[i]].childs=[]}};UCML.FilterCategory.prototype.setSubTreeData=function(OID){this.items[OID].loaded=true;var text=this.BusinessObject.getTreeGridSubData(this.dataTable.BCName,this.ParentFieldName,OID,"",null,null,0,-1,this);var oldIndex=this.dataTable.recordIndex;var index=this.dataTable.getRecordCount();var datas=eval(text)||{};for(var i=0;i<datas.length;i++){var bcValue=datas[i].data;var strBCBase=datas[i].BCName+"Base";var bcBase=eval(strBCBase);for(var j=0;j<bcValue.length;j++){var bcD=bcValue[j];bcBase.addRecord(bcD)}this.items[OID]["haveChilds"]=datas[i].haveChilds;this.setItem(datas[i].haveChilds)}};UCML.FilterCategory.prototype.hasChild=function(cid){var haveChild=false;if(this.items[cid]!=undefined&&this.items[cid].haveChild){haveChild=true}return haveChild};UCML.FilterCategory.prototype.setSubDropdown=function(oid){if(!this.items[oid].loaded){this.setSubTreeData(oid);var sub_dropdownStr='<li class="sub-nav-item active" sub-nav-item-id="'+oid+'"><ul class="dropdown-list">';var recordCount=this.dataTable.getRecordCount();for(var i=0;i<recordCount;i++){this.dataTable.SetIndexNoEvent(i);if(this.dataTable.getFieldValue(this.ParentFieldName)==oid){sub_dropdownStr+='<li data-type="'+oid+'" data-ischild="true" class="right-arrow-point-right" data-category-id="'+this.dataTable.getOID()+'"><span>';sub_dropdownStr+=this.dataTable.getFieldValue(this.TextFieldName);sub_dropdownStr+="</span>";sub_dropdownStr+="</li>"}}this.dataTable.SetIndexNoEvent(0);sub_dropdownStr+="</ul>";this.dropdown.find("#dropdown_sub_scroller>ul>li.active").removeClass("active");this.dropdown.find("#dropdown_sub_scroller>ul").append(sub_dropdownStr);this.setDropdownSize(true)}else{this.dropdown.find("li.sub-nav-item.active").removeClass("active");this.dropdown.find("li.sub-nav-item[sub-nav-item-id='"+oid+"']").addClass("active");this.setDropdownSize(true)}};UCML.FilterCategory.prototype.setDropdownSize=function(flag){if(flag){var dHeight=this.dropdown.find("#dropdown_scroller>ul").outerHeight(true);var cHeight=this.dropdown.find("#dropdown_sub_scroller>ul").outerHeight(true);var height=dHeight>cHeight?dHeight>400?400:dHeight:cHeight>400?400:cHeight;this.dropdown.find("#dropdown_scroller").css({height:height+"px",overflow:"auto",width:"160px"});this.dropdown.find("#dropdown_sub_scroller").css({height:height+"px",overflow:"auto",left:"160px"})}else{this.dropdown.find("#dropdown_scroller").css({height:"auto",overflow:"auto",width:"100%"});this.dropdown.find("#dropdown_sub_scroller").css({height:"auto",overflow:"auto",left:"100%"})}};UCML.Slides=function(id){this.imgList=[];this.srcDataTable;this.imgField;this.addEvents("slidesClick");UCML.Slides.superclass.constructor.call(this,id)};UCML.extend(UCML.Slides,UCML.Input,{ctype:"UCML.Slides",width:500,height:300,interval:2e3,active:false,auto:true,srcBCName:null,setProperties:function(){UCML.Slides.superclass.setProperties.call(this);this.width=this.el.attr("imgWidth")||this.width;this.height=this.el.attr("imgHeight")||this.height;this.interval=this.el.attr("interval")||this.interval;this.auto=this.el.attr("auto")||this.auto;this.active=this.el.attr("active")=="true"?true:this.active;if(this.el.attr("imgList")){this.imgList=this.el.attr("imgList").split(";")}this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("BCName"))||this.dataTable||undefined;this.imgField=this.el.attr("dataFld")||this.imgField},setValue:function(){UCML.Slides.superclass.setValue.call(this)},bindEvents:function(){UCML.Slides.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.imgField)){this.srcDataTable.on("onLoad",this.bindData,this)}else{this.renderImgList()}var opts=this;$(document).on("click","#"+this.id,function(e){if(e.target.nodeName.toLowerCase()=="img"){var el=$(e.target);var sender={};sender.ctl=opts;sender.el=el;sender.oid=el.attr("oid");if(!UCML.isEmpty(opts.srcDataTable))opts.srcDataTable.LocateOID(sender.oid);opts.fireEvent("slidesClick",sender)}})}});UCML.Slides.prototype.getSysImgSrc=function(){var imgURL="File/Images/"+this.srcDataTable.TableName+"_"+this.imgField+"/"+UCML.UserInfo.getUserOID()+"/"+this.srcDataTable.getOID()+this.srcDataTable.getFieldValue(this.imgField);return imgURL};UCML.Slides.prototype.bindData=function(){var recordCount=this.srcDataTable.getRecordCount();if(recordCount>0){this.imgList=[];for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var imgUrl=this.srcDataTable.getFieldValue(this.imgField);if(imgUrl==".jpg"||imgUrl==".png"||imgUrl==".gif")imgUrl=this.getSysImgSrc();if(this.getImgSrc)imgUrl=this.getImgSrc();var obj={};obj.url=imgUrl;obj.oid=this.srcDataTable.getOID();this.imgList.add(obj)}this.srcDataTable.SetIndexNoEvent(0);this.renderImgList()}};UCML.Slides.prototype.formatUrl=function(url){if(url.indexOf("http://")>-1||url.indexOf("https://")>-1){return url}else{url=UCMLLocalResourcePath+url;return url}};UCML.Slides.prototype.renderImgList=function(){if(this.imgList.length>0){var imgStr="";for(var i=0;i<this.imgList.length;i++){if(typeof this.imgList[i]=="object"){imgStr+='<img src="'+this.formatUrl(this.imgList[i].url)+'" oid="'+this.imgList[i].oid+'"/>'}else{imgStr+='<img src="'+this.formatUrl(this.imgList[i])+'"/>'}}this.el.append(imgStr);if(this.imgList.length<2){this.auto=false}this.el.slidesjs({play:{active:false,auto:this.auto,interval:this.interval,effect:"slide",swap:false},navigation:{active:false},width:this.width,height:this.height});if(this.imgList.length<2){this.el.find("img").css("left","0")}}};UCML.reg("UCML.Slides",UCML.Slides);UCML.ComplexMenu=function(id){this.menuUrl;this.menuLink;this.menuText;this.menuDivide;this.menuDivideList=[];this.addEvents("complexMenuClick");UCML.ComplexMenu.superclass.constructor.call(this,id)};UCML.extend(UCML.ComplexMenu,UCML.Input,{ctype:"UCML.ComplexMenu",cols:4,onRender:function(){UCML.ComplexMenu.superclass.onRender.call(this);this.el.addClass("nav-carousel-box")},setProperties:function(){UCML.ComplexMenu.superclass.setProperties.call(this);this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("BCName"))||this.dataTable||undefined;this.menuUrl=this.el.attr("menuUrlField")||"";this.menuLink=this.el.attr("menuLinkField")||"";this.menuText=this.el.attr("menuTextField")||"";this.menuDivide=this.el.attr("menuTypeField")||undefined;this.cols=parseInt(this.el.attr("cols"))||this.cols},bindEvents:function(){UCML.ComplexMenu.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.srcDataTable)){this.srcDataTable.on("onLoad",this.bindData,this)}var opts=this;$(document).on("click","#"+this.id,function(e){if(e.target.nodeName.toLowerCase()=="img"){var sender={};sender.ctl=opts;sender.el=el;sender.oid=$(e.target).attr("oid");if(!UCML.isEmpty(opts.srcDataTable))opts.srcDataTable.LocateOID(sender.oid);opts.fireEvent("complexMenuClick",sender)}})}});UCML.ComplexMenu.prototype.getSysImgSrc=function(){var imgURL="File/Images/"+this.srcDataTable.TableName+"_"+this.menuUrl+"/"+UCML.UserInfo.getUserOID()+"/"+this.srcDataTable.getOID()+this.srcDataTable.getFieldValue(this.menuUrl);return imgURL};UCML.ComplexMenu.prototype.bindData=function(data){var recordCount=this.srcDataTable.getRecordCount();if(recordCount>0){this.getMenuDivideList();var menuStr="";if(this.menuDivideList.length>0){var menuTypeLength=this.menuDivideList.length;for(var m=0;m<menuTypeLength;m++){menuStr+='<ul class="slide_ul_header"><li>'+this.menuDivideList[m].text+"</li></ul>";menuStr+='<ul class="slide_ul"><li>';for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);if(this.menuDivideList[m].value==this.srcDataTable.getFieldValue(this.menuDivide)){var imgsrc=this.srcDataTable.getFieldValue(this.menuUrl);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();if(imgsrc=="")imgsrc="Images/WeiXin/wx_default.jpg";menuStr+='<a href="javascript:void(0)" >'+'<img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/>'+"<span>"+this.srcDataTable.getFieldValue(this.menuText)+"</span>"+"</a>"}}this.srcDataTable.SetIndexNoEvent(0);menuStr+="</li></ul>"}}else{menuStr+='<ul class="slide_ul"><li>';for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var imgsrc=this.srcDataTable.getFieldValue(this.menuUrl);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();if(imgsrc=="")imgsrc="Images/WeiXin/wx_default.jpg";menuStr+='<a href="javascript:void(0)" >'+'<img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/>'+"<span>"+this.srcDataTable.getFieldValue(this.menuText)+"</span>"+"</a>"}this.srcDataTable.SetIndexNoEvent(0);menuStr+="</li></ul>"}this.el.html("");this.el.append(menuStr);var ratioWidth=100/this.cols+"%";this.el.find("ul.slide_ul").find("a").css({width:ratioWidth})}};UCML.ComplexMenu.prototype.formatUrl=function(url){if(url.indexOf("http://")>-1||url.indexOf("https://")>-1){return url}else{url=UCMLLocalResourcePath+url;return url}};UCML.ComplexMenu.prototype.getMenuDivideList=function(){if(this.menuDivide){var col=this.srcDataTable.getColumn(this.menuDivide);var recordCount=this.srcDataTable.getRecordCount();var menuTextArr=[];for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var text="";if(col.isCodeTable&&col.codeTable){text=BusinessObject.GetCodeCaption(col.codeTable,this.srcDataTable.getFieldValue(this.menuDivide))}else{text=this.srcDataTable.getFieldValue(this.menuDivide)}if(menuTextArr.indexOf(text)==-1){menuTextArr.add(text);this.menuDivideList.add({value:this.srcDataTable.getFieldValue(this.menuDivide),text:text})}}this.srcDataTable.SetIndexNoEvent(0)}};UCML.reg("UCML.ComplexMenu",UCML.ComplexMenu);UCML.MImageList=function(id){this.imgSrcField;this.descField;this.contentField;this.priceField;this.addEvents("imageListClick");this.hasMore=false;this.hasSameHeight=false;this.sameHeight=null;UCML.MImageList.superclass.constructor.call(this,id)};UCML.extend(UCML.MImageList,UCML.Input,{ctype:"UCML.MImageList",cols:3,setValue:function(val,trigger){UCML.MImageList.superclass.setValue.call(this)},onRender:function(){UCML.MImageList.superclass.onRender.call(this);this.el.addClass("nav-imagelist-box")},init:function(){UCML.MImageList.superclass.init.call(this);if(this.hasMore){this.el.after(this.clickLoadMore)}},setProperties:function(){UCML.MImageList.superclass.setProperties.call(this);this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("BCName"))||this.dataTable||undefined;this.imgSrcField=this.el.attr("imgSrcField")||this.imgSrc;this.descField=this.el.attr("descField")||this.descField;this.contentField=this.el.attr("contentField")||this.contentField;this.priceField=this.el.attr("priceField")||this.priceField;this.cols=parseInt(this.el.attr("cols"))||this.cols;this.imgList=this.el.attr("imgList")||"";this.imgDescList=this.el.attr("imgDescList")||"";this.listviewEl=$('<ul class="imglist_ul"></ul>');this.hasMore=this.getAttribute("hasMore")=="true"?true:this.hasMore;this.clickLoadMore=$('<div class="click-load-more"><a href="javascript:void(0);">+点击加载更多</a></div>');this.hasSameHeight=this.getAttribute("hasSameHeight")=="true"?true:this.hasSameHeight;this.sameHeight=parseInt(this.getAttribute("sameHeight"))||null},bindEvents:function(){UCML.MImageList.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.imgSrcField)){this.srcDataTable.isLoadHistoryData=true;this.srcDataTable.on("onLoad",this.bindData,this);this.srcDataTable.on("beforeGetData",this.clearData,this)}else{this.bindCustomData()}var opts=this;$(document).on("click","#"+this.id,function(e){var el=$(e.target);if(e.target.nodeName.toLowerCase()=="img"){var sender={};sender.ctl=opts;sender.el=el;sender.oid=el.attr("oid");if(!UCML.isEmpty(opts.srcDataTable))opts.srcDataTable.LocateOID(sender.oid);opts.fireEvent("imageListClick",sender)}});this.clickLoadMore.on("click",function(e){opts.reserveData=true;opts.srcDataTable.LoadMoreData();opts.reserveData=false})}});UCML.MImageList.prototype.clearData=function(){if(!this.reserveData){this.srcDataTable.ClearData()}};UCML.MImageList.prototype.getSysImgSrc=function(){var imgURL="File/Images/"+this.srcDataTable.TableName+"_"+this.imgSrcField+"/"+UCML.UserInfo.getUserOID()+"/"+this.srcDataTable.getOID()+this.srcDataTable.getFieldValue(this.imgSrcField);return imgURL};UCML.MImageList.prototype.formatUrl=function(url){if(url.indexOf("http://")>-1||url.indexOf("https://")>-1){return url}else{url=UCMLLocalResourcePath+url;return url}};UCML.MImageList.prototype.bindCustomData=function(){var imgStr="";var imgArr=this.imgList.split(";");var imgDescArr=[];if(!UCML.isEmpty(this.imgDescList))imgDescArr=this.imgDescList.split(";");for(var i=0;i<imgArr.length;i++){imgStr+='<li><a href="javascript:void(0)">'+'<img alt oid src="'+this.formatUrl(imgArr[i])+'"/>'+(!UCML.isEmpty(imgDescArr[i])?'<span class="img-tip">'+imgDescArr[i]+"</span>":"")+"</a></li>"}this.listviewEl.html("").append(imgStr);this.el.append(this.listviewEl);var ratioWidth=100/this.cols+"%";this.el.find("ul.imglist_ul").find("li").css({width:ratioWidth})};UCML.MImageList.prototype.bindData=function(data){var recordCount=this.srcDataTable.getRecordCount();var imgStr="";for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var imgsrc=this.srcDataTable.getFieldValue(this.imgSrcField);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();imgStr+='<li><a href="javascript:void(0)">';imgStr+='<div class="pro-img-box"><img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/>';if(this.getCustomDesc){imgStr+='<span class="img-tip">'+this.getCustomDesc()+"</span>"}else{imgStr+=!UCML.isEmpty(this.descField)&&!UCML.isEmpty(this.srcDataTable.getFieldValue(this.descField))?'<span class="img-tip">'+this.srcDataTable.getFieldValue(this.descField)+"</span>":""}imgStr+="</div>";if(this.contentField){var content="";if(this.getCustomContent){content=this.getCustomContent();imgStr+='<p class="pro-box">'+content+"</p>"}else{content=this.srcDataTable.getFieldValue(this.contentField);imgStr+='<p class="pro-box"><span>'+content+"</span></p>"}}if(this.priceField){var price="0";if(this.getCustomPrice){price=this.getCustomPrice();imgStr+='<div class="pro-price">'+price+"</div>"}else{price=this.srcDataTable.getFieldValue(this.priceField);imgStr+='<div class="pro-price"><span><em>￥'+price+"</em></span></div>"}}imgStr+="</a></li>"}this.listviewEl.html("").append(imgStr);this.el.append(this.listviewEl);var ratioWidth=100/this.cols+"%";this.el.find("ul.imglist_ul").find("li").css({width:ratioWidth});if(this.hasSameHeight){var height=this.sameHeight!=null&&!UCML.isEmpty(this.sameHeight)?this.sameHeight:this.el.find("img[oid]:first").height();this.el.find("img[oid]").height(height)}};UCML.reg("UCML.MImageList",UCML.MImageList);UCML.MImageCheckList=function(id){this.type="check";this.align="vertical";this.checkOID=[];UCML.MImageCheckList.superclass.constructor.call(this,id)};UCML.extend(UCML.MImageCheckList,UCML.MImageList,{ctype:"UCML.MImageCheckList",setProperties:function(){UCML.MImageCheckList.superclass.setProperties.call(this);this.type=this.getAttribute("type")||this.type;this.align=this.getAttribute("align")||this.align},onRender:function(){UCML.MImageList.superclass.onRender.call(this)},bindEvents:function(){UCML.MImageCheckList.superclass.bindEvents.call(this);var opts=this;this.el.on("click",".imgcheck_item",function(e){var el=$(this);var oid=el.attr("itemoid");if(opts.srcDataTable)opts.srcDataTable.LocateOID(oid);var thisEl=$(e.target);if(e.target.nodeName.toLowerCase()!="input"){var chkEl=el.find("input");if(chkEl.attr("type")=="checkbox"){if(chkEl.attr("checked")=="checked"){chkEl.removeAttr("checked");opts.checkOID.remove(oid)}else{chkEl.attr("checked","checked");opts.checkOID.remove(oid);opts.checkOID.add(oid)}}else{if(chkEl.attr("checked")=="checked"){}else{chkEl.attr("checked","checked")}}}else{if(thisEl.attr("type")=="checkbox"){if(thisEl.attr("checked")=="checked"){opts.checkOID.remove(oid);opts.checkOID.add(oid)}else{opts.checkOID.remove(oid)}}}})}});UCML.MImageCheckList.prototype.getCheckOID=function(){return this.checkOID};UCML.MImageCheckList.prototype.bindData=function(data){var recordCount=this.srcDataTable.getRecordCount();var imgStr='<div class="imgcheck_list">';for(var i=0;i<recordCount;i++){this.srcDataTable.SetIndexNoEvent(i);var imgsrc=this.srcDataTable.getFieldValue(this.imgSrcField);if(imgsrc==".jpg"||imgsrc==".png"||imgsrc==".gif")imgsrc=this.getSysImgSrc();if(this.getImgSrc)imgsrc=this.getImgSrc();var checkname=this.id+"_check";imgStr+='<div class="imgcheck_item" itemoid="'+this.srcDataTable.getOID()+'">';if(this.align=="vertical"){if(this.type=="check"){imgStr+='<div class="imgcheck_item_cell imgcheck_item_input"><input type="checkbox" name="'+checkname+'"></div>';imgStr+='<div class="imgcheck_item_cell imgcheck_item_img"><img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/></div>';imgStr+='<div class="imgcheck_item_cell imgcheck_item_span"><span>'+this.srcDataTable.getFieldValue(this.descField)+"</span></div>"}else if(this.type=="radio"){imgStr+='<div class="imgcheck_item_cell imgcheck_item_input"><input type="radio" name="'+checkname+'"></div>';imgStr+='<div class="imgcheck_item_cell imgcheck_item_img"><img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/></div>';imgStr+='<div class="imgcheck_item_cell imgcheck_item_span"><span>'+this.srcDataTable.getFieldValue(this.descField)+"</span></div>"}}else{if(this.type=="check"){imgStr+='<div class="imgcheck_item_img_outer"><img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/></div>';imgStr+='<div class="imgcheck_item_text_outer"><input type="checkbox" name="'+checkname+'">';imgStr+="<span>"+this.srcDataTable.getFieldValue(this.descField)+"</span></div>"}else if(this.type=="radio"){imgStr+='<div><img alt oid="'+this.srcDataTable.getOID()+'" src="'+this.formatUrl(imgsrc)+'"/></div>';imgStr+='<div><input type="radio" name="'+checkname+'">';imgStr+="<span>"+this.srcDataTable.getFieldValue(this.descField)+"</span></div>"}}imgStr+="</div>"}imgStr+="</div>";this.el.append(imgStr);var ratioWidth=100/this.cols+"%";var css={width:ratioWidth};if(this.align=="vertical"){css["display"]="table"}this.el.find("div.imgcheck_list").find("div.imgcheck_item").css(css);if(this.hasSameHeight){var height=this.sameHeight!=null&&!UCML.isEmpty(this.sameHeight)?this.sameHeight:this.el.find("img[oid]:first").height();this.el.find("img[oid]").height(height)}};UCML.reg("UCML.MImageCheckList",UCML.MImageCheckList);UCML.VideoPlayHTML5=function(id){this.srcDataTable;UCML.VideoPlayHTML5.superclass.constructor.call(this,id)};UCML.extend(UCML.VideoPlayHTML5,UCML.Input,{ctype:"UCML.VideoPlayHTML5",autoPlay:false,controls:true,playerWidth:320,playerHeight:240,setValue:function(val,trigger){UCML.VideoPlayHTML5.superclass.setValue.call(this)},onRender:function(){UCML.VideoPlayHTML5.superclass.onRender.call(this)},setProperties:function(){UCML.VideoPlayHTML5.superclass.setProperties.call(this);this.srcDataTable=BusinessObject.getDataTableByBCName(this.getAttribute("BCName"))||this.dataTable||undefined;this.videoHref=this.getAttribute("videoLinkField")||this.videoHref||"";this.videoTitle=this.getAttribute("videoTitleField")||this.videoTitle||"";this.customVideoHref=this.getAttribute("customVideoHref")||this.customVideoHref||"";this.customVideoTitle=this.getAttribute("customVideoTitle")||this.customVideoTitle||"";this.autoPlay=this.getAttribute("autoPlay")=="true"?true:this.autoPlay;this.controls=this.getAttribute("controls")=="false"?false:this.controls;this.playerWidth=this.getAttribute("playerWidth")||this.playerWidth;this.playerHeight=this.getAttribute("playerHeight")||this.playerHeight;this.titleEl=$("<p></p>");this.videoEl=$("<video>您的浏览器不支持HTML5！</video>")},bindEvents:function(){UCML.VideoPlayHTML5.superclass.bindEvents.call(this);if(!UCML.isEmpty(this.srcDataTable)&&!UCML.isEmpty(this.videoHref)){this.srcDataTable.on("onLoad",this.bindData,this)}else{this.bindCustomData()}}});UCML.VideoPlayHTML5.prototype.bindData=function(data){var title=this.srcDataTable.getFieldValue(this.videoTitle);if(!UCML.isEmpty(title)){this.titleEl.text(title);this.el.append(this.titleEl)}var linkHref=this.srcDataTable.getFieldValue(this.videoHref);if(!UCML.isEmpty(linkHref)){this.videoEl.attr("src",this.formatUrl(linkHref));this.videoEl.attr("width",this.playerWidth+"px");this.videoEl.attr("height",this.playerHeight+"px");if(this.autoPlay)this.videoEl.attr("autoplay","autoplay");if(this.controls)this.videoEl.attr("controls","controls")}else{this.videoEl.text("视频地址为空！")}this.el.append(this.videoEl)};UCML.VideoPlayHTML5.prototype.bindCustomData=function(){if(!UCML.isEmpty(this.customVideoTitle)){this.titleEl.text(this.customVideoTitle);this.el.append(this.titleEl)}var linkHref=this.customVideoHref;if(!UCML.isEmpty(linkHref)){this.videoEl.attr("src",this.formatUrl(linkHref));this.videoEl.attr("width",this.playerWidth+"px");this.videoEl.attr("height",this.playerHeight+"px");if(this.autoPlay)this.videoEl.attr("autoplay","autoplay");if(this.controls)this.videoEl.attr("controls","controls")}else{this.videoEl.text("视频地址为空！")}this.el.append(this.videoEl)};UCML.VideoPlayHTML5.prototype.formatUrl=function(url){if(url.indexOf("http://")>-1||url.indexOf("https://")>-1){return url}else{url=UCMLLocalResourcePath+url;return url}};UCML.reg("UCML.VideoPlayHTML5",UCML.VideoPlayHTML5);
